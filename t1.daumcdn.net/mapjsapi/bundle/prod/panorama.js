!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=130)}([function(e,t,n){var r=n(1),i=n(7),a=n(14),o=n(11),s=n(17),u=function(e,t,n){var l,c,f,h,p=e&u.F,d=e&u.G,v=e&u.S,y=e&u.P,m=e&u.B,g=d?r:v?r[t]||(r[t]={}):(r[t]||{}).prototype,b=d?i:i[t]||(i[t]={}),w=b.prototype||(b.prototype={});for(l in d&&(n=t),n)f=((c=!p&&g&&void 0!==g[l])?g:n)[l],h=m&&c?s(f,r):y&&"function"==typeof f?s(Function.call,f):f,g&&o(g,l,f,e&u.U),b[l]!=f&&a(b,l,h),y&&w[l]!=f&&(w[l]=f)};r.core=i,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r=n(4);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(48)("wks"),i=n(29),a=n(1).Symbol,o="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=r},function(e,t,n){var r=n(19),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t){var n=e.exports={version:"2.6.9"};"number"==typeof __e&&(__e=n)},function(e,t,n){e.exports=!n(2)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(3),i=n(90),a=n(26),o=Object.defineProperty;t.f=n(8)?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(24);e.exports=function(e){return Object(r(e))}},function(e,t,n){var r=n(1),i=n(14),a=n(13),o=n(29)("src"),s=n(135),u=(""+s).split("toString");n(7).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,n,s){var l="function"==typeof n;l&&(a(n,"name")||i(n,"name",t)),e[t]!==n&&(l&&(a(n,o)||i(n,o,e[t]?""+e[t]:u.join(String(t)))),e===r?e[t]=n:s?e[t]?e[t]=n:i(e,t,n):(delete e[t],i(e,t,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[o]||s.call(this)})},function(e,t,n){var r=n(0),i=n(2),a=n(24),o=/"/g,s=function(e,t,n,r){var i=String(a(e)),s="<"+t;return""!==n&&(s+=" "+n+'="'+String(r).replace(o,"&quot;")+'"'),s+">"+i+"</"+t+">"};e.exports=function(e,t){var n={};n[e]=t(s),r(r.P+r.F*i(function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}),"String",n)}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(9),i=n(28);e.exports=n(8)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(44),i=n(24);e.exports=function(e){return r(i(e))}},function(e,t,n){"use strict";var r=n(2);e.exports=function(e,t){return!!e&&r(function(){t?e.call(null,function(){},1):e.call(null)})}},function(e,t,n){var r=n(18);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(45),i=n(28),a=n(15),o=n(26),s=n(13),u=n(90),l=Object.getOwnPropertyDescriptor;t.f=n(8)?l:function(e,t){if(e=a(e),t=o(t,!0),u)try{return l(e,t)}catch(e){}if(s(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t,n){var r=n(0),i=n(7),a=n(2);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*a(function(){n(1)}),"Object",o)}},function(e,t,n){var r=n(17),i=n(44),a=n(10),o=n(6),s=n(106);e.exports=function(e,t){var n=1==e,u=2==e,l=3==e,c=4==e,f=6==e,h=5==e||f,p=t||s;return function(t,s,d){for(var v,y,m=a(t),g=i(m),b=r(s,d,3),w=o(g.length),_=0,T=n?p(t,w):u?p(t,0):void 0;w>_;_++)if((h||_ in g)&&(y=b(v=g[_],_,m),e))if(n)T[_]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return _;case 2:T.push(v)}else if(c)return!1;return f?-1:l||c?c:T}}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){"use strict";if(n(8)){var r=n(30),i=n(1),a=n(2),o=n(0),s=n(59),u=n(85),l=n(17),c=n(42),f=n(28),h=n(14),p=n(43),d=n(19),v=n(6),y=n(117),m=n(32),g=n(26),b=n(13),w=n(46),_=n(4),T=n(10),x=n(77),S=n(33),k=n(35),P=n(34).f,O=n(79),E=n(29),I=n(5),M=n(22),C=n(49),R=n(47),A=n(81),L=n(40),D=n(52),N=n(41),F=n(80),j=n(108),V=n(9),B=n(20),U=V.f,G=B.f,H=i.RangeError,z=i.TypeError,W=i.Uint8Array,q=Array.prototype,Y=u.ArrayBuffer,X=u.DataView,K=M(0),Z=M(2),Q=M(3),J=M(4),$=M(5),ee=M(6),te=C(!0),ne=C(!1),re=A.values,ie=A.keys,ae=A.entries,oe=q.lastIndexOf,se=q.reduce,ue=q.reduceRight,le=q.join,ce=q.sort,fe=q.slice,he=q.toString,pe=q.toLocaleString,de=I("iterator"),ve=I("toStringTag"),ye=E("typed_constructor"),me=E("def_constructor"),ge=s.CONSTR,be=s.TYPED,we=s.VIEW,_e=M(1,function(e,t){return Pe(R(e,e[me]),t)}),Te=a(function(){return 1===new W(new Uint16Array([1]).buffer)[0]}),xe=!!W&&!!W.prototype.set&&a(function(){new W(1).set({})}),Se=function(e,t){var n=d(e);if(n<0||n%t)throw H("Wrong offset!");return n},ke=function(e){if(_(e)&&be in e)return e;throw z(e+" is not a typed array!")},Pe=function(e,t){if(!(_(e)&&ye in e))throw z("It is not a typed array constructor!");return new e(t)},Oe=function(e,t){return Ee(R(e,e[me]),t)},Ee=function(e,t){for(var n=0,r=t.length,i=Pe(e,r);r>n;)i[n]=t[n++];return i},Ie=function(e,t,n){U(e,t,{get:function(){return this._d[n]}})},Me=function(e){var t,n,r,i,a,o,s=T(e),u=arguments.length,c=u>1?arguments[1]:void 0,f=void 0!==c,h=O(s);if(null!=h&&!x(h)){for(o=h.call(s),r=[],t=0;!(a=o.next()).done;t++)r.push(a.value);s=r}for(f&&u>2&&(c=l(c,arguments[2],2)),t=0,n=v(s.length),i=Pe(this,n);n>t;t++)i[t]=f?c(s[t],t):s[t];return i},Ce=function(){for(var e=0,t=arguments.length,n=Pe(this,t);t>e;)n[e]=arguments[e++];return n},Re=!!W&&a(function(){pe.call(new W(1))}),Ae=function(){return pe.apply(Re?fe.call(ke(this)):ke(this),arguments)},Le={copyWithin:function(e,t){return j.call(ke(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return J(ke(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return F.apply(ke(this),arguments)},filter:function(e){return Oe(this,Z(ke(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return $(ke(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(ke(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){K(ke(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ne(ke(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(ke(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return le.apply(ke(this),arguments)},lastIndexOf:function(e){return oe.apply(ke(this),arguments)},map:function(e){return _e(ke(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return se.apply(ke(this),arguments)},reduceRight:function(e){return ue.apply(ke(this),arguments)},reverse:function(){for(var e,t=ke(this).length,n=Math.floor(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this},some:function(e){return Q(ke(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return ce.call(ke(this),e)},subarray:function(e,t){var n=ke(this),r=n.length,i=m(e,r);return new(R(n,n[me]))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,v((void 0===t?r:m(t,r))-i))}},De=function(e,t){return Oe(this,fe.call(ke(this),e,t))},Ne=function(e){ke(this);var t=Se(arguments[1],1),n=this.length,r=T(e),i=v(r.length),a=0;if(i+t>n)throw H("Wrong length!");for(;a<i;)this[t+a]=r[a++]},Fe={entries:function(){return ae.call(ke(this))},keys:function(){return ie.call(ke(this))},values:function(){return re.call(ke(this))}},je=function(e,t){return _(e)&&e[be]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Ve=function(e,t){return je(e,t=g(t,!0))?f(2,e[t]):G(e,t)},Be=function(e,t,n){return!(je(e,t=g(t,!0))&&_(n)&&b(n,"value"))||b(n,"get")||b(n,"set")||n.configurable||b(n,"writable")&&!n.writable||b(n,"enumerable")&&!n.enumerable?U(e,t,n):(e[t]=n.value,e)};ge||(B.f=Ve,V.f=Be),o(o.S+o.F*!ge,"Object",{getOwnPropertyDescriptor:Ve,defineProperty:Be}),a(function(){he.call({})})&&(he=pe=function(){return le.call(this)});var Ue=p({},Le);p(Ue,Fe),h(Ue,de,Fe.values),p(Ue,{slice:De,set:Ne,constructor:function(){},toString:he,toLocaleString:Ae}),Ie(Ue,"buffer","b"),Ie(Ue,"byteOffset","o"),Ie(Ue,"byteLength","l"),Ie(Ue,"length","e"),U(Ue,ve,{get:function(){return this[be]}}),e.exports=function(e,t,n,u){var l=e+((u=!!u)?"Clamped":"")+"Array",f="get"+e,p="set"+e,d=i[l],m=d||{},g=d&&k(d),b=!d||!s.ABV,T={},x=d&&d.prototype,O=function(e,n){U(e,n,{get:function(){return function(e,n){var r=e._d;return r.v[f](n*t+r.o,Te)}(this,n)},set:function(e){return function(e,n,r){var i=e._d;u&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),i.v[p](n*t+i.o,r,Te)}(this,n,e)},enumerable:!0})};b?(d=n(function(e,n,r,i){c(e,d,l,"_d");var a,o,s,u,f=0,p=0;if(_(n)){if(!(n instanceof Y||"ArrayBuffer"==(u=w(n))||"SharedArrayBuffer"==u))return be in n?Ee(d,n):Me.call(d,n);a=n,p=Se(r,t);var m=n.byteLength;if(void 0===i){if(m%t)throw H("Wrong length!");if((o=m-p)<0)throw H("Wrong length!")}else if((o=v(i)*t)+p>m)throw H("Wrong length!");s=o/t}else s=y(n),a=new Y(o=s*t);for(h(e,"_d",{b:a,o:p,l:o,e:s,v:new X(a)});f<s;)O(e,f++)}),x=d.prototype=S(Ue),h(x,"constructor",d)):a(function(){d(1)})&&a(function(){new d(-1)})&&D(function(e){new d,new d(null),new d(1.5),new d(e)},!0)||(d=n(function(e,n,r,i){var a;return c(e,d,l),_(n)?n instanceof Y||"ArrayBuffer"==(a=w(n))||"SharedArrayBuffer"==a?void 0!==i?new m(n,Se(r,t),i):void 0!==r?new m(n,Se(r,t)):new m(n):be in n?Ee(d,n):Me.call(d,n):new m(y(n))}),K(g!==Function.prototype?P(m).concat(P(g)):P(m),function(e){e in d||h(d,e,m[e])}),d.prototype=x,r||(x.constructor=d));var E=x[de],I=!!E&&("values"==E.name||null==E.name),M=Fe.values;h(d,ye,!0),h(x,be,l),h(x,we,!0),h(x,me,d),(u?new d(1)[ve]==l:ve in x)||U(x,ve,{get:function(){return l}}),T[l]=d,o(o.G+o.W+o.F*(d!=m),T),o(o.S,l,{BYTES_PER_ELEMENT:t}),o(o.S+o.F*a(function(){m.of.call(d,1)}),l,{from:Me,of:Ce}),"BYTES_PER_ELEMENT"in x||h(x,"BYTES_PER_ELEMENT",t),o(o.P,l,Le),N(l),o(o.P+o.F*xe,l,{set:Ne}),o(o.P+o.F*!I,l,Fe),r||x.toString==he||(x.toString=he),o(o.P+o.F*a(function(){new d(1).slice()}),l,{slice:De}),o(o.P+o.F*(a(function(){return[1,2].toLocaleString()!=new d([1,2]).toLocaleString()})||!a(function(){x.toLocaleString.call([1,2])})),l,{toLocaleString:Ae}),L[l]=I?E:M,r||I||h(x,de,M)}}else e.exports=function(){}},function(e,t,n){var r=n(4);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(29)("meta"),i=n(4),a=n(13),o=n(9).f,s=0,u=Object.isExtensible||function(){return!0},l=!n(2)(function(){return u(Object.preventExtensions({}))}),c=function(e){o(e,r,{value:{i:"O"+ ++s,w:{}}})},f=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,r)){if(!u(e))return"F";if(!t)return"E";c(e)}return e[r].i},getWeak:function(e,t){if(!a(e,r)){if(!u(e))return!0;if(!t)return!1;c(e)}return e[r].w},onFreeze:function(e){return l&&f.NEED&&u(e)&&!a(e,r)&&c(e),e}}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){e.exports=!1},function(e,t,n){var r=n(92),i=n(64);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){var r=n(19),i=Math.max,a=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):a(e,t)}},function(e,t,n){var r=n(3),i=n(93),a=n(64),o=n(63)("IE_PROTO"),s=function(){},u=function(){var e,t=n(61)("iframe"),r=a.length;for(t.style.display="none",n(65).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[a[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[o]=e):n=u(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(92),i=n(64).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){var r=n(13),i=n(10),a=n(63)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,n){var r=n(5)("unscopables"),i=Array.prototype;null==i[r]&&n(14)(i,r,{}),e.exports=function(e){i[r][e]=!0}},function(e,t,n){var r=n(4);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){var r=n(9).f,i=n(13),a=n(5)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},function(e,t,n){var r=n(0),i=n(24),a=n(2),o=n(67),s="["+o+"]",u=RegExp("^"+s+s+"*"),l=RegExp(s+s+"*$"),c=function(e,t,n){var i={},s=a(function(){return!!o[e]()||"​"!="​"[e]()}),u=i[e]=s?t(f):o[e];n&&(i[n]=u),r(r.P+r.F*s,"String",i)},f=c.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(u,"")),2&t&&(e=e.replace(l,"")),e};e.exports=c},function(e,t){e.exports={}},function(e,t,n){"use strict";var r=n(1),i=n(9),a=n(8),o=n(5)("species");e.exports=function(e){var t=r[e];a&&t&&!t[o]&&i.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(11);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},function(e,t,n){var r=n(23);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var r=n(23),i=n(5)("toStringTag"),a="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:a?r(t):"Object"==(o=r(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,n){var r=n(3),i=n(18),a=n(5)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||null==(n=r(o)[a])?t:i(n)}},function(e,t,n){var r=n(7),i=n(1),a=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(30)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){var r=n(15),i=n(6),a=n(32);e.exports=function(e){return function(t,n,o){var s,u=r(t),l=i(u.length),c=a(o,l);if(e&&n!=n){for(;l>c;)if((s=u[c++])!=s)return!0}else for(;l>c;c++)if((e||c in u)&&u[c]===n)return e||c||0;return!e&&-1}}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(23);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(5)("iterator"),i=!1;try{var a=[7][r]();a.return=function(){i=!0},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var a=[7],o=a[r]();o.next=function(){return{done:n=!0}},a[r]=function(){return o},e(a)}catch(e){}return n}},function(e,t,n){"use strict";var r=n(3);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,n){"use strict";var r=n(46),i=RegExp.prototype.exec;e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var a=n.call(e,t);if("object"!=typeof a)throw new TypeError("RegExp exec method returned something other than an Object or null");return a}if("RegExp"!==r(e))throw new TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},function(e,t,n){"use strict";n(110);var r=n(11),i=n(14),a=n(2),o=n(24),s=n(5),u=n(82),l=s("species"),c=!a(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),f=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();e.exports=function(e,t,n){var h=s(e),p=!a(function(){var t={};return t[h]=function(){return 7},7!=""[e](t)}),d=p?!a(function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===e&&(n.constructor={},n.constructor[l]=function(){return n}),n[h](""),!t}):void 0;if(!p||!d||"replace"===e&&!c||"split"===e&&!f){var v=/./[h],y=n(o,h,""[e],function(e,t,n,r,i){return t.exec===u?p&&!i?{done:!0,value:v.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),m=y[0],g=y[1];r(String.prototype,e,m),i(RegExp.prototype,h,2==t?function(e,t){return g.call(e,this,t)}:function(e){return g.call(e,this)})}}},function(e,t,n){var r=n(17),i=n(105),a=n(77),o=n(3),s=n(6),u=n(79),l={},c={};(t=e.exports=function(e,t,n,f,h){var p,d,v,y,m=h?function(){return e}:u(e),g=r(n,f,t?2:1),b=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(a(m)){for(p=s(e.length);p>b;b++)if((y=t?g(o(d=e[b])[0],d[1]):g(e[b]))===l||y===c)return y}else for(v=m.call(e);!(d=v.next()).done;)if((y=i(v,g,d.value,t))===l||y===c)return y}).BREAK=l,t.RETURN=c},function(e,t,n){var r=n(1).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){"use strict";var r=n(1),i=n(0),a=n(11),o=n(43),s=n(27),u=n(56),l=n(42),c=n(4),f=n(2),h=n(52),p=n(38),d=n(68);e.exports=function(e,t,n,v,y,m){var g=r[e],b=g,w=y?"set":"add",_=b&&b.prototype,T={},x=function(e){var t=_[e];a(_,e,"delete"==e?function(e){return!(m&&!c(e))&&t.call(this,0===e?0:e)}:"has"==e?function(e){return!(m&&!c(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return m&&!c(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,n){return t.call(this,0===e?0:e,n),this})};if("function"==typeof b&&(m||_.forEach&&!f(function(){(new b).entries().next()}))){var S=new b,k=S[w](m?{}:-0,1)!=S,P=f(function(){S.has(1)}),O=h(function(e){new b(e)}),E=!m&&f(function(){for(var e=new b,t=5;t--;)e[w](t,t);return!e.has(-0)});O||((b=t(function(t,n){l(t,b,e);var r=d(new g,t,b);return null!=n&&u(n,y,r[w],r),r})).prototype=_,_.constructor=b),(P||E)&&(x("delete"),x("has"),y&&x("get")),(E||k)&&x(w),m&&_.clear&&delete _.clear}else b=v.getConstructor(t,e,y,w),o(b.prototype,n),s.NEED=!0;return p(b,e),T[e]=b,i(i.G+i.W+i.F*(b!=g),T),m||v.setStrong(b,e,y),b}},function(e,t,n){for(var r,i=n(1),a=n(14),o=n(29),s=o("typed_array"),u=o("view"),l=!(!i.ArrayBuffer||!i.DataView),c=l,f=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");f<9;)(r=i[h[f++]])?(a(r.prototype,s,!0),a(r.prototype,u,!0)):c=!1;e.exports={ABV:l,CONSTR:c,TYPED:s,VIEW:u}},function(e){e.exports=JSON.parse('{"data":[{"name":"spot_mesh","vertices":[3.6,-3.3947,0.4,0,0,1,3.7682,-3.3309,0.4,0,0,1,3.9237,-3.2308,0.4,-0.0001,0.0001,1,3.6,-3.3947,0.4,0,0,1,3.9237,-3.2308,0.4,-0.0001,0.0001,1,4.0534,-3.0999,0.4,0,0,1,4.0534,-3.0999,0.4,0,0,1,4.1523,-2.9425,0.4,-0.0003,0.0002,1,4.2154,-2.7644,0.4,0,0,1,3.6,-3.3947,0.4,0,0,1,4.0534,-3.0999,0.4,0,0,1,4.2154,-2.7644,0.4,0,0,1,4.2154,-2.7644,0.4,0,0,1,4.2375,-2.5702,0.4,-0.0003,0,1,4.2154,-2.3762,0.4,0,0,1,4.2154,-2.3762,0.4,0,0,1,4.1523,-2.1981,0.4,-0.0005,-0.0003,1,4.0534,-2.041,0.4,0,0,1,4.2154,-2.7644,0.4,0,0,1,4.2154,-2.3762,0.4,0,0,1,4.0534,-2.041,0.4,0,0,1,3.6,-3.3947,0.4,0,0,1,4.2154,-2.7644,0.4,0,0,1,4.0534,-2.041,0.4,0,0,1,3.6,-3.3947,0.4,0,0,1,4.0534,-2.041,0.4,0,0,1,0.5704,2.9839,0.4,0,0,1,0.5704,2.9839,0.4,0,0,1,0.3803,3.212,0.4,-0.0001,-0.0001,1,0.1902,3.349,0.4,-0.0001,-0.0001,1,0.5704,2.9839,0.4,0,0,1,0.1902,3.349,0.4,-0.0001,-0.0001,1,0,3.3948,0.4,0,0,1,3.6,-3.3947,0.4,0,0,1,0.5704,2.9839,0.4,0,0,1,0,3.3948,0.4,0,0,1,3.6,-3.3947,0.4,0,0,1,0,3.3948,0.4,0,0,1,0,-2.5558,0.4,0,0,1,-4.0534,-2.041,0.4,-0.8219,0.5697,0,-0.5704,2.9839,0.4,-0.8219,0.5697,0,-0.5704,2.9839,-0.4,-0.8219,0.5697,0,-0.5704,2.9839,-0.4,-0.8219,0.5697,0,-4.0534,-2.041,-0.4,-0.8219,0.5697,0,-4.0534,-2.041,0.4,-0.8219,0.5697,0,-0.5704,2.9839,0.4,-0.7686,0.6398,-0.0002,-0.3802,3.2123,0.4,-0.7686,0.6398,-0.0002,-0.3802,3.212,-0.4,-0.7686,0.6398,-0.0002,-0.3802,3.212,-0.4,-0.7682,0.6402,0,-0.5704,2.9839,-0.4,-0.7682,0.6402,0,-0.5704,2.9839,0.4,-0.7682,0.6402,0,-0.1901,3.349,0.4,-0.2341,0.9722,-0.0003,0,3.3948,0.4,-0.2341,0.9722,-0.0003,0,3.3945,-0.4,-0.2341,0.9722,-0.0003,0,3.3945,-0.4,-0.2329,0.9725,0,-0.1901,3.349,-0.4,-0.2329,0.9725,0,-0.1901,3.349,0.4,-0.2329,0.9725,0,-0.3802,3.2123,0.4,-0.5838,0.8119,0,-0.1901,3.349,0.4,-0.5838,0.8119,0,-0.1901,3.349,-0.4,-0.5838,0.8119,0,-0.1901,3.349,-0.4,-0.5844,0.8114,-0.0002,-0.3802,3.212,-0.4,-0.5844,0.8114,-0.0002,-0.3802,3.2123,0.4,-0.5844,0.8114,-0.0002,0,-2.5558,0.4,-0.2269,-0.9739,0.0001,0,-2.5559,-0.4,-0.2269,-0.9739,0.0001,3.6,-3.3947,-0.4,-0.2269,-0.9739,0.0001,3.6,-3.3947,-0.4,-0.2269,-0.9739,0,3.6,-3.3947,0.4,-0.2269,-0.9739,0,0,-2.5558,0.4,-0.2269,-0.9739,0,-3.6,-3.3947,0.4,-0.3544,-0.9351,0,-3.7681,-3.3309,0.4,-0.3544,-0.9351,0,-3.7681,-3.3309,-0.4,-0.3544,-0.9351,0,-3.7681,-3.3309,-0.4,-0.3544,-0.9351,0,-3.6,-3.3947,-0.4,-0.3544,-0.9351,0,-3.6,-3.3947,0.4,-0.3544,-0.9351,0,-3.7681,-3.3309,0.4,-0.5408,-0.8412,0,-3.9236,-3.231,0.4,-0.5408,-0.8412,0,-3.9236,-3.231,-0.4,-0.5408,-0.8412,0,-3.9236,-3.231,-0.4,-0.5408,-0.8412,0,-3.7681,-3.3309,-0.4,-0.5408,-0.8412,0,-3.7681,-3.3309,0.4,-0.5408,-0.8412,0,-3.9236,-3.231,0.4,-0.7108,-0.7034,0,-4.0534,-3.0999,0.4,-0.7108,-0.7034,0,-4.0534,-3.0999,-0.4,-0.7108,-0.7034,0,-4.0534,-3.0999,-0.4,-0.7108,-0.7034,0,-3.9236,-3.231,-0.4,-0.7108,-0.7034,0,-3.9236,-3.231,0.4,-0.7108,-0.7034,0,-4.0534,-3.0999,0.4,-0.8466,-0.5323,0,-4.1523,-2.9425,0.4,-0.8466,-0.5323,0,-4.1523,-2.9425,-0.4,-0.8466,-0.5323,0,-4.1523,-2.9425,-0.4,-0.8466,-0.5323,0,-4.0534,-3.0999,-0.4,-0.8466,-0.5323,0,-4.0534,-3.0999,0.4,-0.8466,-0.5323,0,-4.1523,-2.9425,0.4,-0.9427,-0.3337,0,-4.2154,-2.7644,0.4,-0.9427,-0.3337,0,-4.2154,-2.7644,-0.4,-0.9427,-0.3337,0,-4.2154,-2.7644,-0.4,-0.9427,-0.3337,0,-4.1523,-2.9425,-0.4,-0.9427,-0.3337,0,-4.1523,-2.9425,0.4,-0.9427,-0.3337,0,-4.2154,-2.7644,0.4,-0.9936,-0.1132,0,-4.2375,-2.5702,0.4,-0.9936,-0.1132,0,-4.2375,-2.5704,-0.4,-0.9936,-0.1132,0,-4.2375,-2.5704,-0.4,-0.9936,-0.1133,0,-4.2154,-2.7644,-0.4,-0.9936,-0.1133,0,-4.2154,-2.7644,0.4,-0.9936,-0.1133,0,-4.2375,-2.5702,0.4,-0.9936,0.1133,0,-4.2154,-2.3762,0.4,-0.9936,0.1133,0,-4.2154,-2.3762,-0.4,-0.9936,0.1133,0,-4.2154,-2.3762,-0.4,-0.9936,0.1132,0,-4.2375,-2.5704,-0.4,-0.9936,0.1132,0,-4.2375,-2.5702,0.4,-0.9936,0.1132,0,-4.2154,-2.3762,0.4,-0.9428,0.3333,-0.0001,-4.1523,-2.1979,0.4,-0.9428,0.3333,-0.0001,-4.1523,-2.1981,-0.4,-0.9428,0.3333,-0.0001,-4.1523,-2.1981,-0.4,-0.9427,0.3337,0,-4.2154,-2.3762,-0.4,-0.9427,0.3337,0,-4.2154,-2.3762,0.4,-0.9427,0.3337,0,-4.1523,-2.1979,0.4,-0.8458,0.5335,0,-4.0534,-2.041,0.4,-0.8458,0.5335,0,-4.0534,-2.041,-0.4,-0.8458,0.5335,0,-4.0534,-2.041,-0.4,-0.8462,0.5329,-0.0002,-4.1523,-2.1981,-0.4,-0.8462,0.5329,-0.0002,-4.1523,-2.1979,0.4,-0.8462,0.5329,-0.0002,0,3.3948,0.4,0.234,0.9722,0,0.1902,3.349,0.4,0.234,0.9722,0,0.1902,3.349,-0.4,0.234,0.9722,0,0.1902,3.349,-0.4,0.2329,0.9725,-0.0003,0,3.3945,-0.4,0.2329,0.9725,-0.0003,0,3.3948,0.4,0.2329,0.9725,-0.0003,0.1902,3.349,0.4,0.5845,0.8114,0,0.3803,3.212,0.4,0.5845,0.8114,0,0.3803,3.212,-0.4,0.5845,0.8114,0,0.3803,3.212,-0.4,0.5845,0.8114,0,0.1902,3.349,-0.4,0.5845,0.8114,0,0.1902,3.349,0.4,0.5845,0.8114,0,0.3803,3.212,0.4,0.7682,0.6402,0,0.5704,2.9839,0.4,0.7682,0.6402,0,0.5704,2.9839,-0.4,0.7682,0.6402,0,0.5704,2.9839,-0.4,0.7682,0.6402,0,0.3803,3.212,-0.4,0.7682,0.6402,0,0.3803,3.212,0.4,0.7682,0.6402,0,0.5704,2.9839,0.4,0.8219,0.5697,0,4.0534,-2.041,0.4,0.8219,0.5697,0,4.0534,-2.041,-0.4,0.8219,0.5697,0,4.0534,-2.041,-0.4,0.8219,0.5697,0,0.5704,2.9839,-0.4,0.8219,0.5697,0,0.5704,2.9839,0.4,0.8219,0.5697,0,4.0534,-2.041,0.4,0.8462,0.5329,0.0002,4.1523,-2.1981,0.4,0.8462,0.5329,0.0002,4.1523,-2.1979,-0.4,0.8462,0.5329,0.0002,4.1523,-2.1979,-0.4,0.8458,0.5335,0,4.0534,-2.041,-0.4,0.8458,0.5335,0,4.0534,-2.041,0.4,0.8458,0.5335,0,4.1523,-2.1981,0.4,0.9427,0.3337,0,4.2154,-2.3762,0.4,0.9427,0.3337,0,4.2154,-2.3762,-0.4,0.9427,0.3337,0,4.2154,-2.3762,-0.4,0.9428,0.3333,0.0001,4.1523,-2.1979,-0.4,0.9428,0.3333,0.0001,4.1523,-2.1981,0.4,0.9428,0.3333,0.0001,4.2154,-2.3762,0.4,0.9936,0.1133,0,4.2375,-2.5702,0.4,0.9936,0.1133,0,4.2375,-2.5702,-0.4,0.9936,0.1133,0,4.2375,-2.5702,-0.4,0.9936,0.1133,0,4.2154,-2.3762,-0.4,0.9936,0.1133,0,4.2154,-2.3762,0.4,0.9936,0.1133,0,4.2375,-2.5702,0.4,0.9936,-0.1132,0,4.2154,-2.7644,0.4,0.9936,-0.1132,0,4.2154,-2.7644,-0.4,0.9936,-0.1132,0,4.2154,-2.7644,-0.4,0.9936,-0.1132,0,4.2375,-2.5702,-0.4,0.9936,-0.1132,0,4.2375,-2.5702,0.4,0.9936,-0.1132,0,4.2154,-2.7644,0.4,0.9427,-0.3337,0,4.1523,-2.9425,0.4,0.9427,-0.3337,0,4.1523,-2.9425,-0.4,0.9427,-0.3337,0,4.1523,-2.9425,-0.4,0.9427,-0.3337,0,4.2154,-2.7644,-0.4,0.9427,-0.3337,0,4.2154,-2.7644,0.4,0.9427,-0.3337,0,4.1523,-2.9425,0.4,0.8466,-0.5323,0,4.0534,-3.0999,0.4,0.8466,-0.5323,0,4.0534,-3.0999,-0.4,0.8466,-0.5323,0,4.0534,-3.0999,-0.4,0.8466,-0.5323,0,4.1523,-2.9425,-0.4,0.8466,-0.5323,0,4.1523,-2.9425,0.4,0.8466,-0.5323,0,4.0534,-3.0999,0.4,0.7105,-0.7037,0,3.9237,-3.2308,0.4,0.7105,-0.7037,0,3.9237,-3.2308,-0.4,0.7105,-0.7037,0,3.9237,-3.2308,-0.4,0.7105,-0.7037,0,4.0534,-3.0999,-0.4,0.7105,-0.7037,0,4.0534,-3.0999,0.4,0.7105,-0.7037,0,3.9237,-3.2308,0.4,0.5412,-0.8409,0,3.7682,-3.3309,0.4,0.5412,-0.8409,0,3.7682,-3.3309,-0.4,0.5412,-0.8409,0,3.7682,-3.3309,-0.4,0.5412,-0.8409,0,3.9237,-3.2308,-0.4,0.5412,-0.8409,0,3.9237,-3.2308,0.4,0.5412,-0.8409,0,3.7682,-3.3309,0.4,0.3544,-0.9351,0,3.6,-3.3947,0.4,0.3544,-0.9351,0,3.6,-3.3947,-0.4,0.3544,-0.9351,0,3.6,-3.3947,-0.4,0.3544,-0.9351,0,3.7682,-3.3309,-0.4,0.3544,-0.9351,0,3.7682,-3.3309,0.4,0.3544,-0.9351,0,-3.6,-3.3947,0.4,0.2269,-0.9739,0,-3.6,-3.3947,-0.4,0.2269,-0.9739,0,0,-2.5559,-0.4,0.2269,-0.9739,0,0,-2.5559,-0.4,0.2269,-0.9739,0.0001,0,-2.5558,0.4,0.2269,-0.9739,0.0001,-3.6,-3.3947,0.4,0.2269,-0.9739,0.0001,-0.1901,3.349,0.4,0,0,1,-0.3802,3.2123,0.4,0,0,1,-0.5704,2.9839,0.4,0,0,1,0,3.3948,0.4,0,0,1,-0.1901,3.349,0.4,0,0,1,-0.5704,2.9839,0.4,0,0,1,0,3.3948,0.4,0,0,1,-0.5704,2.9839,0.4,0,0,1,-4.0534,-2.041,0.4,0,0,1,-4.0534,-2.041,0.4,0,0,1,-4.1523,-2.1979,0.4,0,0,1,-4.2154,-2.3762,0.4,0,0,1,-4.2154,-2.3762,0.4,0,0,1,-4.2375,-2.5702,0.4,0,0,1,-4.2154,-2.7644,0.4,0,0,1,-4.0534,-2.041,0.4,0,0,1,-4.2154,-2.3762,0.4,0,0,1,-4.2154,-2.7644,0.4,0,0,1,-4.2154,-2.7644,0.4,0,0,1,-4.1523,-2.9425,0.4,0,0,1,-4.0534,-3.0999,0.4,0,0,1,-3.9236,-3.231,0.4,-0.0001,-0.0002,1,-3.7681,-3.3309,0.4,0.0001,0.0002,1,-3.6,-3.3947,0.4,0,0,1,-4.0534,-3.0999,0.4,0,0,1,-3.9236,-3.231,0.4,-0.0001,-0.0002,1,-3.6,-3.3947,0.4,0,0,1,-4.2154,-2.7644,0.4,0,0,1,-4.0534,-3.0999,0.4,0,0,1,-3.6,-3.3947,0.4,0,0,1,-4.0534,-2.041,0.4,0,0,1,-4.2154,-2.7644,0.4,0,0,1,-3.6,-3.3947,0.4,0,0,1,0,3.3948,0.4,0,0,1,-4.0534,-2.041,0.4,0,0,1,-3.6,-3.3947,0.4,0,0,1,0,3.3948,0.4,0,0,1,-3.6,-3.3947,0.4,0,0,1,0,-2.5558,0.4,0,0,1],"indices":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245]}],"images":[{"name":"common_sprite","url":"https://map|4|.daumcdn.net/map_roadview/static/images/common.png"},{"name":"empty_toast","url":"https://map|4|.daumcdn.net/map_roadview/static/images/nothumb.png"}]}')},function(e,t,n){var r=n(4),i=n(1).document,a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,n){t.f=n(5)},function(e,t,n){var r=n(48)("keys"),i=n(29);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(1).document;e.exports=r&&r.documentElement},function(e,t,n){var r=n(4),i=n(3),a=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(17)(Function.call,n(20).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return a(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:a}},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,n){var r=n(4),i=n(66).set;e.exports=function(e,t,n){var a,o=t.constructor;return o!==n&&"function"==typeof o&&(a=o.prototype)!==n.prototype&&r(a)&&i&&i(e,a),e}},function(e,t,n){"use strict";var r=n(19),i=n(24);e.exports=function(e){var t=String(i(this)),n="",a=r(e);if(a<0||a==1/0)throw RangeError("Count can't be negative");for(;a>0;(a>>>=1)&&(t+=t))1&a&&(n+=t);return n}},function(e,t){e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},function(e,t){var n=Math.expm1;e.exports=!n||n(10)>22025.465794806718||n(10)<22025.465794806718||-2e-17!=n(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:n},function(e,t,n){var r=n(19),i=n(24);e.exports=function(e){return function(t,n){var a,o,s=String(i(t)),u=r(n),l=s.length;return u<0||u>=l?e?"":void 0:(a=s.charCodeAt(u))<55296||a>56319||u+1===l||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):a:e?s.slice(u,u+2):o-56320+(a-55296<<10)+65536}}},function(e,t,n){"use strict";var r=n(30),i=n(0),a=n(11),o=n(14),s=n(40),u=n(104),l=n(38),c=n(35),f=n(5)("iterator"),h=!([].keys&&"next"in[].keys()),p=function(){return this};e.exports=function(e,t,n,d,v,y,m){u(n,t,d);var g,b,w,_=function(e){if(!h&&e in k)return k[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},T=t+" Iterator",x="values"==v,S=!1,k=e.prototype,P=k[f]||k["@@iterator"]||v&&k[v],O=P||_(v),E=v?x?_("entries"):O:void 0,I="Array"==t&&k.entries||P;if(I&&(w=c(I.call(new e)))!==Object.prototype&&w.next&&(l(w,T,!0),r||"function"==typeof w[f]||o(w,f,p)),x&&P&&"values"!==P.name&&(S=!0,O=function(){return P.call(this)}),r&&!m||!h&&!S&&k[f]||o(k,f,O),s[t]=O,s[T]=p,v)if(g={values:x?O:_("values"),keys:y?O:_("keys"),entries:E},m)for(b in g)b in k||a(k,b,g[b]);else i(i.P+i.F*(h||S),t,g);return g}},function(e,t,n){var r=n(75),i=n(24);e.exports=function(e,t,n){if(r(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(i(e))}},function(e,t,n){var r=n(4),i=n(23),a=n(5)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[a])?!!t:"RegExp"==i(e))}},function(e,t,n){var r=n(5)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},function(e,t,n){var r=n(40),i=n(5)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||a[i]===e)}},function(e,t,n){"use strict";var r=n(9),i=n(28);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},function(e,t,n){var r=n(46),i=n(5)("iterator"),a=n(40);e.exports=n(7).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||a[r(e)]}},function(e,t,n){"use strict";var r=n(10),i=n(32),a=n(6);e.exports=function(e){for(var t=r(this),n=a(t.length),o=arguments.length,s=i(o>1?arguments[1]:void 0,n),u=o>2?arguments[2]:void 0,l=void 0===u?n:i(u,n);l>s;)t[s++]=e;return t}},function(e,t,n){"use strict";var r=n(36),i=n(109),a=n(40),o=n(15);e.exports=n(73)(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},function(e,t,n){"use strict";var r,i,a=n(53),o=RegExp.prototype.exec,s=String.prototype.replace,u=o,l=(r=/a/,i=/b*/g,o.call(r,"a"),o.call(i,"a"),0!==r.lastIndex||0!==i.lastIndex),c=void 0!==/()??/.exec("")[1];(l||c)&&(u=function(e){var t,n,r,i,u=this;return c&&(n=new RegExp("^"+u.source+"$(?!\\s)",a.call(u))),l&&(t=u.lastIndex),r=o.call(u,e),l&&r&&(u.lastIndex=u.global?r.index+r[0].length:t),c&&r&&r.length>1&&s.call(r[0],n,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)}),r}),e.exports=u},function(e,t,n){"use strict";var r=n(72)(!0);e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},function(e,t,n){var r,i,a,o=n(17),s=n(98),u=n(65),l=n(61),c=n(1),f=c.process,h=c.setImmediate,p=c.clearImmediate,d=c.MessageChannel,v=c.Dispatch,y=0,m={},g=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},b=function(e){g.call(e.data)};h&&p||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return m[++y]=function(){s("function"==typeof e?e:Function(e),t)},r(y),y},p=function(e){delete m[e]},"process"==n(23)(f)?r=function(e){f.nextTick(o(g,e,1))}:v&&v.now?r=function(e){v.now(o(g,e,1))}:d?(a=(i=new d).port2,i.port1.onmessage=b,r=o(a.postMessage,a,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(r=function(e){c.postMessage(e+"","*")},c.addEventListener("message",b,!1)):r="onreadystatechange"in l("script")?function(e){u.appendChild(l("script")).onreadystatechange=function(){u.removeChild(this),g.call(e)}}:function(e){setTimeout(o(g,e,1),0)}),e.exports={set:h,clear:p}},function(e,t,n){"use strict";var r=n(1),i=n(8),a=n(30),o=n(59),s=n(14),u=n(43),l=n(2),c=n(42),f=n(19),h=n(6),p=n(117),d=n(34).f,v=n(9).f,y=n(80),m=n(38),g="prototype",b="Wrong index!",w=r.ArrayBuffer,_=r.DataView,T=r.Math,x=r.RangeError,S=r.Infinity,k=w,P=T.abs,O=T.pow,E=T.floor,I=T.log,M=T.LN2,C=i?"_b":"buffer",R=i?"_l":"byteLength",A=i?"_o":"byteOffset";function L(e,t,n){var r,i,a,o=new Array(n),s=8*n-t-1,u=(1<<s)-1,l=u>>1,c=23===t?O(2,-24)-O(2,-77):0,f=0,h=e<0||0===e&&1/e<0?1:0;for((e=P(e))!=e||e===S?(i=e!=e?1:0,r=u):(r=E(I(e)/M),e*(a=O(2,-r))<1&&(r--,a*=2),(e+=r+l>=1?c/a:c*O(2,1-l))*a>=2&&(r++,a/=2),r+l>=u?(i=0,r=u):r+l>=1?(i=(e*a-1)*O(2,t),r+=l):(i=e*O(2,l-1)*O(2,t),r=0));t>=8;o[f++]=255&i,i/=256,t-=8);for(r=r<<t|i,s+=t;s>0;o[f++]=255&r,r/=256,s-=8);return o[--f]|=128*h,o}function D(e,t,n){var r,i=8*n-t-1,a=(1<<i)-1,o=a>>1,s=i-7,u=n-1,l=e[u--],c=127&l;for(l>>=7;s>0;c=256*c+e[u],u--,s-=8);for(r=c&(1<<-s)-1,c>>=-s,s+=t;s>0;r=256*r+e[u],u--,s-=8);if(0===c)c=1-o;else{if(c===a)return r?NaN:l?-S:S;r+=O(2,t),c-=o}return(l?-1:1)*r*O(2,c-t)}function N(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function F(e){return[255&e]}function j(e){return[255&e,e>>8&255]}function V(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function B(e){return L(e,52,8)}function U(e){return L(e,23,4)}function G(e,t,n){v(e[g],t,{get:function(){return this[n]}})}function H(e,t,n,r){var i=p(+n);if(i+t>e[R])throw x(b);var a=e[C]._b,o=i+e[A],s=a.slice(o,o+t);return r?s:s.reverse()}function z(e,t,n,r,i,a){var o=p(+n);if(o+t>e[R])throw x(b);for(var s=e[C]._b,u=o+e[A],l=r(+i),c=0;c<t;c++)s[u+c]=l[a?c:t-c-1]}if(o.ABV){if(!l(function(){w(1)})||!l(function(){new w(-1)})||l(function(){return new w,new w(1.5),new w(NaN),"ArrayBuffer"!=w.name})){for(var W,q=(w=function(e){return c(this,w),new k(p(e))})[g]=k[g],Y=d(k),X=0;Y.length>X;)(W=Y[X++])in w||s(w,W,k[W]);a||(q.constructor=w)}var K=new _(new w(2)),Z=_[g].setInt8;K.setInt8(0,2147483648),K.setInt8(1,2147483649),!K.getInt8(0)&&K.getInt8(1)||u(_[g],{setInt8:function(e,t){Z.call(this,e,t<<24>>24)},setUint8:function(e,t){Z.call(this,e,t<<24>>24)}},!0)}else w=function(e){c(this,w,"ArrayBuffer");var t=p(e);this._b=y.call(new Array(t),0),this[R]=t},_=function(e,t,n){c(this,_,"DataView"),c(e,w,"DataView");var r=e[R],i=f(t);if(i<0||i>r)throw x("Wrong offset!");if(i+(n=void 0===n?r-i:h(n))>r)throw x("Wrong length!");this[C]=e,this[A]=i,this[R]=n},i&&(G(w,"byteLength","_l"),G(_,"buffer","_b"),G(_,"byteLength","_l"),G(_,"byteOffset","_o")),u(_[g],{getInt8:function(e){return H(this,1,e)[0]<<24>>24},getUint8:function(e){return H(this,1,e)[0]},getInt16:function(e){var t=H(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=H(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return N(H(this,4,e,arguments[1]))},getUint32:function(e){return N(H(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return D(H(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return D(H(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){z(this,1,e,F,t)},setUint8:function(e,t){z(this,1,e,F,t)},setInt16:function(e,t){z(this,2,e,j,t,arguments[2])},setUint16:function(e,t){z(this,2,e,j,t,arguments[2])},setInt32:function(e,t){z(this,4,e,V,t,arguments[2])},setUint32:function(e,t){z(this,4,e,V,t,arguments[2])},setFloat32:function(e,t){z(this,4,e,U,t,arguments[2])},setFloat64:function(e,t){z(this,8,e,B,t,arguments[2])}});m(w,"ArrayBuffer"),m(_,"DataView"),s(_[g],o.VIEW,!0),t.ArrayBuffer=w,t.DataView=_},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){e.exports=!n(122)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(317),i=n(318),a=n(319),o=n(320),s=n(321),u=n(322),l=n(323),c=n(324),f=n(325),h=n(326),p=n(327),d=n(328),v=n(329),y=n(330),m=n(331),g=n(332),b=n(333),w=n(334),_=n(335),T=n(336),x=n(337),S=n(338);e.exports={vp:{rastermap:r,bypass_pt:s,Ps4Ts2_Default_TexDif:a,default3d_pt:u,billboard_pto:l,Pf3Tf2_screen_quad:f,pano_raster:p,pano_linepattern:m,pano_indicator:b,pano_compare:v,pano_spot:_,watermark_pattern:x},fp:{rastermap:i,Tex_Default:o,diffuse1:c,deferred_df:h,pano_raster:d,pano_linepattern:g,pano_indicator:w,pano_compare:y,pano_spot:T,watermark_pattern:S}}},function(e,t,n){e.exports=!n(8)&&!n(2)(function(){return 7!=Object.defineProperty(n(61)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(1),i=n(7),a=n(30),o=n(62),s=n(9).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=a?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t,n){var r=n(13),i=n(15),a=n(49)(!1),o=n(63)("IE_PROTO");e.exports=function(e,t){var n,s=i(e),u=0,l=[];for(n in s)n!=o&&r(s,n)&&l.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~a(l,n)||l.push(n));return l}},function(e,t,n){var r=n(9),i=n(3),a=n(31);e.exports=n(8)?Object.defineProperties:function(e,t){i(e);for(var n,o=a(t),s=o.length,u=0;s>u;)r.f(e,n=o[u++],t[n]);return e}},function(e,t,n){var r=n(15),i=n(34).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==a.call(e)?function(e){try{return i(e)}catch(e){return o.slice()}}(e):i(r(e))}},function(e,t,n){"use strict";var r=n(8),i=n(31),a=n(50),o=n(45),s=n(10),u=n(44),l=Object.assign;e.exports=!l||n(2)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=l({},e)[n]||Object.keys(l({},t)).join("")!=r})?function(e,t){for(var n=s(e),l=arguments.length,c=1,f=a.f,h=o.f;l>c;)for(var p,d=u(arguments[c++]),v=f?i(d).concat(f(d)):i(d),y=v.length,m=0;y>m;)p=v[m++],r&&!h.call(d,p)||(n[p]=d[p]);return n}:l},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){"use strict";var r=n(18),i=n(4),a=n(98),o=[].slice,s={},u=function(e,t,n){if(!(t in s)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";s[t]=Function("F,a","return new F("+r.join(",")+")")}return s[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=o.call(arguments,1),s=function(){var r=n.concat(o.call(arguments));return this instanceof s?u(t,r.length,r):a(t,r,e)};return i(t.prototype)&&(s.prototype=t.prototype),s}},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(1).parseInt,i=n(39).trim,a=n(67),o=/^[-+]?0[xX]/;e.exports=8!==r(a+"08")||22!==r(a+"0x16")?function(e,t){var n=i(String(e),3);return r(n,t>>>0||(o.test(n)?16:10))}:r},function(e,t,n){var r=n(1).parseFloat,i=n(39).trim;e.exports=1/r(n(67)+"-0")!=-1/0?function(e){var t=i(String(e),3),n=r(t);return 0===n&&"-"==t.charAt(0)?-0:n}:r},function(e,t,n){var r=n(23);e.exports=function(e,t){if("number"!=typeof e&&"Number"!=r(e))throw TypeError(t);return+e}},function(e,t,n){var r=n(4),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},function(e,t){e.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)}},function(e,t,n){"use strict";var r=n(33),i=n(28),a=n(38),o={};n(14)(o,n(5)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(o,{next:i(1,n)}),a(e,t+" Iterator")}},function(e,t,n){var r=n(3);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var a=e.return;throw void 0!==a&&r(a.call(e)),t}}},function(e,t,n){var r=n(225);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){var r=n(18),i=n(10),a=n(44),o=n(6);e.exports=function(e,t,n,s,u){r(t);var l=i(e),c=a(l),f=o(l.length),h=u?f-1:0,p=u?-1:1;if(n<2)for(;;){if(h in c){s=c[h],h+=p;break}if(h+=p,u?h<0:f<=h)throw TypeError("Reduce of empty array with no initial value")}for(;u?h>=0:f>h;h+=p)h in c&&(s=t(s,c[h],h,l));return s}},function(e,t,n){"use strict";var r=n(10),i=n(32),a=n(6);e.exports=[].copyWithin||function(e,t){var n=r(this),o=a(n.length),s=i(e,o),u=i(t,o),l=arguments.length>2?arguments[2]:void 0,c=Math.min((void 0===l?o:i(l,o))-u,o-s),f=1;for(u<s&&s<u+c&&(f=-1,u+=c-1,s+=c-1);c-- >0;)u in n?n[s]=n[u]:delete n[s],s+=f,u+=f;return n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){"use strict";var r=n(82);n(0)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},function(e,t,n){n(8)&&"g"!=/./g.flags&&n(9).f(RegExp.prototype,"flags",{configurable:!0,get:n(53)})},function(e,t,n){"use strict";var r,i,a,o,s=n(30),u=n(1),l=n(17),c=n(46),f=n(0),h=n(4),p=n(18),d=n(42),v=n(56),y=n(47),m=n(84).set,g=n(245)(),b=n(113),w=n(246),_=n(57),T=n(114),x=u.TypeError,S=u.process,k=S&&S.versions,P=k&&k.v8||"",O=u.Promise,E="process"==c(S),I=function(){},M=i=b.f,C=!!function(){try{var e=O.resolve(1),t=(e.constructor={})[n(5)("species")]=function(e){e(I,I)};return(E||"function"==typeof PromiseRejectionEvent)&&e.then(I)instanceof t&&0!==P.indexOf("6.6")&&-1===_.indexOf("Chrome/66")}catch(e){}}(),R=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},A=function(e,t){if(!e._n){e._n=!0;var n=e._c;g(function(){for(var r=e._v,i=1==e._s,a=0,o=function(t){var n,a,o,s=i?t.ok:t.fail,u=t.resolve,l=t.reject,c=t.domain;try{s?(i||(2==e._h&&N(e),e._h=1),!0===s?n=r:(c&&c.enter(),n=s(r),c&&(c.exit(),o=!0)),n===t.promise?l(x("Promise-chain cycle")):(a=R(n))?a.call(n,u,l):u(n)):l(r)}catch(e){c&&!o&&c.exit(),l(e)}};n.length>a;)o(n[a++]);e._c=[],e._n=!1,t&&!e._h&&L(e)})}},L=function(e){m.call(u,function(){var t,n,r,i=e._v,a=D(e);if(a&&(t=w(function(){E?S.emit("unhandledRejection",i,e):(n=u.onunhandledrejection)?n({promise:e,reason:i}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=E||D(e)?2:1),e._a=void 0,a&&t.e)throw t.v})},D=function(e){return 1!==e._h&&0===(e._a||e._c).length},N=function(e){m.call(u,function(){var t;E?S.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})})},F=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),A(t,!0))},j=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw x("Promise can't be resolved itself");(t=R(e))?g(function(){var r={_w:n,_d:!1};try{t.call(e,l(j,r,1),l(F,r,1))}catch(e){F.call(r,e)}}):(n._v=e,n._s=1,A(n,!1))}catch(e){F.call({_w:n,_d:!1},e)}}};C||(O=function(e){d(this,O,"Promise","_h"),p(e),r.call(this);try{e(l(j,this,1),l(F,this,1))}catch(e){F.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(43)(O.prototype,{then:function(e,t){var n=M(y(this,O));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=E?S.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&A(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new r;this.promise=e,this.resolve=l(j,e,1),this.reject=l(F,e,1)},b.f=M=function(e){return e===O||e===o?new a(e):i(e)}),f(f.G+f.W+f.F*!C,{Promise:O}),n(38)(O,"Promise"),n(41)("Promise"),o=n(7).Promise,f(f.S+f.F*!C,"Promise",{reject:function(e){var t=M(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(s||!C),"Promise",{resolve:function(e){return T(s&&this===o?O:this,e)}}),f(f.S+f.F*!(C&&n(52)(function(e){O.all(e).catch(I)})),"Promise",{all:function(e){var t=this,n=M(t),r=n.resolve,i=n.reject,a=w(function(){var n=[],a=0,o=1;v(e,!1,function(e){var s=a++,u=!1;n.push(void 0),o++,t.resolve(e).then(function(e){u||(u=!0,n[s]=e,--o||r(n))},i)}),--o||r(n)});return a.e&&i(a.v),n.promise},race:function(e){var t=this,n=M(t),r=n.reject,i=w(function(){v(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}})},function(e,t,n){"use strict";var r=n(18);function i(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},function(e,t,n){var r=n(3),i=n(4),a=n(113);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=a.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";var r=n(9).f,i=n(33),a=n(43),o=n(17),s=n(42),u=n(56),l=n(73),c=n(109),f=n(41),h=n(8),p=n(27).fastKey,d=n(37),v=h?"_s":"size",y=function(e,t){var n,r=p(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,l){var c=e(function(e,r){s(e,c,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[v]=0,null!=r&&u(r,n,e[l],e)});return a(c.prototype,{clear:function(){for(var e=d(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[v]=0},delete:function(e){var n=d(this,t),r=y(n,e);if(r){var i=r.n,a=r.p;delete n._i[r.i],r.r=!0,a&&(a.n=i),i&&(i.p=a),n._f==r&&(n._f=i),n._l==r&&(n._l=a),n[v]--}return!!r},forEach:function(e){d(this,t);for(var n,r=o(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!y(d(this,t),e)}}),h&&r(c.prototype,"size",{get:function(){return d(this,t)[v]}}),c},def:function(e,t,n){var r,i,a=y(e,t);return a?a.v=n:(e._l=a={i:i=p(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=a),r&&(r.n=a),e[v]++,"F"!==i&&(e._i[i]=a)),e},getEntry:y,setStrong:function(e,t,n){l(e,t,function(e,n){this._t=d(e,t),this._k=n,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?c(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,c(1))},n?"entries":"values",!n,!0),f(t)}}},function(e,t,n){"use strict";var r=n(43),i=n(27).getWeak,a=n(3),o=n(4),s=n(42),u=n(56),l=n(22),c=n(13),f=n(37),h=l(5),p=l(6),d=0,v=function(e){return e._l||(e._l=new y)},y=function(){this.a=[]},m=function(e,t){return h(e.a,function(e){return e[0]===t})};y.prototype={get:function(e){var t=m(this,e);if(t)return t[1]},has:function(e){return!!m(this,e)},set:function(e,t){var n=m(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=p(this.a,function(t){return t[0]===e});return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,a){var l=e(function(e,r){s(e,l,t,"_i"),e._t=t,e._i=d++,e._l=void 0,null!=r&&u(r,n,e[a],e)});return r(l.prototype,{delete:function(e){if(!o(e))return!1;var n=i(e);return!0===n?v(f(this,t)).delete(e):n&&c(n,this._i)&&delete n[this._i]},has:function(e){if(!o(e))return!1;var n=i(e);return!0===n?v(f(this,t)).has(e):n&&c(n,this._i)}}),l},def:function(e,t,n){var r=i(a(t),!0);return!0===r?v(e).set(t,n):r[e._i]=n,e},ufstore:v}},function(e,t,n){var r=n(19),i=n(6);e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw RangeError("Wrong length!");return n}},function(e,t,n){var r=n(34),i=n(50),a=n(3),o=n(1).Reflect;e.exports=o&&o.ownKeys||function(e){var t=r.f(a(e)),n=i.f;return n?t.concat(n(e)):t}},function(e,t,n){var r=n(6),i=n(69),a=n(24);e.exports=function(e,t,n,o){var s=String(a(e)),u=s.length,l=void 0===n?" ":String(n),c=r(t);if(c<=u||""==l)return s;var f=c-u,h=i.call(l,Math.ceil(f/l.length));return h.length>f&&(h=h.slice(0,f)),o?h+s:s+h}},function(e,t,n){var r=n(8),i=n(31),a=n(15),o=n(45).f;e.exports=function(e){return function(t){for(var n,s=a(t),u=i(s),l=u.length,c=0,f=[];l>c;)n=u[c++],r&&!o.call(s,n)||f.push(e?[n,s[n]]:s[n]);return f}}},function(e,t){var n=e.exports={version:"2.6.9"};"number"==typeof __e&&(__e=n)},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r={"./pano_compare_config":124,"./pano_compare_config.json":124,"./pano_config":125,"./pano_config.json":125,"./pano_thumb_config":126,"./pano_thumb_config.json":126,"./resource_asset":60,"./resource_asset.json":60,"./resource_asset_proxy":127,"./resource_asset_proxy.json":127,"./urls":128,"./urls.json":128,"./urls_proxy":129,"./urls_proxy.json":129};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id=123},function(e){e.exports=JSON.parse('{"version":"2019-04-11","view":{"name":"panorama_past_split","terrain":{"system":"panorama","origin":[0,0],"base_level":1,"min_level":1,"max_level":2,"enable":false},"scene":{"layer":[{"name":"past_preview_layer","type":"panorama_preview","strategy":"panorama_preview_node","reader":"image-texture","priority":"high","url":"pano_preview","enable":true,"visible":true,"clickable":false},{"name":"past_tile_layer","type":"panorama_tile","strategy":"panorama_tile_node","reader":"panorama-tile","priority":"normal","url":"pano_tile","enable":true,"visible":true,"clickable":false},{"name":"past_mask_layer","type":"panorama_tile","strategy":"panorama_street_mask","reader":"panorama-tile","priority":"normal","url":"street_mask","enable":true,"visible":true,"clickable":false},{"name":"past_empty_overlay","type":"ordered","priority":"normal","visible":true,"clickable":false}]}}}')},function(e){e.exports=JSON.parse('{"version":"2019-07-15","view":{"name":"panorama","camera":{"mode":"perspective","center":[0,0,0],"panTilt":[0,90],"fovy":90,"zoomLevel":0,"panoramaMode":true},"terrain":{"system":"panorama","origin":[0,0],"base_level":1,"min_level":1,"max_level":2,"enable":true},"scene":{"layer":[{"name":"pano_preview_layer","type":"panorama_preview","strategy":"panorama_preview_node","reader":"image-texture","priority":"high","url":"pano_preview","enable":true,"visible":true,"clickable":false},{"name":"pano_tile_layer","type":"panorama_tile","strategy":"panorama_tile_node","reader":"panorama-tile","priority":"normal","url":"pano_tile","enable":true,"visible":true,"clickable":false},{"name":"pano_mask_layer","type":"panorama_tile","strategy":"panorama_street_mask","reader":"panorama-tile","priority":"normal","url":"street_mask","enable":true,"visible":true,"clickable":false},{"name":"pano_debug_tile_layer","type":"panorama_tile","strategy":"panorama_tile_node","reader":"debug-panorama-tile","priority":"normal","url":"pano_debug_tile","enable":false,"visible":false,"clickable":false},{"name":"panorama_spot","type":"ordered","priority":"normal","visible":true,"clickable":true},{"name":"panorama_roadname","type":"ordered","priority":"normal","visible":true,"clickable":false},{"name":"panorama_path","type":"ordered","priority":"normal","visible":true,"clickable":false},{"name":"panorama_billboard_spot","type":"ordered","priority":"normal","visible":true,"clickable":false},{"name":"panorama_billboard_indicator","type":"ordered","priority":"normal","visible":true,"clickable":false},{"name":"panorama_screen_overlay","type":"ordered","priority":"normal","visible":true,"clickable":false},{"name":"panorama_indicator","type":"ordered","priority":"normal","visible":true,"clickable":false},{"name":"panorama_wartermark","type":"ordered","priority":"normal","visible":true,"clickable":false},{"name":"panorama_copyright","type":"ordered","priority":"normal","visible":false,"clickable":true},{"name":"panorama_extra_copyright","type":"ordered","priority":"normal","visible":true,"clickable":true},{"name":"panorama_extra_copyright_for_capture","type":"ordered","priority":"normal","visible":true,"clickable":false}],"data":[{"name":"street","reader":"ajaxjson-data","priority":"high","url":"street_json"},{"name":"street_near","reader":"ajaxjson-data","priority":"high","url":"street_near_json"},{"name":"store","reader":"jsonp-data","priority":"high","url":"store_json"},{"name":"rangesearch","reader":"ajaxjson-data","priority":"normal","url":"rangesearch_json"},{"name":"depthmap","reader":"depthmap-image","priority":"high","url":"depthmap_image"},{"name":"depthmapdummy","reader":"depthmap-image","priority":"high","url":"depthmap_dummy_image"}]},"rendering":{"render_targets":[{"name":"diffuse_for_left"},{"name":"diffuse_for_right"},{"name":"diffuse_for_empty"},{"name":"diffuse_for_capture"}],"vp":[{"name":"pano_raster","source":"","ondisk":true},{"name":"billboard_pto","source":"","ondisk":true},{"name":"pano_linepattern","source":"","ondisk":true},{"name":"Pf3Tf2_screen_quad","source":"","ondisk":true},{"name":"pano_indicator","source":"","ondisk":true},{"name":"pano_spot","source":"","ondisk":true},{"name":"pano_compare","source":"","ondisk":true},{"name":"bypass_pt","source":"","ondisk":true}],"fp":[{"name":"pano_raster","source":"","ondisk":true},{"name":"diffuse1","source":"","ondisk":true},{"name":"pano_linepattern","source":"","ondisk":true},{"name":"pano_indicator","source":"","ondisk":true},{"name":"pano_spot","source":"","ondisk":true},{"name":"pano_compare","source":"","ondisk":true}],"technique":[{"name":"roadview","operation":[{"type":"command","command":"clear_all_buffer","color":"0x000000ff","depth":1},{"type":"pass","name":"panorama_tile","vp":"pano_raster","fp":"pano_raster","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["pano_preview_layer","pano_tile_layer","pano_mask_layer"]},{"type":"command","command":"clear_depth_buffer","depth":1},{"type":"pass","name":"panorama-path","vp":"pano_linepattern","fp":"pano_linepattern","depth":{"write":true,"compare":"less"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panorama_path"]},{"type":"pass","name":"panorama-indicator","vp":"pano_indicator","fp":"pano_indicator","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panorama_roadname","panorama_indicator"]},{"type":"pass","name":"panorama-spots_arrow","vp":"pano_spot","fp":"pano_spot","depth":{"write":false,"compare":"less"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panorama_spot"]},{"type":"pass","name":"panorama-spots","vp":"billboard_pto","fp":"diffuse1","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panorama_billboard_indicator","panorama_billboard_spot","panorama_screen_overlay"]},{"type":"pass","name":"copyright","vp":"bypass_pt","fp":"diffuse1","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panorama_copyright","panorama_extra_copyright"]}]},{"name":"storeview","operation":[{"type":"command","command":"clear_all_buffer","color":"0x000000ff","depth":1},{"type":"pass","name":"panorama-sv-tile","vp":"pano_raster","fp":"pano_raster","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["pano_preview_layer","pano_tile_layer","pano_debug_tile_layer"]},{"type":"pass","name":"panorama-sv-spots","vp":"billboard_pto","fp":"diffuse1","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panorama_screen_overlay"]},{"type":"pass","name":"copyright","vp":"bypass_pt","fp":"diffuse1","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panorama_copyright","panorama_extra_copyright"]}]},{"name":"past_compare","operation":[{"type":"command","command":"clear_all_buffer","color":"0x000000ff","depth":1},{"type":"command","command":"bind_render_target","render_target":"diffuse_for_empty"},{"type":"command","command":"clear_all_buffer","color":"0x00000000","depth":1},{"type":"command","command":"bind_render_target","render_target":"diffuse_for_left"},{"type":"command","command":"clear_all_buffer","color":"0x000000ff","depth":1},{"type":"pass","name":"panorama-past","vp":"pano_compare","fp":"pano_raster","depth":{"write":false,"compare":"always"},"blend":{"source_color":"source_alpha","dest_color":"one_minus_source_alpha","source_alpha":"one","dest_alpha":"one_minus_source_alpha"},"layer":["past_preview_layer","past_tile_layer","past_mask_layer"]},{"type":"command","command":"bind_render_target","render_target":"diffuse_for_right"},{"type":"command","command":"clear_all_buffer","color":"0x000000ff","depth":1},{"type":"pass","name":"panorama-current","vp":"pano_compare","fp":"pano_raster","depth":{"write":false,"compare":"always"},"blend":{"source_color":"source_alpha","dest_color":"one_minus_source_alpha","source_alpha":"one","dest_alpha":"one_minus_source_alpha"},"layer":["pano_preview_layer","pano_tile_layer","pano_mask_layer"]},{"type":"command","command":"bind_render_target","render_target":"default"},{"type":"screen_quad_pass","name":"panorama-compare","vp":"Pf3Tf2_screen_quad","fp":"pano_compare","depth":{"write":false,"compare":"always"},"blend":{"source":"one","dest":"one_minus_source_alpha"},"layout":"full","read_render_targets":{"diffuse":"diffuse_for_left","diffuse2":"diffuse_for_right","diffuse3":"diffuse_for_empty"}},{"type":"pass","name":"panorama-spots_arrow","vp":"pano_spot","fp":"pano_spot","depth":{"write":false,"compare":"less"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panorama_spot"]},{"type":"pass","name":"panorama-spots2","vp":"billboard_pto","fp":"diffuse1","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panorama_billboard_spot"]},{"type":"pass","name":"copyright","vp":"bypass_pt","fp":"diffuse1","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panorama_copyright","panorama_extra_copyright"]}]},{"name":"past_compare_empty","operation":[{"type":"command","command":"clear_all_buffer","color":"0x000000ff","depth":1},{"type":"command","command":"bind_render_target","render_target":"diffuse_for_empty"},{"type":"command","command":"clear_all_buffer","color":"0x00000000","depth":1},{"type":"pass","name":"panorama-empty","vp":"bypass_pt","fp":"diffuse1","depth":{"write":false,"compare":"always"},"blend":{"source_color":"source_alpha","dest_color":"one_minus_source_alpha","source_alpha":"one","dest_alpha":"one_minus_source_alpha"},"layer":["past_empty_overlay"]},{"type":"command","command":"bind_render_target","render_target":"diffuse_for_right"},{"type":"command","command":"clear_all_buffer","color":"0x000000ff","depth":1},{"type":"pass","name":"panorama-current","vp":"pano_compare","fp":"pano_raster","depth":{"write":false,"compare":"always"},"blend":{"source_color":"source_alpha","dest_color":"one_minus_source_alpha","source_alpha":"one","dest_alpha":"one_minus_source_alpha"},"layer":["pano_preview_layer","pano_tile_layer","pano_mask_layer"]},{"type":"command","command":"bind_render_target","render_target":"default"},{"type":"screen_quad_pass","name":"panorama-compare","vp":"Pf3Tf2_screen_quad","fp":"pano_compare","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layout":"full","read_render_targets":{"diffuse":"diffuse_for_left","diffuse2":"diffuse_for_right","diffuse3":"diffuse_for_empty"}},{"type":"pass","name":"panorama-spots_arrow","vp":"pano_spot","fp":"pano_spot","depth":{"write":false,"compare":"less"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panorama_spot"]},{"type":"pass","name":"panorama-spots2","vp":"billboard_pto","fp":"diffuse1","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panorama_billboard_spot"]},{"type":"pass","name":"copyright","vp":"bypass_pt","fp":"diffuse1","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panorama_copyright","panorama_extra_copyright"]}]},{"name":"capture_normal","operation":[{"type":"command","command":"clear_all_buffer","color":"0x000000ff","depth":1},{"type":"command","command":"bind_render_target","render_target":"default"},{"type":"pass","name":"panorama_tile","vp":"pano_raster","fp":"pano_raster","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["pano_preview_layer","pano_tile_layer","pano_mask_layer"]},{"type":"command","command":"bind_render_target","render_target":"diffuse_for_capture"},{"type":"command","command":"clear_all_buffer","color":"0x000000ff","depth":1},{"type":"pass","name":"panorama_tile","vp":"pano_raster","fp":"pano_raster","depth":{"write":false,"compare":"always"},"blend":{"source_color":"source_alpha","dest_color":"one_minus_source_alpha","source_alpha":"one","dest_alpha":"one_minus_source_alpha"},"layer":["pano_preview_layer","pano_tile_layer","pano_mask_layer"]},{"type":"pass","name":"warter_mark","vp":"bypass_pt","fp":"diffuse1","depth":{"write":false,"compare":"always"},"blend":{"source_color":"source_alpha","dest_color":"one_minus_source_alpha","source_alpha":"one","dest_alpha":"one_minus_source_alpha"},"layer":["panorama_wartermark","panorama_extra_copyright_for_capture"]}]},{"name":"capture_compare","operation":[{"type":"command","command":"clear_all_buffer","color":"0x000000ff","depth":1},{"type":"command","command":"bind_render_target","render_target":"default"},{"type":"screen_quad_pass","name":"panorama-compare","vp":"Pf3Tf2_screen_quad","fp":"pano_compare","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layout":"full","read_render_targets":{"diffuse":"diffuse_for_left","diffuse2":"diffuse_for_right","diffuse3":"diffuse_for_empty"}},{"type":"command","command":"bind_render_target","render_target":"diffuse_for_capture"},{"type":"command","command":"clear_all_buffer","color":"0x000000ff","depth":1},{"type":"screen_quad_pass","name":"panorama-compare","vp":"Pf3Tf2_screen_quad","fp":"pano_compare","depth":{"write":false,"compare":"always"},"blend":{"source_color":"source_alpha","dest_color":"one_minus_source_alpha","source_alpha":"one","dest_alpha":"one_minus_source_alpha"},"layout":"full","read_render_targets":{"diffuse":"diffuse_for_left","diffuse2":"diffuse_for_right","diffuse3":"diffuse_for_empty"}},{"type":"pass","name":"warter_mark","vp":"bypass_pt","fp":"diffuse1","depth":{"write":false,"compare":"always"},"blend":{"source_color":"source_alpha","dest_color":"one_minus_source_alpha","source_alpha":"one","dest_alpha":"one_minus_source_alpha"},"layer":["panorama_wartermark","panorama_extra_copyright_for_capture"]}]}]}}}')},function(e){e.exports=JSON.parse('{"version":"2019-04-11","view":{"name":"panorama_thumbnail","camera":{"mode":"perspective","center":[0,0,0],"panTilt":[0,90],"fovy":90,"zoomLevel":0,"panoramaMode":true},"terrain":{"system":"panorama","origin":[0,0],"base_level":1,"min_level":1,"max_level":2,"enable":true},"scene":{"layer":[{"name":"panothumb_preview_layer","type":"panorama_preview","strategy":"panorama_preview_node","reader":"image-texture","priority":"high","url":"pano_preview","enable":true,"visible":true,"clickable":false},{"name":"panothumb_tile_layer","type":"panorama_tile","strategy":"panorama_tile_node","reader":"panorama-tile","priority":"normal","url":"pano_tile","enable":false,"visible":false,"clickable":false},{"name":"panothumb_mask_layer","type":"panorama_tile","strategy":"panorama_street_mask","reader":"panorama-tile","priority":"normal","url":"street_mask","enable":true,"visible":true,"clickable":false}]},"rendering":{"vp":[{"name":"default3d_pt","source":"","ondisk":true}],"fp":[{"name":"diffuse1","source":"","ondisk":true}],"technique":[{"name":"thumbnail","operation":[{"type":"command","command":"clear_all_buffer","color":"0x000000ff","depth":1},{"type":"pass","name":"panorama-thumbnail","vp":"default3d_pt","fp":"diffuse1","depth":{"write":false,"compare":"always"},"blend":{"source":"source_alpha","dest":"one_minus_source_alpha"},"layer":["panothumb_preview_layer","panothumb_tile_layer","panothumb_mask_layer"]}]}]}}}')},function(e){e.exports=JSON.parse('{"data":[{"name":"spot_mesh","vertices":[3.6,-3.3947,0.4,0,0,1,3.7682,-3.3309,0.4,0,0,1,3.9237,-3.2308,0.4,-0.0001,0.0001,1,3.6,-3.3947,0.4,0,0,1,3.9237,-3.2308,0.4,-0.0001,0.0001,1,4.0534,-3.0999,0.4,0,0,1,4.0534,-3.0999,0.4,0,0,1,4.1523,-2.9425,0.4,-0.0003,0.0002,1,4.2154,-2.7644,0.4,0,0,1,3.6,-3.3947,0.4,0,0,1,4.0534,-3.0999,0.4,0,0,1,4.2154,-2.7644,0.4,0,0,1,4.2154,-2.7644,0.4,0,0,1,4.2375,-2.5702,0.4,-0.0003,0,1,4.2154,-2.3762,0.4,0,0,1,4.2154,-2.3762,0.4,0,0,1,4.1523,-2.1981,0.4,-0.0005,-0.0003,1,4.0534,-2.041,0.4,0,0,1,4.2154,-2.7644,0.4,0,0,1,4.2154,-2.3762,0.4,0,0,1,4.0534,-2.041,0.4,0,0,1,3.6,-3.3947,0.4,0,0,1,4.2154,-2.7644,0.4,0,0,1,4.0534,-2.041,0.4,0,0,1,3.6,-3.3947,0.4,0,0,1,4.0534,-2.041,0.4,0,0,1,0.5704,2.9839,0.4,0,0,1,0.5704,2.9839,0.4,0,0,1,0.3803,3.212,0.4,-0.0001,-0.0001,1,0.1902,3.349,0.4,-0.0001,-0.0001,1,0.5704,2.9839,0.4,0,0,1,0.1902,3.349,0.4,-0.0001,-0.0001,1,0,3.3948,0.4,0,0,1,3.6,-3.3947,0.4,0,0,1,0.5704,2.9839,0.4,0,0,1,0,3.3948,0.4,0,0,1,3.6,-3.3947,0.4,0,0,1,0,3.3948,0.4,0,0,1,0,-2.5558,0.4,0,0,1,-4.0534,-2.041,0.4,-0.8219,0.5697,0,-0.5704,2.9839,0.4,-0.8219,0.5697,0,-0.5704,2.9839,-0.4,-0.8219,0.5697,0,-0.5704,2.9839,-0.4,-0.8219,0.5697,0,-4.0534,-2.041,-0.4,-0.8219,0.5697,0,-4.0534,-2.041,0.4,-0.8219,0.5697,0,-0.5704,2.9839,0.4,-0.7686,0.6398,-0.0002,-0.3802,3.2123,0.4,-0.7686,0.6398,-0.0002,-0.3802,3.212,-0.4,-0.7686,0.6398,-0.0002,-0.3802,3.212,-0.4,-0.7682,0.6402,0,-0.5704,2.9839,-0.4,-0.7682,0.6402,0,-0.5704,2.9839,0.4,-0.7682,0.6402,0,-0.1901,3.349,0.4,-0.2341,0.9722,-0.0003,0,3.3948,0.4,-0.2341,0.9722,-0.0003,0,3.3945,-0.4,-0.2341,0.9722,-0.0003,0,3.3945,-0.4,-0.2329,0.9725,0,-0.1901,3.349,-0.4,-0.2329,0.9725,0,-0.1901,3.349,0.4,-0.2329,0.9725,0,-0.3802,3.2123,0.4,-0.5838,0.8119,0,-0.1901,3.349,0.4,-0.5838,0.8119,0,-0.1901,3.349,-0.4,-0.5838,0.8119,0,-0.1901,3.349,-0.4,-0.5844,0.8114,-0.0002,-0.3802,3.212,-0.4,-0.5844,0.8114,-0.0002,-0.3802,3.2123,0.4,-0.5844,0.8114,-0.0002,0,-2.5558,0.4,-0.2269,-0.9739,0.0001,0,-2.5559,-0.4,-0.2269,-0.9739,0.0001,3.6,-3.3947,-0.4,-0.2269,-0.9739,0.0001,3.6,-3.3947,-0.4,-0.2269,-0.9739,0,3.6,-3.3947,0.4,-0.2269,-0.9739,0,0,-2.5558,0.4,-0.2269,-0.9739,0,-3.6,-3.3947,0.4,-0.3544,-0.9351,0,-3.7681,-3.3309,0.4,-0.3544,-0.9351,0,-3.7681,-3.3309,-0.4,-0.3544,-0.9351,0,-3.7681,-3.3309,-0.4,-0.3544,-0.9351,0,-3.6,-3.3947,-0.4,-0.3544,-0.9351,0,-3.6,-3.3947,0.4,-0.3544,-0.9351,0,-3.7681,-3.3309,0.4,-0.5408,-0.8412,0,-3.9236,-3.231,0.4,-0.5408,-0.8412,0,-3.9236,-3.231,-0.4,-0.5408,-0.8412,0,-3.9236,-3.231,-0.4,-0.5408,-0.8412,0,-3.7681,-3.3309,-0.4,-0.5408,-0.8412,0,-3.7681,-3.3309,0.4,-0.5408,-0.8412,0,-3.9236,-3.231,0.4,-0.7108,-0.7034,0,-4.0534,-3.0999,0.4,-0.7108,-0.7034,0,-4.0534,-3.0999,-0.4,-0.7108,-0.7034,0,-4.0534,-3.0999,-0.4,-0.7108,-0.7034,0,-3.9236,-3.231,-0.4,-0.7108,-0.7034,0,-3.9236,-3.231,0.4,-0.7108,-0.7034,0,-4.0534,-3.0999,0.4,-0.8466,-0.5323,0,-4.1523,-2.9425,0.4,-0.8466,-0.5323,0,-4.1523,-2.9425,-0.4,-0.8466,-0.5323,0,-4.1523,-2.9425,-0.4,-0.8466,-0.5323,0,-4.0534,-3.0999,-0.4,-0.8466,-0.5323,0,-4.0534,-3.0999,0.4,-0.8466,-0.5323,0,-4.1523,-2.9425,0.4,-0.9427,-0.3337,0,-4.2154,-2.7644,0.4,-0.9427,-0.3337,0,-4.2154,-2.7644,-0.4,-0.9427,-0.3337,0,-4.2154,-2.7644,-0.4,-0.9427,-0.3337,0,-4.1523,-2.9425,-0.4,-0.9427,-0.3337,0,-4.1523,-2.9425,0.4,-0.9427,-0.3337,0,-4.2154,-2.7644,0.4,-0.9936,-0.1132,0,-4.2375,-2.5702,0.4,-0.9936,-0.1132,0,-4.2375,-2.5704,-0.4,-0.9936,-0.1132,0,-4.2375,-2.5704,-0.4,-0.9936,-0.1133,0,-4.2154,-2.7644,-0.4,-0.9936,-0.1133,0,-4.2154,-2.7644,0.4,-0.9936,-0.1133,0,-4.2375,-2.5702,0.4,-0.9936,0.1133,0,-4.2154,-2.3762,0.4,-0.9936,0.1133,0,-4.2154,-2.3762,-0.4,-0.9936,0.1133,0,-4.2154,-2.3762,-0.4,-0.9936,0.1132,0,-4.2375,-2.5704,-0.4,-0.9936,0.1132,0,-4.2375,-2.5702,0.4,-0.9936,0.1132,0,-4.2154,-2.3762,0.4,-0.9428,0.3333,-0.0001,-4.1523,-2.1979,0.4,-0.9428,0.3333,-0.0001,-4.1523,-2.1981,-0.4,-0.9428,0.3333,-0.0001,-4.1523,-2.1981,-0.4,-0.9427,0.3337,0,-4.2154,-2.3762,-0.4,-0.9427,0.3337,0,-4.2154,-2.3762,0.4,-0.9427,0.3337,0,-4.1523,-2.1979,0.4,-0.8458,0.5335,0,-4.0534,-2.041,0.4,-0.8458,0.5335,0,-4.0534,-2.041,-0.4,-0.8458,0.5335,0,-4.0534,-2.041,-0.4,-0.8462,0.5329,-0.0002,-4.1523,-2.1981,-0.4,-0.8462,0.5329,-0.0002,-4.1523,-2.1979,0.4,-0.8462,0.5329,-0.0002,0,3.3948,0.4,0.234,0.9722,0,0.1902,3.349,0.4,0.234,0.9722,0,0.1902,3.349,-0.4,0.234,0.9722,0,0.1902,3.349,-0.4,0.2329,0.9725,-0.0003,0,3.3945,-0.4,0.2329,0.9725,-0.0003,0,3.3948,0.4,0.2329,0.9725,-0.0003,0.1902,3.349,0.4,0.5845,0.8114,0,0.3803,3.212,0.4,0.5845,0.8114,0,0.3803,3.212,-0.4,0.5845,0.8114,0,0.3803,3.212,-0.4,0.5845,0.8114,0,0.1902,3.349,-0.4,0.5845,0.8114,0,0.1902,3.349,0.4,0.5845,0.8114,0,0.3803,3.212,0.4,0.7682,0.6402,0,0.5704,2.9839,0.4,0.7682,0.6402,0,0.5704,2.9839,-0.4,0.7682,0.6402,0,0.5704,2.9839,-0.4,0.7682,0.6402,0,0.3803,3.212,-0.4,0.7682,0.6402,0,0.3803,3.212,0.4,0.7682,0.6402,0,0.5704,2.9839,0.4,0.8219,0.5697,0,4.0534,-2.041,0.4,0.8219,0.5697,0,4.0534,-2.041,-0.4,0.8219,0.5697,0,4.0534,-2.041,-0.4,0.8219,0.5697,0,0.5704,2.9839,-0.4,0.8219,0.5697,0,0.5704,2.9839,0.4,0.8219,0.5697,0,4.0534,-2.041,0.4,0.8462,0.5329,0.0002,4.1523,-2.1981,0.4,0.8462,0.5329,0.0002,4.1523,-2.1979,-0.4,0.8462,0.5329,0.0002,4.1523,-2.1979,-0.4,0.8458,0.5335,0,4.0534,-2.041,-0.4,0.8458,0.5335,0,4.0534,-2.041,0.4,0.8458,0.5335,0,4.1523,-2.1981,0.4,0.9427,0.3337,0,4.2154,-2.3762,0.4,0.9427,0.3337,0,4.2154,-2.3762,-0.4,0.9427,0.3337,0,4.2154,-2.3762,-0.4,0.9428,0.3333,0.0001,4.1523,-2.1979,-0.4,0.9428,0.3333,0.0001,4.1523,-2.1981,0.4,0.9428,0.3333,0.0001,4.2154,-2.3762,0.4,0.9936,0.1133,0,4.2375,-2.5702,0.4,0.9936,0.1133,0,4.2375,-2.5702,-0.4,0.9936,0.1133,0,4.2375,-2.5702,-0.4,0.9936,0.1133,0,4.2154,-2.3762,-0.4,0.9936,0.1133,0,4.2154,-2.3762,0.4,0.9936,0.1133,0,4.2375,-2.5702,0.4,0.9936,-0.1132,0,4.2154,-2.7644,0.4,0.9936,-0.1132,0,4.2154,-2.7644,-0.4,0.9936,-0.1132,0,4.2154,-2.7644,-0.4,0.9936,-0.1132,0,4.2375,-2.5702,-0.4,0.9936,-0.1132,0,4.2375,-2.5702,0.4,0.9936,-0.1132,0,4.2154,-2.7644,0.4,0.9427,-0.3337,0,4.1523,-2.9425,0.4,0.9427,-0.3337,0,4.1523,-2.9425,-0.4,0.9427,-0.3337,0,4.1523,-2.9425,-0.4,0.9427,-0.3337,0,4.2154,-2.7644,-0.4,0.9427,-0.3337,0,4.2154,-2.7644,0.4,0.9427,-0.3337,0,4.1523,-2.9425,0.4,0.8466,-0.5323,0,4.0534,-3.0999,0.4,0.8466,-0.5323,0,4.0534,-3.0999,-0.4,0.8466,-0.5323,0,4.0534,-3.0999,-0.4,0.8466,-0.5323,0,4.1523,-2.9425,-0.4,0.8466,-0.5323,0,4.1523,-2.9425,0.4,0.8466,-0.5323,0,4.0534,-3.0999,0.4,0.7105,-0.7037,0,3.9237,-3.2308,0.4,0.7105,-0.7037,0,3.9237,-3.2308,-0.4,0.7105,-0.7037,0,3.9237,-3.2308,-0.4,0.7105,-0.7037,0,4.0534,-3.0999,-0.4,0.7105,-0.7037,0,4.0534,-3.0999,0.4,0.7105,-0.7037,0,3.9237,-3.2308,0.4,0.5412,-0.8409,0,3.7682,-3.3309,0.4,0.5412,-0.8409,0,3.7682,-3.3309,-0.4,0.5412,-0.8409,0,3.7682,-3.3309,-0.4,0.5412,-0.8409,0,3.9237,-3.2308,-0.4,0.5412,-0.8409,0,3.9237,-3.2308,0.4,0.5412,-0.8409,0,3.7682,-3.3309,0.4,0.3544,-0.9351,0,3.6,-3.3947,0.4,0.3544,-0.9351,0,3.6,-3.3947,-0.4,0.3544,-0.9351,0,3.6,-3.3947,-0.4,0.3544,-0.9351,0,3.7682,-3.3309,-0.4,0.3544,-0.9351,0,3.7682,-3.3309,0.4,0.3544,-0.9351,0,-3.6,-3.3947,0.4,0.2269,-0.9739,0,-3.6,-3.3947,-0.4,0.2269,-0.9739,0,0,-2.5559,-0.4,0.2269,-0.9739,0,0,-2.5559,-0.4,0.2269,-0.9739,0.0001,0,-2.5558,0.4,0.2269,-0.9739,0.0001,-3.6,-3.3947,0.4,0.2269,-0.9739,0.0001,-0.1901,3.349,0.4,0,0,1,-0.3802,3.2123,0.4,0,0,1,-0.5704,2.9839,0.4,0,0,1,0,3.3948,0.4,0,0,1,-0.1901,3.349,0.4,0,0,1,-0.5704,2.9839,0.4,0,0,1,0,3.3948,0.4,0,0,1,-0.5704,2.9839,0.4,0,0,1,-4.0534,-2.041,0.4,0,0,1,-4.0534,-2.041,0.4,0,0,1,-4.1523,-2.1979,0.4,0,0,1,-4.2154,-2.3762,0.4,0,0,1,-4.2154,-2.3762,0.4,0,0,1,-4.2375,-2.5702,0.4,0,0,1,-4.2154,-2.7644,0.4,0,0,1,-4.0534,-2.041,0.4,0,0,1,-4.2154,-2.3762,0.4,0,0,1,-4.2154,-2.7644,0.4,0,0,1,-4.2154,-2.7644,0.4,0,0,1,-4.1523,-2.9425,0.4,0,0,1,-4.0534,-3.0999,0.4,0,0,1,-3.9236,-3.231,0.4,-0.0001,-0.0002,1,-3.7681,-3.3309,0.4,0.0001,0.0002,1,-3.6,-3.3947,0.4,0,0,1,-4.0534,-3.0999,0.4,0,0,1,-3.9236,-3.231,0.4,-0.0001,-0.0002,1,-3.6,-3.3947,0.4,0,0,1,-4.2154,-2.7644,0.4,0,0,1,-4.0534,-3.0999,0.4,0,0,1,-3.6,-3.3947,0.4,0,0,1,-4.0534,-2.041,0.4,0,0,1,-4.2154,-2.7644,0.4,0,0,1,-3.6,-3.3947,0.4,0,0,1,0,3.3948,0.4,0,0,1,-4.0534,-2.041,0.4,0,0,1,-3.6,-3.3947,0.4,0,0,1,0,3.3948,0.4,0,0,1,-3.6,-3.3947,0.4,0,0,1,0,-2.5558,0.4,0,0,1],"indices":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245]}],"images":[{"name":"common_sprite","url":"http://rvproxy.devel.kakao.com/?url=http://map.daumcdn.net/map_roadview/static/images/common.png"},{"name":"empty_toast","url":"http://rvproxy.devel.kakao.com/?url=http://map.daumcdn.net/map_roadview/static/images/nothumb.png"}]}')},function(e){e.exports=JSON.parse('{"version":"2019-07-26","url":[{"name":"raster_tile","type":"tile","address":"https://map|4|.daumcdn.net/map_d3f_2d/3sta","format":"png"},{"name":"skyview_3d","type":"tile","address":"https://map|4|.daumcdn.net/map_d3b/k3t/18oct1","format":"d3g"},{"name":"debug_raster_tile","type":"tile_debug","address":"","format":""},{"name":"pano_preview","type":"p_preview","address":"https://map|4|.daumcdn.net/map_roadview","format":"jpg"},{"name":"pano_tile","type":"p_tile","address":"https://map|4|.daumcdn.net/map_roadview","format":"jpg"},{"name":"pano_debug_tile","type":"p_tile_debug","address":"","format":""},{"name":"street_mask","type":"p_street_mask","address":"https://map|4|.daumcdn.net/map_roadview/static/images/vehiclemask/RvBottom_","format":"png"},{"name":"street_json","type":"p_street","address":"https://rv.map.kakao.com/roadview-search/v2/node/","format":""},{"name":"street_near_json","type":"p_near_street","address":"https://rv.map.kakao.com/roadview-search/v2/near-node/","format":""},{"name":"store_json","type":"p_store","address":"https://rv.maps.daum.net/roadview-search/storeview?output=jsonp&","format":""},{"name":"rangesearch_json","type":"p_rangesearch","address":"https://rv.map.kakao.com/roadview-search/v2/nodes","format":""},{"name":"depthmap_image","type":"p_depthmap","address":"https://map|4|.daumcdn.net/map_roadview/depthmap_meerkat","format":"png"},{"name":"depthmap_dummy_image","type":"server_no","address":"https://map|4|.daumcdn.net/map_roadview/static/images/depthmap/default_W","format":"png"}]}')},function(e){e.exports=JSON.parse('{"version":"2019-04-11","url":[{"name":"raster_tile","type":"tile","address":"https://maps-proxy.dev.daum.net/map|4|/map_d3f_2d/3sta","format":"png"},{"name":"skyview_3d","type":"tile","address":"https://maps-proxy.dev.daum.net/map|4|/map_d3b/k3t/18oct1","format":"d3g"},{"name":"debug_raster_tile","type":"tile_debug","address":"","format":""},{"name":"pano_preview","type":"p_preview","address":"https://maps-proxy.dev.daum.net/map|4|/map_roadview","format":"jpg"},{"name":"pano_tile","type":"p_tile","address":"https://maps-proxy.dev.daum.net/map|4|/map_roadview","format":"jpg"},{"name":"pano_debug_tile","type":"p_tile_debug","address":"","format":""},{"name":"street_mask","type":"p_street_mask","address":"http://maps-util-api.devel.kakao.com/api/v1/proxy/png?url=http://t1.daumcdn.net/mapjsapi/images/panorama/vehiclemask/RvBottom_","format":"png"},{"name":"street_json","type":"p_street","address":"https://rv.map.kakao.com/roadview-search/v2/node/","format":""},{"name":"street_near_json","type":"p_near_street","address":"https://rv.map.kakao.com/roadview-search/v2/near-node/","format":""},{"name":"store_json","type":"p_store","address":"https://rv.maps.daum.net/roadview-search/storeview?output=jsonp&","format":""},{"name":"rangesearch_json","type":"p_rangesearch","address":"https://rv.map.kakao.com/roadview-search/v2/nodes","format":""},{"name":"depthmap_image","type":"p_depthmap","address":"http://maps-util-api.devel.kakao.com/api/v1/proxy/png?url=http://map0.daumcdn.net/map_roadview/depthmap_meerkat","format":"png"},{"name":"depthmap_dummy_image","type":"normal","address":"http://maps-util-api.devel.kakao.com/api/v1/proxy/png?url=http://t1.daumcdn.net/mapjsapi/images/panorama/depthmap/default","format":"png"}]}')},function(e,t,n){n(131),e.exports=n(339)},function(e,t,n){"use strict";n(132);var r,i=(r=n(304))&&r.__esModule?r:{default:r};i.default._babelPolyfill&&"undefined"!=typeof console&&console.warn&&console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended and may have consequences if different versions of the polyfills are applied sequentially. If you do need to load the polyfill more than once, use @babel/polyfill/noConflict instead to bypass the warning."),i.default._babelPolyfill=!0},function(e,t,n){"use strict";n(133),n(276),n(278),n(281),n(283),n(285),n(287),n(289),n(291),n(293),n(295),n(297),n(299),n(303)},function(e,t,n){n(134),n(137),n(138),n(139),n(140),n(141),n(142),n(143),n(144),n(145),n(146),n(147),n(148),n(149),n(150),n(151),n(152),n(153),n(154),n(155),n(156),n(157),n(158),n(159),n(160),n(161),n(162),n(163),n(164),n(165),n(166),n(167),n(168),n(169),n(170),n(171),n(172),n(173),n(174),n(175),n(176),n(177),n(178),n(180),n(181),n(182),n(183),n(184),n(185),n(186),n(187),n(188),n(189),n(190),n(191),n(192),n(193),n(194),n(195),n(196),n(197),n(198),n(199),n(200),n(201),n(202),n(203),n(204),n(205),n(206),n(207),n(208),n(209),n(210),n(211),n(212),n(213),n(215),n(216),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),n(235),n(236),n(237),n(238),n(81),n(239),n(110),n(240),n(111),n(241),n(242),n(243),n(244),n(112),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(274),n(275),e.exports=n(7)},function(e,t,n){"use strict";var r=n(1),i=n(13),a=n(8),o=n(0),s=n(11),u=n(27).KEY,l=n(2),c=n(48),f=n(38),h=n(29),p=n(5),d=n(62),v=n(91),y=n(136),m=n(51),g=n(3),b=n(4),w=n(10),_=n(15),T=n(26),x=n(28),S=n(33),k=n(94),P=n(20),O=n(50),E=n(9),I=n(31),M=P.f,C=E.f,R=k.f,A=r.Symbol,L=r.JSON,D=L&&L.stringify,N=p("_hidden"),F=p("toPrimitive"),j={}.propertyIsEnumerable,V=c("symbol-registry"),B=c("symbols"),U=c("op-symbols"),G=Object.prototype,H="function"==typeof A&&!!O.f,z=r.QObject,W=!z||!z.prototype||!z.prototype.findChild,q=a&&l(function(){return 7!=S(C({},"a",{get:function(){return C(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=M(G,t);r&&delete G[t],C(e,t,n),r&&e!==G&&C(G,t,r)}:C,Y=function(e){var t=B[e]=S(A.prototype);return t._k=e,t},X=H&&"symbol"==typeof A.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof A},K=function(e,t,n){return e===G&&K(U,t,n),g(e),t=T(t,!0),g(n),i(B,t)?(n.enumerable?(i(e,N)&&e[N][t]&&(e[N][t]=!1),n=S(n,{enumerable:x(0,!1)})):(i(e,N)||C(e,N,x(1,{})),e[N][t]=!0),q(e,t,n)):C(e,t,n)},Z=function(e,t){g(e);for(var n,r=y(t=_(t)),i=0,a=r.length;a>i;)K(e,n=r[i++],t[n]);return e},Q=function(e){var t=j.call(this,e=T(e,!0));return!(this===G&&i(B,e)&&!i(U,e))&&(!(t||!i(this,e)||!i(B,e)||i(this,N)&&this[N][e])||t)},J=function(e,t){if(e=_(e),t=T(t,!0),e!==G||!i(B,t)||i(U,t)){var n=M(e,t);return!n||!i(B,t)||i(e,N)&&e[N][t]||(n.enumerable=!0),n}},$=function(e){for(var t,n=R(_(e)),r=[],a=0;n.length>a;)i(B,t=n[a++])||t==N||t==u||r.push(t);return r},ee=function(e){for(var t,n=e===G,r=R(n?U:_(e)),a=[],o=0;r.length>o;)!i(B,t=r[o++])||n&&!i(G,t)||a.push(B[t]);return a};H||(s((A=function(){if(this instanceof A)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(n){this===G&&t.call(U,n),i(this,N)&&i(this[N],e)&&(this[N][e]=!1),q(this,e,x(1,n))};return a&&W&&q(G,e,{configurable:!0,set:t}),Y(e)}).prototype,"toString",function(){return this._k}),P.f=J,E.f=K,n(34).f=k.f=$,n(45).f=Q,O.f=ee,a&&!n(30)&&s(G,"propertyIsEnumerable",Q,!0),d.f=function(e){return Y(p(e))}),o(o.G+o.W+o.F*!H,{Symbol:A});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)p(te[ne++]);for(var re=I(p.store),ie=0;re.length>ie;)v(re[ie++]);o(o.S+o.F*!H,"Symbol",{for:function(e){return i(V,e+="")?V[e]:V[e]=A(e)},keyFor:function(e){if(!X(e))throw TypeError(e+" is not a symbol!");for(var t in V)if(V[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),o(o.S+o.F*!H,"Object",{create:function(e,t){return void 0===t?S(e):Z(S(e),t)},defineProperty:K,defineProperties:Z,getOwnPropertyDescriptor:J,getOwnPropertyNames:$,getOwnPropertySymbols:ee});var ae=l(function(){O.f(1)});o(o.S+o.F*ae,"Object",{getOwnPropertySymbols:function(e){return O.f(w(e))}}),L&&o(o.S+o.F*(!H||l(function(){var e=A();return"[null]"!=D([e])||"{}"!=D({a:e})||"{}"!=D(Object(e))})),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(b(t)||void 0!==e)&&!X(e))return m(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!X(t))return t}),r[1]=t,D.apply(L,r)}}),A.prototype[F]||n(14)(A.prototype,F,A.prototype.valueOf),f(A,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},function(e,t,n){e.exports=n(48)("native-function-to-string",Function.toString)},function(e,t,n){var r=n(31),i=n(50),a=n(45);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var o,s=n(e),u=a.f,l=0;s.length>l;)u.call(e,o=s[l++])&&t.push(o);return t}},function(e,t,n){var r=n(0);r(r.S,"Object",{create:n(33)})},function(e,t,n){var r=n(0);r(r.S+r.F*!n(8),"Object",{defineProperty:n(9).f})},function(e,t,n){var r=n(0);r(r.S+r.F*!n(8),"Object",{defineProperties:n(93)})},function(e,t,n){var r=n(15),i=n(20).f;n(21)("getOwnPropertyDescriptor",function(){return function(e,t){return i(r(e),t)}})},function(e,t,n){var r=n(10),i=n(35);n(21)("getPrototypeOf",function(){return function(e){return i(r(e))}})},function(e,t,n){var r=n(10),i=n(31);n(21)("keys",function(){return function(e){return i(r(e))}})},function(e,t,n){n(21)("getOwnPropertyNames",function(){return n(94).f})},function(e,t,n){var r=n(4),i=n(27).onFreeze;n(21)("freeze",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){var r=n(4),i=n(27).onFreeze;n(21)("seal",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){var r=n(4),i=n(27).onFreeze;n(21)("preventExtensions",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){var r=n(4);n(21)("isFrozen",function(e){return function(t){return!r(t)||!!e&&e(t)}})},function(e,t,n){var r=n(4);n(21)("isSealed",function(e){return function(t){return!r(t)||!!e&&e(t)}})},function(e,t,n){var r=n(4);n(21)("isExtensible",function(e){return function(t){return!!r(t)&&(!e||e(t))}})},function(e,t,n){var r=n(0);r(r.S+r.F,"Object",{assign:n(95)})},function(e,t,n){var r=n(0);r(r.S,"Object",{is:n(96)})},function(e,t,n){var r=n(0);r(r.S,"Object",{setPrototypeOf:n(66).set})},function(e,t,n){"use strict";var r=n(46),i={};i[n(5)("toStringTag")]="z",i+""!="[object z]"&&n(11)(Object.prototype,"toString",function(){return"[object "+r(this)+"]"},!0)},function(e,t,n){var r=n(0);r(r.P,"Function",{bind:n(97)})},function(e,t,n){var r=n(9).f,i=Function.prototype,a=/^\s*function ([^ (]*)/;"name"in i||n(8)&&r(i,"name",{configurable:!0,get:function(){try{return(""+this).match(a)[1]}catch(e){return""}}})},function(e,t,n){"use strict";var r=n(4),i=n(35),a=n(5)("hasInstance"),o=Function.prototype;a in o||n(9).f(o,a,{value:function(e){if("function"!=typeof this||!r(e))return!1;if(!r(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},function(e,t,n){var r=n(0),i=n(99);r(r.G+r.F*(parseInt!=i),{parseInt:i})},function(e,t,n){var r=n(0),i=n(100);r(r.G+r.F*(parseFloat!=i),{parseFloat:i})},function(e,t,n){"use strict";var r=n(1),i=n(13),a=n(23),o=n(68),s=n(26),u=n(2),l=n(34).f,c=n(20).f,f=n(9).f,h=n(39).trim,p=r.Number,d=p,v=p.prototype,y="Number"==a(n(33)(v)),m="trim"in String.prototype,g=function(e){var t=s(e,!1);if("string"==typeof t&&t.length>2){var n,r,i,a=(t=m?t.trim():h(t,3)).charCodeAt(0);if(43===a||45===a){if(88===(n=t.charCodeAt(2))||120===n)return NaN}else if(48===a){switch(t.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+t}for(var o,u=t.slice(2),l=0,c=u.length;l<c;l++)if((o=u.charCodeAt(l))<48||o>i)return NaN;return parseInt(u,r)}}return+t};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof p&&(y?u(function(){v.valueOf.call(n)}):"Number"!=a(n))?o(new d(g(t)),n,p):g(t)};for(var b,w=n(8)?l(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),_=0;w.length>_;_++)i(d,b=w[_])&&!i(p,b)&&f(p,b,c(d,b));p.prototype=v,v.constructor=p,n(11)(r,"Number",p)}},function(e,t,n){"use strict";var r=n(0),i=n(19),a=n(101),o=n(69),s=1..toFixed,u=Math.floor,l=[0,0,0,0,0,0],c="Number.toFixed: incorrect invocation!",f=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*l[n],l[n]=r%1e7,r=u(r/1e7)},h=function(e){for(var t=6,n=0;--t>=0;)n+=l[t],l[t]=u(n/e),n=n%e*1e7},p=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==l[e]){var n=String(l[e]);t=""===t?n:t+o.call("0",7-n.length)+n}return t},d=function(e,t,n){return 0===t?n:t%2==1?d(e,t-1,n*e):d(e*e,t/2,n)};r(r.P+r.F*(!!s&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n(2)(function(){s.call({})})),"Number",{toFixed:function(e){var t,n,r,s,u=a(this,c),l=i(e),v="",y="0";if(l<0||l>20)throw RangeError(c);if(u!=u)return"NaN";if(u<=-1e21||u>=1e21)return String(u);if(u<0&&(v="-",u=-u),u>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(u*d(2,69,1))-69)<0?u*d(2,-t,1):u/d(2,t,1),n*=4503599627370496,(t=52-t)>0){for(f(0,n),r=l;r>=7;)f(1e7,0),r-=7;for(f(d(10,r,1),0),r=t-1;r>=23;)h(1<<23),r-=23;h(1<<r),f(1,1),h(2),y=p()}else f(0,n),f(1<<-t,0),y=p()+o.call("0",l);return y=l>0?v+((s=y.length)<=l?"0."+o.call("0",l-s)+y:y.slice(0,s-l)+"."+y.slice(s-l)):v+y}})},function(e,t,n){"use strict";var r=n(0),i=n(2),a=n(101),o=1..toPrecision;r(r.P+r.F*(i(function(){return"1"!==o.call(1,void 0)})||!i(function(){o.call({})})),"Number",{toPrecision:function(e){var t=a(this,"Number#toPrecision: incorrect invocation!");return void 0===e?o.call(t):o.call(t,e)}})},function(e,t,n){var r=n(0);r(r.S,"Number",{EPSILON:Math.pow(2,-52)})},function(e,t,n){var r=n(0),i=n(1).isFinite;r(r.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},function(e,t,n){var r=n(0);r(r.S,"Number",{isInteger:n(102)})},function(e,t,n){var r=n(0);r(r.S,"Number",{isNaN:function(e){return e!=e}})},function(e,t,n){var r=n(0),i=n(102),a=Math.abs;r(r.S,"Number",{isSafeInteger:function(e){return i(e)&&a(e)<=9007199254740991}})},function(e,t,n){var r=n(0);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,n){var r=n(0);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,n){var r=n(0),i=n(100);r(r.S+r.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(e,t,n){var r=n(0),i=n(99);r(r.S+r.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(e,t,n){var r=n(0),i=n(103),a=Math.sqrt,o=Math.acosh;r(r.S+r.F*!(o&&710==Math.floor(o(Number.MAX_VALUE))&&o(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:i(e-1+a(e-1)*a(e+1))}})},function(e,t,n){var r=n(0),i=Math.asinh;r(r.S+r.F*!(i&&1/i(0)>0),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}})},function(e,t,n){var r=n(0),i=Math.atanh;r(r.S+r.F*!(i&&1/i(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},function(e,t,n){var r=n(0),i=n(70);r(r.S,"Math",{cbrt:function(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},function(e,t,n){var r=n(0),i=Math.exp;r(r.S,"Math",{cosh:function(e){return(i(e=+e)+i(-e))/2}})},function(e,t,n){var r=n(0),i=n(71);r(r.S+r.F*(i!=Math.expm1),"Math",{expm1:i})},function(e,t,n){var r=n(0);r(r.S,"Math",{fround:n(179)})},function(e,t,n){var r=n(70),i=Math.pow,a=i(2,-52),o=i(2,-23),s=i(2,127)*(2-o),u=i(2,-126);e.exports=Math.fround||function(e){var t,n,i=Math.abs(e),l=r(e);return i<u?l*(i/u/o+1/a-1/a)*u*o:(n=(t=(1+o/a)*i)-(t-i))>s||n!=n?l*(1/0):l*n}},function(e,t,n){var r=n(0),i=Math.abs;r(r.S,"Math",{hypot:function(e,t){for(var n,r,a=0,o=0,s=arguments.length,u=0;o<s;)u<(n=i(arguments[o++]))?(a=a*(r=u/n)*r+1,u=n):a+=n>0?(r=n/u)*r:n;return u===1/0?1/0:u*Math.sqrt(a)}})},function(e,t,n){var r=n(0),i=Math.imul;r(r.S+r.F*n(2)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(e,t){var n=+e,r=+t,i=65535&n,a=65535&r;return 0|i*a+((65535&n>>>16)*a+i*(65535&r>>>16)<<16>>>0)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},function(e,t,n){var r=n(0);r(r.S,"Math",{log1p:n(103)})},function(e,t,n){var r=n(0);r(r.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},function(e,t,n){var r=n(0);r(r.S,"Math",{sign:n(70)})},function(e,t,n){var r=n(0),i=n(71),a=Math.exp;r(r.S+r.F*n(2)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(a(e-1)-a(-e-1))*(Math.E/2)}})},function(e,t,n){var r=n(0),i=n(71),a=Math.exp;r(r.S,"Math",{tanh:function(e){var t=i(e=+e),n=i(-e);return t==1/0?1:n==1/0?-1:(t-n)/(a(e)+a(-e))}})},function(e,t,n){var r=n(0);r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},function(e,t,n){var r=n(0),i=n(32),a=String.fromCharCode,o=String.fromCodePoint;r(r.S+r.F*(!!o&&1!=o.length),"String",{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,o=0;r>o;){if(t=+arguments[o++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");n.push(t<65536?a(t):a(55296+((t-=65536)>>10),t%1024+56320))}return n.join("")}})},function(e,t,n){var r=n(0),i=n(15),a=n(6);r(r.S,"String",{raw:function(e){for(var t=i(e.raw),n=a(t.length),r=arguments.length,o=[],s=0;n>s;)o.push(String(t[s++])),s<r&&o.push(String(arguments[s]));return o.join("")}})},function(e,t,n){"use strict";n(39)("trim",function(e){return function(){return e(this,3)}})},function(e,t,n){"use strict";var r=n(72)(!0);n(73)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){"use strict";var r=n(0),i=n(72)(!1);r(r.P,"String",{codePointAt:function(e){return i(this,e)}})},function(e,t,n){"use strict";var r=n(0),i=n(6),a=n(74),o="".endsWith;r(r.P+r.F*n(76)("endsWith"),"String",{endsWith:function(e){var t=a(this,e,"endsWith"),n=arguments.length>1?arguments[1]:void 0,r=i(t.length),s=void 0===n?r:Math.min(i(n),r),u=String(e);return o?o.call(t,u,s):t.slice(s-u.length,s)===u}})},function(e,t,n){"use strict";var r=n(0),i=n(74);r(r.P+r.F*n(76)("includes"),"String",{includes:function(e){return!!~i(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var r=n(0);r(r.P,"String",{repeat:n(69)})},function(e,t,n){"use strict";var r=n(0),i=n(6),a=n(74),o="".startsWith;r(r.P+r.F*n(76)("startsWith"),"String",{startsWith:function(e){var t=a(this,e,"startsWith"),n=i(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return o?o.call(t,r,n):t.slice(n,n+r.length)===r}})},function(e,t,n){"use strict";n(12)("anchor",function(e){return function(t){return e(this,"a","name",t)}})},function(e,t,n){"use strict";n(12)("big",function(e){return function(){return e(this,"big","","")}})},function(e,t,n){"use strict";n(12)("blink",function(e){return function(){return e(this,"blink","","")}})},function(e,t,n){"use strict";n(12)("bold",function(e){return function(){return e(this,"b","","")}})},function(e,t,n){"use strict";n(12)("fixed",function(e){return function(){return e(this,"tt","","")}})},function(e,t,n){"use strict";n(12)("fontcolor",function(e){return function(t){return e(this,"font","color",t)}})},function(e,t,n){"use strict";n(12)("fontsize",function(e){return function(t){return e(this,"font","size",t)}})},function(e,t,n){"use strict";n(12)("italics",function(e){return function(){return e(this,"i","","")}})},function(e,t,n){"use strict";n(12)("link",function(e){return function(t){return e(this,"a","href",t)}})},function(e,t,n){"use strict";n(12)("small",function(e){return function(){return e(this,"small","","")}})},function(e,t,n){"use strict";n(12)("strike",function(e){return function(){return e(this,"strike","","")}})},function(e,t,n){"use strict";n(12)("sub",function(e){return function(){return e(this,"sub","","")}})},function(e,t,n){"use strict";n(12)("sup",function(e){return function(){return e(this,"sup","","")}})},function(e,t,n){var r=n(0);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,n){"use strict";var r=n(0),i=n(10),a=n(26);r(r.P+r.F*n(2)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(e){var t=i(this),n=a(t);return"number"!=typeof n||isFinite(n)?t.toISOString():null}})},function(e,t,n){var r=n(0),i=n(214);r(r.P+r.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},function(e,t,n){"use strict";var r=n(2),i=Date.prototype.getTime,a=Date.prototype.toISOString,o=function(e){return e>9?e:"0"+e};e.exports=r(function(){return"0385-07-25T07:06:39.999Z"!=a.call(new Date(-5e13-1))})||!r(function(){a.call(new Date(NaN))})?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),n=e.getUTCMilliseconds(),r=t<0?"-":t>9999?"+":"";return r+("00000"+Math.abs(t)).slice(r?-6:-4)+"-"+o(e.getUTCMonth()+1)+"-"+o(e.getUTCDate())+"T"+o(e.getUTCHours())+":"+o(e.getUTCMinutes())+":"+o(e.getUTCSeconds())+"."+(n>99?n:"0"+o(n))+"Z"}:a},function(e,t,n){var r=Date.prototype,i=r.toString,a=r.getTime;new Date(NaN)+""!="Invalid Date"&&n(11)(r,"toString",function(){var e=a.call(this);return e==e?i.call(this):"Invalid Date"})},function(e,t,n){var r=n(5)("toPrimitive"),i=Date.prototype;r in i||n(14)(i,r,n(217))},function(e,t,n){"use strict";var r=n(3),i=n(26);e.exports=function(e){if("string"!==e&&"number"!==e&&"default"!==e)throw TypeError("Incorrect hint");return i(r(this),"number"!=e)}},function(e,t,n){var r=n(0);r(r.S,"Array",{isArray:n(51)})},function(e,t,n){"use strict";var r=n(17),i=n(0),a=n(10),o=n(105),s=n(77),u=n(6),l=n(78),c=n(79);i(i.S+i.F*!n(52)(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,i,f,h=a(e),p="function"==typeof this?this:Array,d=arguments.length,v=d>1?arguments[1]:void 0,y=void 0!==v,m=0,g=c(h);if(y&&(v=r(v,d>2?arguments[2]:void 0,2)),null==g||p==Array&&s(g))for(n=new p(t=u(h.length));t>m;m++)l(n,m,y?v(h[m],m):h[m]);else for(f=g.call(h),n=new p;!(i=f.next()).done;m++)l(n,m,y?o(f,v,[i.value,m],!0):i.value);return n.length=m,n}})},function(e,t,n){"use strict";var r=n(0),i=n(78);r(r.S+r.F*n(2)(function(){function e(){}return!(Array.of.call(e)instanceof e)}),"Array",{of:function(){for(var e=0,t=arguments.length,n=new("function"==typeof this?this:Array)(t);t>e;)i(n,e,arguments[e++]);return n.length=t,n}})},function(e,t,n){"use strict";var r=n(0),i=n(15),a=[].join;r(r.P+r.F*(n(44)!=Object||!n(16)(a)),"Array",{join:function(e){return a.call(i(this),void 0===e?",":e)}})},function(e,t,n){"use strict";var r=n(0),i=n(65),a=n(23),o=n(32),s=n(6),u=[].slice;r(r.P+r.F*n(2)(function(){i&&u.call(i)}),"Array",{slice:function(e,t){var n=s(this.length),r=a(this);if(t=void 0===t?n:t,"Array"==r)return u.call(this,e,t);for(var i=o(e,n),l=o(t,n),c=s(l-i),f=new Array(c),h=0;h<c;h++)f[h]="String"==r?this.charAt(i+h):this[i+h];return f}})},function(e,t,n){"use strict";var r=n(0),i=n(18),a=n(10),o=n(2),s=[].sort,u=[1,2,3];r(r.P+r.F*(o(function(){u.sort(void 0)})||!o(function(){u.sort(null)})||!n(16)(s)),"Array",{sort:function(e){return void 0===e?s.call(a(this)):s.call(a(this),i(e))}})},function(e,t,n){"use strict";var r=n(0),i=n(22)(0),a=n(16)([].forEach,!0);r(r.P+r.F*!a,"Array",{forEach:function(e){return i(this,e,arguments[1])}})},function(e,t,n){var r=n(4),i=n(51),a=n(5)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){"use strict";var r=n(0),i=n(22)(1);r(r.P+r.F*!n(16)([].map,!0),"Array",{map:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(22)(2);r(r.P+r.F*!n(16)([].filter,!0),"Array",{filter:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(22)(3);r(r.P+r.F*!n(16)([].some,!0),"Array",{some:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(22)(4);r(r.P+r.F*!n(16)([].every,!0),"Array",{every:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(107);r(r.P+r.F*!n(16)([].reduce,!0),"Array",{reduce:function(e){return i(this,e,arguments.length,arguments[1],!1)}})},function(e,t,n){"use strict";var r=n(0),i=n(107);r(r.P+r.F*!n(16)([].reduceRight,!0),"Array",{reduceRight:function(e){return i(this,e,arguments.length,arguments[1],!0)}})},function(e,t,n){"use strict";var r=n(0),i=n(49)(!1),a=[].indexOf,o=!!a&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(o||!n(16)(a)),"Array",{indexOf:function(e){return o?a.apply(this,arguments)||0:i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(15),a=n(19),o=n(6),s=[].lastIndexOf,u=!!s&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(u||!n(16)(s)),"Array",{lastIndexOf:function(e){if(u)return s.apply(this,arguments)||0;var t=i(this),n=o(t.length),r=n-1;for(arguments.length>1&&(r=Math.min(r,a(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}})},function(e,t,n){var r=n(0);r(r.P,"Array",{copyWithin:n(108)}),n(36)("copyWithin")},function(e,t,n){var r=n(0);r(r.P,"Array",{fill:n(80)}),n(36)("fill")},function(e,t,n){"use strict";var r=n(0),i=n(22)(5),a=!0;"find"in[]&&Array(1).find(function(){a=!1}),r(r.P+r.F*a,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(36)("find")},function(e,t,n){"use strict";var r=n(0),i=n(22)(6),a="findIndex",o=!0;a in[]&&Array(1)[a](function(){o=!1}),r(r.P+r.F*o,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(36)(a)},function(e,t,n){n(41)("Array")},function(e,t,n){var r=n(1),i=n(68),a=n(9).f,o=n(34).f,s=n(75),u=n(53),l=r.RegExp,c=l,f=l.prototype,h=/a/g,p=/a/g,d=new l(h)!==h;if(n(8)&&(!d||n(2)(function(){return p[n(5)("match")]=!1,l(h)!=h||l(p)==p||"/a/i"!=l(h,"i")}))){l=function(e,t){var n=this instanceof l,r=s(e),a=void 0===t;return!n&&r&&e.constructor===l&&a?e:i(d?new c(r&&!a?e.source:e,t):c((r=e instanceof l)?e.source:e,r&&a?u.call(e):t),n?this:f,l)};for(var v=function(e){e in l||a(l,e,{configurable:!0,get:function(){return c[e]},set:function(t){c[e]=t}})},y=o(c),m=0;y.length>m;)v(y[m++]);f.constructor=l,l.prototype=f,n(11)(r,"RegExp",l)}n(41)("RegExp")},function(e,t,n){"use strict";n(111);var r=n(3),i=n(53),a=n(8),o=/./.toString,s=function(e){n(11)(RegExp.prototype,"toString",e,!0)};n(2)(function(){return"/a/b"!=o.call({source:"a",flags:"b"})})?s(function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!a&&e instanceof RegExp?i.call(e):void 0)}):"toString"!=o.name&&s(function(){return o.call(this)})},function(e,t,n){"use strict";var r=n(3),i=n(6),a=n(83),o=n(54);n(55)("match",1,function(e,t,n,s){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=s(n,e,this);if(t.done)return t.value;var u=r(e),l=String(this);if(!u.global)return o(u,l);var c=u.unicode;u.lastIndex=0;for(var f,h=[],p=0;null!==(f=o(u,l));){var d=String(f[0]);h[p]=d,""===d&&(u.lastIndex=a(l,i(u.lastIndex),c)),p++}return 0===p?null:h}]})},function(e,t,n){"use strict";var r=n(3),i=n(10),a=n(6),o=n(19),s=n(83),u=n(54),l=Math.max,c=Math.min,f=Math.floor,h=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g;n(55)("replace",2,function(e,t,n,d){return[function(r,i){var a=e(this),o=null==r?void 0:r[t];return void 0!==o?o.call(r,a,i):n.call(String(a),r,i)},function(e,t){var i=d(n,e,this,t);if(i.done)return i.value;var f=r(e),h=String(this),p="function"==typeof t;p||(t=String(t));var y=f.global;if(y){var m=f.unicode;f.lastIndex=0}for(var g=[];;){var b=u(f,h);if(null===b)break;if(g.push(b),!y)break;""===String(b[0])&&(f.lastIndex=s(h,a(f.lastIndex),m))}for(var w,_="",T=0,x=0;x<g.length;x++){b=g[x];for(var S=String(b[0]),k=l(c(o(b.index),h.length),0),P=[],O=1;O<b.length;O++)P.push(void 0===(w=b[O])?w:String(w));var E=b.groups;if(p){var I=[S].concat(P,k,h);void 0!==E&&I.push(E);var M=String(t.apply(void 0,I))}else M=v(S,h,k,P,E,t);k>=T&&(_+=h.slice(T,k)+M,T=k+S.length)}return _+h.slice(T)}];function v(e,t,r,a,o,s){var u=r+e.length,l=a.length,c=p;return void 0!==o&&(o=i(o),c=h),n.call(s,c,function(n,i){var s;switch(i.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(u);case"<":s=o[i.slice(1,-1)];break;default:var c=+i;if(0===c)return n;if(c>l){var h=f(c/10);return 0===h?n:h<=l?void 0===a[h-1]?i.charAt(1):a[h-1]+i.charAt(1):n}s=a[c-1]}return void 0===s?"":s})}})},function(e,t,n){"use strict";var r=n(3),i=n(96),a=n(54);n(55)("search",1,function(e,t,n,o){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=o(n,e,this);if(t.done)return t.value;var s=r(e),u=String(this),l=s.lastIndex;i(l,0)||(s.lastIndex=0);var c=a(s,u);return i(s.lastIndex,l)||(s.lastIndex=l),null===c?-1:c.index}]})},function(e,t,n){"use strict";var r=n(75),i=n(3),a=n(47),o=n(83),s=n(6),u=n(54),l=n(82),c=n(2),f=Math.min,h=[].push,p=!c(function(){RegExp(4294967295,"y")});n(55)("split",2,function(e,t,n,c){var d;return d="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,t){var i=String(this);if(void 0===e&&0===t)return[];if(!r(e))return n.call(i,e,t);for(var a,o,s,u=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,p=void 0===t?4294967295:t>>>0,d=new RegExp(e.source,c+"g");(a=l.call(d,i))&&!((o=d.lastIndex)>f&&(u.push(i.slice(f,a.index)),a.length>1&&a.index<i.length&&h.apply(u,a.slice(1)),s=a[0].length,f=o,u.length>=p));)d.lastIndex===a.index&&d.lastIndex++;return f===i.length?!s&&d.test("")||u.push(""):u.push(i.slice(f)),u.length>p?u.slice(0,p):u}:"0".split(void 0,0).length?function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)}:n,[function(n,r){var i=e(this),a=null==n?void 0:n[t];return void 0!==a?a.call(n,i,r):d.call(String(i),n,r)},function(e,t){var r=c(d,e,this,t,d!==n);if(r.done)return r.value;var l=i(e),h=String(this),v=a(l,RegExp),y=l.unicode,m=(l.ignoreCase?"i":"")+(l.multiline?"m":"")+(l.unicode?"u":"")+(p?"y":"g"),g=new v(p?l:"^(?:"+l.source+")",m),b=void 0===t?4294967295:t>>>0;if(0===b)return[];if(0===h.length)return null===u(g,h)?[h]:[];for(var w=0,_=0,T=[];_<h.length;){g.lastIndex=p?_:0;var x,S=u(g,p?h:h.slice(_));if(null===S||(x=f(s(g.lastIndex+(p?0:_)),h.length))===w)_=o(h,_,y);else{if(T.push(h.slice(w,_)),T.length===b)return T;for(var k=1;k<=S.length-1;k++)if(T.push(S[k]),T.length===b)return T;_=w=x}}return T.push(h.slice(w)),T}]})},function(e,t,n){var r=n(1),i=n(84).set,a=r.MutationObserver||r.WebKitMutationObserver,o=r.process,s=r.Promise,u="process"==n(23)(o);e.exports=function(){var e,t,n,l=function(){var r,i;for(u&&(r=o.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){o.nextTick(l)};else if(!a||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var c=s.resolve(void 0);n=function(){c.then(l)}}else n=function(){i.call(r,l)};else{var f=!0,h=document.createTextNode("");new a(l).observe(h,{characterData:!0}),n=function(){h.data=f=!f}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){"use strict";var r=n(115),i=n(37);e.exports=n(58)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(i(this,"Map"),0===e?0:e,t)}},r,!0)},function(e,t,n){"use strict";var r=n(115),i=n(37);e.exports=n(58)("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return r.def(i(this,"Set"),e=0===e?0:e,e)}},r)},function(e,t,n){"use strict";var r,i=n(1),a=n(22)(0),o=n(11),s=n(27),u=n(95),l=n(116),c=n(4),f=n(37),h=n(37),p=!i.ActiveXObject&&"ActiveXObject"in i,d=s.getWeak,v=Object.isExtensible,y=l.ufstore,m=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},g={get:function(e){if(c(e)){var t=d(e);return!0===t?y(f(this,"WeakMap")).get(e):t?t[this._i]:void 0}},set:function(e,t){return l.def(f(this,"WeakMap"),e,t)}},b=e.exports=n(58)("WeakMap",m,g,l,!0,!0);h&&p&&(u((r=l.getConstructor(m,"WeakMap")).prototype,g),s.NEED=!0,a(["delete","has","get","set"],function(e){var t=b.prototype,n=t[e];o(t,e,function(t,i){if(c(t)&&!v(t)){this._f||(this._f=new r);var a=this._f[e](t,i);return"set"==e?this:a}return n.call(this,t,i)})}))},function(e,t,n){"use strict";var r=n(116),i=n(37);n(58)("WeakSet",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return r.def(i(this,"WeakSet"),e,!0)}},r,!1,!0)},function(e,t,n){"use strict";var r=n(0),i=n(59),a=n(85),o=n(3),s=n(32),u=n(6),l=n(4),c=n(1).ArrayBuffer,f=n(47),h=a.ArrayBuffer,p=a.DataView,d=i.ABV&&c.isView,v=h.prototype.slice,y=i.VIEW;r(r.G+r.W+r.F*(c!==h),{ArrayBuffer:h}),r(r.S+r.F*!i.CONSTR,"ArrayBuffer",{isView:function(e){return d&&d(e)||l(e)&&y in e}}),r(r.P+r.U+r.F*n(2)(function(){return!new h(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(e,t){if(void 0!==v&&void 0===t)return v.call(o(this),e);for(var n=o(this).byteLength,r=s(e,n),i=s(void 0===t?n:t,n),a=new(f(this,h))(u(i-r)),l=new p(this),c=new p(a),d=0;r<i;)c.setUint8(d++,l.getUint8(r++));return a}}),n(41)("ArrayBuffer")},function(e,t,n){var r=n(0);r(r.G+r.W+r.F*!n(59).ABV,{DataView:n(85).DataView})},function(e,t,n){n(25)("Int8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(25)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(25)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}},!0)},function(e,t,n){n(25)("Int16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(25)("Uint16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(25)("Int32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(25)("Uint32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(25)("Float32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(25)("Float64",8,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){var r=n(0),i=n(18),a=n(3),o=(n(1).Reflect||{}).apply,s=Function.apply;r(r.S+r.F*!n(2)(function(){o(function(){})}),"Reflect",{apply:function(e,t,n){var r=i(e),u=a(n);return o?o(r,t,u):s.call(r,t,u)}})},function(e,t,n){var r=n(0),i=n(33),a=n(18),o=n(3),s=n(4),u=n(2),l=n(97),c=(n(1).Reflect||{}).construct,f=u(function(){function e(){}return!(c(function(){},[],e)instanceof e)}),h=!u(function(){c(function(){})});r(r.S+r.F*(f||h),"Reflect",{construct:function(e,t){a(e),o(t);var n=arguments.length<3?e:a(arguments[2]);if(h&&!f)return c(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(l.apply(e,r))}var u=n.prototype,p=i(s(u)?u:Object.prototype),d=Function.apply.call(e,p,t);return s(d)?d:p}})},function(e,t,n){var r=n(9),i=n(0),a=n(3),o=n(26);i(i.S+i.F*n(2)(function(){Reflect.defineProperty(r.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(e,t,n){a(e),t=o(t,!0),a(n);try{return r.f(e,t,n),!0}catch(e){return!1}}})},function(e,t,n){var r=n(0),i=n(20).f,a=n(3);r(r.S,"Reflect",{deleteProperty:function(e,t){var n=i(a(e),t);return!(n&&!n.configurable)&&delete e[t]}})},function(e,t,n){"use strict";var r=n(0),i=n(3),a=function(e){this._t=i(e),this._i=0;var t,n=this._k=[];for(t in e)n.push(t)};n(104)(a,"Object",function(){var e,t=this._k;do{if(this._i>=t.length)return{value:void 0,done:!0}}while(!((e=t[this._i++])in this._t));return{value:e,done:!1}}),r(r.S,"Reflect",{enumerate:function(e){return new a(e)}})},function(e,t,n){var r=n(20),i=n(35),a=n(13),o=n(0),s=n(4),u=n(3);o(o.S,"Reflect",{get:function e(t,n){var o,l,c=arguments.length<3?t:arguments[2];return u(t)===c?t[n]:(o=r.f(t,n))?a(o,"value")?o.value:void 0!==o.get?o.get.call(c):void 0:s(l=i(t))?e(l,n,c):void 0}})},function(e,t,n){var r=n(20),i=n(0),a=n(3);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return r.f(a(e),t)}})},function(e,t,n){var r=n(0),i=n(35),a=n(3);r(r.S,"Reflect",{getPrototypeOf:function(e){return i(a(e))}})},function(e,t,n){var r=n(0);r(r.S,"Reflect",{has:function(e,t){return t in e}})},function(e,t,n){var r=n(0),i=n(3),a=Object.isExtensible;r(r.S,"Reflect",{isExtensible:function(e){return i(e),!a||a(e)}})},function(e,t,n){var r=n(0);r(r.S,"Reflect",{ownKeys:n(118)})},function(e,t,n){var r=n(0),i=n(3),a=Object.preventExtensions;r(r.S,"Reflect",{preventExtensions:function(e){i(e);try{return a&&a(e),!0}catch(e){return!1}}})},function(e,t,n){var r=n(9),i=n(20),a=n(35),o=n(13),s=n(0),u=n(28),l=n(3),c=n(4);s(s.S,"Reflect",{set:function e(t,n,s){var f,h,p=arguments.length<4?t:arguments[3],d=i.f(l(t),n);if(!d){if(c(h=a(t)))return e(h,n,s,p);d=u(0)}if(o(d,"value")){if(!1===d.writable||!c(p))return!1;if(f=i.f(p,n)){if(f.get||f.set||!1===f.writable)return!1;f.value=s,r.f(p,n,f)}else r.f(p,n,u(0,s));return!0}return void 0!==d.set&&(d.set.call(p,s),!0)}})},function(e,t,n){var r=n(0),i=n(66);i&&r(r.S,"Reflect",{setPrototypeOf:function(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(e){return!1}}})},function(e,t,n){n(277),e.exports=n(7).Array.includes},function(e,t,n){"use strict";var r=n(0),i=n(49)(!0);r(r.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(36)("includes")},function(e,t,n){n(279),e.exports=n(7).Array.flatMap},function(e,t,n){"use strict";var r=n(0),i=n(280),a=n(10),o=n(6),s=n(18),u=n(106);r(r.P,"Array",{flatMap:function(e){var t,n,r=a(this);return s(e),t=o(r.length),n=u(r,0),i(n,r,r,t,0,1,e,arguments[1]),n}}),n(36)("flatMap")},function(e,t,n){"use strict";var r=n(51),i=n(4),a=n(6),o=n(17),s=n(5)("isConcatSpreadable");e.exports=function e(t,n,u,l,c,f,h,p){for(var d,v,y=c,m=0,g=!!h&&o(h,p,3);m<l;){if(m in u){if(d=g?g(u[m],m,n):u[m],v=!1,i(d)&&(v=void 0!==(v=d[s])?!!v:r(d)),v&&f>0)y=e(t,n,d,a(d.length),y,f-1)-1;else{if(y>=9007199254740991)throw TypeError();t[y]=d}y++}m++}return y}},function(e,t,n){n(282),e.exports=n(7).String.padStart},function(e,t,n){"use strict";var r=n(0),i=n(119),a=n(57),o=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(a);r(r.P+r.F*o,"String",{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},function(e,t,n){n(284),e.exports=n(7).String.padEnd},function(e,t,n){"use strict";var r=n(0),i=n(119),a=n(57),o=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(a);r(r.P+r.F*o,"String",{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},function(e,t,n){n(286),e.exports=n(7).String.trimLeft},function(e,t,n){"use strict";n(39)("trimLeft",function(e){return function(){return e(this,1)}},"trimStart")},function(e,t,n){n(288),e.exports=n(7).String.trimRight},function(e,t,n){"use strict";n(39)("trimRight",function(e){return function(){return e(this,2)}},"trimEnd")},function(e,t,n){n(290),e.exports=n(62).f("asyncIterator")},function(e,t,n){n(91)("asyncIterator")},function(e,t,n){n(292),e.exports=n(7).Object.getOwnPropertyDescriptors},function(e,t,n){var r=n(0),i=n(118),a=n(15),o=n(20),s=n(78);r(r.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,n,r=a(e),u=o.f,l=i(r),c={},f=0;l.length>f;)void 0!==(n=u(r,t=l[f++]))&&s(c,t,n);return c}})},function(e,t,n){n(294),e.exports=n(7).Object.values},function(e,t,n){var r=n(0),i=n(120)(!1);r(r.S,"Object",{values:function(e){return i(e)}})},function(e,t,n){n(296),e.exports=n(7).Object.entries},function(e,t,n){var r=n(0),i=n(120)(!0);r(r.S,"Object",{entries:function(e){return i(e)}})},function(e,t,n){"use strict";n(112),n(298),e.exports=n(7).Promise.finally},function(e,t,n){"use strict";var r=n(0),i=n(7),a=n(1),o=n(47),s=n(114);r(r.P+r.R,"Promise",{finally:function(e){var t=o(this,i.Promise||a.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then(function(){return n})}:e,n?function(n){return s(t,e()).then(function(){throw n})}:e)}})},function(e,t,n){n(300),n(301),n(302),e.exports=n(7)},function(e,t,n){var r=n(1),i=n(0),a=n(57),o=[].slice,s=/MSIE .\./.test(a),u=function(e){return function(t,n){var r=arguments.length>2,i=!!r&&o.call(arguments,2);return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};i(i.G+i.B+i.F*s,{setTimeout:u(r.setTimeout),setInterval:u(r.setInterval)})},function(e,t,n){var r=n(0),i=n(84);r(r.G+r.B,{setImmediate:i.set,clearImmediate:i.clear})},function(e,t,n){for(var r=n(81),i=n(31),a=n(11),o=n(1),s=n(14),u=n(40),l=n(5),c=l("iterator"),f=l("toStringTag"),h=u.Array,p={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},d=i(p),v=0;v<d.length;v++){var y,m=d[v],g=p[m],b=o[m],w=b&&b.prototype;if(w&&(w[c]||s(w,c,h),w[f]||s(w,f,m),u[m]=h,g))for(y in r)w[y]||a(w,y,r[y],!0)}},function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),o=new O(r||[]);return a._invoke=function(e,t,n){var r=c;return function(i,a){if(r===h)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw a;return I()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=S(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===c)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var u=l(e,t,n);if("normal"===u.type){if(r=n.done?p:f,u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=p,n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var c="suspendedStart",f="suspendedYield",h="executing",p="completed",d={};function v(){}function y(){}function m(){}var g={};g[a]=function(){return this};var b=Object.getPrototypeOf,w=b&&b(b(E([])));w&&w!==n&&r.call(w,a)&&(g=w);var _=m.prototype=v.prototype=Object.create(g);function T(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function x(e){var t;this._invoke=function(n,i){function a(){return new Promise(function(t,a){!function t(n,i,a,o){var s=l(e[n],e,i);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,a,o)},function(e){t("throw",e,a,o)}):Promise.resolve(c).then(function(e){u.value=e,a(u)},function(e){return t("throw",e,a,o)})}o(s.arg)}(n,i,t,a)})}return t=t?t.then(a,a):a()}}function S(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method))return d;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,d;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,d):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,d)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function E(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:I}}function I(){return{value:t,done:!0}}return y.prototype=_.constructor=m,m.constructor=y,m[s]=y.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},T(x.prototype),x.prototype[o]=function(){return this},e.AsyncIterator=x,e.async=function(t,n,r,i){var a=new x(u(t,n,r,i));return e.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(_),_[s]="Generator",_[a]=function(){return this},_.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:E(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),d}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){n(305),e.exports=n(121).global},function(e,t,n){var r=n(306);r(r.G,{global:n(86)})},function(e,t,n){var r=n(86),i=n(121),a=n(307),o=n(309),s=n(316),u=function(e,t,n){var l,c,f,h=e&u.F,p=e&u.G,d=e&u.S,v=e&u.P,y=e&u.B,m=e&u.W,g=p?i:i[t]||(i[t]={}),b=g.prototype,w=p?r:d?r[t]:(r[t]||{}).prototype;for(l in p&&(n=t),n)(c=!h&&w&&void 0!==w[l])&&s(g,l)||(f=c?w[l]:n[l],g[l]=p&&"function"!=typeof w[l]?n[l]:y&&c?a(f,r):m&&w[l]==f?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(f):v&&"function"==typeof f?a(Function.call,f):f,v&&((g.virtual||(g.virtual={}))[l]=f,e&u.R&&b&&!b[l]&&o(b,l,f)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,n){var r=n(308);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(310),i=n(315);e.exports=n(88)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(311),i=n(312),a=n(314),o=Object.defineProperty;t.f=n(88)?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(87);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){e.exports=!n(88)&&!n(122)(function(){return 7!=Object.defineProperty(n(313)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(87),i=n(86).document,a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,n){var r=n(87);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t){e.exports="attribute vec2 a_position;attribute vec2 a_uv;uniform mat4 u_mvp;varying vec2 v_uv;void main(void) { v_uv = a_uv; gl_Position = u_mvp * vec4(a_position, 0.0, 1.0);}"},function(e,t){e.exports="precision mediump float;varying vec2 v_uv;uniform sampler2D u_diffuse;uniform float u_opacity;void main(void) { vec4 cr = texture2D(u_diffuse, v_uv); cr.a *= u_opacity; gl_FragColor = cr; }"},function(e,t){e.exports="precision highp float;attribute vec4 a_position;attribute vec2 a_uv;varying vec2 v_uv;uniform mat4 u_mvp;const float uvWeight = 1.0 / 8192.0;void main(){ v_uv = a_uv * uvWeight; gl_Position = u_mvp * vec4( a_position.x, a_position.y, a_position.z, 1.0 );}"},function(e,t){e.exports="precision highp float;uniform sampler2D u_diffuse;varying vec2 v_uv;void main(){gl_FragColor = texture2D(u_diffuse, v_uv);}"},function(e,t){e.exports="attribute vec3 a_position;attribute vec2 a_uv;varying vec2 v_uv;void main(void) { v_uv = a_uv; gl_Position = vec4(a_position, 1.0);}"},function(e,t){e.exports="attribute vec3 a_position;attribute vec2 a_uv;uniform mat4 u_mvp;varying vec2 v_uv;void main(void) { vec4 pos = u_mvp * vec4(a_position, 1.0); v_uv = a_uv; gl_Position = pos;}"},function(e,t){e.exports="attribute vec3 a_position;attribute vec2 a_uv;attribute vec2 a_pixel_offset;uniform mat4 u_mvp;uniform vec2 u_viewport;varying vec2 v_uv;void main(void) { vec4 pos = u_mvp * vec4(a_position, 1.0); pos /= abs(pos.w); pos.x += (a_pixel_offset.x / u_viewport.x); pos.y += (a_pixel_offset.y / u_viewport.y); v_uv = a_uv; gl_Position = pos;}"},function(e,t){e.exports="precision mediump float;varying vec2 v_uv;uniform sampler2D u_diffuse;uniform float u_opacity;uniform float u_global_opacity;void main(void) { vec4 color = texture2D(u_diffuse, v_uv); color.a *= u_opacity; color *= u_global_opacity; gl_FragColor = color;}"},function(e,t){e.exports="attribute vec3 a_position;attribute vec2 a_uv;varying vec2 v_uv;void main(){ v_uv = a_uv; gl_Position = vec4( a_position, 1.0 );}"},function(e,t){e.exports="precision mediump float;varying float v_distance_field;uniform float u_global_opacity;void main(void) { gl_FragColor = vec4(0.0, 0.0, 0.0, v_distance_field) * u_global_opacity;}"},function(e,t){e.exports="attribute vec4 a_position;attribute vec2 a_uv;attribute vec2 a_depthuv;uniform mat4 u_mvp;uniform float u_viewtype;uniform float u_viewradius;uniform float u_maxdepth;varying vec3 v_uv;uniform sampler2D u_rv_depthmap;float getDepth(in float b, in float maxValue) { float depth = pow(maxValue + 1., b / 256.) - 1.; if (depth == 0.) { return maxValue; } return depth;}void main(void) { float maxNormalLen = 0.33; vec4 data = texture2D(u_rv_depthmap, a_depthuv.xy) * 255.; float depth = getDepth(data.b, u_maxdepth) * (1.0 - u_viewtype) + (u_viewradius - u_viewradius * (1.0 - u_viewtype)); vec3 npos = a_position.xyz * (depth + 1.0); v_uv = vec3(a_uv.xy, 1.0) * depth / (u_maxdepth * (1.0 - u_viewtype) + u_viewradius * u_viewtype); vec4 pos = u_mvp * vec4(npos, 1.0); gl_Position = pos;}"},function(e,t){e.exports="precision highp float;uniform sampler2D u_diffuse;uniform float u_opacity;uniform float u_global_opacity;varying vec3 v_uv;void main(void) { vec4 color = texture2DProj(u_diffuse, v_uv); color.a *= u_opacity; color *= u_global_opacity; gl_FragColor = color;}"},function(e,t){e.exports="attribute vec4 a_position;attribute vec2 a_uv;attribute vec2 a_depthuv;uniform mat4 u_pcmvp; uniform float u_maxdepth;varying vec3 v_uv;uniform sampler2D u_rv_depthmap;float getDepth(in float b, in float maxValue) { float depth = pow(maxValue + 1., b / 256.) - 1.; if (depth == 0.) { return maxValue; } return depth;}void main(void) { vec4 data = texture2D(u_rv_depthmap, a_depthuv.xy) * 255.; float depth = getDepth(data.b, u_maxdepth); vec3 dpos = a_position.xyz * (depth + 1.0); vec4 pos = u_pcmvp * vec4(dpos, 1.0); v_uv = vec3(a_uv.xy, 1.0) * depth / u_maxdepth; gl_Position = pos;}"},function(e,t){e.exports="precision mediump float;varying vec2 v_uv;uniform sampler2D u_diffuse;uniform sampler2D u_diffuse2;uniform sampler2D u_diffuse3;uniform float u_rto;uniform float u_sbf;uniform vec4 u_sbc;uniform float u_ma;uniform float u_sm;uniform float u_opacity;uniform float u_global_opacity;void main(void) { vec4 color = u_sbc; if (v_uv.x < (u_rto - u_sbf)) { color = texture2D(u_diffuse, vec2(v_uv.x * u_sm, v_uv.y)); color.a *= u_ma; vec4 empty = texture2D(u_diffuse3, v_uv); color = vec4(vec3(empty.rgb * empty.a + color.rgb * (1.0 - empty.a)), empty.a + color.a * (1.0 - empty.a)); } else if (v_uv.x > (u_rto + u_sbf)) { float ux = v_uv.x * u_sm - (u_sm - 1.0); vec2 uv = vec2(ux, v_uv.y); color = texture2D(u_diffuse2, uv); color.a *= u_opacity; } color *= u_global_opacity; gl_FragColor = color;}"},function(e,t){e.exports="attribute vec4 a_position;attribute vec4 a_normal;attribute vec4 a_uv;uniform mat4 u_mvp;uniform vec4 u_lineinfo;varying float v_width;varying float v_period;varying float v_c_dist;varying float v_dist;varying float v_start_dist;varying vec2 v_start_uv;varying float v_u_range;void main() { vec4 pos = u_mvp * vec4(a_position.xy + (a_normal.xy * u_lineinfo.x * a_uv.w * 0.5), 0.0, 1.0); pos.z += a_normal.z; v_width = u_lineinfo.x; v_period = u_lineinfo.y; v_c_dist = a_normal.w; v_dist = a_position.z; v_start_dist = a_position.w; v_start_uv = a_uv.xy; v_u_range = a_uv.z; gl_Position = pos;}"},function(e,t){e.exports="precision highp float;uniform sampler2D u_diffuse;uniform float u_opacity;uniform vec4 u_lineinfo;uniform float u_global_opacity;varying float v_c_dist;varying float v_dist;varying float v_start_dist;varying vec2 v_start_uv;varying float v_u_range;varying float v_width;varying float v_period;void main() { float x = v_dist - v_start_dist; float addedX = mod(v_start_dist, v_period); float tx = min(mod(x + addedX, v_period), v_width); vec2 uv = vec2(v_start_uv.x + v_u_range * (tx / v_width), v_start_uv.y); float cDist = v_c_dist - u_lineinfo.z; float maxDist = u_lineinfo.w - u_lineinfo.z; float lA = 1.0 - smoothstep(0.2, 0.9, (cDist * 2.0) / maxDist); vec4 pattern = texture2D(u_diffuse, uv); pattern.a *= (u_opacity * lA); gl_FragColor = pattern * u_global_opacity;}"},function(e,t){e.exports="attribute vec4 a_position;attribute vec3 a_uv;uniform mat4 u_mvp;varying float v_df;varying float v_flag;varying vec2 v_uv;varying float v_sa;void main() { vec4 pos = u_mvp * vec4(a_position.xy, 0.0, 1.0); v_flag = a_position.z; v_df = a_position.w; v_uv = a_uv.xy; v_sa = a_uv.z; gl_Position = pos;}"},function(e,t){e.exports="precision mediump float;uniform sampler2D u_diffuse;uniform vec4 u_diffuse_color; uniform float u_opacity;uniform float u_global_opacity;varying float v_df;varying float v_flag;varying vec2 v_uv;varying float v_sa;void main() { float mA = 1.0 - smoothstep(0.9, 0.95, v_df); vec4 icon = texture2D(u_diffuse, v_uv * v_flag) * vec4(1.0, 1.0, 1.0, v_sa); vec4 background = vec4(u_diffuse_color.rgb, 1.0); background.a *= u_opacity * mA; float sA = icon.a; float dA = 1.0 - icon.a; vec4 color = vec4(vec3(icon.rgb * sA + background.rgb * dA), sA + background.a * dA); gl_FragColor = color * u_global_opacity;}"},function(e,t){e.exports="attribute vec3 a_position;attribute vec3 a_normal;uniform mat4 u_mvp;varying float v_nf;void main(void) { v_nf = dot(a_normal, vec3(0.0, 0.0, 1.0)); vec4 pos = u_mvp * vec4(a_position, 1.0); gl_Position = pos;}"},function(e,t){e.exports="precision mediump float;varying float v_nf;uniform vec4 u_diffuse_color;uniform float u_global_opacity;void main(void) { float a = u_diffuse_color.a; vec4 color = vec4(v_nf + u_diffuse_color.rgb * (1.0 - v_nf), min(v_nf + 0.2 + (a - 0.9) * 4.0, a)); gl_FragColor = color * u_global_opacity;}"},function(e,t){e.exports="attribute vec4 a_position;attribute vec2 a_uv;attribute vec2 a_pixel_offset;varying vec2 v_uv;varying vec2 v_uv_range;varying vec2 v_size;varying vec2 v_size_range;void main(void) { v_uv = a_uv; v_size = a_pixel_offset; v_size_range = vec2((a_position.xy + 1.0) * 0.5); v_uv_range = a_position.zw; gl_Position = vec4(a_position.xy, 0.0, 1.0);}"},function(e,t){e.exports="precision mediump float;varying vec2 v_uv;varying vec2 v_size;varying vec2 v_uv_range;varying vec2 v_size_range;uniform vec2 u_viewport;uniform sampler2D u_diffuse;uniform float u_opacity;uniform float u_global_opacity;void main(void) { float padding = 200.; vec2 uv_delta = mod(v_size_range * u_viewport, v_size + padding); uv_delta = clamp(uv_delta, vec2(0.), v_size) / v_size; vec4 color = texture2D(u_diffuse, v_uv + (v_uv_range * uv_delta)); color.a *= u_opacity; color *= u_global_opacity; gl_FragColor = color;}"},function(e,t,n){"use strict";n.r(t);var r={CTX_LOST:"context_lost",INIT:"init",PANOID_CHANGED:"panoid_changed",PANOID_EMPTY:"panoid_empty",PANOID_LEFT:"panoid_left",PANOID_MOVE:"panoid_move",VIEWPOINT_CHANGED:"viewpoint_changed",BUILDING_DETECTED:"building_detected",SPOT_MOVED:"spot_moved",KEYBOARD_MOVED:"keyboard_moved",KEYBOARD_MOVED_CONTINUE:"keyboard_moved_continue",RETURN_MOVED:"back_moved",SMART_MOVED:"smart_moved",SMART_MOVED_FAR:"smart_moved_far",SMART_MOVED_FAR_WALL:"smart_moved_far_wall",CAPTURE:"capture",MT:"motion_type",QT:"quality_type",RATIO_CHANGED:"ratio_changed",PAST_CHANGED:"past_changed",PAST_EMPTY:"past_empty",VIEWTYPE_CHANGED:"viewtype_changed",SHOW:"show",HIDE:"hide",RESIZE:"resize",CLICK:"click",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",ATTACHED:"attached",DETACHED:"detached"},i={INTERACTION_CHANGED:"1",INTERACTION_IDLE:"2",KEEP_HOVER:"3",ACTION:"4",VT_STEP:"11",VT_END:"22",PT_PREPARE:"111",PT_START:"222",PT_STEP:"333",PT_END:"444",PT_CHAIN:"555",PT_IDLE:"666",FC_INIT_TYPE:"1111",FC_CHANGE_TYPE:"2222"},a=0,o=1,s=3,u=10,l="wtm",c=["N","북","NW","북서","W","서","SW","남서","S","남","SE","남동","E","동","NE","북동"],f=32,h=64,p=64,d=128,v=[[1,1],[4,8],[8,16]],y=[f*h*6,p/v[1][0]*d/v[1][1]*6,p/v[2][0]*d/v[2][1]*6],m={GROUND:"ground",WALL:"wall",LONG:"long"},g="11",b="33",w={CAR:"102",NAVER_CAR:"200",INSTA_TITAN:"202",PANOZIP:"100",ROTATOR:"101",SKY:"103",INSTA360:"201",SEA:"203",isCar:function(e){return w.CAR===e||w.NAVER_CAR===e||w.INSTA_TITAN===e},isWalk:function(e){return w.PANOZIP===e||w.ROTATOR===e||w.SKY===e||w.SEA===e||w.INSTA360===e}},_={MAX_WIDTH:800,MAX_HEIGHT:800,MID_WIDTH:500,MID_HEIGHT:500},T={FROM_NULL:0,FROM_SPOT:1,FROM_ARROW_CMD:2,FROM_ARROW_CONTINUE_CMD:3,FROM_RETURN_CMD:4,FROM_RANGE_GROUND:5,FROM_FAR_GROUND:6,FROM_FAR_WALL:7,FROM_CAPTURE:8},x={MOTION:{PVT_ON:0,PVT_OFF:1,PT_OFF:2,VT_OFF:3},QUALITY:{LOW:"LOW",HIGH:"HIGH"}},S={LOW:["2","5"],HIGH:["5","2"],NONE:[""]},k={NORMAL:2,EXTEND:3},P=[{PT_ANIMATION_TIME:300,PT_IDLE_TIME:250,VPT_ANIMATION_TIME:300,VPT_INERTIA_TIME:500,VPT_INERTIA_ACTIVE:!0,PANTILT_INERTIA_ACTIVE:!0,ZOOM_INERTIA_ACTIVE:!0},{PT_ANIMATION_TIME:15,PT_IDLE_TIME:250,VPT_ANIMATION_TIME:5,VPT_INERTIA_TIME:500,VPT_INERTIA_ACTIVE:!1,PANTILT_INERTIA_ACTIVE:!1,ZOOM_INERTIA_ACTIVE:!1},{PT_ANIMATION_TIME:15,PT_IDLE_TIME:250,VPT_ANIMATION_TIME:5,VPT_INERTIA_TIME:500,VPT_INERTIA_ACTIVE:!0,PANTILT_INERTIA_ACTIVE:!0,ZOOM_INERTIA_ACTIVE:!0},{PT_ANIMATION_TIME:300,PT_IDLE_TIME:250,VPT_ANIMATION_TIME:300,VPT_INERTIA_TIME:500,VPT_INERTIA_ACTIVE:!1,PANTILT_INERTIA_ACTIVE:!1,ZOOM_INERTIA_ACTIVE:!1}];function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var E=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._listenersTable={};var t=Array.prototype.slice.call(arguments),n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if("string"!=typeof s)throw"eventType is only string type.";this._listenersTable[s]=[]}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}var t,n,r;return t=e,(n=[{key:"on",value:function(e,t){var n=this._listenersTable[e];if(!n)throw"exception: Event >>> ".concat(e," <<< is not registered.");return n.push(t),this}},{key:"off",value:function(e,t){if(e||t){var n=this._listenersTable[e];if(!n)throw"존재하지 않는 이벤트 입니다. ( ".concat(e," )");if(t){var r,i;for(i=0;r=n[i];++i)if(r===t){n.splice(i,1);break}return this}n.length=0}else for(var a in this._listenersTable)if(this._listenersTable.hasOwnProperty(a)){var o=this._listenersTable[a];o&&(o.length=0)}}},{key:"one",value:function(e,t){var n=this;return this.on(e,t).on(e,function r(){n.off(e,t).off(e,r)})}},{key:"dispatch",value:function(e,t){var n=this._listenersTable[e];if(!n)throw"이벤트가 등록되어 있지 않습니다. ( ".concat(e," )");if(0!==n.length){var r=n.slice(0),i=!0,a=!1,o=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){(0,s.value)(this,t)}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}r.length=0}}}])&&O(t.prototype,n),r&&O(t,r),e}();function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var M=0,C=1,R=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).excutionTime,n=void 0===t?6:t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.executionTime=n,this.queues=[[],[],[]],this.counter=0}var t,n,r;return t=e,(n=[{key:"invoke",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C;this.queues[t].push(e),this.counter++}},{key:"execute",value:function(){var e,t=Date.now()+this.executionTime,n=!0,r=!0,i=!1,a=void 0;try{for(var o,s=this.queues[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){for(var u=o.value;u.length>0;){if(t<Date.now()){n=!1;break}(e=u.shift()).isCanceled()||e.execute(),this.counter--}if(!n)break}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},{key:"isEmpty",value:function(){return 0===this.counter}},{key:"clear",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.queues[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){r.value.length=0}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this.counter=0}}])&&I(t.prototype,n),r&&I(t,r),e}();function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(){},D=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.doneHandlers=[],this.startHandler=t.start||L,this.errorHandler=t.error||L,this.cancelHandler=t.cancel||L,this.async=!!t.async,this.doneHandler=t.done||L,t.done&&this.then(t.done)}var t,n,r;return t=e,(n=[{key:"start",value:function(){var e=this;this.async?this.startHandler(function(){return e.done.apply(e,arguments)},function(){return e.error.apply(e,arguments)}):(this.startHandler(),this.done())}},{key:"then",value:function(e){e&&this.doneHandlers.push(e)}},{key:"done",value:function(){for(var e=this.doneHandlers;e.length;)e.pop().apply(void 0,arguments);this.cancelHandler=L}},{key:"error",value:function(){this.errorHandler.apply(this,arguments),this.cancelHandler=L,this.doneHandlers.length=0}},{key:"cancel",value:function(){this.cancelHandler(),this.cancelHandler=L,this.doneHandlers.length=0}}])&&A(t.prototype,n),r&&A(t,r),e}();function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var F=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.task=null,this.status="none",this.id=""}var t,n,r;return t=e,(n=[{key:"setTask",value:function(e){this.task=e,this.status="none"}},{key:"execute",value:function(){return"none"===this.status&&(this.status="completed",this.task&&this.task.start(),!0)}},{key:"cancel",value:function(){return this.status="canceled",this.task&&this.task.cancel(),!0}},{key:"isCanceled",value:function(){return"canceled"===this.status}}])&&N(t.prototype,n),r&&N(t,r),e}(),j=document.getElementsByTagName("head")[0],V=0,B=function(e,t){return(t=t||{}).jsonp?function(e,t){var n=t.complete,r=t.error,i=Array.isArray(t.callbackNames)&&t.callbackNames.length>=1?t.callbackNames:["callback"],a=document.createElement("script"),o="mvp_"+ ++V,s=null,u=function(){s=null,delete window[o],a.parentNode&&a.parentNode.removeChild(a)},l=function(e){clearTimeout(s),u(),n&&n("string"==typeof e?JSON.parse(e):e)};return a.async=!0,a.src=e+(-1===e.indexOf("?")?"?":"&")+i.reduce(function(e,t){return(e?e+"&":"")+t+"="+o},""),{send:function(){s=setTimeout(function(){u(),r&&r()},1e4),window[o]=l,j.appendChild(a)},abort:function(){null!==s?(clearTimeout(s),window[o]=u):u()}}}(e,t):function(e,t){var n,r=t.complete,i=t.error,a=t.responseType||"json";return{send:function(){var t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&(200===t.status?r&&("arraybuffer"===a?r(t.response):"text"===a?r(JSON.parse(t.responseText)):"json"===a&&(navigator.userAgent.toLocaleLowerCase().indexOf("trident")>=0?r(JSON.parse(t.response)):r(t.response))):i&&i())},n=function(){t.onreadystatechange=null,t.abort()},t.open("GET",e),t.responseType=a,t.send()},abort:function(){n&&n()}}}(e,t)},U=document.getElementsByTagName("head")[0];var G=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.datas=t?t.split("|"):[]};function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(n,!0).forEach(function(t){q(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function X(e,t){return!t||"object"!==H(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Z(e,t){return(Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Q=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=X(this,K(t).call(this))).cache=new Map,e.maxDownloadingCount=12,e.downloadingCount=0,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Z(e,t)}(t,R),n=t,(r=[{key:"start",value:function(){}},{key:"end",value:function(){}},{key:"execute",value:function(){var e,t=this.queues,n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0)for(var s=a.value;s.length>0;){if(this.downloadingCount>=this.maxDownloadingCount)return;(e=s.shift())&&!e.isCanceled()&&e.execute()}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}},{key:"download",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a=(this.cache,new F),o=this.createDownloadTask(e,t,r,i);return a.setTask(o),this.queues[n].push(a),a}},{key:"createDownloadTask",value:function(e,t,n,r){return"image-texture"===t||"panorama-tile"===t||"raster-tile"===t||"depthmap-image"===t?this.imageLoadingTask(e,n,r):"jsonp-data"===t?this.jsonLoadingTask(e,n,r,{jsonp:!0,callbackNames:["CALLBACK","callback"]}):"ajaxjson-data"===t?this.jsonLoadingTask(e,n,r,{jsonp:!1}):"debug-raster-tile"===t?this.debugLoadingTask(e,n):"debug-panorama-tile"===t?this.debugLoadingTask(e,n):"d3g-to-shape"===t||"d3b-to-shape"===t?this.arrayBufferLoadingTask(e,n,r):"json_to_poi_shape"===t?this.jsonLoadingTask(e,n,r):void 0}},{key:"imageLoadingTask",value:function(e,t,n){var r,i=this,a=!1;return new D({async:!0,start:function(t,n){i.downloadingCount++,(r=new Image).crossOrigin="anonymous",r.onload=function(){return t()},r.onerror=function(){return n()},r.src=e},cancel:function(){r&&!a&&(r.onload=null,r.onerror=null,r.src="",a=!0,i.downloadingCount--)},done:function(){a=!0,i.downloadingCount--,t(r)},error:function(){a=!0,i.downloadingCount--,n()}})}},{key:"jsonLoadingTask",value:function(e,t,n){var r,i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=!1,s=new D({async:!0,start:function(t,n){i.downloadingCount++,(r=B(e,W({complete:function(e){return t(e)},error:function(){return n()}},a))).send()},cancel:function(){r&&!o&&(r.abort(),o=!0,i.downloadingCount--)},done:function(e){o=!0,i.downloadingCount--,t(e)},error:function(){o=!0,i.downloadingCount--,n()}});return s}},{key:"debugLoadingTask",value:function(e,t){var n=new G(e);return new D({start:function(){t(n)},cancel:function(){}})}},{key:"arrayBufferLoadingTask",value:function(e,t,n){var r,i=this,a=!1;return new D({async:!0,start:function(t,n){i.downloadingCount++,(r=B(e,{complete:function(e){return t(e)},error:function(){return n()},responseType:"arraybuffer"})).send()},cancel:function(){r&&!a&&(r.abort(),a=!0,i.downloadingCount--)},done:function(e){a=!0,i.downloadingCount--,t(e)},error:function(){a=!0,i.downloadingCount--,n()}})}}])&&Y(n.prototype,r),i&&Y(n,i),t}();function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var $=256,ee=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).maxCacheSize,n=void 0===t?$:t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._maxCacheSize=n,this._pool={},this._count=0,this._oldest=null,this._newest=null}var t,n,r;return t=e,(n=[{key:"set",value:function(e,t){var n={newer:null,older:this._newest,key:e,value:t};null===this._newest?this._oldest=n:this._newest.newer=n,this._newest=n,this._pool[e]=n,this._count++}},{key:"get",value:function(e){var t=this._pool[e];return t?t===this._newest?t.value:(t===this._oldest?(this._oldest=this._oldest.newer,this._oldest.older=null):(t.newer.older=t.older,t.older.newer=t.newer),t.newer=null,t.older=this._newest,t.older.newer=t,this._newest=t,t.value):null}},{key:"pop",value:function(){var e=this._oldest,t=e.newer;return delete this._pool[e.key],null!==t&&(t.older=null),this._oldest=t,null===t&&(this._newest=null),this._count--,e}},{key:"expire",value:function(e){for(;this.canExpire();){var t=this.pop();"function"==typeof e&&e(t)}}},{key:"canExpire",value:function(){return this._count>this._maxCacheSize}},{key:"getCount",value:function(){return this._count}},{key:"clear",value:function(){this._pool={},this._count=0,this._oldest=null,this._newest=null}},{key:"has",value:function(e){return this._pool.hasOwnProperty(e)}},{key:"forEach",value:function(e,t){for(var n=this._newest;n;)e.call(t,n.value,n.key),n=n.older}}])&&J(t.prototype,n),r&&J(t,r),e}();function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ne=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contentType=null}var t,n,r;return t=e,(n=[{key:"read",value:function(){}},{key:"setContentType",value:function(e){this.contentType=e}},{key:"getContentType",value:function(){return this.contentType}}])&&te(t.prototype,n),r&&te(t,r),e}();function re(e){return(re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ae(e,t){return!t||"object"!==re(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function oe(e){return(oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ue=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ae(this,oe(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}(t,ne),n=t,(r=[{key:"read",value:function(e,t,n){n(e)}}])&&ie(n.prototype,r),i&&ie(n,i),t}();function le(e){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fe(e,t){return!t||"object"!==le(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pe(e,t){return(pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var de=Date.now,ve=function(e){function t(){var e,n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).useCache,r=void 0===n||n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=fe(this,he(t).call(this,"complete","error"))).executionTime=6,e.downloadManager=new Q,e.cacheTable=new ee,e.useCache=r,e.typeReaderTable=new Map,e.typeReaderTable.set("default",new ue),e.processingInvoker=new R({executionTime:3}),e.doneInvoker=new R({executionTime:3}),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pe(e,t)}(t,E),n=t,(r=[{key:"start",value:function(){}},{key:"stop",value:function(){}},{key:"execute",value:function(){var e=de()+this.executionTime;this.downloadManager.execute(),de()<e&&this.processingInvoker.execute(),de()<e&&this.doneInvoker.execute(),de()<e&&this.processingInvoker.isEmpty()&&this.doneInvoker.isEmpty()&&this.cacheExpire()}},{key:"doTask",value:function(e,t,n){var r=this,i=new F;return i.setTask(new D({start:function(){t&&e.then(function(){var e=new F;e.setTask(t),r.doneInvoker.invoke(e,n)}),e.start()}})),this.processingInvoker.invoke(i,n),i}},{key:"load",value:function(e,t,n,r,i){var a,o=this,s="".concat(t,"@").concat(e),u=this.cacheTable;if(this.useCache&&u.has(s)){a=new F;var l=u.get(s),c=new F;c.setTask(new D({start:function(){o.onDoneComplete(l,a,i)}})),this.doneInvoker.invoke(c,r)}else(a=this.downloadManager.download(e,n,r,function(e){o.onDownloadingComplete(e,a,n,r,i)},function(){o.onDownloadingError(a,i)})).id=s;return a}},{key:"onDownloadingComplete",value:function(e,t,n,r,i){var a=this;if(!t.isCanceled()){var o=new F;o.setTask(new D({start:function(){a.onReadingComplete(e,t,n,r,i)}})),this.processingInvoker.invoke(o,r)}}},{key:"onDownloadingError",value:function(e,t){e.isCanceled()||t(null)}},{key:"onReadingComplete",value:function(e,t,n,r,i){var a=this;t.isCanceled()||this.getReader(n).read(e,t,function(e){a.onProcessingComplete(e,t,r,i)})}},{key:"onProcessingComplete",value:function(e,t,n,r){var i=this;if(!t.isCanceled()){this.useCache&&this.cacheTable.set(t.id,e);var a=new F;a.setTask(new D({start:function(){i.onDoneComplete(e,t,r)}})),this.doneInvoker.invoke(a,n)}}},{key:"onDoneComplete",value:function(e,t,n){t.isCanceled()||(n(e),this.dispatch("complete"))}},{key:"setReader",value:function(e,t){this.typeReaderTable.set(e,t)}},{key:"getReader",value:function(e){return this.typeReaderTable.has(e)?this.typeReaderTable.get(e):this.typeReaderTable.get("default")}},{key:"cacheExpire",value:function(){this.useCache&&this.cacheTable.expire()}}])&&ce(n.prototype,r),i&&ce(n,i),t}(),ye={POSITION:"a_position",NORMAL:"a_normal",UV:"a_uv",PIXELOFFSET:"a_pixel_offset",DEPTHUV:"a_depthuv"},me={},ge=0;for(var be in ye)ye.hasOwnProperty(be)&&(me[ye[be]]=ge++);Object.defineProperty(ye,"Name2Location",{value:me,enumerable:!1}),Object.freeze(ye),Object.freeze(ye.Name2Location);var we=ye;function _e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Te=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.xpos=t,this.ypos=n,this.width=r,this.height=i}var t,n,r;return t=e,(n=[{key:"update",value:function(e,t,n,r){return(this.xpos!==e||this.ypos!==t||this.width!==n||this.height!==r)&&(this.xpos=e,this.ypos=t,this.width=n,this.height=r,!0)}},{key:"isValid",value:function(){return this.width>0&&this.height>0}}])&&_e(t.prototype,n),r&&_e(t,r),e}();function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Se=WebGLRenderingContext,ke=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.srcColor=Se.ONE,this.srcAlpha=Se.ONE,this.dstColor=Se.ZERO,this.dstAlpha=Se.ZERO,this.blendMode=Se.FUNC_ADD}var t,n,r;return t=e,(n=[{key:"equals",value:function(e){return e&&this.srcColor===e.srcColor&&this.srcAlpha===e.srcAlpha&&this.dstColor===e.dstColor&&this.dstAlpha===e.dstAlpha&&this.blendMode===e.blendMode}},{key:"set",value:function(e){this.srcColor=e.srcColor,this.srcAlpha=e.srcAlpha,this.dstColor=e.dstColor,this.dstAlpha=e.dstAlpha,this.blendMode=e.blendMode}}])&&xe(t.prototype,n),r&&xe(t,r),e}(),Pe=Math.tan;function Oe(e){return e[0]=e[5]=e[10]=e[15]=1,e[1]=e[2]=e[3]=e[4]=0,e[6]=e[7]=e[8]=e[9]=0,e[11]=e[12]=e[13]=e[14]=0,e}function Ee(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ie(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,u=i+i,l=n*o,c=n*s,f=n*u,h=r*s,p=r*u,d=i*u,v=a*o,y=a*s,m=a*u;return e[0]=1-(h+d),e[1]=c+m,e[2]=f-y,e[4]=c-m,e[5]=1-(l+d),e[6]=p+v,e[8]=f+y,e[9]=p-v,e[10]=1-(l+h),e[3]=e[7]=e[11]=0,e[12]=e[13]=e[14]=0,e[15]=1,e}function Me(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=t[9],p=t[10],d=t[11],v=t[12],y=t[13],m=t[14],g=t[15],b=n[0],w=n[1],_=n[2],T=n[3],x=n[4],S=n[5],k=n[6],P=n[7],O=n[8],E=n[9],I=n[10],M=n[11],C=n[12],R=n[13],A=n[14],L=n[15];return e[0]=b*r+w*s+_*f+T*v,e[1]=b*i+w*u+_*h+T*y,e[2]=b*a+w*l+_*p+T*m,e[3]=b*o+w*c+_*d+T*g,e[4]=x*r+S*s+k*f+P*v,e[5]=x*i+S*u+k*h+P*y,e[6]=x*a+S*l+k*p+P*m,e[7]=x*o+S*c+k*d+P*g,e[8]=O*r+E*s+I*f+M*v,e[9]=O*i+E*u+I*h+M*y,e[10]=O*a+E*l+I*p+M*m,e[11]=O*o+E*c+I*d+M*g,e[12]=C*r+R*s+A*f+L*v,e[13]=C*i+R*u+A*h+L*y,e[14]=C*a+R*l+A*p+L*m,e[15]=C*o+R*c+A*d+L*g,e}function Ce(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],p=t[11],d=t[12],v=t[13],y=t[14],m=t[15],g=n*s-r*o,b=n*u-i*o,w=n*l-a*o,_=r*u-i*s,T=r*l-a*s,x=i*l-a*u,S=c*v-f*d,k=c*y-h*d,P=c*m-p*d,O=f*y-h*v,E=f*m-p*v,I=h*m-p*y,M=g*I-b*E+w*O+_*P-T*k+x*S;if(0===M)throw"matrix inversion fail.";var C=1/M;return e[0]=(s*I-u*E+l*O)*C,e[1]=(i*E-r*I-a*O)*C,e[2]=(v*x-y*T+m*_)*C,e[3]=(h*T-f*x-p*_)*C,e[4]=(u*P-o*I-l*k)*C,e[5]=(n*I-i*P+a*k)*C,e[6]=(y*w-d*x-m*b)*C,e[7]=(c*x-h*w+p*b)*C,e[8]=(o*E-s*P+l*S)*C,e[9]=(r*P-n*E-a*S)*C,e[10]=(d*T-v*w+m*g)*C,e[11]=(f*w-c*T-p*g)*C,e[12]=(s*k-o*O-u*S)*C,e[13]=(n*O-r*k+i*S)*C,e[14]=(v*b-d*_-y*g)*C,e[15]=(c*_-f*b+h*g)*C,e}function Re(e,t,n,r,i){var a=1/Pe(.5*t),o=1/(r-i);return e[0]=a/n,e[5]=a,e[10]=(i+r)*o,e[11]=-1,e[14]=2*i*r*o,e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=0,e[8]=e[9]=e[12]=e[13]=e[15]=0,e}function Ae(e,t,n,r){var i=n[0],a=n[1],o=n[2],s=t[0],u=t[1],l=t[2];return!r||0===r[0]&&0===r[1]&&0===r[2]&&1===r[3]?(e[0]=i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=o,e[11]=0,e[12]=s,e[13]=u,e[14]=l,e[15]=1):(Ie(e,r),e[0]*=i,e[1]*=i,e[2]*=i,e[3]=0,e[4]*=a,e[5]*=a,e[6]*=a,e[7]=0,e[8]*=o,e[9]*=o,e[10]*=o,e[11]=0,e[12]=s,e[13]=u,e[14]=l,e[15]=1),e}function Le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var De=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=t,this.gl=t.getContext("webgl",{alpha:!1})||t.getContext("experimental-webgl",{alpha:!1}),!this.gl)throw"WebGL initialize fail.";this.viewport=new Te(0,0,0,0),this.depthMask=null,this.compareMode=null,this.blendState=new ke}var t,n,r;return t=e,(n=[{key:"initialize",value:function(){var e=this.gl;return e.enable(e.CULL_FACE),e.frontFace(e.CCW),e.cullFace(e.BACK),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clearDepth(1),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.clearColor(0,0,0,1),this.clearAllBuffer(),0!==e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)}},{key:"drawPrimitive",value:function(e){this.gl.drawElements(e.drawMode,e.indexLength,e.mesh.indexBuffer.indexType,e.indexOffset)}},{key:"clearColor",value:function(e){this.gl.clearColor(e[0],e[1],e[2],e[3])}},{key:"clearDepth",value:function(e){this.gl.clearDepth(e)}},{key:"clearColorBuffer",value:function(){var e=this.gl;e.clear(e.COLOR_BUFFER_BIT)}},{key:"clearDepthBuffer",value:function(){var e=this.gl;e.clear(e.DEPTH_BUFFER_BIT)}},{key:"clearAllBuffer",value:function(){var e=this.gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"getViewport",value:function(){throw"under construction"}},{key:"setViewport",value:function(e){var t=e.xpos,n=e.ypos,r=e.width,i=e.height;this.viewport.update(t,n,r,i)&&(this.gl.viewport(t,n,r,i),this.gl.scissor(t,n,r,i))}},{key:"setDepthMask",value:function(e){this.depthMask!==e&&(this.depthMask=e,this.gl.depthMask(e))}},{key:"setDepthTest",value:function(e){if(this.compareMode!==e){this.compareMode=e;var t=this.gl;e!==t.ALWAYS?(t.enable(t.DEPTH_TEST),t.depthFunc(e)):t.disable(t.DEPTH_TEST)}}},{key:"setCulling",value:function(e){if(this.cullFace!==e){this.cullFace=e;var t=this.gl;e!==t.NONE?(t.enable(t.CULL_FACE),t.cullFace(e)):t.disable(t.CULL_FACE)}}},{key:"setBlendFactors",value:function(e){if(!this.blendState.equals(e)){this.blendState.set(e);var t=this.gl;e.srcColor!==t.ONE||e.dstColor!==t.ZERO||e.srcAlpha!==t.ONE||e.dstAlpha!==t.ZERO?(t.enable(t.BLEND),t.blendEquation(e.blendMode),t.blendFuncSeparate(e.srcColor,e.dstColor,e.srcAlpha,e.dstAlpha)):t.disable(t.BLEND)}}},{key:"setBlendColor",value:function(e){this.gl.blendColor(e[0],e[1],e[2],e[3])}},{key:"compileShaderProgram",value:function(e,t,n){var r=this.gl,i=r.createShader(e);if(r.shaderSource(i,n),r.compileShader(i),!r.getShaderParameter(i,r.COMPILE_STATUS))throw"shader compile error: ("+t+")\n"+r.getShaderInfoLog(i);return i}},{key:"linkShaderProgram",value:function(e,t,n){var r=this.gl;if(r.attachShader(e,t),r.attachShader(e,n),r.linkProgram(e),!r.getProgramParameter(e,r.LINK_STATUS))throw console.error?(console.log("Panorama Shader Error"),console.log("Shader Link Error1 : Could not initialize shader."),console.log("Shader Link Error2 : ",r.getProgramParameter(e,r.VALIDATE_STATUS)),console.log("Shader Link Error3 : ",r.getError()),console.log("Shader Link Error4 : ",r.getProgramInfoLog(e))):alert("Panorama Shader Error \nShader Link Error1 : Could not initialize shader.\nShader Link Error2 : "+r.getProgramParameter(e,r.VALIDATE_STATUS)+"\nShader Link Error3 : "+r.getError()+"\nShader Link Error4 : "+r.getProgramInfoLog(e)),r.deleteProgram(e),"shader build error:\n"+r.getProgramParameter(e,r.VALIDATE_STATUS);return e}},{key:"buildShaderProgram",value:function(e,t,n,r){var i=this.gl,a=this.compileShaderProgram(i.VERTEX_SHADER,e,t),o=this.compileShaderProgram(i.FRAGMENT_SHADER,n,r),s=i.createProgram(),u=we.Name2Location;for(var l in u)u.hasOwnProperty(l)&&i.bindAttribLocation(s,u[l],l);return this.linkShaderProgram(s,a,o),i.deleteShader(a),i.deleteShader(o),s}},{key:"bindShaderProgram",value:function(e){this.gl.useProgram(e)}},{key:"deleteShaderProgram",value:function(e){this.gl.deleteProgram(e)}},{key:"extractActiveAttributes",value:function(e){for(var t=this.gl,n=[],r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<r;++i){var a=t.getActiveAttrib(e,i);n[i]={location:t.getAttribLocation(e,a.name),name:a.name,type:a.type,size:a.size}}return n}},{key:"extractActiveUniforms",value:function(e){for(var t=this.gl,n=[],r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),i=0;i<r;++i){var a=t.getActiveUniform(e,i);n[i]={location:t.getUniformLocation(e,a.name),name:a.name,type:a.type,size:a.size}}return n}},{key:"bindVertexAttributePointer",value:function(e,t){var n=this.gl;t?(n.enableVertexAttribArray(e),n.vertexAttribPointer(e,t.size,t.type,t.normalize,t.stride,t.offset)):n.disableVertexAttribArray(e)}},{key:"enableVertexAttrib",value:function(e){this.gl.enableVertexAttribArray(e)}},{key:"disableVertexAttrib",value:function(e){this.gl.disableVertexAttribArray(e)}},{key:"bindUniformValue",value:function(e,t,n){var r=this.gl;switch(arguments.length,t){case r.FLOAT:r.uniform1f(e,n);break;case r.FLOAT_VEC2:r.uniform2f(e,n[0],n[1]);break;case r.FLOAT_VEC3:r.uniform3f(e,n[0],n[1],n[2]);break;case r.FLOAT_VEC4:r.uniform4f(e,n[0],n[1],n[2],n[3]);break;case r.INT:case r.SAMPLER_2D:case r.BOOL:r.uniform1i(e,n);break;case r.INT_VEC2:case r.BOOL_VEC2:r.uniform2i(e,n[0],n[1]);break;case r.INT_VEC3:case r.BOOL_VEC3:r.uniform3i(e,n[0],n[1],n[2]);break;case r.INT_VEC4:case r.BOOL_VEC4:r.uniform4i(e,n[0],n[1],n[2],n[3]);break;case r.FLOAT_MAT2:case r.FLOAT_MAT3:throw"not implemented yet.";case r.FLOAT_MAT4:Ee(Ne,n),r.uniformMatrix4fv(e,!1,Ne);break;default:throw"unexpected case"}}},{key:"createVertexBuffer",value:function(e){var t=this.gl,n=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),n}},{key:"bindVertexBuffer",value:function(e){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e)}},{key:"deleteVertexBuffer",value:function(e){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,null),t.deleteBuffer(e)}},{key:"createIndexBuffer",value:function(e){var t=this.gl,n=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW),n}},{key:"bindIndexBuffer",value:function(e){var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e)}},{key:"deleteIndexBuffer",value:function(e){var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.deleteBuffer(e)}},{key:"bindFramebuffer",value:function(e){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e)}},{key:"createTextureBuffer",value:function(e,t,n){var r=this.gl;return r.activeTexture(r.TEXTURE0),r.createTexture()}},{key:"bindTextureBuffer",value:function(e,t){var n=this.gl;n.activeTexture(n.TEXTURE0+e),n.bindTexture(n.TEXTURE_2D,t)}},{key:"uploadTextureParameters",value:function(e,t,n,r){var i=this.gl;i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,r)}},{key:"updateTexture",value:function(e,t,n){var r=this.gl;r.bindTexture(r.TEXTURE_2D,e),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,n.wrapS),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,n.wrapT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n.minFilter),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n.magFilter),r.texImage2D(r.TEXTURE_2D,0,n.pixelType,n.pixelType,r.UNSIGNED_BYTE,t)}},{key:"updateTextureFromPixelArray",value:function(e,t,n,r,i){var a=this.gl;a.bindTexture(a.TEXTURE_2D,e),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i.wrapS),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i.wrapT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,i.minFilter),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,i.magFilter),a.texImage2D(a.TEXTURE_2D,0,i.pixelType,t,n,0,i.pixelType,a.UNSIGNED_BYTE,r)}},{key:"deleteTextureBuffer",value:function(e){this.gl.deleteTexture(e)}},{key:"createRenderBuffer",value:function(e,t,n){var r=this.gl,i=r.createRenderbuffer();return r.bindRenderbuffer(r.RENDERBUFFER,i),r.renderbufferStorage(r.RENDERBUFFER,n,e,t),i}},{key:"createFrameBuffer",value:function(e,t,n){var r=this.gl,i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,colorBufferHandle,0);var a=r.DEPTH_COMPONENT16,o=r.createRenderbuffer();if(r.bindRenderbuffer(r.RENDERBUFFER,o),r.renderbufferStorage(r.RENDERBUFFER,a,e,t),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,o),r.checkFramebufferStatus(r.FRAMEBUFFER)!==r.FRAMEBUFFER_COMPLETE)throw"frame buffer creation fail."}},{key:"flush",value:function(){this.gl.flush()}}])&&Le(t.prototype,n),r&&Le(t,r),e}(),Ne=new Float32Array(16);function Fe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ve=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),We(t),this.selector=t,this.rule=He[He.length-1],this.style=this.rule.style}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){qe(this.selector),this.style=this.rule=this.selector=null}},{key:"cssText",value:function(e){var t=this;e.split(";").forEach(function(e){var n=Fe(e.split(":"),2),r=n[0],i=n[1];t.set(r,i)})}},{key:"set",value:function(e,t){var n=Ke(e);if(""!==n)if(Xe[e]){for(var r=0,i=Ye.length;r<i;r++){var a=Ye[r]+n.charAt(0).toUpperCase()+n.substr(1);this.style[a]=t}this.style[n]=t}else this.style[n]=t;return this}},{key:"get",value:function(e){var t=Ke(e),n=null;return""!==t&&(n=this.style[t]),n}}])&&je(t.prototype,n),r&&je(t,r),e}(),Be=function(){},Ue=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(Ue);var Ge=Ue.styleSheet||Ue.sheet,He=Ge.cssRules||Ge.rules,ze=function(e){for(var t,n=0,r=He.length;n<r;n++)if(He[t=n].selectorText.toLowerCase()===e||He[t=r-n-1].selectorText.toLowerCase()===e)return t},We=Be,qe=Be;Ge.insertRule?(We=function(e){Ge.insertRule(e+"{}",He.length)},qe=function(e){Ge.deleteRule(ze(e))}):(We=function(e){try{Ge.addRule(e+"{}",He.length)}catch(t){Ge.addRule(e,He.length)}},qe=function(e){Ge.removeRule(ze(e))});var Ye=["webkit","moz","o","ms"],Xe={transform:!0,"transform-origin":!0,"transform-style":!0,transition:!0,"transition-property":!0,"transition-duration":!0,"transition-timing-function":!0,"transition-delay":!0,"animation-name":!0,"animation-duration":!0,"animation-timing-function":!0,"animation-iteration-count":!0,"animation-direction":!0,"animation-play-state":!0,"animation-delay":!0,"text-shadow":!0,"box-shadow":!0,"box-sizing":!0,"border-radius":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-image":!0,"border-image-source":!0,"border-image-slice":!0,"border-image-width":!0,"border-image-outset":!0,"border-image-repeat":!0};function Ke(e){if(e&&""!==e){var t=e.split("-"),n="";if(t.length>1)for(var r=0,i=t.length;r<i;r++)n+=0===r?t[r]:t[r].charAt(0).toUpperCase()+t[r].substr(1);else n+=t[0];return n}return""}var Ze=new Map;function Qe(e,t,n){return Ze.set(e,{group:t,dataType:n}),e}var Je={GLOBAL:Symbol("GLOBAL"),RENDERABLE_TEXTURE:Symbol("RENDERABLE_TEXTURE"),RENDERABLE:Symbol("RENDERABLE")},$e=Je,et=WebGLRenderingContext,tt={GLOBAL_OPACITY:Qe("u_global_opacity",$e.GLOBAL,et.FLOAT),PIXEL_RATIO:Qe("u_pixel_ratio",$e.GLOBAL,et.FLOAT),PIXEL_RATIO_INV:Qe("u_pixel_ratio_inv",$e.GLOBAL,et.FLOAT),VIEWPORT:Qe("u_viewport",$e.GLOBAL,et.FLOAT_VEC2),RV_DEPTHMAP:Qe("u_rv_depthmap",$e.GLOBAL,et.SAMPLER_2D),PANO_VIEW_TYPE:Qe("u_viewtype",$e.GLOBAL,et.FLOAT),PANO_VIEW_RADIUS:Qe("u_viewradius",$e.GLOBAL,et.FLOAT),PANO_MAX_DEPTH:Qe("u_maxdepth",$e.GLOBAL,et.FLOAT),PANO_COMPARE_RATIO:Qe("u_rto",$e.GLOBAL,et.FLOAT),PANO_COMPARE_SPLITBAR_FACTOR:Qe("u_sbf",$e.GLOBAL,et.FLOAT),PANO_COMPARE_MOVE_ALPHA:Qe("u_ma",$e.GLOBAL,et.FLOAT),PANO_COMPARE_SPLIT_MODE:Qe("u_sm",$e.GLOBAL,et.FLOAT),PANO_COMPARE_SPLITBAR_COLOR:Qe("u_sbc",$e.GLOBAL,et.FLOAT_VEC4),DECAL:Qe("u_decal",$e.RENDERABLE_TEXTURE,et.SAMPLER_2D),SCREEN:Qe("u_screen",$e.RENDERABLE_TEXTURE,et.SAMPLER_2D),DIFFUSE:Qe("u_diffuse",$e.RENDERABLE_TEXTURE,et.SAMPLER_2D),DIFFUSE2:Qe("u_diffuse2",$e.RENDERABLE_TEXTURE,et.SAMPLER_2D),DIFFUSE3:Qe("u_diffuse3",$e.RENDERABLE_TEXTURE,et.SAMPLER_2D),DIFFUSE4:Qe("u_diffuse4",$e.RENDERABLE_TEXTURE,et.SAMPLER_2D),MVP:Qe("u_mvp",$e.RENDERABLE,et.FLOAT_MAT4),DIFFUSE_COLOR:Qe("u_diffuse_color",$e.RENDERABLE,et.FLOAT_VEC4),OPACITY:Qe("u_opacity",$e.RENDERABLE,et.FLOAT),PANO_LINE_INFO:Qe("u_lineinfo",$e.RENDERABLE,et.FLOAT_VEC4),PANO_COMPARE_MVP:Qe("u_pcmvp",$e.RENDERABLE,et.FLOAT_MAT4),N_MATRIX:Qe("u_n_matrix",$e.RENDERABLE,et.FLOAT_MAT4)};function nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.freeze(Ze),Object.freeze(Je),Object.freeze(tt);var rt=function(){function e(t,n,r,i,a,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderContext=t,this.location=n,this.name=r,this.group=i,this.dataType=a,this.size=o}var t,n,r;return t=e,(n=[{key:"uploadParameter",value:function(e){this.renderContext.bindUniformValue(this.location,this.dataType,e)}}])&&nt(t.prototype,n),r&&nt(t,r),e}();function it(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var at=function(){function e(t,n,r,i,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"highp";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o&&(r=ot(r,o),a=ot(a,o));var s=t.buildShaderProgram(n,r,i,a),u=t.extractActiveAttributes(s),l=!0,c=!1,f=void 0;try{for(var h,p=u[Symbol.iterator]();!(l=(h=p.next()).done);l=!0){var d=h.value;we.Name2Location.hasOwnProperty(d.name)||console.warn("unauthorized shader attribute: ".concat(d.name,"@").concat(n))}}catch(e){c=!0,f=e}finally{try{l||null==p.return||p.return()}finally{if(c)throw f}}var v=t.extractActiveUniforms(s),y=[],m=[],g=[],b=!0,w=!1,_=void 0;try{for(var T,x=v[Symbol.iterator]();!(b=(T=x.next()).done);b=!0){var S=T.value,k=Ze.get(S.name);k||console.warn('unauthorized shader uniform: " '.concat(S.name,' " (vs:').concat(n,", fs:").concat(i,")")),S.type!==k.dataType&&console.warn('uniform data type unmatched: " '.concat(S.name,' " (vs:').concat(n,", fs:").concat(i,")"));var P=new rt(t,S.location,S.name,k.group,S.type,S.size);switch(k.group){case Je.GLOBAL:y.push(P);break;case Je.RENDERABLE_TEXTURE:m.push(P);break;case Je.RENDERABLE:g.push(P);break;default:console.warn('uniform group is unknown: " '.concat(S.name,' " (vs:').concat(n,", fs:").concat(i,")"))}}}catch(e){w=!0,_=e}finally{try{b||null==x.return||x.return()}finally{if(w)throw _}}this.renderContext=t,this.handle=s,this.attributes=u,this.uniformsOfProgram=y,this.uniformsOfTexture=m,this.uniformsOfRenderable=g}var t,n,r;return t=e,(n=[{key:"reset",value:function(){this.attributes=null,this.uniforms=null,this.renderContext.deleteShaderProgram(this.handle),this.handle=null}}])&&it(t.prototype,n),r&&it(t,r),e}();function ot(e,t){return"precision"!==e.substring(0,9)?"precision "+t+" float;\n"+e:e}function st(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ut=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderContext=t,this.handle=t.createVertexBuffer(n),this.dataView=new DataView(n.buffer,n.byteOffset,n.byteLength),this.component=null}var t,n,r;return t=e,(n=[{key:"setVertexComponent",value:function(e){this.component=e}},{key:"reset",value:function(){null!==this.handle&&(this.renderContext.deleteVertexBuffer(this.handle),this.handle=null,this.component=null)}}])&&st(t.prototype,n),r&&st(t,r),e}();function lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ct=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderContext=t,this.handle=t.createIndexBuffer(n),this.dataView=new DataView(n.buffer,n.byteOffset,n.byteLength),this.indexType=5123,this.indexLength=n.byteLength/2}var t,n,r;return t=e,(n=[{key:"reset",value:function(){null!==this.handle&&(this.renderContext.deleteIndexBuffer(this.handle),this.handle=null,this.indexLength=0)}}])&&lt(t.prototype,n),r&&lt(t,r),e}();function ft(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ht=WebGLRenderingContext,pt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderContext=t,this.handle=t.createTextureBuffer(),this.wrapS=ht.CLAMP_TO_EDGE,this.wrapT=ht.CLAMP_TO_EDGE,this.minFilter=ht.LINEAR,this.magFilter=ht.LINEAR,this.pixelType=ht.RGBA}var t,n,r;return t=e,(n=[{key:"updateData",value:function(e){this.renderContext.updateTexture(this.handle,e,this)}},{key:"updateFromPixelArray",value:function(e,t,n){this.renderContext.updateTextureFromPixelArray(this.handle,e,t,n,this)}},{key:"reset",value:function(){this.renderContext.deleteTextureBuffer(this.handle)}}])&&ft(t.prototype,n),r&&ft(t,r),e}();function dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var vt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderContext=t,this.name="default",this.width=0,this.height=0,this.pixelFormat=WebGLRenderingContext.RGBA,this.pixelDataType=WebGLRenderingContext.UNSIGNED_BYTE,this.depthBuffer=n?null:t.gl.createRenderbuffer(),this.frameBuffer=n?null:t.gl.createFramebuffer(),this.colorBuffer=n?null:new pt(t),this.colorBuffer&&(this.colorBuffer.handle=t.gl.createTexture()),this.pixelDataArray=new Uint8Array(0),this.isDefault=n}var t,n,r;return t=e,(n=[{key:"update",value:function(){if(!this.isDefault){if(0===this.width||0===this.height)return console.warn("RenderTarget의 width/height가 0이 될 수 없습니다.");var e=this.renderContext.gl;e.bindTexture(e.TEXTURE_2D,this.colorBuffer.handle),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,this.pixelFormat,this.pixelDataType,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,this.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.width,this.height),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.colorBuffer.handle,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer),e.bindFramebuffer(e.FRAMEBUFFER,null)}}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.update()}},{key:"getColorBuffer",value:function(){return this.colorBuffer}},{key:"getFrameBuffer",value:function(){return this.frameBuffer}},{key:"getPixelData",value:function(){var e=this.width*this.height*4;this.pixelDataArray.length!==e&&(this.pixelDataArray=new Uint8Array(e));var t=this.renderContext.gl;return t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.pixelDataArray),t.bindFramebuffer(t.FRAMEBUFFER,null),this.pixelDataArray}}])&&dt(t.prototype,n),r&&dt(t,r),e}();function yt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var mt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n="string"==typeof t?document.getElementById(t):t;if(!n)throw"container must be HTMLElement or element id";var r=Date.now()%1e4,i=document.createElement("canvas");i.id="renderview_"+r;var a=new De(i);if(!a.initialize())throw alert("해당 시스템에서는 로드뷰를 이용하실 수 없습니다.\nWindows OS라면 DirectX 버전을 11.0 이상으로 업데이트 해주시기 바랍니다.\n또는 Windows 10 이상의 OS로 업그레이드를 해주시기 바랍니다.\n이외 다른 문제라면 고객센터를 통해 제보 부탁드립니다."),"Rendering Context initialize fail.";var o=i.rcss=new Ve("#"+i.id);o.set("position","relative"),o.set("width","100%"),o.set("height","100%"),o.set("zIndex",0),n.appendChild(i),n.rcss=new Ve(n.id?"#"+n.id:"."+n.className),n.rcss.set("position","relative"),n.rcss.set("width","100%"),n.rcss.set("height","100%"),n.rcss.set("display","block"),this.container=n,this.canvas=i,this.renderContext=a,this.devicePixelRatio=1,this.viewSizeWidth=0,this.viewSizeHeight=0,this.vsCodeTable=new Map,this.fsCodeTable=new Map,this.shaderTable=new Map,this.updateViewportSize()}var t,n,r;return t=e,(n=[{key:"getContainer",value:function(){return this.container}},{key:"updateViewportSize",value:function(){var e=this.canvas;this.viewSizeWidth=e.width=e.clientWidth*this.devicePixelRatio,this.viewSizeHeight=e.height=e.clientHeight*this.devicePixelRatio}},{key:"getRenderContext",value:function(){return this.renderContext}},{key:"getPixelRatio",value:function(){return this.devicePixelRatio}},{key:"addVertexShader",value:function(e,t){this.vsCodeTable.has(e)||this.vsCodeTable.set(e,t)}},{key:"addFragmentShader",value:function(e,t){this.fsCodeTable.has(e)||this.fsCodeTable.set(e,t)}},{key:"getShaderProgram",value:function(e,t){var n="".concat(e,"_").concat(t),r=this.shaderTable.get(n);if(!r){var i=this.vsCodeTable.get(e),a=this.fsCodeTable.get(t);r=new at(this.renderContext,e,i,t,a),this.shaderTable.set(n,r)}return r}},{key:"createRenderTarget2D",value:function(e,t){var n=new vt(this.renderContext);return n.resize(e,t),n}},{key:"createVertexBuffer",value:function(e,t){var n=new ut(this.renderContext,e);return n.setVertexComponent(t),n}},{key:"createIndexBuffer",value:function(e){return new ct(this.renderContext,e)}},{key:"createTextureBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=this.renderContext.gl,l=new pt(this.renderContext);return l.pixelType=r||u.RGBA,l.wrapS=i||u.CLAMP_TO_EDGE,l.wrapT=a||u.CLAMP_TO_EDGE,l.minFilter=o||u.LINEAR,l.magFilter=s||u.LINEAR,t&&n&&e.BYTES_PER_ELEMENT?l.updateFromPixelArray(t,n,e):l.updateData(e),l}}])&&yt(t.prototype,n),r&&yt(t,r),e}(),gt=Math.PI/2,bt=Math.PI,wt=2*bt,_t=bt/180,Tt=180/bt;function xt(e,t,n){return e<t?t:n<e?n:e}function St(e){return(e%=wt)<0&&(e+=wt),e}function kt(e){return(e%=360)<0&&(e+=360),e}function Pt(e,t){var n="",r=e.toString();if(r.length<t)for(var i=0;i<t-r.length;++i)n+="0";return n+r}Math.abs;var Ot=Math.sqrt;function Et(e){return e[0]=e[1]=e[2]=0,e}function It(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Mt(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function Ct(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Rt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function At(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Lt(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Dt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Nt(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2];return e[0]=i*u-a*s,e[1]=a*o-r*u,e[2]=r*s-i*o,e}function Ft(e,t){var n=e[0],r=e[1],i=e[2],a=t[0],o=t[1],s=t[2];return(a-n)*(a-n)+(o-r)*(o-r)+(s-i)*(s-i)}function jt(e,t){return Ot(Ft(e,t))}function Vt(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Ot(a),e[0]=n*a,e[1]=r*a,e[2]=i*a),e}function Bt(e,t,n){var r=t[0],i=t[1],a=t[2],o=1/(n[3]*r+n[7]*i+n[11]*a+n[15]);return e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])*o,e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])*o,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])*o,e}var Ut=Math.sin,Gt=Math.cos;function Ht(e){return e[0]=e[1]=e[2]=0,e[3]=1,e}function zt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Wt(e,t){return e[0]=0,e[1]=0,e[2]=Ut(.5*t),e[3]=Gt(.5*t),e}function qt(e,t,n){var r=Ut(.5*t),i=Gt(.5*t),a=Ut(.5*n),o=Gt(.5*n);return e[0]=i*a,e[1]=r*a,e[2]=r*o,e[3]=i*o,e}var Yt=Math.sqrt;function Xt(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=n[0]-i,u=n[1]-a,l=n[2]-o,c=r[0]-i,f=r[1]-a,h=r[2]-o,p=u*h-l*f,d=l*c-s*h,v=s*f-u*c,y=p*p+d*d+v*v;return 0===y?(e[0]=e[1]=e[2]=e[3]=0,e):(y=1/Yt(y),e[0]=p*=y,e[1]=d*=y,e[2]=v*=y,e[3]=p*i+d*a+v*o,e)}function Kt(e,t,n,r){return e[0]*t+e[1]*n+e[2]*r-e[3]}function Zt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Qt=Oe([]),Jt=[-1,-1,-1],$t=[1,-1,-1],en=[1,1,-1],tn=[-1,1,-1],nn=[-1,-1,1],rn=[1,-1,1],an=[1,1,1],on=[-1,1,1],sn=[0,0,0],un=[0,0,0],ln=[0,0,0],cn=[0,0,0],fn=[0,0,0],hn=[0,0,0],pn=[0,0,0],dn=[0,0,0],vn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.planes=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}var t,n,r;return t=e,(n=[{key:"fromCamera",value:function(e){Ce(Qt,e.viewProjTransform),Bt(sn,Jt,Qt),Bt(un,$t,Qt),Bt(ln,en,Qt),Bt(cn,tn,Qt),Bt(fn,nn,Qt),Bt(hn,rn,Qt),Bt(pn,an,Qt),Bt(dn,on,Qt);var t=this.planes;Xt(t[0],ln,un,sn),Xt(t[1],pn,hn,un),Xt(t[2],dn,fn,hn),Xt(t[3],cn,sn,fn),Xt(t[4],dn,pn,ln),Xt(t[5],hn,fn,sn)}},{key:"intersectAxisAlignedBox2",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=this.planes[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(Kt(o,o[0]<0?e[0]:e[3],o[1]<0?e[1]:e[4],0)<0)return!1}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}return!0}},{key:"intersectAxisAlignedBox3",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=this.planes[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(Kt(o,o[0]<0?e[0]:e[3],o[1]<0?e[1]:e[4],o[2]<0?e[2]:e[5])<0)return!1}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}return!0}}])&&Zt(t.prototype,n),r&&Zt(t,r),e}();function yn(e){return(yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var gn=Math.abs,bn=Math.pow,wn=(Math.sin,Math.cos,Math.tan),_n=Math.atan2,Tn=Math.acos,xn=Math.min,Sn=Math.max,kn=Date.now,Pn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.projectionMode=t,this.viewportWidth=n.width,this.viewportHeight=n.height,this.aspectRatio=n.width/n.height,this.fovy=60*_t,this.nearZ=-1,this.farZ=1,this.focalLength=n.height/(2*wn(.5*this.fovy)),this.scaleFactor=.0625,this.zoomLevel=3,this.distance=this.focalLength*this.scaleFactor*bn(2,this.zoomLevel),this.target=Et([]),this.position=Et([]),this.orientation=Ht([]),this.pan=0,this.tilt=0,this.direction=Et([]),this.viewTransform=Oe([]),this.projTransform=Oe([]),this.viewProjTransform=Oe([]),this.hasUpdated=!1,this.idleReservationTime=1/0,this.tiltMin=0,this.tiltMax=bt,this.zoomMin=0,this.zoomMax=14,this.fovyMin=30*_t,this.fovyMax=90*_t,this.panoramaMode=!1,this.frustum=new vn}var t,n,r;return t=e,(n=[{key:"setViewport",value:function(e,t){this.viewportWidth=e,this.viewportHeight=t,this.aspectRatio=e/t,this.focalLength=Sn(e,t)/(2*wn(.5*xn(this.fovy,this.fovy*this.aspectRatio))),this.updateMatrix()}},{key:"setFovy",value:function(e){this.fovy=e*_t,this.updateMatrix()}},{key:"setTarget",value:function(e,t,n){"number"==typeof e&&"number"==typeof t&&"number"==typeof n?Mt(this.target,e,t,n):"object"===yn(e)&&"number"==typeof e[0]&&"number"==typeof e[1]&&"number"==typeof e[2]&&It(this.target,e),this.updateMatrix()}},{key:"setPanTilt",value:function(e,t){this.pan=e*_t,this.tilt=t*_t,qt(this.orientation,this.pan,this.tilt),this.updateMatrix()}},{key:"setOrientation",value:function(e){var t=e[0],n=e[1],r=e[2],i=e[3];this.pan=_n(2*t*n+2*i*r,1-2*n*n-2*r*r),this.tilt=Tn(1-2*t*t-2*n*n),zt(this.orientation,e),this.updateMatrix()}},{key:"setZoomLevel",value:function(e){this.zoomLevel=e,this.updateMatrix()}},{key:"setDistance",value:function(e){this.distance=e,this.updateMatrix()}},{key:"setValue",value:function(e,t,n,r,i,a){null!==e&&(this.target[0]=e),null!==t&&(this.target[1]=t),null!==n&&(this.target[2]=n),null!==r&&(this.pan=r*_t),null!==i&&(this.tilt=i*_t),null!==a&&(this.zoomLevel=a),qt(this.orientation,this.pan,this.tilt),this.updateMatrix()}},{key:"needUpdate",value:function(){this.hasUpdated=!0,this.idleReservationTime=kn()+250}},{key:"updateMatrix",value:function(){switch(this.focalLength=this.viewportHeight/(2*wn(.5*this.fovy)),this.distance=this.focalLength*this.scaleFactor*bn(2,this.zoomLevel),this.updateViewMatrix(),this.projectionMode){case e.ORTHOGRAPHIC:this.updateOrthographicProjection();break;case e.PERSPECTIVE:this.updatePerspectiveProjection()}Me(this.viewProjTransform,this.projTransform,this.viewTransform),this.needUpdate()}},{key:"updateViewMatrix",value:function(){var e,t,n,r,i,a,o,s,u,l,c,f,h,p,d,v,y,m,g=this.viewTransform,b=this.position,w=this.direction,_=this.target,T=this.distance;e=g,t=this.orientation,n=-t[0],r=-t[1],i=-t[2],a=t[3],l=n*(o=n+n),c=n*(s=r+r),f=n*(u=i+i),h=r*s,p=r*u,d=i*u,v=a*o,y=a*s,m=a*u,e[0]=1-(h+d),e[1]=c+m,e[2]=f-y,e[4]=c-m,e[5]=1-(l+d),e[6]=p+v,e[8]=f+y,e[9]=p-v,e[10]=1-(l+h),e[3]=e[7]=e[11]=0,e[12]=e[13]=e[14]=0,e[15]=1,w[0]=-g[2],w[1]=-g[6],w[2]=-g[10],this.panoramaMode?(b[0]=_[0],b[1]=_[1],b[2]=_[2]):(b[0]=_[0]-w[0]*T,b[1]=_[1]-w[1]*T,b[2]=_[2]-w[2]*T),g[12]=-(g[0]*b[0]+g[4]*b[1]+g[8]*b[2]),g[13]=-(g[1]*b[0]+g[5]*b[1]+g[9]*b[2]),g[14]=-(g[2]*b[0]+g[6]*b[1]+g[10]*b[2]),g[3]=g[7]=g[11]=0,g[15]=1}},{key:"updateFrustum",value:function(){this.frustum.fromCamera(this)}},{key:"updateOrthographicProjection",value:function(){var e=this.scaleFactor*bn(2,this.zoomLevel),t=this.viewportWidth*e,n=this.viewportHeight*e,r=gn(.5*n*wn(this.tilt));this.nearZ=xn(0,this.distance-r),this.farZ=this.distance+r,function(e,t,n,r,i){e[0]=2/t,e[5]=2/n,e[10]=-2/(i-r),e[14]=-(i+r)/(i-r),e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=0,e[8]=e[9]=e[11]=e[12]=e[13]=0,e[15]=1}(this.projTransform,t,n,this.nearZ,this.farZ)}},{key:"updatePerspectiveProjection",value:function(){this.panoramaMode?this.farZ=2048:this.farZ=1024*this.distance,this.nearZ=1e-6*this.farZ,Re(this.projTransform,this.fovy,this.aspectRatio,this.nearZ,this.farZ)}},{key:"getClearDistance",value:function(e){return Sn(this.viewportWidth,this.viewportHeight)/(2*wn(.5*this.fovy))*this.scaleFactor*bn(2,14-e)}},{key:"translate",value:function(e,t){var n=this.scaleFactor*bn(2,this.zoomLevel),r=this.viewTransform,i=this.target;i[0]+=(e*r[0]-t*r[4])*n,i[1]+=(e*r[4]+t*r[0])*n,this.updateMatrix()}},{key:"panTilt",value:function(e,t){if(e||t){var n=this.fovy/this.viewportHeight;this.panoramaMode?(this.pan=St(this.pan-e*n),this.tilt=xt(this.tilt+t*n,this.tiltMin,this.tiltMax)):(this.pan=St(this.pan+e*n),this.tilt=xt(this.tilt-t*n,this.tiltMin,this.tiltMax)),qt(this.orientation,this.pan,this.tilt),this.updateMatrix()}}},{key:"zoom",value:function(e){e&&(this.zoomLevel=xt(this.zoomLevel+-.0625*e,this.zoomMin,this.zoomMax),this.updateMatrix())}},{key:"zoomFovy",value:function(e,t){if(e){var n=e*_t,r=xt(this.fovy+n,this.fovyMin,this.fovyMax);if(t&&r!==this.fovyMin&&r!==this.fovyMax){var i=gn(t.pan-this.pan)%wt,a=t.tilt-this.tilt,o=xn(wt-i,i),s=xn(bt-a,a),u=Dt([0,0,1],Nt([],this.direction,t.dir))>0?1:-1,l=n/this.fovy*o*-u,c=(e>0?n:-n)/this.fovy*s*(e>0?-1:1);this.pan+=l,this.tilt+=c,qt(this.orientation,this.pan,this.tilt)}this.fovy=r,this.updateMatrix()}}}])&&mn(t.prototype,n),r&&mn(t,r),e}();function On(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Pn.PERSPECTIVE="perspective",Pn.ORTHOGRAPHIC="orthographic";var En=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.maxLength=t,this.shapes=new Set,this.shapeCount=0,this.renderables=new Set,this.renderableCount=0,this.camera=null,this.isCheckFrustum=!1}var t,n,r;return t=e,(n=[{key:"addRenderable",value:function(e){++this.renderableCount,this.renderables.add(e)}},{key:"addShape",value:function(e){++this.shapeCount,this.shapes.add(e)}},{key:"getShapes",value:function(){return this.shapes}},{key:"setCamera",value:function(e){this.camera=e}},{key:"checkFrustum",value:function(e){"boolean"==typeof e&&(this.isCheckFrustum=e)}},{key:"enterMesh",value:function(e){if(!this.isCheckFrustum)return!0;var t=e.getPhysicsModel();return!t||t.getBound().isInFrustum(this.camera.frustum)}},{key:"reset",value:function(){this.renderables.clear(),this.renderableCount=0,this.shapes.clear(),this.shapeCount=0}}])&&On(t.prototype,n),r&&On(t,r),e}(),In=0,Mn=1,Cn=0,Rn=1,An=0,Ln=1;function Dn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Nn=Math.sqrt,Fn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pos=t,this.dir=n,this.screenPoint=[]}var t,n,r;return t=e,(n=[{key:"copy",value:function(e){Object.assign(this.pos,e.pos),Object.assign(this.dir,e.dir)}},{key:"set",value:function(e,t){this.pos=e,this.dir=t}},{key:"setScreenPoint",value:function(e){this.screenPoint[0]=e[0],this.screenPoint[1]=e[1]}},{key:"fromOriginDirection",value:function(e,t){this.pos[0]=e[0],this.pos[1]=e[1],this.pos[2]=e[2],this.dir[0]=t[0],this.dir[1]=t[1],this.dir[2]=t[2]}},{key:"fromOriginTarget",value:function(e,t){var n=e[0],r=e[1],i=e[2],a=t[0]-n,o=t[1]-r,s=t[2]-i,u=a*a+o*o+s*s;return u>0&&(a*=u=1/Nn(u),o*=u,s*=u),this.px=n,this.py=r,this.pz=i,this.nx=a,this.ny=o,this.nz=s,this}}])&&Dn(t.prototype,n),r&&Dn(t,r),e}();function jn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Vn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.bound=n,this._boundMin=Et([]),this._boundMax=Et([]),this.bvhRoot=null,this.mesh=null,this.modelRay=new Fn,this.needUpdateBoundToWorld=!0}var t,n,r;return t=e,(n=[{key:"getBound",value:function(){return this.bound}},{key:"setBVHRoot",value:function(e){this.bvhRoot=e,this.mesh&&(this.bvhRoot.setMesh(this.mesh),this.bvhRoot.build())}},{key:"getBVHRoot",value:function(){return this.bvhRoot}},{key:"setMesh",value:function(e){this.mesh=e,this.bvhRoot&&(this.bvhRoot.setMesh(e),this.bvhRoot.build())}},{key:"updateBoundToWorld",value:function(){this.needUpdateBoundToWorld&&(At(this._boundMin,this.bvhRoot.getBound().getMin(),this.mesh.getShape().scale),Ct(this._boundMin,this._boundMin,this.mesh.getShape().position),At(this._boundMax,this.bvhRoot.getBound().getMax(),this.mesh.getShape().scale),Ct(this._boundMax,this._boundMax,this.mesh.getShape().position),this.bound.fromExtreams(this._boundMin,this._boundMax))}},{key:"intersectRay",value:function(e,t){}}])&&jn(t.prototype,n),r&&jn(t,r),e}(),Bn=1e-6,Un={ClippingFar:1/0};function Gn(e,t,n){var r=t.pos[0],i=t.pos[1],a=t.pos[2],o=t.dir[0],s=t.dir[1],u=t.dir[2],l=n[0],c=n[1],f=n[2],h=n[3],p=n[4],d=n[5],v=n[6],y=n[7],m=n[8],g=h-l,b=p-c,w=d-f,_=v-l,T=y-c,x=m-f,S=b*x-w*T,k=w*_-g*x,P=g*T-b*_,O=S*o+k*s+P*u;if(Math.abs(O)<Bn)return null;var E=-(S*r+k*i+P*a-(S*l+k*c+P*f))/O;if(e.distance=E,E<0)return null;var I=r+E*o,M=i+E*s,C=a+E*u,R=h-l,A=p-c,L=d-f,D=I-l,N=M-c,F=C-f;if((A*F-L*N)*S+(L*D-R*F)*k+(R*N-A*D)*P<0)return!1;var j=v-h,V=y-p,B=m-d,U=I-h,G=M-p,H=C-d;if((V*H-B*G)*S+(B*U-j*H)*k+(j*G-V*U)*P<0)return!1;var z=l-v,W=c-y,q=f-m,Y=I-v,X=M-y,K=C-m;return(W*K-q*X)*S+(q*Y-z*K)*k+(z*X-W*Y)*P>=0}function Hn(e){return(Hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wn(e,t){return!t||"object"!==Hn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qn(e){return(qn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Yn(e,t){return(Yn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xn=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Wn(this,qn(t).call(this,Mn,e))).invMatrix=Oe([]),n.needUpdateBoundToWorld=!0,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Yn(e,t)}(t,Vn),n=t,(r=[{key:"intersectRay",value:function(e,t){return!!(this.bound.intersect(t)&&this.bound.intersectResult.distance<=Un.ClippingFar&&(Ce(this.invMatrix,this.mesh.getShape().modelTransform),n=this.modelRay.dir,r=t.dir,i=this.invMatrix,a=r[0],o=r[1],s=r[2],n[0]=i[0]*a+i[4]*o+i[8]*s,n[1]=i[1]*a+i[5]*o+i[9]*s,n[2]=i[2]*a+i[6]*o+i[10]*s,Vt(this.modelRay.dir,this.modelRay.dir),Bt(this.modelRay.pos,t.pos,this.invMatrix),this.bvhRoot.intersectRay(e,this.modelRay)))&&(Bt(e.impactPosition,e.impactPosition,e.chunk.mesh.getShape().modelTransform),!0);var n,r,i,a,o,s}}])&&zn(n.prototype,r),i&&zn(n,i),t}();var Kn=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.distance=1/0};function Zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Qn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.box=n,this.intersectResult=new Kn}var t,n,r;return t=e,(n=[{key:"getMin",value:function(){}},{key:"getMax",value:function(){}},{key:"getCenter",value:function(){}}])&&Zn(t.prototype,n),r&&Zn(t,r),e}(),Jn=1/0;function $n(e){return e[0]=e[1]=e[2]=Jn,e[3]=e[4]=e[5]=-Jn,e}function er(e){return(er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nr(e,t){return!t||"object"!==er(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function rr(e){return(rr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ir(e,t){return(ir=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ar=WebGLRenderingContext,or=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=nr(this,rr(t).call(this,An,$n([])))).minPoint=[],e.maxPoint=[],e.centerPoint=[],e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ir(e,t)}(t,Qn),n=t,(r=[{key:"reset",value:function(){$n(this.box),this.minPoint.length=0,this.maxPoint.length=0,this.centerPoint.length=0}},{key:"getCenter",value:function(){return e=this.centerPoint,t=this.box,e[0]=.5*(t[0]+t[3]),e[1]=.5*(t[1]+t[4]),e[2]=.5*(t[2]+t[5]),e;var e,t}},{key:"getMin",value:function(){return this.minPoint[0]=this.box[0],this.minPoint[1]=this.box[1],this.minPoint[2]=this.box[2],this.minPoint}},{key:"getMax",value:function(){return this.maxPoint[0]=this.box[3],this.maxPoint[1]=this.box[4],this.maxPoint[2]=this.box[5],this.maxPoint}},{key:"fromVerticesFloat32",value:function(e,t){for(var n=t.stride,r=t[we.POSITION],i=r.size>=4?3:r.size,a=n/Float32Array.BYTES_PER_ELEMENT,o=e.length/a,s=0;s<o;++s){for(var u=[0,0,0],l=0;l<i;++l)u[l]=e[s*a+l];this.expand(u)}}},{key:"fromVertexBuffer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.reset();var r=e.dataView,i=t.stride,a=t[we.POSITION],o=a.size>=4?3:a.size,s=null;a.type===ar.FLOAT?s=this._getFloat32Position:a.type===ar.SHORT&&(s=this._getInt16Position);for(var u=r.byteLength+r.byteOffset,l=r.byteOffset;l<u;l+=i){for(var c=[0,0,0],f=0;f<o;++f)c[f]=s(r,l,f);n&&Bt(c,c,n),this.expand(c)}}},{key:"fromExtreams",value:function(e,t){this.box[0]=e[0],this.box[1]=e[1],this.box[2]=e[2],this.box[3]=t[0],this.box[4]=t[1],this.box[5]=t[2],this.minPoint=this.getMin(),this.maxPoint=this.getMax(),this.centerPoint=this.getCenter()}},{key:"expand",value:function(e){var t=e[0],n=e[1],r=e[2];this.box[0]=this.box[0]<t?this.box[0]:t,this.box[1]=this.box[1]<n?this.box[1]:n,this.box[2]=this.box[2]<r?this.box[2]:r,this.box[3]=this.box[3]>t?this.box[3]:t,this.box[4]=this.box[4]>n?this.box[4]:n,this.box[5]=this.box[5]>r?this.box[5]:r,this.minPoint=this.getMin(),this.maxPoint=this.getMax(),this.centerPoint=this.getCenter()}},{key:"expandBoundary",value:function(e){this.expand(e.getMin()),this.expand(e.getMax())}},{key:"isInFrustum",value:function(e){return e.intersectAxisAlignedBox3(this.box)}},{key:"intersect",value:function(e){return function(e,t,n){var r,i,a,o=(n[0]-t.pos[0])/t.dir[0],s=(n[3]-t.pos[0])/t.dir[0],u=(n[1]-t.pos[1])/t.dir[1],l=(n[4]-t.pos[1])/t.dir[1],c=(n[2]-t.pos[2])/t.dir[2],f=(n[5]-t.pos[2])/t.dir[2];a=c<f?c:f;var h=(r=o<s?o:s)<(i=u<l?u:l)?i<a?a:i:r<a?a:r;a=c<f?f:c;var p=(r=o<s?s:o)<(i=u<l?l:u)?r<a?r:a:i<a?i:a;return!(p<0||p<h||(e.distance=h,0))}(this.intersectResult,e,this.box)}},{key:"_getFloat32Position",value:function(e,t,n){return e.getFloat32(t+4*n,!0)}},{key:"_getInt16Position",value:function(e,t,n){return e.getInt16(t+2*n,!0)}}])&&tr(n.prototype,r),i&&tr(n,i),t}();function sr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ur=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.bound=n,this.mesh=null,this.leaf=!0,this.childs=[]}var t,n,r;return t=e,(n=[{key:"intersectRay",value:function(e,t){}},{key:"build",value:function(){}},{key:"setMesh",value:function(e){this.mesh=e}},{key:"getBound",value:function(){return this.bound}},{key:"isLeaf",value:function(){return this.isLeaf}}])&&sr(t.prototype,n),r&&sr(t,r),e}();var lr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.id=null,this.distance=1/0,this.impactPosition=Et([]),this.chunk=null,this.index0=-1,this.index1=-1,this.index2=-1};function cr(e){return(cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function hr(e,t){return!t||"object"!==cr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function pr(e){return(pr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dr(e,t){return(dr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var vr=WebGLRenderingContext,yr=function(e){function t(e){var n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=hr(this,pr(t).call(this,Cn,e))).tri3=((r=[])[0]=0,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=0,r[6]=0,r[7]=0,r[8]=0,r),n.getPositionFunc=null,n.verticesView=null,n.indicesView=null,n.positionSize=0,n.vertexStride=0,n.smallestTriangleDistance=1/0,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dr(e,t)}(t,ur),n=t,(r=[{key:"build",value:function(){this.bound.reset();for(var e=0,t=this.mesh.chunks.length;e<t;++e){var n=this.mesh.chunks[e];this.bound.expandBoundary(n.bound)}var r=this.mesh.vertexBuffer.component[we.POSITION];r.type===vr.FLOAT?this.getPositionFunc=this._getFloat32Position:r.type===vr.SHORT&&(this.getPositionFunc=this._getInt16Position),this.verticesView=this.mesh.vertexBuffer.dataView,this.indicesView=this.mesh.indexBuffer.dataView,this.positionSize=r.size>=4?3:r.size,this.vertexStride=this.mesh.vertexBuffer.component.stride}},{key:"intersectRay",value:function(e,t){if(!this.mesh)return!1;this.smallestTriangleDistance=1/0;var n=[],r=new Kn,i=!1,a=this.mesh.getChunks(),o=!0,s=!1,u=void 0;try{for(var l,c=a[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var f=l.value;if(f.bound.intersect(t)&&f.bound.intersectResult.distance<=this.smallestTriangleDistance)for(var h=f.offset,p=f.offset+f.length;h<p;h+=3){n[0]=this.indicesView.getUint16(2*h,!0),n[1]=this.indicesView.getUint16(2*(h+1),!0),n[2]=this.indicesView.getUint16(2*(h+2),!0);for(var d=0;d<9;++d)this.tri3[d]=0;for(var v=0;v<3;++v)for(var y=n[v]*this.vertexStride,m=0;m<this.positionSize;++m)this.tri3[3*v+m]=this.getPositionFunc(y,m);Gn(r,t,this.tri3)&&r.distance<e.distance&&(this.smallestTriangleDistance=r.distance,e.distance=r.distance,e.chunk=f,e.id=f.id,e.impactPosition[0]=t.pos[0]+t.dir[0]*r.distance,e.impactPosition[1]=t.pos[1]+t.dir[1]*r.distance,e.impactPosition[2]=t.pos[2]+t.dir[2]*r.distance,e.index0=n[0],e.index1=n[1],e.index2=n[2],i=!0)}}}catch(e){s=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}return i}},{key:"_getFloat32Position",value:function(e,t){return this.verticesView.getFloat32(e+4*t,!0)}},{key:"_getInt16Position",value:function(e,t){return this.verticesView.getInt16(e+2*t,!0)}}])&&fr(n.prototype,r),i&&fr(n,i),t}();function mr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var gr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.name="",this.tags=[],this.type=null,this.mesh=null,this.offset=0,this.length=0,this.bound=t}var t,n,r;return t=e,(n=[{key:"setMesh",value:function(e){this.mesh=e}}])&&mr(t.prototype,n),r&&mr(t,r),e}();function br(e){return(br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _r(e,t){return!t||"object"!==br(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tr(e){return(Tr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xr(e,t){return(xr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Sr=null,kr=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=_r(this,Tr(t).call(this,Ln,[]))).maxValue=Math.pow(2,32)-1,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xr(e,t)}(t,Qn),n=t,i=[{key:"GetLargestBound",value:function(){return Sr||(Sr=new t),Sr}}],(r=[{key:"getCenter",value:function(){return[0,0,0]}},{key:"getMin",value:function(){return[-this.maxValue,-this.maxValue,-this.maxValue]}},{key:"getMax",value:function(){return[this.maxValue,this.maxValue,this.maxValue]}}])&&wr(n.prototype,r),i&&wr(n,i),t}();function Pr(e){return(Pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Or(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Er(e,t){return!t||"object"!==Pr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ir(e){return(Ir=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mr(e,t){return(Mr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Cr=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Er(this,Ir(t).call(this,Rn,e))).renderView=n,r.pixelOffset={offset:0,size:2},r.vertexStrideCount=0,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mr(e,t)}(t,ur),n=t,(r=[{key:"build",value:function(){var e=this.mesh.vertexBuffer.component[we.PIXELOFFSET];this.pixelOffset.offset=e.offset/Float32Array.BYTES_PER_ELEMENT,this.pixelOffset.size=e.size,this.vertexStrideCount=this.mesh.vertexBuffer.component.stride/Float32Array.BYTES_PER_ELEMENT}},{key:"intersectRay",value:function(e,t){if(!this.mesh)return!1;var n=this.mesh.vertexBuffer.dataView,r=n.getFloat32(0,!0),i=n.getFloat32(4,!0),a=n.getFloat32(8,!0),o=!1,s=this.mesh.getChunks(),u=!0,l=!1,c=void 0;try{for(var f,h=s[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var p=f.value,d=p.mesh.getShape(),v=[r+d.position[0],i+d.position[1],a+d.position[2]],y=this.renderView.project(v);if(y[2]>0){for(var m=[[],[],[],[]],g=0;g<4;++g)for(var b=this.pixelOffset.offset+this.vertexStrideCount*g,w=0;w<this.pixelOffset.size;++w)m[g][w]=.5*n.getFloat32(4*(b+w),!0);var _=m[3],T=m[1],x=[y[0]+_[0],y[1]-_[1]],S=[y[0]+T[0],y[1]-T[1]];if(t.screenPoint[0]>=x[0]&&t.screenPoint[0]<=S[0]&&t.screenPoint[1]>=x[1]&&t.screenPoint[1]<=S[1]){var k=jt(v,t.pos);k<e.distance&&(e.impactPosition=v,e.distance=k,e.id=p.id,e.chunk=p,o=!0)}}}}catch(e){l=!0,c=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw c}}return o}}])&&Or(n.prototype,r),i&&Or(n,i),t}(),Rr=(Math.abs,Math.sqrt);function Ar(e){return e[0]=e[1]=0,e}function Lr(e){return e[0]=e[1]=1,e}function Dr(e,t,n){return e[0]=t,e[1]=n,e}function Nr(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function Fr(e,t){return e[0]*t[0]+e[1]*t[1]}function jr(e){return Rr(function(e){return e[0]*e[0]+e[1]*e[1]}(e))}function Vr(e,t){var n=e[0],r=e[1],i=t[0],a=t[1];return(i-n)*(i-n)+(a-r)*(a-r)}function Br(e,t){return Rr(Vr(e,t))}function Ur(e){return(Ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Hr(e,t){return!t||"object"!==Ur(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function zr(e){return(zr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wr(e,t){return(Wr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qr=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Hr(this,zr(t).call(this,Rn,e))).renderView=n,r.vertexStrideCount=0,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wr(e,t)}(t,ur),n=t,(r=[{key:"build",value:function(){}},{key:"intersectRay",value:function(e,t){if(!this.mesh)return!1;this.vertexStrideCount=this.mesh.vertexBuffer.component.stride/Float32Array.BYTES_PER_ELEMENT;var n=this.renderView.getViewport(),r=[n.width,n.height],i=this.mesh.vertexBuffer.dataView,a=!1,o=this.mesh.getChunks(),s=!0,u=!1,l=void 0;try{for(var c,f=o[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){for(var h=c.value,p=(h.mesh.getShape(),[[],[],[],[]]),d=0;d<4;++d){var v=this.vertexStrideCount*d;p[d][0]=(.5*i.getFloat32(4*(v+0),!0)+.5)*r[0],p[d][1]=(.5-.5*i.getFloat32(4*(v+1),!0))*r[1]}var y=p[3],m=p[1],g=[y[0],y[1]],b=[m[0],m[1]],w=[.5*(g[0]+b[0]),.5*(g[1]+b[1])];if(t.screenPoint[0]>=g[0]&&t.screenPoint[0]<=b[0]&&t.screenPoint[1]>=g[1]&&t.screenPoint[1]<=b[1]){var _=Br(w,t.screenPoint);_<e.distance&&(e.impactPosition=w,e.distance=_,e.id=h.id,e.chunk=h,a=!0)}}}catch(e){u=!0,l=e}finally{try{s||null==f.return||f.return()}finally{if(u)throw l}}return a}}])&&Gr(n.prototype,r),i&&Gr(n,i),t}();function Yr(e){return(Yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Kr(e,t){return!t||"object"!==Yr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Zr(e){return(Zr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qr(e,t){return(Qr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Jr=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Kr(this,Zr(t).call(this,In,e))).needUpdateBoundToWorld=!1,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qr(e,t)}(t,Vn),n=t,(r=[{key:"intersectRay",value:function(e,t){return!!this.bvhRoot.intersectRay(e,t)}}])&&Xr(n.prototype,r),i&&Xr(n,i),t}();function $r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ei(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ti=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderView=t,this.camera=null,this.contentManager=null,this.terrain=null,this.traverser=null,this.layers=new Map,this.shapeCollectorTable=new Map}var t,n,r;return t=e,(n=[{key:"getContentManager",value:function(){return this.contentManager}},{key:"getCamera",value:function(){return this.camera}},{key:"setCamera",value:function(e){this.camera=e;var t=!0,n=!1,r=void 0;try{for(var i,a=this.shapeCollectorTable.values()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.setCamera(e)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}this.traverser&&this.traverser.setCamera(e)}},{key:"addLayer",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++){var a=i[r];this.layers.set(a.getName(),a),null===a.contentManager&&(a.contentManager=this.contentManager);var o=new En(3e3);o.setCamera(this.camera),this.shapeCollectorTable.set(a.getName(),o)}}},{key:"removeLayer",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++){var a=i[r];this.layers.delete(a.getName()),this.shapeCollectorTable.delete(a.getName())}}},{key:"getLayer",value:function(e){return this.layers.get(e)}},{key:"getShapeCollector",value:function(e){return this.shapeCollectorTable.get(e)}},{key:"getTerrain",value:function(){return this.terrain}},{key:"getTraverser",value:function(){return this.traverser}},{key:"extractScene",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.layers[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=$r(r.value,2),o=a[0],s=a[1],u=this.shapeCollectorTable.get(o);u&&(u.reset(),s.extractVisibleShape(u))}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"createPhysicsModel",value:function(e,t){var n=null;return e===Mn?n=new Xn(this.createBoundingVolume(t)):e===In&&(n=new Jr(this.createBoundingVolume(t))),n}},{key:"createBVH",value:function(e,t){var n=null;return e===Cn?n=new yr(this.createBoundingVolume(t)):e===Rn?n=new Cr(this.createBoundingVolume(t),this.renderView):2===e&&(n=new qr(this.createBoundingVolume(t),this.renderView)),n}},{key:"createChunks",value:function(e,t){for(var n=[],r=0;r<e;++r)n.push(new gr(this.createBoundingVolume(t)));return n}},{key:"createBoundingVolume",value:function(e){var t=null;return e===An?t=new or:e===Ln&&(t=kr.GetLargestBound()),t}}])&&ei(t.prototype,n),r&&ei(t,r),e}();function ni(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ri=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"setCount",value:function(){}}])&&ni(t.prototype,n),r&&ni(t,r),e}();var ii=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};var ai=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},oi=function(e,t){return t.rank-e.rank},si=function(e,t){return e.screenPosition()[1]==t.screenPosition()[1]?e.screenPosition[0]-t.screenPosition[0]:t.screenPosition[1]-e.screenPosition[1]},ui=1,li={create:function(e){return e.data.order===ui?si:oi}};function ci(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var fi=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sorter=li.create(n),this.labels=[]}var t,n,r;return t=e,(n=[{key:"clear",value:function(){this.labels.clear()}}])&&ci(t.prototype,n),r&&ci(t,r),e}();function hi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var pi=function(){function e(t,n,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderView=t,this.labelPool=n,this.visible=!0,this.hasLable=!1,this.data=null,this.collector=null,this.deployer=null,this.groupTable=new Map,this.exitIcons=[],this.exitTexts=[]}var t,n,r;return t=e,(n=[{key:"setStrategyData",value:function(e){this.data=e,this.collector=new fi(this.renderView,this),this.deployer=new LabelDeployer(this)}},{key:"addLabel",value:function(e,t){var n=this.groupTable.get(e);n.addLabel(t),n.invalidate()}},{key:"isValid",value:function(){var e=this.renderView.getSceneManager().getTerrain().currentLevel;return this.visible&&this.data.icon.minLevel<=e&&this.data.text.maxLevel>=e||this.exitIcons.length>0||this.exitTexts.length>0}},{key:"addExitIcon",value:function(e){if(this.labelPool.length>0&&lebel.isFirstEnterance&&this.animatorSet.iconExit.needAnimation(e)){var t=this.labelPool.shift();this.animatorSet.iconExit.initializeAnimationLabel(t,e),this.exitIcons.push(t)}this.animatorSet.iconEnterance.initializeAnimationLabel(e)}},{key:"addExitText",value:function(e){}},{key:"release",value:function(){this.disable(),this.clearAllLabels()}},{key:"clearAllLabels",value:function(){}}])&&hi(t.prototype,n),r&&hi(t,r),e}(),di=8;function vi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function yi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var gi=8192,bi=new Uint16Array(6*gi),wi={Background:0,Competition:1},_i=function(){function e(t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderView=t,this.containerTable=new Map,this.strategyTable=new Map;t.graphicsManager.createIndexBuffer(bi);var r={competitionTargetLayers:[],clickableLayers:[],labelChunks:null,labelBVHNode:null,chunkIndex:0},i=new ri(gi);i.setCount(0),r.labelChunks=i,r.labelBVHNode=new ii(t),this.competitionInfo=r,this.labelShapeDataComponents=(yi(n={},wi.Competition,new ai(t)),yi(n,wi.Background,new ai(t)),n)}var t,n,r;return t=e,(n=[{key:"reset",value:function(){}},{key:"extractShape",value:function(e){this.reset();var t=!0,n=!1,r=void 0;try{for(var i,a=this.containerTable[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=vi(i.value,2);o[0];o[1].extractVisibleLabels(this.strategyTable)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}var s=!0,u=!1,l=void 0;try{for(var c,f=this.labelShapeDataComponents[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){c.value;this.labelShapeDataComponents.reset()}}catch(e){u=!0,l=e}finally{try{s||null==f.return||f.return()}finally{if(u)throw l}}this.collectPois(),this.deployPois()}},{key:"collectPois",value:function(){}},{key:"deployPois",value:function(){}},{key:"onResizeViewport",value:function(e){}},{key:"addLabelLayer",value:function(e,t){this.containerTable.set(e,t)}},{key:"addStrategy",value:function(e){var t,n,r=this.labelShapeDataComponents[wi.Background],i=this.labelShapeDataComponents[wi.Competition];e.competition===di?(t=r,n=r):(t=i,n=r);var a=new pi(this.renderView,this.labelPool,this.competitionInfo,t,n);a.setStrategyData(e);var o=this.strategyTable.get(a.name);o&&o.release(),this.strategyTable.set(e.name,a)}}])&&mi(t.prototype,n),r&&mi(t,r),e}();function Ti(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var xi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderView=t,this.labelManager=new _i(t)}var t,n,r;return t=e,(n=[{key:"extractScene",value:function(e){this.labelManager.extractShape(e)}}])&&Ti(t.prototype,n),r&&Ti(t,r),e}();function Si(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ki=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderView=t,this.passes=[]}var t,n,r;return t=e,(n=[{key:"addPass",value:function(e){this.passes.push(e)}},{key:"render",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.passes[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){r.value.execute()}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}])&&Si(t.prototype,n),r&&Si(t,r),e}();function Pi(e){return(Pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ei(e,t){return!t||"object"!==Pi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ii(e){return(Ii=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mi(e,t){return(Mi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ci=Oe([]),Ri=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ei(this,Ii(t).call(this,"moved","idle","resize","success"))).graphicsManager=e,n.sceneManager=null,n.geometryManager=null,n.technique=null,n.viewport=new Te(0,0,e.viewSizeWidth,e.viewSizeHeight),n.renderTargetTable=new Map,n.renderTargetTable.set("default",new vt(n.graphicsManager.getRenderContext(),!0)),n.renderTargetForScreenList=new Set,n._needDraw=!0,n._isVisible=!0,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mi(e,t)}(t,E),n=t,(r=[{key:"setVisible",value:function(e){this._isVisible="boolean"!=typeof e||e}},{key:"isValid",value:function(){return this.viewport.isValid()&&this._isVisible}},{key:"getGraphicsManager",value:function(){return this.graphicsManager}},{key:"getSceneManager",value:function(){return this.sceneManager}},{key:"setEffectTechnique",value:function(e){this.technique=e}},{key:"project",value:function(e){var t=this.viewport,n=[];return Bt(n,e,this.sceneManager.getCamera().viewProjTransform),n[0]=.5*(n[0]+1)*t.width,n[1]=.5*(1-n[1])*t.height,n[2]=.5*(1-n[2]),n}},{key:"unproject",value:function(e){}},{key:"constructRayThroughPixel",value:function(e,t){var n=Ce(Ci,this.sceneManager.getCamera().viewProjTransform),r=this.viewport,i=2*t[0]/r.width-1,a=-(2*t[1]/r.height-1),o=[i,a,-1];Bt(o,o,n);var s=[i,a,1];Bt(s,s,n);var u=[];Rt(u,s,o),Vt(u,u),e.set(o,u),e.setScreenPoint(t)}},{key:"existRenderTarget",value:function(e){return this.renderTargetTable.has(e)}},{key:"getRenderTarget",value:function(e){return this.existRenderTarget(e)?this.renderTargetTable.get(e):null}},{key:"createRenderTarget",value:function(e,t,n){var r=!1;t&&n||(t=this.viewport.width,n=this.viewport.height,r=!0);var i=this.graphicsManager.createRenderTarget2D(t,n);i.name=e,this.renderTargetTable.set(e,i),r&&this.renderTargetForScreenList.add(i)}},{key:"resizeRenderTarget",value:function(e,t,n){"string"==typeof e?this.existRenderTarget(name)&&this.renderTargetTable.get(name).resize(t,n):renderTarget.resize(t,n)}},{key:"setViewport",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=this.viewport;if(!a.update(e,t,n,r))return!1;i&&this.graphicsManager.updateViewportSize();var o=!0,s=!1,u=void 0;try{for(var l,c=this.renderTargetForScreenList[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var f=l.value;f.resize(n,r)}}catch(e){s=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}return this.sceneManager.getCamera().setViewport(n,r),this.todoRender(),this.dispatch("resize"),!0}},{key:"getViewport",value:function(){return this.viewport}},{key:"setViewportFull",value:function(){var e=this.graphicsManager;e.updateViewportSize(),this.setViewport(0,0,e.viewSizeWidth,e.viewSizeHeight,!0)}},{key:"updateScene",value:function(){var e=this.sceneManager,t=e.camera;t.hasUpdated&&(t.updateFrustum(),e.terrain.update(e.traverser),this.todoRender(),this.dispatch("moved")),t.idleReservationTime<Date.now()&&(t.hasUpdated=!1,t.idleReservationTime=1/0,this.dispatch("idle"))}},{key:"needDraw",value:function(){return this._needDraw}},{key:"todoRender",value:function(){this._needDraw=!0}},{key:"draw",value:function(){this.technique&&this._needDraw&&(this._needDraw=!1,this.graphicsManager.renderContext.setViewport(this.viewport),this.sceneManager.extractScene(),this.technique.render())}},{key:"width",get:function(){}},{key:"height",get:function(){}}])&&Oi(n.prototype,r),i&&Oi(n,i),t}();function Ai(e){return(Ai="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Li(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Di(e,t){return!t||"object"!==Ai(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ni(e){return(Ni=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fi(e,t){return(Fi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ji=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Di(this,Ni(t).call(this,"play","resize"))).options={container:null,useCache:!0},Object.assign(n.options,e);var r=new ve({useCache:n.options.useCache}),i=new mt(n.options.container);n.contentManager=r,n.graphicsManager=i,n.renderViews=new Set,n.renderViewTable=new Map,n.isPlaying=!1,n.rafId=0,n.assetTable=new Map,n.configTable=new Map,n.renderQueue=[],n.taskId=0,n.animations=[];var a=!1;return window.addEventListener("resize",function(){!a&&n.isPlaying&&(a=!0,n.requestRenderFrame(function(){a=!1,i.updateViewportSize(),n.dispatch("resize");var e=!0,t=!1,r=void 0;try{for(var o,s=n.renderViews[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){o.value.setViewportFull()}}catch(e){t=!0,r=e}finally{try{e||null==s.return||s.return()}finally{if(t)throw r}}}))}),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fi(e,t)}(t,E),n=t,(r=[{key:"addAnimation",value:function(e){this.animations.push(e)}},{key:"cancelAnimation",value:function(e){var t=this.animations;if(void 0!==e)for(var n=0;n<t.length;n++){if(t[n].id===e){t.splice(n,1);break}}else t.length=0}},{key:"requestRenderFrame",value:function(e){var t=this.taskId++;return this.renderQueue.push({id:t,action:e}),t}},{key:"cancelRenderFrame",value:function(e){if(void 0!==e)for(var t=0;t<this.renderQueue.length;t++){if(this.renderQueue[t].id===e){this.renderQueue.splice(t,1);break}}else this.renderQueue.length=0}},{key:"setContentManager",value:function(e){this.contentManager=e}},{key:"getContentManager",value:function(){return this.contentManager}},{key:"getGraphicsManager",value:function(){return this.graphicsManager}},{key:"getRenderView",value:function(e){return this.renderViewTable.get(e)}},{key:"getAsset",value:function(e){return this.assetTable.get(e)}},{key:"getConfig",value:function(e){return this.configTable.get(e)}},{key:"addRenderView",value:function(e){var t=new Ri(this.graphicsManager),n=new ti(t);return t.sceneManager=n,n.contentManager=this.contentManager,t.geometryManager=new xi(t),this.renderViewTable.set(e,t),this.renderViews.add(t),t}},{key:"start",value:function(){var e=this;this.isPlaying||(this.isPlaying=!0,this.contentManager.start(),this.contentManager.on("complete",function(){e.renderViews.forEach(function(e){return e.todoRender()})}))}},{key:"stop",value:function(){this.isPlaying&&(this.isPlaying=!1,this.contentManager.stop())}},{key:"render",value:function(e){if(this.isPlaying){for(var t;t=this.renderQueue.shift();)t.action(e);var n=this.animations.slice(),r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;u.isDone&&this.cancelAnimation(u.id),u.next(e)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}this.contentManager.execute();var l=this.graphicsManager.renderContext,c=!0,f=!1,h=void 0;try{for(var p,d=this.renderViews[Symbol.iterator]();!(c=(p=d.next()).done);c=!0){var v=p.value;v.isValid()&&(v.updateScene(),v.draw())}}catch(e){f=!0,h=e}finally{try{c||null==d.return||d.return()}finally{if(f)throw h}}l.flush()}}}])&&Li(n.prototype,r),i&&Li(n,i),t}();function Vi(e){return(Vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bi(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ui(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gi(e,t){return!t||"object"!==Vi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Hi(e){return(Hi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zi(e,t){return(zi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Wi=function(e){function t(e){var n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Gi(this,(n=Hi(t)).call.apply(n,[this].concat(Bi(e))))).ctxLost=!1,r.renderEngine=null,r.renderView=null,r.config=null,r.renderpassTable=new Map,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zi(e,t)}(t,E),n=t,(r=[{key:"createRenderEngine",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;this.renderEngine=new ji({container:e,useCache:n});var i=this.renderEngine.getGraphicsManager(),a=i&&i.canvas;return a&&(a.addEventListener("webglcontextlost",function(e){e.preventDefault(),t.ctxLost=!0,"function"==typeof r&&r()},!1),a.addEventListener("webglcontextrestored",function(e){e.preventDefault(),t.ctxLost=!1,"function"==typeof r&&r()},!1)),this.renderEngine}},{key:"setRenderEngine",value:function(e){this.renderEngine=e}},{key:"createRenderView",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.renderView=this.renderEngine.addRenderView(e),this.renderView.setVisible(t),this.renderView}},{key:"setRenderView",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.renderView=e,this.renderView.setVisible(t)}},{key:"setConfig",value:function(e){this.config=e}},{key:"getConfig",value:function(){return this.config}},{key:"addRenderpass",value:function(e,t){this.renderpassTable.set(e,t)}},{key:"changeRenderpass",value:function(e){this.config.changeEffectTechnique(this.renderpassTable.get(e))}},{key:"updateViewport",value:function(){this.renderView.setViewportFull()}},{key:"getRay",value:function(e,t){var n=new Fn;return this.renderView.constructRayThroughPixel(n,[e,t]),n}},{key:"viewRender",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&this.renderView.getSceneManager().getCamera().needUpdate(),this.renderView.todoRender()}},{key:"isContextLost",value:function(){return this.ctxLost}}])&&Ui(n.prototype,r),i&&Ui(n,i),t}();function qi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Yi=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=n,this.url=r,this.contentType=t}var t,n,r;return t=e,(n=[{key:"getUrl",value:function(){return this.url.replace(/\|(\d)\|/g,function(e,t){return 10*Math.random()&parseInt(t,10)-1})}},{key:"build",value:function(){}}])&&qi(t.prototype,n),r&&qi(t,r),e}();function Xi(e){return(Xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ki(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zi(e,t){return!t||"object"!==Xi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qi(e){return(Qi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ji(e,t){return(Ji=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $i=!!document.font,ea=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Zi(this,Qi(t).call(this,"font-asset",e,n))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ji(e,t)}(t,Yi),n=t,(r=[{key:"build",value:function(e){if($i)document.fonts.load("300px ".concat(this.name),"ABC가나다").then(function(){e()});else{var t=document.createElement("span");t.style.cssText="display:block;position:absolute;top:-999px;left:-999px;font-size: 300px;",t.appendChild(document.createTextNode("ABC가나다")),document.body.appendChild(t);var n=t.getBoundingClientRect();t.style.fontFamily=this.name;!function r(){var i=t.getBoundingClientRect();if(n.width!==i.width)return document.body.removeChild(t),void e();setTimeout(r,100)}()}}}])&&Ki(n.prototype,r),i&&Ki(n,i),t}();function ta(e){return(ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function na(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ra(e,t){return!t||"object"!==ta(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ia(e){return(ia=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function aa(e,t){return(aa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var oa=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=ra(this,ia(t).call(this,"image-asset",e,n))).source=null,r.width=0,r.height=0,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&aa(e,t)}(t,Yi),n=t,(r=[{key:"build",value:function(e){this.source=e,this.width=e.width,this.height=e.height}}])&&na(n.prototype,r),i&&na(n,i),t}();function sa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ua=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.appEngine=t,this.assets=[],this.configs=[],this.doneCounter=0}var t,r,i;return t=e,(r=[{key:"addFont",value:function(e,t){var n=new ea(e,t);this.assets.push({name:e,asset:n})}},{key:"addImage",value:function(e,t){var n=new oa(e,t);this.assets.push({name:e,asset:n})}},{key:"addData",value:function(e,t){this.appEngine.assetTable.set(e,t)}},{key:"addConfig",value:function(e,t){var n=e.createConfig(this.appEngine,t);this.configs.push({configInfo:e,config:n})}},{key:"load",value:function(e){this.doneCounter=this.assets.length+this.configs.length,this._loadAsset(e),this._loadConfig(e)}},{key:"_checkAllDone",value:function(){var e=0==--this.doneCounter;return e&&(this.assets.length=0,this.configs.length=0),e}},{key:"_loadAsset",value:function(e){var t=this;this.assets.forEach(function(n){var r,i,a,o=n.name,s=n.asset,u=null;"font-asset"===s.contentType?(r=s.getUrl(),i={complete:function(){s.build(function(){t.appEngine.assetTable.set(o,s),t._checkAllDone()&&e()})}}.complete,(a=document.createElement("link")).rel="stylesheet",a.href=r,a.addEventListener("load",function(){i()},!1),(u={send:function(){U.appendChild(a)},abort:function(){console.log("font abort - 아무것도 하지 않아요.")}}).send()):"image-asset"===s.contentType&&((u=new Image).crossOrigin="anonymous",u.onload=function(){s.build(u),t.appEngine.assetTable.set(o,s),t._checkAllDone()&&e()},u.src=s.getUrl())})}},{key:"_loadConfig",value:function(e){var t=this;this.configs.forEach(function(r){var i=r.configInfo,a=r.config;if(i.hasPath()){var o=i.getPath()+i.getUrlName();B(o,{complete:function(n){a.buildURL(n);var r=i.getPath()+i.getConfigName();B(r,{complete:function(n){a.build(n),t.appEngine.configTable.set(i,a),t._checkAllDone()&&e()}}).send()}}).send()}else{var s=n(123)("./".concat(i.getUrlName())),u=n(123)("./".concat(i.getConfigName()));a.buildURL(s),a.build(u),t._checkAllDone()&&e()}})}}])&&sa(t.prototype,r),i&&sa(t,i),e}();function la(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ca=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="",this.renderView=t,this.renderContext=t.getGraphicsManager().getRenderContext(),this.renderTarget=t.getRenderTarget("default")}var t,n,r;return t=e,(n=[{key:"getName",value:function(){return this.name}},{key:"execute",value:function(){}}])&&la(t.prototype,n),r&&la(t,r),e}(),fa={},ha=0;for(var pa in tt)if(tt.hasOwnProperty(pa)){var da=tt[pa];Ze.get(da).dataType===WebGLRenderingContext.SAMPLER_2D&&(Object.defineProperty(fa,da,{value:ha,enumerable:!0}),Object.defineProperty(fa,pa,{value:ha,enumerable:!1}),++ha)}Object.freeze(fa);var va=fa;function ya(e){return(ya="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ma(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ga(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ba(e,t){return!t||"object"!==ya(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function wa(e){return(wa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _a(e,t){return(_a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ta=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=ba(this,wa(t).call(this,e))).shaderProgram=n,r.readRenderTargetTable=new Map,r._depthMask=!1,r._depthFunc=WebGLRenderingContext.LESS,r._cullFace=WebGLRenderingContext.BACK,r._blendState=new ke,r._blendColor=[0,0,0,0],r._tempMatrix1=Oe([]),r._tempMatrix2=Oe([]),r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_a(e,t)}(t,ca),n=t,(r=[{key:"enter",value:function(){var e=this.renderContext;e.setDepthMask(this._depthMask),e.setDepthTest(this._depthFunc),e.setCulling(this._cullFace),e.setBlendFactors(this._blendState),e.setBlendColor(this._blendColor),e.bindShaderProgram(this.shaderProgram.handle),this.bindGlobalParameter()}},{key:"leave",value:function(){var e=this.renderContext,t=!0,n=!1,r=void 0;try{for(var i,a=this.shaderProgram.attributes[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e.disableVertexAttrib(o.location)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"bindGlobalParameter",value:function(){var e=this.renderView,t=e.getGraphicsManager(),n=e.getSceneManager(),r=n.getTerrain(),i=n.getCamera(),a=r.panoramaInfo,o=!0,s=!1,u=void 0;try{for(var l,c=this.shaderProgram.uniformsOfProgram[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var f=l.value;switch(f.name){case tt.PIXEL_RATIO:f.uploadParameter(t.getPixelRatio());break;case tt.PIXEL_RATIO_INV:f.uploadParameter(1/t.getPixelRatio());break;case tt.GLOBAL_OPACITY:f.uploadParameter(r.getGlobalOpacity());break;case tt.VIEWPORT:f.uploadParameter([i.viewportWidth,i.viewportHeight]);break;case tt.RV_DEPTHMAP:this.bindTexture(f,a.getDepthMaterial());break;case tt.PANO_VIEW_TYPE:f.uploadParameter(a.getCurrentViewType()>0?1:0);break;case tt.PANO_VIEW_RADIUS:f.uploadParameter(a.getGlobalRadius());break;case tt.PANO_MAX_DEPTH:f.uploadParameter(a.getMaxDepth());break;case tt.PANO_COMPARE_RATIO:f.uploadParameter(a.getCompareModeRatio());break;case tt.PANO_COMPARE_SPLITBAR_FACTOR:f.uploadParameter(.5*a.getCompareModeSplitBarSize()/i.viewportWidth);break;case tt.PANO_COMPARE_MOVE_ALPHA:f.uploadParameter(a.getCompareModeMoveOpacity());break;case tt.PANO_COMPARE_SPLIT_MODE:f.uploadParameter(a.getSplitModeRatio());break;case tt.PANO_COMPARE_SPLITBAR_COLOR:f.uploadParameter(a.getCompareModeSplitBarColor());break;default:console.warn("uniform binding fail.")}}}catch(e){s=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}}},{key:"bindParameter",value:function(e){this.bindVertexComponent(e);var t=!0,n=!1,r=void 0;try{for(var i,o=this.shaderProgram.uniformsOfTexture[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;this.bindTexture(s,e.material)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}var u,l,c=this.renderView.getSceneManager().getTerrain(),f=this.renderView.getSceneManager().getCamera(),h=!0,p=!1,d=void 0;try{for(var v,y=this.shaderProgram.uniformsOfRenderable[Symbol.iterator]();!(h=(v=y.next()).done);h=!0){var m=v.value;switch(m.name){case tt.MVP:var g=this._tempMatrix1;Me(g,f.viewProjTransform,e.getModelTransform()),m.uploadParameter(g);break;case tt.DIFFUSE_COLOR:m.uploadParameter(e.material.getDiffuseColor());break;case tt.OPACITY:var b=e.material.getDiffuseColor()[3];m.uploadParameter(b);break;case tt.PANO_LINE_INFO:var w=c.getPanoramaInfo(),_=w.getCurrentViewType();if(a===_){var T=w.getRoutePath();if(T){var x=T.getTesselator().getLineInfo();m.uploadParameter(x)}else console.warn("초기화가 아직 안되었네요?")}break;case tt.PANO_COMPARE_MVP:var S=c.getPanoramaInfo(),k=this._tempMatrix1;Me(k,f.viewTransform,e.getModelTransform());var P=this._tempMatrix2;Re(P,f.fovy,f.viewportWidth*(1/S.getSplitModeRatio())/f.viewportHeight,f.nearZ,f.farZ),Me(P,P,k),m.uploadParameter(P);break;case tt.N_MATRIX:var O=this._tempMatrix1;Me(O,f.viewTransform,e.getModelTransform()),l=O,(u=O)[0]=l[0],u[1]=l[4],u[2]=l[8],u[3]=l[12],u[4]=l[1],u[5]=l[5],u[6]=l[9],u[7]=l[13],u[8]=l[2],u[9]=l[6],u[10]=l[10],u[11]=l[14],u[12]=l[3],u[13]=l[7],u[14]=l[11],u[15]=l[15],m.uploadParameter(O);break;default:console.warn("uniform binding fail.")}}}catch(e){p=!0,d=e}finally{try{h||null==y.return||y.return()}finally{if(p)throw d}}}},{key:"bindTexture",value:function(e,t){var n=va[e.name],r=t.getTexture(n);r?(e.uploadParameter(n),this.renderContext.bindTextureBuffer(n,r.handle)):console.warn("텍스쳐가 없습니다. ",e.name)}},{key:"bindVertexComponent",value:function(e){var t=this.renderContext,n=e.getVertexBuffer();t.bindVertexBuffer(n.handle);var r=!0,i=!1,a=void 0;try{for(var o,s=this.shaderProgram.attributes[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;t.bindVertexAttributePointer(u.location,n.component[u.name])}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}var l=e.getIndexBuffer();t.bindIndexBuffer(l.handle)}},{key:"setReadRenderTarget",value:function(e,t){var n=this.readRenderTargetTable;n.has(e)&&n.delete(e),n.set(e,t)}},{key:"updateReadRenderTarget",value:function(e){var t=e.material,n=!0,r=!1,i=void 0;try{for(var a,o=this.readRenderTargetTable[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=ma(a.value,2),u=s[0],l=s[1];t.getTexture(u)!==l.getColorBuffer()&&(t.removeTexture(u),t.addTexture(u,l.getColorBuffer()))}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}},{key:"setDepthTest",value:function(e,t){var n=this.renderContext.gl,r={always:n.ALWAYS,equal:n.EQUAL,grater:n.GREATER,greater_equal:n.GEQUAL,less:n.LESS,less_equal:n.LEQUAL,never:n.NEVER,not_equal:n.NOTEQUAL};this._depthMask=e,this._depthFunc=r[t]}},{key:"setBlendState",value:function(e,t,n,r,i){var a=this.renderContext.gl,o={destination_alpha:a.DST_ALPHA,destination_color:a.DST_COLOR,one:a.ONE,one_minus_destination_alpha:a.ONE_MINUS_DST_ALPHA,one_minus_destination_color:a.ONE_MINUS_DST_COLOR,one_minus_source_alpha:a.ONE_MINUS_SRC_ALPHA,one_minus_source_color:a.ONE_MINUS_SRC_COLOR,source_alpha:a.SRC_ALPHA,source_color:a.SRC_COLOR,zero:a.ZERO},s=this._blendState;s.srcColor=o[e]||a.DST_ALPHA,s.dstColor=o[t]||a.DST_ALPHA,s.srcAlpha=o[n]||a.DST_ALPHA,s.dstAlpha=o[r]||a.DST_ALPHA,s.blendMode=i||a.FUNC_ADD}}])&&ga(n.prototype,r),i&&ga(n,i),t}();function xa(e){return(xa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ka(e,t){return!t||"object"!==xa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Pa(e){return(Pa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oa(e,t){return(Oa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ea=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=ka(this,Pa(t).call(this,n,r))).name=e||"EffectPass",i.layerNames=new Set,i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oa(e,t)}(t,Ta),n=t,(r=[{key:"execute",value:function(){var e=this.renderView.getSceneManager(),t=this.renderContext;this.enter();var n=!0,r=!1,i=void 0;try{for(var a,o=this.layerNames[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,u=e.getShapeCollector(s);if(u){var l=!0,c=!1,f=void 0;try{for(var h,p=u.renderables[Symbol.iterator]();!(l=(h=p.next()).done);l=!0){var d=h.value;this.updateReadRenderTarget(d),this.bindParameter(d),t.drawPrimitive(d)}}catch(e){c=!0,f=e}finally{try{l||null==p.return||p.return()}finally{if(c)throw f}}}}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.leave()}},{key:"addLayerName",value:function(e){this.layerNames.add(e)}},{key:"removeLayerName",value:function(e){this.layerNames.delete(e)}}])&&Sa(n.prototype,r),i&&Sa(n,i),t}();function Ia(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ma=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mesh=null,this.material=null,this.drawMode=WebGLRenderingContext.TRIANGLES,this.indexOffset=0,this.indexLength=0}var t,n,r;return t=e,(n=[{key:"getVertexBuffer",value:function(){return this.mesh.vertexBuffer}},{key:"getIndexBuffer",value:function(){return this.mesh.indexBuffer}},{key:"getModelTransform",value:function(){return this.mesh.getShape().getTransform()}}])&&Ia(t.prototype,n),r&&Ia(t,r),e}();function Ca(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Ra=function e(t,n){var r=Ca(t,4),i=r[0],a=r[1],o=r[2],s=r[3];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=i,this.size=a,this.type=o,this.normalize=!1,this.stride=n,this.offset=s};var Aa=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=0,i=!0,a=!1,o=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=new Ra(l,t);this[c.name]=c,r+=c.size}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}this.stride=t,this.elementCount=r},La=WebGLRenderingContext,Da=we;function Na(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Aa.Pf2Tf2=new Aa(16,[[Da.POSITION,2,La.FLOAT,0],[Da.UV,2,La.FLOAT,8]]),Aa.Pf3Tf2=new Aa(20,[[Da.POSITION,3,La.FLOAT,0],[Da.UV,2,La.FLOAT,12]]),Aa.Ps4Ts2=new Aa(12,[[Da.POSITION,4,La.SHORT,0],[Da.UV,2,La.SHORT,8]]),Aa.Pf3Tf2Tf2=new Aa(28,[[Da.POSITION,3,La.FLOAT,0],[Da.UV,2,La.FLOAT,12],[Da.DEPTHUV,2,La.FLOAT,20]]),Aa.Pf3Tf2F2=new Aa(28,[[Da.POSITION,3,La.FLOAT,0],[Da.UV,2,La.FLOAT,12],[Da.PIXELOFFSET,2,La.FLOAT,20]]),Aa.Pf4Tf2F2=new Aa(32,[[Da.POSITION,4,La.FLOAT,0],[Da.UV,2,La.FLOAT,16],[Da.PIXELOFFSET,2,La.FLOAT,24]]),Aa.Pf4Nf4Tf4=new Aa(48,[[Da.POSITION,4,La.FLOAT,0],[Da.NORMAL,4,La.FLOAT,16],[Da.UV,4,La.FLOAT,32]]),Aa.Pf4Tf2=new Aa(24,[[Da.POSITION,4,La.FLOAT,0],[Da.UV,2,La.FLOAT,16]]),Aa.Pf4Tf3=new Aa(28,[[Da.POSITION,4,La.FLOAT,0],[Da.UV,3,La.FLOAT,16]]),Aa.Pf3Nf3=new Aa(24,[[Da.POSITION,3,La.FLOAT,0],[Da.NORMAL,3,La.FLOAT,12]]),Aa.Ps4Nb4=new Aa(12,[[Da.POSITION,4,La.SHORT,0],[Da.NORMAL,4,La.BYTE,8]]);var Fa=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.shape=t,this.vertexBuffer=null,this.indexBuffer=null,this.physicsModel=null,this.chunks=[],this.renderables=[],this.materials=[]}var t,n,r;return t=e,(n=[{key:"getShape",value:function(){return this.shape}},{key:"setChunk",value:function(e){e.setMesh(this),this.chunks.push(e)}},{key:"getChunks",value:function(){return this.chunks}},{key:"getChunk",value:function(e){return this.chunks[e]}},{key:"setPhysicsModel",value:function(e){e&&e.setMesh(this),this.physicsModel=e}},{key:"getPhysicsModel",value:function(){return this.physicsModel}},{key:"updateTransform",value:function(){this.physicsModel&&this.physicsModel.updateBoundToWorld()}}])&&Na(t.prototype,n),r&&Na(t,r),e}();function ja(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Va=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.textures=new Map,this.diffuseColor=[0,0,0,1],this.ambientColor=[0,0,0],this.specularColor=[0,0,0]}var t,n,r;return t=e,(n=[{key:"addTexture",value:function(e,t){this.textures.set(e,t)}},{key:"getTexture",value:function(e){return this.textures.has(e)?this.textures.get(e):null}},{key:"removeTexture",value:function(e){if(this.textures.has(e))return this.textures.delete(e)}},{key:"setDiffuseColor",value:function(e,t,n,r){this.diffuseColor[0]=e,this.diffuseColor[1]=t,this.diffuseColor[2]=n,this.diffuseColor[3]=r}},{key:"getDiffuseColor",value:function(){return this.diffuseColor}}])&&ja(t.prototype,n),r&&ja(t,r),e}();function Ba(e){return(Ba="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ua(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ga(e,t){return!t||"object"!==Ba(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ha(e){return(Ha=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function za(e,t){return(za=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Wa=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=Ga(this,Ha(t).call(this,n,r))).name=e||"EffectScreenQuadPass",i.mesh=new Fa(null),i.material=new Va,i.renderable=new Ma,i.mesh.vertexBuffer=n.getGraphicsManager().createVertexBuffer(new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),Aa.Pf3Tf2),i.mesh.indexBuffer=n.getGraphicsManager().createIndexBuffer(new Uint16Array([0,1,2,2,3,0])),i.renderable.mesh=i.mesh,i.renderable.material=i.material,i.renderable.indexOffset=0,i.renderable.indexLength=i.mesh.indexBuffer.indexLength,i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&za(e,t)}(t,Ta),n=t,(r=[{key:"execute",value:function(){this.enter(),this.updateReadRenderTarget(this.renderable),this.bindParameter(this.renderable),this.renderContext.drawPrimitive(this.renderable),this.leave()}},{key:"addLayerName",value:function(e){this.layerNames.add(e)}},{key:"removeLayerName",value:function(e){this.layerNames.delete(e)}}])&&Ua(n.prototype,r),i&&Ua(n,i),t}();function qa(e){return(qa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ya(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xa(e,t){return!t||"object"!==qa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ka(e){return(Ka=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Za(e,t){return(Za=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qa=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Xa(this,Ka(t).call(this,e))).name="BindRenderTargetCommand",r.renderTarget=n,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Za(e,t)}(t,ca),n=t,(r=[{key:"execute",value:function(){this.renderContext.bindFramebuffer(this.renderTarget.getFrameBuffer())}}])&&Ya(n.prototype,r),i&&Ya(n,i),t}();function Ja(e){return(Ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function eo(e,t){return!t||"object"!==Ja(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function to(e){return(to=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function no(e,t){return(no=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ro=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=eo(this,to(t).call(this,e))).name="ClearAllBufferCommand",i.color=n,i.depth=r,i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&no(e,t)}(t,ca),n=t,(r=[{key:"execute",value:function(){var e=this.renderContext;e.clearColor(this.color),e.clearDepth(this.depth),e.clearAllBuffer()}}])&&$a(n.prototype,r),i&&$a(n,i),t}();function io(e){return(io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ao(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function oo(e,t){return!t||"object"!==io(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function so(e){return(so=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function uo(e,t){return(uo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var lo=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=oo(this,so(t).call(this,e))).name="ClearColorBufferCommand",r.color=n,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&uo(e,t)}(t,ca),n=t,(r=[{key:"execute",value:function(){var e=this.renderContext;e.clearColor(this.color),e.clearColorBuffer()}}])&&ao(n.prototype,r),i&&ao(n,i),t}();function co(e){return(co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ho(e,t){return!t||"object"!==co(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function po(e){return(po=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vo(e,t){return(vo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yo=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=ho(this,po(t).call(this,e))).name="ClearDepthBufferCommand",r.depth=n,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vo(e,t)}(t,ca),n=t,(r=[{key:"execute",value:function(){var e=this.renderContext;e.clearDepth(this.depth),e.clearDepthBuffer()}}])&&fo(n.prototype,r),i&&fo(n,i),t}();function mo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var go=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"CreateEffectTechnique",value:function(e){return new ki(e)}},{key:"CreateEffectPass",value:function(e,t,n,r){var i=e.getGraphicsManager().getShaderProgram(n,r);return new Ea(t,e,i)}},{key:"CreateEffectScreenQuadPass",value:function(e,t,n,r){var i=e.getGraphicsManager().getShaderProgram(n,r);return new Wa(t,e,i)}},{key:"CreateBindRenderTargetCommand",value:function(e,t){return new Qa(e,t)}},{key:"CreateClearAllBufferCommand",value:function(e,t,n){return new ro(e,t,n)}},{key:"CreateClearDepthBufferCommand",value:function(e,t){return new yo(e,t)}},{key:"CreateClearColorBufferCommand",value:function(e,t){return new lo(e,t)}}],(n=null)&&mo(t.prototype,n),r&&mo(t,r),e}();function bo(e){return(bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _o(e,t){return!t||"object"!==bo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function To(e){return(To=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xo(e,t){return(xo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var So=WebGLRenderingContext,ko=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=_o(this,To(t).call(this))).renderView=e,n.width=0,n.height=0,n.pixelType=So.RGBA,n.wrapS=So.CLAMP_TO_EDGE,n.wrapT=So.CLAMP_TO_EDGE,n.minFilter=So.LINEAR,n.magFilter=So.LINEAR,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xo(e,t)}(t,ne),n=t,(r=[{key:"setParameter",value:function(e,t,n,r,i,a,o){e&&(this.width=e),t&&(this.height=t),n&&(this.pixelType=n),r&&(this.wrapS=r),i&&(this.wrapT=i),a&&(this.minFilter=a),o&&(this.magFilter=o)}},{key:"read",value:function(e,t,n){t.isCanceled()?n(null):n(this.renderView.getGraphicsManager().createTextureBuffer(e,this.width,this.height,this.pixelType,this.wrapS,this.wrapT,this.minFilter,this.magFilter))}}])&&wo(n.prototype,r),i&&wo(n,i),t}();function Po(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Oo=function(){function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.position=Et([]),this.scale=((t=[])[0]=t[1]=t[2]=1,t),this.orientation=Ht([]),this.modelTransform=Oe([])}var t,n,r;return t=e,(n=[{key:"getTransform",value:function(){return this.modelTransform}},{key:"updateTransform",value:function(){Ae(this.modelTransform,this.position,this.scale,this.orientation)}}])&&Po(t.prototype,n),r&&Po(t,r),e}();function Eo(e){return(Eo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Io(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mo(e,t){return!t||"object"!==Eo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Co(e,t,n){return(Co="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ro(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Ro(e){return(Ro=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ao(e,t){return(Ao=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Lo=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Mo(this,Ro(t).call(this))).meshPool=[],e.materialPool=[],e.renderables=[],e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ao(e,t)}(t,Oo),n=t,(r=[{key:"updateTransform",value:function(){Co(Ro(t.prototype),"updateTransform",this).call(this);var e=!0,n=!1,r=void 0;try{for(var i,a=this.meshPool[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){i.value.updateTransform()}}catch(e){n=!0,r=e}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"extractScene",value:function(e){var t=!1,n=!0,r=!1,i=void 0;try{for(var a,o=this.meshPool[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;e.enterMesh(s)&&(t=!0)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t}},{key:"createMesh",value:function(){var e=new Fa(this);return this.meshPool.push(e),e}},{key:"createMaterial",value:function(){var e=new Va;return this.materialPool.push(e),e}},{key:"createRenderable",value:function(e,t){var n=new Ma;return n.mesh=e,n.material=t,this.renderables.push(n),n}}])&&Io(n.prototype,r),i&&Io(n,i),t}();function Do(e){return(Do="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function No(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Fo(e,t){return!t||"object"!==Do(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function jo(e){return(jo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vo(e,t){return(Vo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Bo=new Uint16Array([0,1,2,2,3,0]),Uo=new Float32Array([-1,-1,.5/512,.5/512,1,-1,511.5/512,.5/512,1,1,511.5/512,511.5/512,-1,1,.5/512,511.5/512]),Go=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Fo(this,jo(t).call(this))).renderView=e,n.commonTileVertexBuffer=n.renderView.getGraphicsManager().createVertexBuffer(Uo,Aa.Pf2Tf2),n.commonTileIndexBuffer=n.renderView.getGraphicsManager().createIndexBuffer(Bo),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vo(e,t)}(t,ne),n=t,(r=[{key:"read",value:function(e,t,n){n(this.makeShape(e))}},{key:"makeShape",value:function(e){var t=new Lo,n=t.createMesh();n.vertexBuffer=this.commonTileVertexBuffer,n.indexBuffer=this.commonTileIndexBuffer;var r=t.createMaterial(),i=this.renderView.getGraphicsManager().createTextureBuffer(e);return r.addTexture(va.DIFFUSE,i),t.createRenderable(n,r).indexLength=n.indexBuffer.indexLength,t}}])&&No(n.prototype,r),i&&No(n,i),t}();function Ho(e){return(Ho="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wo(e,t){return!t||"object"!==Ho(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qo(e){return(qo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Yo(e,t){return(Yo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xo=document.createElement("canvas");Xo.width=512,Xo.height=512;var Ko=Xo.getContext("2d");Ko.font="72px san-serif",Ko.textAlign="center",Ko.textBaseline="middle",Ko.strokeStyle="black",Ko.fillStyle="red",Ko.globalAlpha=.4;var Zo=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Wo(this,qo(t).call(this))).renderView=e,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Yo(e,t)}(t,ne),n=t,(r=[{key:"setSize",value:function(e,t){this.width=e,this.height=t}},{key:"read",value:function(e,t,n){if(t.isCanceled())n(null);else{var r="";e.datas.forEach(function(e){r+=e+","}),Ko.clearRect(0,0,512,512),Ko.lineWidth=4,Ko.strokeRect(0,0,512,512),Ko.lineWidth=8,Ko.strokeText(r,256,256),Ko.fillText(r,256,256),n(this.renderView.getGraphicsManager().createTextureBuffer(Xo))}}}])&&zo(n.prototype,r),i&&zo(n,i),t}();function Qo(e){return(Qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $o(e,t){return!t||"object"!==Qo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function es(e){return(es=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ts(e,t){return(ts=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ns,rs,is=new Uint16Array([0,1,2,2,3,0]),as=new Float32Array([-1,-1,.5/512,.5/512,1,-1,511.5/512,.5/512,1,1,511.5/512,511.5/512,-1,1,.5/512,511.5/512]),os=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=$o(this,es(t).call(this))).renderView=e,n.debugTileToTextureReader=new Zo(e),n.commonTileVertexBuffer=n.renderView.getGraphicsManager().createVertexBuffer(as,Aa.Pf2Tf2),n.commonTileIndexBuffer=n.renderView.getGraphicsManager().createIndexBuffer(is),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ts(e,t)}(t,ne),n=t,(r=[{key:"read",value:function(e,t,n){var r=this;this.debugTileToTextureReader.read(e,t,function(e){n(null===e?null:r.makeShape(e))})}},{key:"makeShape",value:function(e){var t=new Lo,n=t.createMesh();n.vertexBuffer=this.commonTileVertexBuffer,n.indexBuffer=this.commonTileIndexBuffer;var r=t.createMaterial();return r.addTexture(va.DIFFUSE,e),t.createRenderable(n,r).indexLength=n.indexBuffer.indexLength,t}}])&&Jo(n.prototype,r),i&&Jo(n,i),t}(),ss=(ns=document.createElement("canvas"),rs=ns.getContext("webgl",{alpha:!1})||ns.getContext("experimental-webgl",{alpha:!1}),function(){return!!rs}),us=function(){var e=document.createElement("canvas"),t=e.getContext("webgl",{alpha:!1,failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{alpha:!1,failIfMajorPerformanceCaveat:!0});return function(){return!!t}}();function ls(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;e=e.replace(/^(#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,r,i){return n+n+r+r+i+i});var r=/^(#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?[parseInt(r[2],16)*n/255,parseInt(r[3],16)*n/255,parseInt(r[4],16)*n/255,t]:[0,0,0,1]}function cs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e=e.replace(/^(#|0x)?([a-f\d])([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,r,i){return t+t+n+n+r+r+i+i});var n=/^(#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?[parseInt(n[2],16)*t/255,parseInt(n[3],16)*t/255,parseInt(n[4],16)*t/255,parseInt(n[5],16)*t/255]:[0,0,0,1]}function fs(e,t,n){var r=v[e],i=r[0],a=r[1];return(i-t)*a+(n-a)+1}function hs(e){return e.every(function(e){return!isNaN(parseInt(e,10))})}function ps(e){return 2.5*e}function ds(e){return.4*e}function vs(e){return(vs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ys(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ms(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gs(e,t){return!t||"object"!==vs(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function bs(e){return(bs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ws(e,t){return(ws=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _s=function(e){function t(e){var n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=gs(this,(n=bs(t)).call.apply(n,[this].concat(ys(a))))).position=e||{x:0,y:0,z:0},r.opacity=i,r.screenPoint=null,r.target=null,r.attached=!1,r.changeState={position:!1,opacity:!1,source:!1,offset:!1,margin:!1,content:!1},r.setPosition(r.position),r.setOpacity(r.opacity),r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ws(e,t)}(t,E),n=t,(r=[{key:"update",value:function(){}},{key:"setTarget",value:function(e){this.target=e}},{key:"setOpacity",value:function(e){"number"==typeof e&&(this.opacity=e,this.changeState.opacity=!0,this.update("opacity"))}},{key:"getOpacity",value:function(){return this.opacity}},{key:"setPosition",value:function(e){var t=e.x,n=e.y,r=e.z;"number"==typeof t&&"number"==typeof n&&"number"==typeof r&&(this.position.x=ds(t),this.position.y=ds(n),this.position.z=r,this.changeState.position=!0,this.update("position"))}},{key:"getPosition",value:function(){return{x:ps(this.position.x),y:ps(this.position.y),z:this.position.z}}},{key:"isAttached",value:function(){return null!==this.target&&this.attached}},{key:"getScreenPoint",value:function(){if(this.target){var e=this.target.getProjection();this.screenPoint=e.project(this.getPosition())}return this.screenPoint}},{key:"checkAndUpdate",value:function(){for(var e in this.changeState)this.changeState.hasOwnProperty(e)&&this.changeState[e]&&this.update(e)}}])&&ms(n.prototype,r),i&&ms(n,i),t}();function Ts(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function xs(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ss(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ks=function(){function e(t,n,r,i,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.partitionTree=t,this.parentNode=n,this.childNodes=null,this.level=r,this.row=i,this.col=a,this.key="".concat(r,",").concat(i,",").concat(a),this.extraData={},this.box=[o,s,u,l,c,f],this.cx=.5*(o+l),this.cy=.5*(s+c),this.cz=.5*(u+f),this.isLeaf=!0,this.isInFrustum=!1,this.isSurrounds=!1}var t,n,r;return t=e,(n=[{key:"update",value:function(e){var t=this.partitionTree,n=this.isInFrustum,r=e.enterNode(this);if(this.isInFrustum=r,n!==r&&(n?t.cameraOutNodes.push(this):t.cameraInNodes.push(this)),r&&(e.visibleNodes.add(this),this.level>=t.terrain.currentLevel))return e.leafNodes.add(this),void(this.isLeaf||(t.dynamic&&this.removeChildren(),this.isLeaf=!0));if(e.endNode(this))this.isLeaf||(t.dynamic&&this.removeChildren(),this.isLeaf=!0);else if(this.level<t.levelDepth-1&&(this.isLeaf&&t.dynamic&&this.createChildren(),this.childNodes)){var i=!0,a=!1,o=void 0;try{for(var s,u=this.childNodes[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){s.value.update(e)}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}}this.isLeaf&&(e.leafNodes.add(this),this.isInFrustum&&e.visibleNodes.add(this))}},{key:"createChildren",value:function(){var t,n=this.partitionTree,r=this.level+1,i=this.row<<1,a=this.col<<1,o=xs(this.box,6),s=o[0],u=o[1],l=o[2],c=o[3],f=o[4],h=o[5],p=this.cx,d=this.cy,v=this.cz;this.childNodes=[new e(n,this,r,i,a,s,u,l,p,d,v),new e(n,this,r,i,a+1,p,u,l,c,d,v),new e(n,this,r,i+1,a,s,d,v,p,f,h),new e(n,this,r,i+1,a+1,p,d,v,c,f,h)],(t=n.createdNodes).push.apply(t,Ts(this.childNodes)),this.isLeaf=!1}},{key:"removeChildren",value:function(){if(this.isLeaf)this.isLeaf=!1;else{var e=this.childNodes;if(e){var t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;o.removeChildren(),this.partitionTree.removedNodes.push(o)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}}}}])&&Ss(t.prototype,n),r&&Ss(t,r),e}();function Ps(e){return(Ps="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Os(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Es(e,t){return!t||"object"!==Ps(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Is(e){return(Is=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ms(e,t){return(Ms=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Cs=0,Rs=function(e){function t(e){var n,i=e.source,a=e.position,o=void 0===a?{x:0,y:0,z:0}:a,s=e.offset,u=void 0===s?{x:0,y:0}:s,l=e.opacity,c=void 0===l?1:l,f=e.clickable,h=void 0===f||f,p=e.hoverable,d=void 0===p||p;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Es(this,Is(t).call(this,o,c,[r.CLICK,r.MOUSEOVER,r.MOUSEOUT,r.ATTACHED,r.DETACHED]))).key=new ks(null,null,0,0,Cs++),n.type="marker",n.source=i,n.offset=u,n.clickable="boolean"!=typeof h||h,n.hoverable="boolean"!=typeof d||d,n}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ms(e,t)}(t,_s),n=t,(i=[{key:"triggerClick",value:function(){this.clickable&&this.dispatch(r.CLICK)}},{key:"triggerMouseover",value:function(){this.hoverable&&this.dispatch(r.MOUSEOVER)}},{key:"triggerMouseout",value:function(){this.hoverable&&this.dispatch(r.MOUSEOUT)}},{key:"triggerAttached",value:function(){this.target&&(this.attached=!0,this.dispatch(r.ATTACHED))}},{key:"triggerDetached",value:function(){this.target||(this.attached=!1,this.dispatch(r.DETACHED))}},{key:"setClickable",value:function(e){"boolean"==typeof e&&(this.clickable=e)}},{key:"setHoverable",value:function(e){"boolean"==typeof e&&(this.hoverable=e)}},{key:"setSource",value:function(e){this.source=e,this.changeState.source=!0,this.update("source")}},{key:"getSource",value:function(){return this.source}},{key:"setOffset",value:function(e){var t=e.x,n=e.y;this.offset.x=t,this.offset.y=n,this.changeState.offset=!0,this.update("offset")}},{key:"getOffset",value:function(){return this.offset}},{key:"update",value:function(e){this.target&&(this.target.uiManager.changeMarker(this,e),this.changeState[e]=!1)}}])&&Os(n.prototype,i),a&&Os(n,a),t}();function As(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ls=Mt([],0,0,1),Ds=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isDummy=!1,this.panoId=null,this.northAngle=null,this.northAngleRad=null,this.width=0,this.height=0,this.header=null,this.table=null,this.bodyData=null,this.hasDepthmap=!1,this.depthMaterial=new Va,this.hitTable=new Map}var t,n,r;return t=e,(n=[{key:"setStreet",value:function(e){this.panoId=e.panoId,this.northAngle=e.northAngle,this.northAngleRad=e.northAngleRad}},{key:"setData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.width=e,this.height=t,this.table=r,this.bodyData=i,this.header=n,this.nbits0=0*this.header.nbits,this.nbits1=1*this.header.nbits,this.nbits2=2*this.header.nbits,this.nbits3=3*this.header.nbits,this.zbits=this.header.zbits,this.ibits=this.header.ibits,this.maxDepthLength=this.header.maxdist,this.maxNormalLength=1/Math.abs(Math.pow(2,this.nbits1-1)-1)}},{key:"setDepthMaterial",value:function(e){this.depthMaterial.addTexture(va.RV_DEPTHMAP,e),this.hasDepthmap=!0}},{key:"getDepthMaterial",value:function(){return this.hasDepthmap?this.depthMaterial:null}},{key:"clearDepthMaterial",value:function(){var e=this.getDepthMaterial();if(e){var t=e.getTexture(va.RV_DEPTHMAP);t&&(t.reset(),t.handle=null,e.addTexture(va.RV_DEPTHMAP,null))}}},{key:"getData",value:function(e,t){var n=4*e+this.width*t*4,r=this.hitTable.get(n);if(r)return r;if(!this.bodyData)return null;var i=this.bodyData.subarray(n,n+3),a=i[0],o=i[1],s=i[2],u=0===(s=Math.pow(this.maxDepthLength+1,s/256)-1);s=0===s?this.maxDepthLength:s;var l=Math.floor(a/2)-1,c=Math.floor(o/64),f=4*(a-2*Math.floor(a/2))+c,h=Math.floor((o-8*c*8)/8),p=Math.floor(o%8);f+=f>3?-8:0,h+=h>3?-8:0,p+=p>3?-8:0;var d=Mt([],p*=this.maxNormalLength,h*=this.maxNormalLength,f*=this.maxNormalLength),v=1===Dt(Ls,d);return r={depth:s,maxDepth:this.maxDepthLength,table:this.table,normal:d,index:l,isSky:u,isGround:v,isWall:!u&&!v},this.hitTable.set(n,r),r}},{key:"getDataFromUV",value:function(e,t){var n=Math.floor((this.width-1)*e),r=Math.floor((this.height-1)*(1-t));return this.getData(n,r)}},{key:"getDataFromImagePanTilt",value:function(e,t){var n=this.width,r=this.height,i=Math.round(n/360*e);i=i===n?0:i;var a=Math.round(r/180*t);return a=a===r?a-1:a,this.getData(i,a)}},{key:"getDataFromDirection",value:function(e){var t=-(Math.atan2(e[1],e[0])-Math.PI/2),n=Math.PI-Math.acos(e[2])-Math.PI/2,r=St(t+this.northAngleRad)*Tt,i=(Math.PI-(n+Math.PI/2))*Tt;return this.getDataFromImagePanTilt(r,i)}},{key:"getImageXYFromDirection",value:function(e){var t=Math.atan2(e[1],e[0])-Math.PI/2,n=Math.PI-Math.acos(e[2]),r=St(-t+this.northAngleRad)*Tt,i=(Math.PI-(n-Math.PI/2+Math.PI/2))*Tt,a=Math.round(this.width/360*r);a=a===this.width?0:a;var o=Math.round(this.height/180*i);return{x:a,y:o=o===this.height?o-1:o}}}])&&As(t.prototype,n),r&&As(t,r),e}();function Ns(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Fs(e){return(Fs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function js(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Vs(e,t){return!t||"object"!==Fs(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bs(e){return(Bs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Us(e,t){return(Us=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Gs={w:512,h:257},Hs=document.createElement("canvas");Hs.style.cssText="position:absolute;left:0;top:0";var zs=Hs.getContext("2d"),Ws=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Vs(this,Bs(t).call(this))).renderView=e,n.imageToTextureReader=new ko(e),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Us(e,t)}(t,ne),n=t,(r=[{key:"read",value:function(e,t,n){n(this.makeData(e,t))}},{key:"makeData",value:function(e,t){var n=this,r=new Ds;Hs.width=Gs.w=e.width,Hs.height=Gs.h=e.height,zs.drawImage(e,0,0);var i=zs.getImageData(0,0,Gs.w,Gs.h),a=i.data;i.data instanceof Uint8ClampedArray&&(a=new Uint8Array(i.data.buffer));try{if(t.isCanceled())return r=null;var o=new D({start:function(){if(!t.isCanceled()){var i=n._decodeData(a,Gs.w,Gs.h,e,t);r.setData(i.width,i.height,i.depthmapHeader,i.depthmapTable,i.depthmapBody)}},cancel:function(){console.log(n.constructor.name,"cancel decode depthmap header")}}),s=new D({start:function(){t.isCanceled()||(n.imageToTextureReader.setParameter(r.width,r.height,null,null,null,WebGLRenderingContext.NEAREST,WebGLRenderingContext.NEAREST),n.imageToTextureReader.read(r.bodyData,t,function(e){r.setDepthMaterial(e)}))},cancel:function(){console.log(n.constructor.name,"cancel texture bind")}});this.renderView.getSceneManager().getContentManager().doTask(o,s,0)}catch(e){r=null,console.log(e)}return r}},{key:"_decodeData",value:function(e,t,n,r,i){var a=t*(t>>1)*4,o=e.slice(0,a),s=e.slice(a,e.length),u=function(e,t,n){for(var r,i,a,o,s,u={},l=0;l<10;l++)i=e[(r=4*(l+t*(n-1)))+2],a=e[r+1],o=e[r],0===l?u[qs[0]]=String.fromCharCode(i,a,o):(s=((255&o)<<16)+((255&a)<<8)+i,u[qs[l]]=s);return u}(s,t,n-(t>>1)),l=function(e,t,n){for(var r,i,a,o,s,u=new ArrayBuffer(4*t*n-10),l=new Uint8Array(u),c=0,f=n-1;f>=0;f--)for(var h=f===n-1?10:0,p=h;p<t&&(i=e[(r=4*(p+t*f))+2],a=e[r+1],o=e[r],0!==(s=255&i))&&(l[c++]=s,0!==(s=255&a))&&(l[c++]=s,0!==(s=255&o));p++)l[c++]=s;var d=null;try{var v=l.subarray(0,c),y=decodeURIComponent(escape(String.fromCharCode.apply(String,Ns(v))));-1===y.lastIndexOf("]}")&&(y+="]}"),d=JSON.parse(y)}catch(e){console.log(e,e.stack)}return d}(s,t,n-(t>>1));return{width:t,height:n-u.blockheight,depthmapHeader:u,depthmapTable:l,depthmapBody:o}}}])&&js(n.prototype,r),i&&js(n,i),t}(),qs=["identifier","bitsperpel","version","headersize","blockheight","zbits","nbits","ibits","maxdist","nrecoords"];function Ys(e){return(Ys="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xs(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ks(e,t){return!t||"object"!==Ys(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Zs(e){return(Zs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qs(e,t){return(Qs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Js=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ks(this,Zs(t).call(this))).renderView=e,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qs(e,t)}(t,ne),n=t,(r=[{key:"read",value:function(e,t,n){if(e.byteLength<4)return!1;var r={geometries:[],entities:[],materials:[],textures:[],renderables:[]},i=new DataView(e);if(1751593828!==i.getInt32(0,!0))throw"Not a D3G file.";if(1!==i.getInt32(4,!0))throw"Invalid D3G version. Source version: ".concat(1);var a,o,s,u=i.getInt32(12,!0),l=16;for(o=0;o<u&&!(l>=i.byteLength);++o){switch(i.getInt16(l,!0)){case 1:var c={};c.meshId=i.getInt16(l+2,!0),c.vertexDescriptionCode=i.getInt16(l+4,!0),c.vertexLength=i.getInt32(l+8,!0),c.indexLength=i.getInt32(l+12,!0),c.bbox=[i.getFloat64(l+16,!0),i.getFloat64(l+24,!0),i.getFloat64(l+32,!0),i.getFloat64(l+40,!0),i.getFloat64(l+48,!0),i.getFloat64(l+56,!0)],c.position=[i.getFloat64(l+64,!0),i.getFloat64(l+72,!0),i.getFloat64(l+80,!0)],c.scale=[i.getFloat64(l+88,!0),i.getFloat64(l+96,!0),i.getFloat64(l+104,!0)],l+=128,c.vertexData=new Uint8Array(e,l,c.vertexLength),l+=c.vertexLength,c.indexData=new Uint16Array(e,l,c.indexLength/2),l+=c.indexLength,r.geometries.push(c);break;case 2:var f=i.getInt16(l+2,!0);for(a=i.getInt16(l+6,!0),l+=8,s=0;s<a;++s){var h={meshId:f,indexOffset:i.getInt16(l,!0),indexLength:i.getInt16(l+2,!0),bbox:[i.getFloat32(l+4,!0),i.getFloat32(l+8,!0),i.getFloat32(l+12,!0),i.getFloat32(l+16,!0),i.getFloat32(l+20,!0),i.getFloat32(l+24,!0)],tag:[i.getInt32(l+30,!0),i.getInt32(l+34,!0),i.getInt32(l+38,!0)]};r.entities.push(h),l+=42}break;case 3:var p={};p.mtlId=i.getInt16(l+2,!0);var d=i.getInt16(l+4,!0);l+=6,l+=20*d;var v=i.getInt16(l,!0);l+=2;var y=[];for(o=0;o<v;++o)y.push({texType:i.getInt16(l,!0),texId:i.getInt16(l+2,!0)-1}),l+=4;p.textureSource=y,r.materials.push(p);break;case 4:var m={};m.texId=i.getInt16(l+2,!0),m.wrapS=i.getUint16(l+4,!0),m.wrapT=i.getUint16(l+6,!0),m.minFilter=i.getUint16(l+8,!0),m.magFilter=i.getUint16(l+10,!0);var g=i.getInt32(l+14,!0);l+=18,m.imageBuffer=new Uint8Array(e,l,g),l+=g,r.textures.push(m);break;case 5:var b={};b.meshId=i.getInt16(l+2,!0),b.mtlId=i.getInt16(l+4,!0),b.drawMode=i.getInt16(l+6,!0),b.indexOffset=2*i.getInt16(l+8,!0),b.indexLength=i.getInt16(l+10,!0),l+=12,r.renderables.push(b)}}n(r)}}])&&Xs(n.prototype,r),i&&Xs(n,i),t}();function $s(e){return($s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function tu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nu(e,t){return!t||"object"!==$s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ru(e){return(ru=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function iu(e,t){return(iu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var au=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=nu(this,ru(t).call(this))).renderView=e,n.d3gToShapeDataReader=new Js(e),n.contentManager=e.getSceneManager().getContentManager(),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&iu(e,t)}(t,ne),n=t,(r=[{key:"read",value:function(e,t,n){var r=this;t.isCanceled()||this.d3gToShapeDataReader.read(e,t,function(e){var i=new Lo,a=new D({async:!0,start:function(t){r.createTexture(e,t)},done:function(){r.setDataToShape(i,e)},cancel:function(){t.cancel()}}),o=new D({start:function(){t.isCanceled()?n(null):n(i)},cancel:function(){t.cancel()}});r.contentManager.doTask(a,o)})}},{key:"createTexture",value:function(e,t){var n=this,r=0,i=this.renderView.getGraphicsManager(),a=e.textures.length,o=!0,s=!1,u=void 0;try{for(var l,c=function(){var e=l.value,o=new Blob([e.imageBuffer],{type:"image/jpeg"}),s=URL.createObjectURL(o);n.contentManager.load(s,"d3g-texture","image-texture",M,function(n){var o=i.createTextureBuffer(n);e.textureBuffer=o,++r===a&&t(),URL.revokeObjectURL(s)})},f=e.textures[Symbol.iterator]();!(o=(l=f.next()).done);o=!0)c()}catch(e){s=!0,u=e}finally{try{o||null==f.return||f.return()}finally{if(s)throw u}}}},{key:"setDataToShape",value:function(e,t){var n=this.renderView.getGraphicsManager(),r={},i={},a={},o=!0,s=!1,u=void 0;try{for(var l,c=t.geometries[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var f=l.value,h=f.meshId,p=f.vertexData,d=f.indexData,v=f.position,y=f.scale,m=e.createMesh();m.vertexBuffer=n.createVertexBuffer(p,Aa.Ps4Ts2),m.indexBuffer=n.createIndexBuffer(d),Mt(e.scale,y[0],y[1],y[2]),Mt(e.position,v[0],v[1],v[2]),r[h]=m}}catch(e){s=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}var g=!0,b=!1,w=void 0;try{for(var _,T=t.textures[Symbol.iterator]();!(g=(_=T.next()).done);g=!0){var x=_.value;a[x.texId-1]=x.textureBuffer}}catch(e){b=!0,w=e}finally{try{g||null==T.return||T.return()}finally{if(b)throw w}}var S=!0,k=!1,P=void 0;try{for(var O,E=t.materials[Symbol.iterator]();!(S=(O=E.next()).done);S=!0){var I=O.value,M=I.mtlId,C=(I.textureSource,e.createMaterial()),R=!0,A=!1,L=void 0;try{for(var D,N=I.textureSource[Symbol.iterator]();!(R=(D=N.next()).done);R=!0){var F=a[D.value.texId];C.addTexture(va.DIFFUSE,F)}}catch(e){A=!0,L=e}finally{try{R||null==N.return||N.return()}finally{if(A)throw L}}i[M]=C}}catch(e){k=!0,P=e}finally{try{S||null==E.return||E.return()}finally{if(k)throw P}}var j=!0,V=!1,B=void 0;try{for(var U,G=t.renderables[Symbol.iterator]();!(j=(U=G.next()).done);j=!0){var H=U.value,z=(h=H.meshId,M=H.mtlId,H.indexLength);e.createRenderable(r[h],i[M]).indexLength=z}}catch(e){V=!0,B=e}finally{try{j||null==G.return||G.return()}finally{if(V)throw B}}var W=this.renderView.getSceneManager().createChunks(t.entities.length,An),q=!0,Y=!1,X=void 0;try{for(var K,Z=t.entities.entries()[Symbol.iterator]();!(q=(K=Z.next()).done);q=!0){var Q=eu(K.value,2),J=Q[0],$=Q[1],ee=r[$.meshId],te=W[J];te.offset=$.indexOffset,te.length=$.indexLength,te.bound.fromExtreams([$.bbox[0],$.bbox[1],$.bbox[2]],[$.bbox[3],$.bbox[4],$.bbox[5]]),te.tags[0]=$.tag[0],te.tags[1]=$.tag[1],te.tags[2]=$.tag[2],te.mesh=ee,ee.setChunk(te)}}catch(e){Y=!0,X=e}finally{try{q||null==Z.return||Z.return()}finally{if(Y)throw X}}var ne=!0,re=!1,ie=void 0;try{for(var ae,oe=t.geometries[Symbol.iterator]();!(ne=(ae=oe.next()).done);ne=!0){var se=r[h=ae.value.meshId],ue=this.renderView.getSceneManager().createPhysicsModel(Mn,An),le=this.renderView.getSceneManager().createBVH(Cn,An);ue.setBVHRoot(le),se.setPhysicsModel(ue)}}catch(e){re=!0,ie=e}finally{try{ne||null==oe.return||oe.return()}finally{if(re)throw ie}}return e.updateTransform(),e}}])&&tu(n.prototype,r),i&&tu(n,i),t}();function ou(e){return e[0]=e[1]=e[2]=e[3]=0,e}function su(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var uu=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.camera=t,this.func=fu(lu.None,cu.Camera_Roll),this.data={info:{type:lu.None,relative:cu.Camera_Roll},translation:Ar([]),scale:Lr([]),rotation:Ht([])}}var t,n,r;return t=e,(n=[{key:"selectTransform",value:function(e){var t=e.type,n=e.relative;this.func=fu(t,n)}},{key:"setInfo",value:function(e){this.data.info=e}},{key:"apply",value:function(e,t){this.func(e,t,this)}},{key:"getCameraRollQuaternion",value:function(){}},{key:"getCameraFlipHorizontallyQuaternion",value:function(){}},{key:"setTranslation",value:function(e){this.data.translation=e}},{key:"setScale",value:function(e){this.data.scale=e}},{key:"setRotation",value:function(e){this.data.rotation=e}},{key:"reset",value:function(){this.data.scale=Lr([]),this.data.rotation=Ht([]),this.data.translation=Ar([])}},{key:"setData",value:function(e){Object.assign(this.data,e),this.selectTransform(e.info)}},{key:"getData",value:function(){return this.data}}])&&su(t.prototype,n),r&&su(t,r),e}(),lu={None:0,Scale:1,Scale_Rotation:2,Scale_Rotation_Translation:3,Scale_Translation:4,Rotation:5,Rotation_Translation:6,Translation:7},cu={Absolute:0,Camera_Roll:1,Keep_Horizontal:2},fu=function(e,t){return yu[t][e]},hu=function(){},pu=function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},du=function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},vu=function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},yu=[[hu,pu,function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},vu,function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},du],[hu,pu,function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},vu,function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},du],[hu,pu,function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},vu,function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}},du]];function mu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var gu=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.screenPosition=n,this.transform=new uu(t.getSceneManager().getCamera()),this.alpha=0,this.image=null,this.anchor=[],this.center=Ar([]),this.bound=ou([]),this.decorations=[]}var t,n,r;return t=e,(n=[{key:"setData",value:function(e){var t=e.style;this.setAnchor([.01*t.anchorX,.01*t.anchorY]),this.alpha=0}},{key:"setImage",value:function(e){this.image=e,this.makeCenter()}},{key:"setAnchor",value:function(e){var t,n;t=this.anchor,n=e,t[0]=n[0],t[1]=n[1],this.makeCenter()}},{key:"makeCenter",value:function(){this.image&&(this.center[0]=this.image.width*this.anchor[0],this.center[1]=this.image.height*this.anchor[1])}}])&&mu(t.prototype,n),r&&mu(t,r),e}();function bu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var wu=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.screenPosition=n,this.transform=new uu(t.getSceneManager().getCamera()),this.text="",this.format={size:26,font:"",color:"FFFFFFFF",stroke:0,strokeColor:"000000FF",textSpace:1,padding:1,backgroundColor:"FFFFFF00"},this.renderer,this.glyphInfo,this.maxWidth=-1,this.invalidate=!0,this.size=[0,0],this.image=null}var t,n,r;return t=e,(n=[{key:"setText",value:function(e){this.text=e}},{key:"setTextFormat",value:function(e){Object.assign(this.format,e)}},{key:"getTextFormat",value:function(){return this.format}},{key:"doFontRender",value:function(e){this.invalidate=!1;var t=0,n=0,r=this.format,i=r.size,a=r.color,o=r.stroke,s=r.strokeColor,u=this.text;if(o>0){var l=document.createElement("canvas");this.image=l;var c=this.image.getContext("2d");c.lineWidth=2*o,c.font=i+"px YoonGothic",t=c.measureText(u).width+2*o+2,n=i+2*o+2,l.width=t,l.height=n,c.textBaseline="hanging",c.font=i+"px YoonGothic",o&&(c.shadowBlur=2,c.shadowColor=s,c.lineWidth=2*o,c.strokeStyle=s,c.strokeText(u,o+1,o+5)),c.fillStyle=a,c.fillText(u,o+1,o+5)}this.size[0]=t,this.size[1]=n}},{key:"getPixelSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:512;return this.invalidate&&this.doFontRender(e),this.size}}])&&bu(t.prototype,n),r&&bu(t,r),e}(),_u={Center:0,Top:1,Bottom:2,Left:3,Right:4};function Tu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function xu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Su=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderView=t,this.screenPosition=n,this.transform=new uu(t.getSceneManager().getCamera()),this.fields=[],this.alpha=0,this.layout=_u.Bottom,this.bound=ou([]),this.size=[0,0],this.images=[]}var t,n,r;return t=e,(n=[{key:"setData",value:function(e){this.fields.length=0;for(var t=e.dpnameCount,n=e.style,r=n.fontStyles,i=Math.max(0,r.length-1),a=e.dpNames,o=0;o<t;o++){var s=a[o],u=new wu(this.renderView,this.screenPosition);this.fields.push(u),u.setText(s);var l=r[Math.min(i,o)],c=l.size,f=l.color,h=l.maskColor,p=l.maskWidth;u.setTextFormat({size:c,color:f,strokeColor:h,stroke:p})}this.layout=n.labelAlign,this.alpha=0}},{key:"rasterize",value:function(){this.clearImages();var e=!0,t=!1,n=void 0;try{for(var r,i=this.fields[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value,o=Tu(a.getPixelSize(),2),s=o[0],u=o[1];s&&u&&this.images.push(a.image),this.size[0]=Math.max(this.size[0],s),this.size[1]=u}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"rasterizeToImage",value:function(e){this.clearImages();var t=this.size,n=0,r=0,i=!0,a=!1,o=void 0;try{for(var s,u=this.fields[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=Tu(s.value.getPixelSize(),2),c=l[0],f=l[1];n=Math.max(c,n),r+=f}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}t[0]=n,t[1]=r;var h=document.createElement("canvas");h.width=n,h.height=r;var p,d=h.getContext("2d"),v=0,y=!0,m=!1,g=void 0;try{for(var b,w=this.fields[Symbol.iterator]();!(y=(b=w.next()).done);y=!0){var _=b.value,T=Tu(_.getPixelSize(),2);c=T[0],f=T[1];p=(n-c)/2,d.drawImage(_.image,p,v),v+=f}}catch(e){m=!0,g=e}finally{try{y||null==w.return||w.return()}finally{if(m)throw g}}return h}},{key:"clearImages",value:function(){this.images.length=0}}])&&xu(t.prototype,n),r&&xu(t,r),e}();function ku(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Pu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ou(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Eu=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.type="",this.name="",this.rank,this.height=0,this.terrainHeight=0,this.position=[],this.position3d=[];var n=[];this.icon=new gu(t,n),this.text=new Su(t,n),this.firstEnterance=!0,this.needRasterize=!0}var t,n,r;return t=e,(n=[{key:"setData",value:function(e){this.id=e.id,Dr(this.position,e.x,e.y),this.height=e.bheight,this.terrainHeight=e.height,this.rank=e.score,this.style=e.style,this.maxAlpha=1-e.transparency;var t=360-e.rotation,n=Ht([]);if(0!==t){qt(n,t>=180?(t-360)*_t:t*_t,0),this.icon.transform.setRotation(n),this.text.transform.setRotation(n)}var r,i,a=e.translate;if(null!==a&&2===a.length){var o=Et([]);o[0]=a[0],o[1]=a[1],!function(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2],l=s*a-u*i,c=u*r-o*a,f=o*i-s*r,h=s*f-u*c,p=u*l-o*f,d=o*c-s*l,v=2*n[3];e[0]=r+l*v+2*h,e[1]=i+c*v+2*p,e[2]=a+f*v+2*d}(o,o,(i=n,(r=[])[0]=-i[0],r[1]=-i[1],r[2]=-i[2],r[3]=i[3],r)),this.position.x+=o[0],this.position.y+=o[1]}this.name=e.dpNames.join(""),this.text.setData(e),this.icon.setData(e),this.firstEnterance=!0;var s=this.getTransform(e.transform);this.icon.transform.setInfo(s),this.icon.transform.selectTransform(s),this.text.transform.setInfo(s),this.text.transform.selectTransform(s)}},{key:"raterize",value:function(e,t){if(this.needRasterize){var n=this.icon;null===n.image?(n.setImage(this.text.rasterizeToImage(e)),n.setAnchor([.5,.5]),n.transform.setData(this.text.transform.data)):t&&this.text.rasterize(e),this.needRasterize=!1}}},{key:"getTransform",value:function(e){var t={},n=lu.None,r=cu.Camera_Roll;if(e){var i=Pu(e.split("_"),2),a=i[0],o=i[1];"S"===a?n=lu.Scale:"SR"===a?n=lu.Scale_Rotation:"SRT"===a?n=lu.Scale_Rotation_Translation:"ST"===a?n=lu.Scale_Translation:"R"===a?n=lu.Rotation:"RT"===a?n=lu.Rotation_Translation:"T"===a&&(n=lu.Translation),o&&("A"===o?r=cu.Absolute:"H"==o&&(r=cu.Keep_Horizontal))}return t.type=n,t.relative=r,t}},{key:"updateScreenPosition",value:function(e,t){Mt(this.position3d,this.position.x,this.position.y,Math.min(t.max,this.height*t.weight+this.terrainHeight));var n=e.project(this.position3d);Dr(this.screenPosition,n.x,n.y)}},{key:"updateTerrainHeight",value:function(e){var t;this.terrainHeight=(t=e.getSceneManager().getTerrain()).getHeightAt.apply(t,ku(this.position))}}])&&Ou(t.prototype,n),r&&Ou(t,r),e}();function Iu(e){return(Iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Cu(e,t){return!t||"object"!==Iu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ru(e){return(Ru=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Au(e,t){return(Au=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Lu=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Cu(this,Ru(t).call(this))).labels=null,e.visible=!0,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Au(e,t)}(t,Lo),n=t,(r=[{key:"extractScene",value:function(){return this.visible}},{key:"extractVisibleLabels",value:function(e){var t=this.labels,n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,u=e.get(s.type);u&&u.addLabel(0,s)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}},{key:"extractExitLabels",value:function(e){var t=this.labels,n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,u=e.get(s.type);u&&u.isValid()&&(u.addExitIcon(s),u.addExitText(s),s.isFirstEnterance=!0)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}console.log("extractExitLabels is not implemented yet.")}},{key:"buildLabels",value:function(e,t){var n=this.labels,r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){o.value.raterize(e,t)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}}])&&Mu(n.prototype,r),i&&Mu(n,i),t}(),Du={},Nu={},Fu={getImage:function(e){return Nu[e]},load:function(e,t){if(Nu[e])t(Nu[e]);else if(Du[e])Du[e].addEventListener("load",function(){t(Nu[e])});else{var n="http://maps-proxy.dev.daum.net/vectormap-poi/symbol/1.0/"+e,r=new Image;r.crossOrigin="anonymous",r.onload=function(){Nu[e]=r,delete Du[e],t(r)},r.src=n,Du[e]=r}}};function ju(e){return(ju="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Bu(e,t){return!t||"object"!==ju(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Uu(e){return(Uu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gu(e,t){return(Gu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Hu=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Bu(this,Uu(t).call(this))).renderView=e,n.contentManager=e.getSceneManager().getContentManager(),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gu(e,t)}(t,ne),n=t,(r=[{key:"read",value:function(e,t,n){this.makePois(e,t,n)}},{key:"makePois",value:function(e,t,n){var r=this,i=new Lu,a=e.poiResults,o=new D({start:function(){t.isCanceled()?n(null):n(i)},cancel:function(){t.cancel()}}),s=new D({async:!0,start:function(e){if(!t.isCanceled()){var n=[];i.labels=n;var o=[],s=!0,u=!1,l=void 0;try{for(var c,f=a[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=c.value,p=h.poiType,d=h.pois,v=!0,y=!1,m=void 0;try{for(var g,b=d[Symbol.iterator]();!(v=(g=b.next()).done);v=!0){var w=g.value;if((O=new Eu(r.renderView)).setData(w),O.type=p,n.push(O),E=w.style.imgUrl){var _=Fu.getImage(E);_?O.icon.setImage(_):o.push({label:O,imgUrl:E})}}}catch(e){y=!0,m=e}finally{try{v||null==b.return||b.return()}finally{if(y)throw m}}}}catch(e){u=!0,l=e}finally{try{s||null==f.return||f.return()}finally{if(u)throw l}}if(0===o.length)e();else for(var T=o.length,x=function(t){return function(n){t.icon.setImage(n),0===--T&&e()}},S=0,k=o;S<k.length;S++){var P=k[S],O=P.label,E=P.imgUrl;Fu.load(E,x(O))}}},done:function(){i.buildLabels(512,!0)},cancel:function(){t.cancel()}});this.contentManager.doTask(s,o)}}])&&Vu(n.prototype,r),i&&Vu(n,i),t}();function zu(e){return(zu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qu(e,t){return!t||"object"!==zu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Yu(e){return(Yu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xu(e,t){return(Xu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ku=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),qu(this,Yu(t).call(this))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xu(e,t)}(t,ne),n=t,(r=[{key:"read",value:function(e,t,n){"string"==typeof e&&(e=JSON.parse(e)),n(e)}}])&&Wu(n.prototype,r),i&&Wu(n,i),t}();function Zu(e){return(Zu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ju(e,t){return!t||"object"!==Zu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $u(e){return($u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function el(e,t){return(el=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var tl=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ju(this,$u(t).call(this))).renderView=e,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&el(e,t)}(t,ne),n=t,(r=[{key:"read",value:function(e,t,n){n(this.makeShape(e))}},{key:"makeShape",value:function(e){var t=new Lo,n=t.createMesh(),r=t.createMaterial(),i=this.renderView.getGraphicsManager().createTextureBuffer(e);return r.addTexture(va.DIFFUSE,i),r.setDiffuseColor(0,0,0,1),t.createRenderable(n,r),t}}])&&Qu(n.prototype,r),i&&Qu(n,i),t}();function nl(e){return(nl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function il(e,t){return!t||"object"!==nl(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function al(e){return(al=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ol(e,t){return(ol=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var sl=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=il(this,al(t).call(this))).renderView=e,n.debugTileToTextureReader=new Zo(e),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ol(e,t)}(t,ne),n=t,(r=[{key:"read",value:function(e,t,n){var r=this;this.debugTileToTextureReader.read(e,t,function(e){n(null===e?null:r.makeShape(e))})}},{key:"makeShape",value:function(e){var t=new Lo,n=t.createMesh(),r=t.createMaterial();return r.addTexture(va.DIFFUSE,e),r.setDiffuseColor(0,0,0,1),t.createRenderable(n,r),t}}])&&rl(n.prototype,r),i&&rl(n,i),t}();function ul(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ll=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderView=t;var n={tile:function(e){return function(t){return e.address.replace(/\|(\d)\|/g,function(e,n){return t.col&parseInt(n,10)-1})+"/L".concat(14-t.level,"/").concat(t.row,"/").concat(t.col,".").concat(e.format)}},normal:function(e){return function(){return e.address+".".concat(e.format)}},server_no:function(e){return function(){return e.address.replace(/\|(\d)\|/g,function(e,t){return 10*Math.random()&parseInt(t,10)-1})+".".concat(e.format)}},tile_debug:function(e){return function(e){return"".concat(e.level,"|").concat(e.row,"|").concat(e.col)}},p_preview:function(e){return function(t,n,r,i){return e.address.replace(/\|(\d)\|/g,function(e,n){return t&parseInt(n,10)-1})+"/".concat(n,"/").concat(i).concat(r,".").concat(e.format)}},p_tile:function(e){return function(t,n,r,i){var a=Pt(fs(t.level,t.row,t.col),t.level+1),o=i?"_HD1":"";return e.address.replace(/\|(\d)\|/g,function(e,t){return a&parseInt(t,10)-1})+"/".concat(n).concat(o,"/").concat(r).concat(o,"_").concat(a,".").concat(e.format)}},p_tile_debug:function(e){return function(e){var t=Pt(fs(e.level,e.row,e.col),e.level+1);return"".concat(e.level,"|").concat(e.row,"|").concat(e.col,"|").concat(t)}},p_street_mask:function(e){return function(t){return e.address.replace(/\|(\d)\|/g,function(e,n){return t.col&parseInt(n,10)-1})+"".concat(3-t.row,"_").concat(t.col,".").concat(e.format)}},p_street:function(e){return function(t){return e.address+"".concat(t,"?SERVICE=glpano")}},p_near_street:function(e){return function(t,n,r,i){return e.address+"".concat(t,"?PX=").concat(n,"&PY=").concat(r,"&RAD=70&TYPE=w&PAGE_SIZE=35&INPUT=").concat(i,"&SERVICE=glpano")}},p_store:function(e){return function(t){return e.address+"vId=".concat(t)}},p_rangesearch:function(e){return function(t,n,r,i,a){return e.address+"?PX=".concat(t,"&PY=").concat(n,"&RAD=").concat(r,"&PAGE_SIZE=").concat(i,"&INPUT=").concat(a,"&TYPE=w&SERVICE=glpano")}},p_depthmap:function(e){return function(t,n){return e.address.replace(/\|(\d)\|/g,function(e,n){return t&parseInt(n,10)-1})+"/".concat(n,"_W.png")}}};this.typeToFunc=n}var t,n,r;return t=e,(n=[{key:"getFunctionByType",value:function(e){var t=this.typeToFunc[e];if(!t)throw"".concat(e," 에 대한 URL function 이 준비되어있지 않습니다.");return t}}])&&ul(t.prototype,n),r&&ul(t,r),e}();function cl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var fl=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.appEngine=t,this.renderView=n,this.urlFunction=new ll(n),this.nameToFunctionTable=new Map,this.version=null}var t,n,r;return t=e,(n=[{key:"build",value:function(e){var t=this;this.version=e.version,e.url.forEach(function(e){var n=e.name,r=t.urlFunction.getFunctionByType(e.type)(e,t.renderView);t.nameToFunctionTable.set(n,r)})}},{key:"getURLFunction",value:function(e){return this.nameToFunctionTable.get(e)}}])&&cl(t.prototype,n),r&&cl(t,r),e}();function hl(e){return(hl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function dl(e,t){return!t||"object"!==hl(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vl(e){return(vl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yl(e,t){return(yl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ml=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=dl(this,vl(t).call(this,"created","removed","cameraIn","cameraOut","changed","postUpdate","bboxUpdate"))).terrain=e,n.rootNodes=[],n.levelDepth=0,n.createdNodes=[],n.removedNodes=[],n.cameraInNodes=[],n.cameraOutNodes=[],n.visibleNodes=[],n.leafNodes=[],n.needUpdate=!1,n.dynamic=!0,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yl(e,t)}(t,E),n=t,(r=[{key:"initialize",value:function(e){var t=e.originX,n=e.originY,r=e.width,i=e.height,a=e.startLevel,o=e.depth,s=e.minRow,u=e.maxRow,l=e.minColumn,c=e.maxColumn,f=e.dynamic,h=this.rootNodes;this.dynamic="boolean"!=typeof f||f,this.levelDepth=o;var p,d,v,y,m,g,b=0;for(p=s;p<=u;++p)for(d=l;d<=c;++d,++b)0,m=(v=d*r+t)+r,g=(y=p*i+n)+i,0,h[b]=new ks(this,null,a,p,d,v,y,0,m,g,0)}},{key:"update",value:function(e){this.createdNodes.length=0,this.removedNodes.length=0,this.cameraInNodes.length=0,this.cameraOutNodes.length=0;var t=!0,n=!1,r=void 0;try{for(var i,a=this.rootNodes[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.update(e)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}var o=this.createdNodes.length>0,s=this.removedNodes.length>0;(o||s)&&(this.dispatch("changed"),o&&this.dispatch("created"),s&&this.dispatch("removed")),this.cameraInNodes.length>0&&this.dispatch("cameraIn"),this.cameraOutNodes.length>0&&this.dispatch("cameraOut"),this.dispatch("postUpdate")}}])&&pl(n.prototype,r),i&&pl(n,i),t}();function gl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var bl=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.partition=new ml(this),this.currentLevel=-1,this.minLevel=-1,this.maxLevel=-1,this.globalOpacity=1}var t,n,r;return t=e,(n=[{key:"update",value:function(e){}},{key:"getGlobalOpacity",value:function(){return this.globalOpacity}},{key:"setGlobalOpacity",value:function(e){"number"==typeof this.globalOpacity&&(this.globalOpacity=e)}},{key:"getHeightAt",value:function(e,t){return 0}}])&&gl(t.prototype,n),r&&gl(t,r),e}();function wl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _l(e,t,n){return"".concat(e,",").concat(t,",").concat(n)}var Tl=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderView=t,this.maxLevel=v.length-1,this.sourceGeometries=new Map,this.sourceBasisBBox=new Map,this.makeGeometry()}var t,n,r;return t=e,(n=[{key:"makeGeometry",value:function(){this._createPreviewGeometry(),this._createTileGeometry(this.maxLevel),this._createTileGeometry(this.maxLevel-1)}},{key:"getGeometry",value:function(e){return this.sourceGeometries.get(e)}},{key:"getBasisBBox",value:function(e){return this.sourceBasisBBox.get(e)}},{key:"makeSphereTileByDensity",value:function(e,t){var n=[e,t].join("|"),r=180/e,i=360/t;if(this.sourceGeometries.has(n))return this.sourceGeometries.get(n);var a=[],o=[],s=a.length-1;this._createIndices(o,e,t),this._createVertices(180,0,0,360,r,i,function(e,t,n,r,i,o){a[++s]=e,a[++s]=t,a[++s]=n,a[++s]=r,a[++s]=i});var u={vertexBuffer:this.renderView.getGraphicsManager().createVertexBuffer(new Float32Array(a),Aa.Pf3Tf2Tf2),indexBuffer:this.renderView.getGraphicsManager().createIndexBuffer(new Uint16Array(o))};return this.sourceGeometries.set(n,u),u}},{key:"_createPreviewGeometry",value:function(){var e=this.sourceGeometries,t=180/f,n=360/h,r=[],i=[],a=r.length-1;this._createIndices(i,f,h),this._createVertices(180,0,0,360,t,n,function(e,t,n,i,o,s){r[++a]=e,r[++a]=t,r[++a]=n,r[++a]=i,r[++a]=o,r[++a]=0===i?1:i,r[++a]=0===o?1:o});var o={vertexBuffer:this.renderView.getGraphicsManager().createVertexBuffer(new Float32Array(r),Aa.Pf3Tf2Tf2),indexBuffer:this.renderView.getGraphicsManager().createIndexBuffer(new Uint16Array(i))};e.set("preview_geometry",o)}},{key:"_createTileGeometry",value:function(e){var t,n,r=this,i=this.sourceGeometries,a=180/p,o=360/d,s=v[e][0],u=v[e][1],l=180/s,c=360/u,f=p/s,h=d/u;for(t=0;t<s;++t){var y=function(){var p=[],d=[],v=p.length-1,y=180-t*l,m=y-l,g=n*c,b=g+c,w=Mt([],1/0,1/0,1/0),_=Mt([],-1/0,-1/0,-1/0);r._createIndices(d,f,h),r._createVertices(y,m,g,b,a,o,function(e,i,a,o,l){p[++v]=e,p[++v]=i,p[++v]=a,p[++v]=o,p[++v]=l,p[++v]=n/u+o/u,p[++v]=t/s+l/s,r._buildBasisBBox(w,_,e,i,a)});var T={vertexBuffer:r.renderView.getGraphicsManager().createVertexBuffer(new Float32Array(p),Aa.Pf3Tf2Tf2),indexBuffer:r.renderView.getGraphicsManager().createIndexBuffer(new Uint16Array(d))};i.set(_l(e,t,n),T),r.sourceBasisBBox.set(_l(e,t,n),{minBox:w,maxBox:_})};for(n=0;n<u;++n)y()}}},{key:"_buildBasisBBox",value:function(e,t,n,r,i){e[0]=Math.min(e[0],n),e[1]=Math.min(e[1],r),e[2]=Math.min(e[2],i),t[0]=Math.max(t[0],n),t[1]=Math.max(t[1],r),t[2]=Math.max(t[2],i)}},{key:"_createVertices",value:function(e,t,n,r,i,a,o){var s,u,l,c,f,h,p=Math.abs(t-e)/i,d=Math.abs(r-n)/a,v=0;for(l=e,s=0;l>=t;l-=i,++s){for(f=Math.cos(l*_t),h=Math.sin(l*_t),c=n+-90,u=0;c<=r+-90;c+=a,++u)o(h*Math.cos(-c*_t),h*Math.sin(-c*_t),f,u/d,s/p,v);v++}}},{key:"_createIndices",value:function(e,t,n){var r,i,a,o,s=e,u=s.length-1;for(a=0;a<t;++a)for(o=0;o<n;++o)i=(r=a*(n+1)+o)+n+1,s[++u]=0+r,s[++u]=0+r+1,s[++u]=0+i+1,s[++u]=0+i+1,s[++u]=0+i,s[++u]=0+r}},{key:"_createDebugIndices",value:function(e,t,n){var r,i,a,o,s=e,u=s.length-1;for(a=0;a<t;++a)for(o=0;o<n;++o)i=(r=a*(n+1)+o)+n+1,s[++u]=0+r,s[++u]=0+r+1,s[++u]=0+r+1,s[++u]=0+i+1,s[++u]=0+i+1,s[++u]=0+r,s[++u]=0+i+1,s[++u]=0+i,s[++u]=0+i,s[++u]=0+r,s[++u]=0+r,s[++u]=0+i+1}}])&&wl(t.prototype,n),r&&wl(t,r),e}();function xl(e){return(xl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function kl(e){return(kl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ol(e,t){return(Ol=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var El=50*_t,Il=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==xl(t)&&"function"!=typeof t?Pl(e):t}(this,kl(t).call(this))).renderView=e,n.currentLevel=0,n.minLevel=1,n.maxLevel=2,n.depth=n.maxLevel+1,n.partition.initialize({originX:0,originY:0,width:0,height:0,startLevel:n.minLevel,depth:n.depth,minRow:0,maxRow:3,minColumn:0,maxColumn:7,dynamic:!1}),n._buildPartition(),n.partition.needUpdate=!1,n.panoramaDataManager=null,n.panoramaInfo=null,n.sphereTileGeometry=new Tl(e),n.partitionResetListener=n.onPartitionReset.bind(Pl(n)),n.updateLock=!1,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ol(e,t)}(t,bl),n=t,(r=[{key:"lock",value:function(){this.updateLock=!0}},{key:"unLock",value:function(){this.updateLock=!1}},{key:"update",value:function(e){this.updateLock||this.partition.needUpdate&&(this.currentLevel=this.calculateLevel(e.camera),e.reset(),this.partition.update(e))}},{key:"calculateLevel",value:function(e){return e.fovy<El?this.maxLevel:this.minLevel}},{key:"getLevelRange",value:function(){return{min:this.minLevel,max:this.maxLevel}}},{key:"getPanoramaInfo",value:function(){return this.panoramaInfo}},{key:"getDataManager",value:function(){return this.panoramaDataManager}},{key:"onPartitionReset",value:function(){var e=this.panoramaInfo,t=e.getPosition(),n=e.getRotation();if(t&&n){var r=Ae([],t,[1,1,1],n),i=!0,a=!1,o=void 0;try{for(var s,u=this.partition.rootNodes[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;this._resetPartitionNodeState(l),this._resetPartitionNodeBoundingBox(l,r)}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}this.partition.needUpdate=!0,this.partition.dispatch("bboxUpdate")}}},{key:"_buildPartition",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.partition.rootNodes[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;this._buildPartitionNode(a)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"_buildPartitionNode",value:function(e){if(!(e.level>=this.maxLevel)){e.createChildren();var t=!0,n=!1,r=void 0;try{for(var i,a=e.childNodes[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this._buildPartitionNode(o)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}}},{key:"_resetPartitionNodeState",value:function(e){e.isLeaf=!0,e.isInFrustum=!1,e.isSurrounds=!1}},{key:"_resetPartitionNodeBoundingBox",value:function(e,t){var n=this.sphereTileGeometry.getBasisBBox(e.key),r=n.minBox,i=n.maxBox,a=Bt([],r,t),o=Bt([],i,t);if(e.box[0]=Math.min(a[0],o[0]),e.box[1]=Math.min(a[1],o[1]),e.box[2]=Math.min(a[2],o[2]),e.box[3]=Math.max(a[0],o[0]),e.box[4]=Math.max(a[1],o[1]),e.box[5]=Math.max(a[2],o[2]),e.cx=.5*(e.box[0]+e.box[3]),e.cy=.5*(e.box[1]+e.box[4]),e.cz=.5*(e.box[2]+e.box[5]),e.childNodes){var s=!0,u=!1,l=void 0;try{for(var c,f=e.childNodes[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=c.value;this._resetPartitionNodeState(h),this._resetPartitionNodeBoundingBox(h,t)}}catch(e){u=!0,l=e}finally{try{s||null==f.return||f.return()}finally{if(u)throw l}}}}},{key:"enable",value:function(){this.panoramaInfo.on("street_created",this.partitionResetListener),this.panoramaInfo.on("store_created",this.partitionResetListener)}},{key:"disable",value:function(){this.panoramaInfo.off("street_created",this.partitionResetListener),this.panoramaInfo.off("store_created",this.partitionResetListener)}},{key:"geometry",set:function(e){this.sphereTileGeometry=e||null},get:function(){return this.sphereTileGeometry}}])&&Sl(n.prototype,r),i&&Sl(n,i),t}();function Ml(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Cl=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.camera=null,this.visibleNodes=new Set,this.leafNodes=new Set,this.levelDepth=0}var t,n,r;return t=e,(n=[{key:"reset",value:function(){this.visibleNodes.clear(),this.leafNodes.clear()}},{key:"setCamera",value:function(e){this.camera=e}},{key:"enterNode",value:function(e){return this.camera.frustum.intersectAxisAlignedBox3(e.box)}},{key:"endNode",value:function(e){return e.partitionTree.terrain.calculateLevel(this.camera)===e.level}}])&&Ml(t.prototype,n),r&&Ml(t,r),e}();function Rl(e){return(Rl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Al(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ll(e,t){return!t||"object"!==Rl(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Dl(e){return(Dl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Nl(e,t){return(Nl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fl=Math.abs,jl=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Ll(this,Dl(t).call(this))).currentLevel=0,e.minLevel=0,e.maxLevel=14,e.originX=-3e4,e.originY=-6e4,e.width=524288,e.height=524288,e.depth=e.maxLevel+1,e.partition.initialize({originX:e.originX,originY:e.originY,width:e.width,height:e.height,startLevel:e.minLevel,depth:e.depth,minRow:0,maxRow:0,minColumn:0,maxColumn:0}),e.partition.needUpdate=!0,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nl(e,t)}(t,bl),n=t,(r=[{key:"update",value:function(e){this.partition.needUpdate&&(this.currentLevel=this.calculateLevel(e.camera),e.reset(),this.partition.update(e))}},{key:"calculateLevel",value:function(e){return Fl(this.maxLevel-this.minLevel)-e.zoomLevel}},{key:"getTilePosition",value:function(e,t,n){var r=this.width>>e,i=n*r+this.originX,a=t*r+this.originY;return Mt([],.5*(i+((n+1)*r+this.originX)),.5*(a+((t+1)*r+this.originY)),0)}},{key:"getTileScale",value:function(e){var t=16<<Fl(this.maxLevel-this.minLevel)-e;return Mt([],t,t,t)}}])&&Al(n.prototype,r),i&&Al(n,i),t}();function Vl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Bl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ul=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.camera=null,this.visibleNodes=new Set,this.leafNodes=new Set,this.levelDepth=0}var t,n,r;return t=e,(n=[{key:"reset",value:function(){this.visibleNodes.clear(),this.leafNodes.clear()}},{key:"setCamera",value:function(e){this.camera=e}},{key:"enterNode",value:function(e){return this.camera.frustum.intersectAxisAlignedBox2(e.box)}},{key:"endNode",value:function(e){var t=e.cx,n=e.cy,r=Vl(this.camera.target,2),i=r[0],a=r[1],o=this.camera.getClearDistance(e.level);return o*o<(i-t)*(i-t)+(a-n)*(a-n)}}])&&Bl(t.prototype,n),r&&Bl(t,r),e}();function Gl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Hl=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.layer=t,this.shapeExtract=!0}var t,n,r;return t=e,(n=[{key:"enable",value:function(){}},{key:"disable",value:function(){}},{key:"extractLock",value:function(){this.shapeExtract=!1}},{key:"extractUnLock",value:function(){this.shapeExtract=!0}},{key:"extractVisibleShape",value:function(e){this.shapeExtract&&(e.checkFrustum(this.layer.isCheckFrustum),this.layer.visibleNodes.forEach(function(t){if(t.extractScene(e)){e.addShape(t);var n=!0,r=!1,i=void 0;try{for(var a,o=t.renderables[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;e.addRenderable(s)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}}))}}])&&Gl(t.prototype,n),r&&Gl(t,r),e}();function zl(e){return(zl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wl(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ql(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Yl(e,t){return!t||"object"!==zl(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Xl(e){return(Xl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kl(e,t){return(Kl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Zl=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Yl(this,Xl(t).call(this,e))).executingCommands=new Map;n.orderNodes=[];for(var r=0;r<10;++r)n.orderNodes[r]=new ks(null,null,0,0,r);return n.nodeToPreviewDataTable=new Map,n.orderIndex=-1,n}var n,r,i,a,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kl(e,t)}(t,Hl),n=t,(r=[{key:"getPreviewData",value:function(e){return this.nodeToPreviewDataTable.get(e)}},{key:"onDataUpdate",value:function(e,t,n){++this.orderIndex;var r=this.orderNodes[this.getCurrentIndex()];this.nodeToPreviewDataTable.set(r,e),this.createPreviewNode(r,t,n)}},{key:"getCurrentIndex",value:function(){return this.orderIndex>=1e4&&(this.orderIndex=0),this.orderIndex%this.orderNodes.length}},{key:"createPreviewNode",value:(a=regeneratorRuntime.mark(function e(t,n,r){var i,a,o,s,u,l,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.executingCommands.get(t)){e.next=39;break}i=null,a=!0,o=!1,s=void 0,e.prev=6,u=n[Symbol.iterator]();case 8:if(a=(l=u.next()).done){e.next=24;break}return c=l.value,e.prev=10,e.next=13,this.requestLayerBufferData(t,c);case 13:if(!(i=e.sent)){e.next=16;break}return e.abrupt("break",24);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),console.log(e.t0);case 21:a=!0,e.next=8;break;case 24:e.next=30;break;case 26:e.prev=26,e.t1=e.catch(6),o=!0,s=e.t1;case 30:e.prev=30,e.prev=31,a||null==u.return||u.return();case 33:if(e.prev=33,!o){e.next=36;break}throw s;case 36:return e.finish(33);case 37:return e.finish(30);case 38:i?this.onLoadingComplete(t,i,r):this.onLoadingError(t,r);case 39:case"end":return e.stop()}},e,this,[[6,26,30,38],[10,18],[31,,33,37]])}),o=function(){var e=this,t=arguments;return new Promise(function(n,r){var i=a.apply(e,t);function o(e){Wl(i,n,r,o,s,"next",e)}function s(e){Wl(i,n,r,o,s,"throw",e)}o(void 0)})},function(e,t,n){return o.apply(this,arguments)})},{key:"requestLayerBufferData",value:function(e,t){var n=this,r=this.layer;return new Promise(function(i,a){var o=r.request(e,t,function(e){e?i(e):a("".concat(t,"번 이미지 오류!"))});n.executingCommands.set(e,o)})}},{key:"onLoadingComplete",value:function(e,t,n){this.executingCommands.delete(e),n(this.layer.addShape(e,t))}},{key:"onLoadingError",value:function(e,t){this.executingCommands.delete(e),this.layer.addShape(e,null),t(null)}},{key:"extractVisibleShape",value:function(e){e.checkFrustum(this.layer.isCheckFrustum);for(var t=1;t>=0;--t){var n=this.layer.animatedShapeList[t];if(n&&n.extractScene(e)){e.addShape(n);var r=!0,i=!1,a=void 0;try{for(var o,s=n.renderables[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;e.addRenderable(u)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}}}}])&&ql(n.prototype,r),i&&ql(n,i),t}();function Ql(e){return(Ql="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function $l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ec(e){return(ec=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nc(e,t){return(nc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rc=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==Ql(t)&&"function"!=typeof t?tc(e):t}(this,ec(t).call(this,e))).executingCommands=new Map,n.cameraInListener=n.onCameraIn.bind(tc(n)),n.cameraOutListener=n.onCameraOut.bind(tc(n)),n.removedListener=n.onRemoved.bind(tc(n)),n.bboxUpdateListener=n.onBBoxUpdate.bind(tc(n)),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nc(e,t)}(t,Hl),n=t,(r=[{key:"enable",value:function(){var e=this.layer.terrain.partition;e.on("cameraIn",this.cameraInListener),e.on("cameraOut",this.cameraOutListener),e.on("removed",this.removedListener),e.on("bboxUpdate",this.bboxUpdateListener)}},{key:"disable",value:function(){var e=this.layer.terrain.partition;e.off("cameraIn",this.cameraInListener),e.off("cameraOut",this.cameraOutListener),e.off("removed",this.removedListener),e.off("bboxUpdate",this.bboxUpdateListener)}},{key:"onBBoxUpdate",value:function(){this.resetVisibleNodeAll()}},{key:"onCameraIn",value:function(){var e=this.layer.terrain.partition.cameraInNodes,t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.createVisibleNode(o)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"onCameraOut",value:function(){var e=this.layer.terrain.partition.cameraOutNodes,t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.removeVisibleNode(o)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"onRemoved",value:function(){var e=this.layer.terrain.partition.removedNodes,t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.removeVisibleNode(o),o.parentNode&&o.parentNode.isLeaf&&o.parentNode.isInFrustum&&this.createVisibleNode(o.parentNode)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"createVisibleNode",value:function(e){var t=this,n=this.layer;if(e.isLeaf&&n.minLevel<=e.level&&n.maxLevel>=e.level){var r=this.executingCommands.get(e),i=this.layer.getShape(e);if(r||i)this.onLoadingComplete(e,i);else{var a=n.request(e,function(n){n?t.onLoadingComplete(e,n):t.onLoadingError(e)});this.executingCommands.set(e,a)}}else this.removeVisibleNode(e);e.parentNode&&this.removeVisibleNode(e.parentNode)}},{key:"removeVisibleNode",value:function(e){if(!e.isLeaf||!e.isInFrustum){var t=this.executingCommands.get(e);if(t)return t.cancel(),void this.executingCommands.delete(e);this.layer.visibleNodes.has(e)&&this.layer.visibleNodes.delete(e)}}},{key:"resetVisibleNodeAll",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.executingCommands.entries()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=Jl(r.value,2),o=a[0];a[1].cancel(),this.executingCommands.delete(o)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this.layer.clearShape()}},{key:"onLoadingComplete",value:function(e,t,n){this.executingCommands.delete(e),this.layer.addShape(e,t,n)}},{key:"onLoadingError",value:function(e){this.executingCommands.delete(e),this.layer.addShape(e,null)}},{key:"extractVisibleShape",value:function(e){var t=this;if(this.shapeExtract){e.checkFrustum(this.layer.isCheckFrustum);var n=this.layer.terrain.calculateLevel(this.layer.traverser.camera);this.layer.traverser.visibleNodes.forEach(function(r){if(r.level===n&&r.parentNode&&r.parentNode.level<n){var i=t.layer.getShape(r.parentNode);if(i&&i.extractScene(e)){e.addShape(i);var a=!0,o=!1,s=void 0;try{for(var u,l=i.renderables[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;e.addRenderable(c)}}catch(e){o=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}}}}),this.layer.visibleNodes.forEach(function(t,r){if(r.level===n&&t.extractScene(e)){e.addShape(t);var i=!0,a=!1,o=void 0;try{for(var s,u=t.renderables[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;e.addRenderable(l)}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}}})}}}])&&$l(n.prototype,r),i&&$l(n,i),t}();function ic(e){return(ic="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ac(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function oc(e){return(oc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function sc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function uc(e,t){return(uc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var lc=0,cc=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==ic(t)&&"function"!=typeof t?sc(e):t}(this,oc(t).call(this,e))).identity=lc++,n.executingCommands=new Map,n.cameraInListener=n.onCameraIn.bind(sc(n)),n.cameraOutListener=n.onCameraOut.bind(sc(n)),n.removedListener=n.onRemoved.bind(sc(n)),n.bboxUpdateListener=n.onBBoxUpdate.bind(sc(n)),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&uc(e,t)}(t,Hl),n=t,(r=[{key:"enable",value:function(){var e=this.layer.terrain.partition;e.on("cameraIn",this.cameraInListener),e.on("cameraOut",this.cameraOutListener),e.on("removed",this.removedListener),e.on("bboxUpdate",this.bboxUpdateListener)}},{key:"disable",value:function(){var e=this.layer.terrain.partition;e.off("cameraIn",this.cameraInListener),e.off("cameraOut",this.cameraOutListener),e.off("removed",this.removedListener),e.off("bboxUpdate",this.bboxUpdateListener)}},{key:"onBBoxUpdate",value:function(){var e=this.layer.terrain,t=e.getPanoramaInfo().getPosition(),n=e.getPanoramaInfo().getRotation(),r=!0,i=!1,a=void 0;try{for(var o,s=this.layer.visibleNodes.values()[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;It(u.position,t),zt(u.orientation,n),u.updateTransform()}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},{key:"onCameraIn",value:function(){var e=this.layer.terrain.partition.cameraInNodes,t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.createVisibleNode(o)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"onCameraOut",value:function(){var e=this.layer.terrain.partition.cameraOutNodes,t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.removeVisibleNode(o)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"onRemoved",value:function(){var e=this.layer.terrain.partition.removedNodes,t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.removeVisibleNode(o)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"createVisibleNode",value:function(e){var t=this,n=this.layer.terrain.getLevelRange().min;if(!(e.level>n||e.row>=2)){var r=this.layer,i=r.visibleNodes,a=this.executingCommands.get(e),o=i.get(e);if(!a&&!o){var s=this.layer.terrain.getPanoramaInfo().getCurrentPanoId(),u=r.request(e,function(n){n?t.onLoadingComplete(e,n,s):t.onLoadingError(e)});this.executingCommands.set(e,u)}}}},{key:"removeVisibleNode",value:function(e){var t=this.layer.terrain.getLevelRange().min;if(!(e.level>t||e.row>=2)){var n=this.executingCommands.get(e);return n?(n.cancel(),void this.executingCommands.delete(e)):void 0}}},{key:"onLoadingComplete",value:function(e,t,n){this.executingCommands.delete(e),t.materialPool[0].setDiffuseColor(0,0,0,1),this.layer.addShape(e,t,n)}},{key:"onLoadingError",value:function(e){this.executingCommands.delete(e),this.layer.addShape(e,null)}}])&&ac(n.prototype,r),i&&ac(n,i),t}();function fc(e){return(fc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pc(e){return(pc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vc(e,t){return(vc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yc=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==fc(t)&&"function"!=typeof t?dc(e):t}(this,pc(t).call(this,e))).executingCommands=new Map,n.cameraInListener=n.onCameraIn.bind(dc(n)),n.cameraOutListener=n.onCameraOut.bind(dc(n)),n.removedListener=n.onRemoved.bind(dc(n)),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vc(e,t)}(t,Hl),n=t,(r=[{key:"enable",value:function(){var e=this.layer.terrain.partition;e.on("cameraIn",this.cameraInListener),e.on("cameraOut",this.cameraOutListener),e.on("removed",this.removedListener)}},{key:"disable",value:function(){var e=this.layer.terrain.partition;e.off("cameraIn",this.cameraInListener),e.off("cameraOut",this.cameraOutListener),e.off("removed",this.removedListener)}},{key:"onCameraIn",value:function(){var e=this.layer.terrain.partition.cameraInNodes,t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.createVisibleNode(o)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"onCameraOut",value:function(){var e=this.layer.terrain.partition.cameraOutNodes,t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.removeVisibleNode(o)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"onRemoved",value:function(){var e=this.layer.terrain.partition.removedNodes,t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.removeVisibleNode(o),o.parentNode&&o.parentNode.isLeaf&&o.parentNode.isInFrustum&&this.createVisibleNode(o.parentNode)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"createVisibleNode",value:function(e){var t=this,n=this.layer;if(e.isLeaf&&n.minLevel<=e.level&&n.maxLevel>=e.level){var r=n.visibleNodes,i=this.executingCommands.get(e),a=r.get(e);if(!i&&!a){var o=n.request(e,function(n){n?t.onLoadingComplete(e,n):t.executingCommands.delete(e)});this.executingCommands.set(e,o)}}else this.removeVisibleNode(e);e.parentNode&&this.removeVisibleNode(e.parentNode)}},{key:"removeVisibleNode",value:function(e){if(!e.isLeaf||!e.isInFrustum){var t=this.executingCommands.get(e);t?(t.cancel(),this.executingCommands.delete(e)):this.layer.visibleNodes.has(e)&&this.layer.visibleNodes.delete(e)}}},{key:"onLoadingComplete",value:function(e,t){this.executingCommands.delete(e),this.layer.addShape(e,t)}}])&&hc(n.prototype,r),i&&hc(n,i),t}();function mc(e){return(mc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function bc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function wc(e){return(wc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Tc(e,t){return(Tc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var xc=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==mc(t)&&"function"!=typeof t?_c(e):t}(this,wc(t).call(this,e))).tempNodes=[],n.parentTableForCreating=new Map,n.childrenTableForRemoving=new Map,n.initializingTilesForCreatingNode=new Map,n.numCandidateChildrenForCreatingNode={},n.forcedVisibleNodes=new Set,n.nodesForCreating=new Set,n.nodesForRemoving=new Set,n.executingCommands=new Map,n.executingCommandsForRemoving=new Map,n.lowRankForCreatingNodes=new Set,n.lowRankForRemovingNodes=new Set,n.createdListener=n.onCreated.bind(_c(n)),n.removedListener=n.onRemoved.bind(_c(n)),n.changedListener=n.onChanged.bind(_c(n)),n.postUpdateListener=n.onPostUpdate.bind(_c(n)),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tc(e,t)}(t,Hl),n=t,(r=[{key:"enable",value:function(){var e=this.layer,t=e.terrain.partition;t.on("created",this.createdListener),t.on("removed",this.removedListener),t.on("changed",this.changedListener),t.on("postUpdate",this.postUpdateListener);var n=e.traverser.leafNodes;if(n.length>0){var r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;u.isInFrustum?this.createContent(u,e.priority):this.tempNodes.push(u)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}var l=!0,c=!1,f=void 0;try{for(var h,p=this.tempNodes[Symbol.iterator]();!(l=(h=p.next()).done);l=!0){var d=h.value;this.createContent(d,"low")}}catch(e){c=!0,f=e}finally{try{l||null==p.return||p.return()}finally{if(c)throw f}}this.tempNodes.length=0}}},{key:"disable",value:function(){var e=this.layer.terrain.partition;e.off("created",this.createdListener),e.off("removed",this.removedListener),e.off("changed",this.changedListener),e.off("postUpdate",this.postUpdateListener)}},{key:"extractVisibleShape",value:function(e){var t=this.layer;if(t.terrain.currentLevel<t.minLevel){var n=!0,r=!1,i=void 0;try{for(var a,o=this.forcedVisibleNodes[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;this.layer.visibleNodes.get(s)&&this.layer.visibleNodes.delete(s)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.forcedVisibleNodes.clear()}else{var u=!0,l=!1,c=void 0;try{for(var f,h=this.initializingTilesForCreatingNode[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var p=gc(f.value,2),d=(p[0],p[1]),v=!0,y=!1,m=void 0;try{for(var g,b=d[Symbol.iterator]();!(v=(g=b.next()).done);v=!0){var w=gc(g.value,2),_=w[0],T=w[1];if(e.checkFrustum(!0),_.isInFrustum){if(t.addShape(_,T),T.extractScene(e)){e.addShape(T);var x=!0,S=!1,k=void 0;try{for(var P,O=T.renderables[Symbol.iterator]();!(x=(P=O.next()).done);x=!0){var E=P.value;e.addRenderable(E)}}catch(e){S=!0,k=e}finally{try{x||null==O.return||O.return()}finally{if(S)throw k}}}t.visibleNodes.delete(_)}}}catch(e){y=!0,m=e}finally{try{v||null==b.return||b.return()}finally{if(y)throw m}}}}catch(e){l=!0,c=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw c}}e.checkFrustum(t.isCheckFrustum);var I=t.traverser.visibleNodes,M=!0,C=!1,R=void 0;try{for(var A,L=t.visibleNodes[Symbol.iterator]();!(M=(A=L.next()).done);M=!0){var D=gc(A.value,2),N=D[0],F=D[1];if(I.has(N)){e.checkFrustum(!1),F.extractScene(e),e.addShape(F);var j=!0,V=!1,B=void 0;try{for(var U,G=F.renderables[Symbol.iterator]();!(j=(U=G.next()).done);j=!0){var H=U.value;e.addRenderable(H)}}catch(e){V=!0,B=e}finally{try{j||null==G.return||G.return()}finally{if(V)throw B}}}else if(this.forcedVisibleNodes.has(N)&&(e.checkFrustum(!0),F.extractScene(e))){e.addShape(F);var z=!0,W=!1,q=void 0;try{for(var Y,X=F.renderables[Symbol.iterator]();!(z=(Y=X.next()).done);z=!0){var K=Y.value;e.addRenderable(K)}}catch(e){W=!0,q=e}finally{try{z||null==X.return||X.return()}finally{if(W)throw q}}}}}catch(e){C=!0,R=e}finally{try{M||null==L.return||L.return()}finally{if(C)throw R}}}}},{key:"onCreated",value:function(){var e=this.layer,t=e.terrain,n=!0,r=!1,i=void 0;try{for(var a,o=t.partition.createdNodes[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.isLeaf&&(s.isInFrustum||s.level===t.currentLevel?this.createContent(s,e.priority):this.lowRankForCreatingNodes.add(s))}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}},{key:"onRemoved",value:function(){var e=this.layer,t=e.terrain,n=t.partition,r=!0,i=!1,a=void 0;try{for(var o,s=n.removedNodes[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value,l=u.parentNode;l&&l.isLeaf&&(l.isInFrustum||l.level===t.currentLevel?this.deleteContent(u,e.priority):this.lowRankForRemovingNodes.add(u))}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},{key:"onPostUpdate",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.lowRankForCreatingNodes[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;this.createContent(a,"low")}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this.lowRankForCreatingNodes.clear();var o=!0,s=!1,u=void 0;try{for(var l,c=this.lowRankForRemovingNodes[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var f=l.value;this.deleteContent(f,"low")}}catch(e){s=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}this.lowRankForCreatingNodes.clear()}},{key:"onChanged",value:function(){var e=this.tempNodes;e.length=0;var t=!0,n=!1,r=void 0;try{for(var i,a=this.parentTableForCreating[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=gc(i.value,2),s=o[0],u=o[1];s.isLeaf||(this.deleteCreatingContentProcessingContent(s,u),e.push(s))}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}var l=!0,c=!1,f=void 0;try{for(var h,p=e[Symbol.iterator]();!(l=(h=p.next()).done);l=!0){s=h.value;this.nodesForCreating.delete(s),this.parentTableForCreating.delete(s)}}catch(e){c=!0,f=e}finally{try{l||null==p.return||p.return()}finally{if(c)throw f}}e.length=0;var d=!0,v=!1,y=void 0;try{for(var m,g=this.childrenTableForRemoving[Symbol.iterator]();!(d=(m=g.next()).done);d=!0){var b=gc(m.value,2),w=b[0];b[1];if(!w.isLeaf){var _=this.executingCommandsForRemoving.get(w);_&&(_.cancel(),this.executingCommandsForRemoving.delete(w)),e.push(w)}}}catch(e){v=!0,y=e}finally{try{d||null==g.return||g.return()}finally{if(v)throw y}}var T=!0,x=!1,S=void 0;try{for(var k,P=e[Symbol.iterator]();!(T=(k=P.next()).done);T=!0){var O=k.value;this.childrenTableForRemoving.delete(O),this.nodesForRemoving.delete(O)}}catch(e){x=!0,S=e}finally{try{T||null==P.return||P.return()}finally{if(x)throw S}}e.length=0}},{key:"createContent",value:function(e,t){var n=this.layer;if(n.visibleNodes.has(e))this.forcedVisibleNodes.has(e)&&this.forcedVisibleNodes.delete(e);else{var r=this.findHoldingNodeForCreating(e);if(r)this.doLoadingForCreatingNode(r,e,t);else if(!this.doLoadingForRemovingNode(e,t)){this.parentTableForCreating.set(e,e),this.nodesForCreating.add(e);var i=n.contentURLs[0](e),a=this.onLoadingCompleteForCreating(e),o=n.contentManager.load(i,n.contentTypes[0],t,a);this.executingCommands.set(e,o)}}}},{key:"findHoldingNodeForCreating",value:function(e){for(var t=this.layer,n=e.parentNode;n;){if(t.visibleNodes.has(n))return this.forcedVisibleNodes.has(e)&&this.forcedVisibleNodes.delete(e),n;n=n.parentNode}return null}},{key:"findHoldingNodeForRemovingNode",value:function(e,t){if(e)if(this.layer.visibleNodes.has(e))t.add(e),this.forcedVisibleNodes.add(e);else if(!e.isLeaf&&e.childNodes){var n=!0,r=!1,i=void 0;try{for(var a,o=e.childNodes[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;this.findHoldingNodeForRemovingNode(s,t)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}}},{key:"doLoadingForCreatingNode",value:function(e,t,n){this.initializingTilesForCreatingNode.has(e)||this.initializingTilesForCreatingNode.set(e,new Map),e in this.numCandidateChildrenForCreatingNode==!1&&(this.numCandidateChildrenForCreatingNode[e]=0),this.numCandidateChildrenForCreatingNode[e]+=1,this.parentTableForCreating.set(t,e),this.nodesForCreating.add(t);var r=this.layer,i=r.contentURLs[0](t),a=this.onLoadingCompleteForCreating(t),o=r.contentManager.load(i,r.contentTypes[0],n,a);this.executingCommands.set(t,o)}},{key:"doLoadingForRemovingNode",value:function(e,t){if(this.childrenTableForRemoving.has(e))return!0;var n=new Set;if(e.childNodes){var r=!0,i=!1,a=void 0;try{for(var o,s=e.childNodes[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;this.findHoldingNodeForRemovingNode(u,n)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}var l=this.layer;if(0!==n.size){this.nodesForRemoving.add(e),this.childrenTableForRemoving.set(e,n);var c=l.contentURLs[0](e),f=this.onLoadingCompleteForRemoving(e),h=l.contentManager.load(c,l.contentTypes[0],t,f);return this.executingCommandsForRemoving.set(e,h),!0}return this.forcedVisibleNodes.has(e)&&this.forcedVisibleNodes.delete(e),!1}},{key:"deleteContent",value:function(e,t){var n=e.parentNode,r=this.layer;if(!r.visibleNodes.has(n)&&!this.doLoadingForRemovingNode(n,t)&&!this.parentTableForCreating.has(n)){var i=this.findHoldingNodeForCreating(n);if(i)this.doLoadingForCreatingNode(i,n,t);else if(n.isLeaf){this.parentTableForCreating.set(n,n),this.nodesForCreating.add(n);var a=r.contentURLs[0](n),o=this.onLoadingCompleteForCreating(n),s=r.contentManager.load(a,r.contentTypes[0],t,o);this.executingCommands.set(n,s)}}}},{key:"deleteCreatingContentProcessingContent",value:function(e,t){var n=this.executingCommands.get(e);if(e===t)n&&(n.cancel(),this.executingCommands.delete(e));else if(n){if(n.cancel(),this.executingCommands.delete(e),0===(this.numCandidateChildrenForCreatingNode[t]-=1)){delete this.numCandidateChildrenForCreatingNode[t];var r=this.initializingTilesForCreatingNode.get(t);r&&0===r.size&&this.initializingTilesForCreatingNode.delete(t)}}else if(this.initializingTilesForCreatingNode.has(t)){var i=this.initializingTilesForCreatingNode.get(t);i.has(e)&&i.delete(e),0===i.size&&this.initializingTilesForCreatingNode.delete(t)}}},{key:"deleteRemovingNodeContentProcessingContent",value:function(e){var t=this.executingCommandsForRemoving.get(e);t&&(t.cancel(),this.executingCommandsForRemoving.delete(e))}},{key:"onLoadingCompleteForCreating",value:function(e){var t=this;return function(n){var r=t.executingCommands.get(e);if(r){var i=n;if(!r.isCanceled()){var a=t.parentTableForCreating.get(e);if(e!==a){var o=t.initializingTilesForCreatingNode.get(a);if(!o)return;o.set(e,i),0===(t.numCandidateChildrenForCreatingNode[a]-=1)&&(t.onCompleteCreatingChildren(a,o),t.initializingTilesForCreatingNode.delete(a),delete t.numCandidateChildrenForCreatingNode[a])}else t.parentTableForCreating.delete(e),t.nodesForCreating.delete(e),t.layer.addShape(e,i)}t.executingCommands.delete(e)}}}},{key:"onLoadingCompleteForRemoving",value:function(e){var t=this;return function(n){var r=t.executingCommandsForRemoving.get(e);if(r){var i=n;if(!r.isCanceled()){var a=t.childrenTableForRemoving.get(e),o=!0,s=!1,u=void 0;try{for(var l,c=a[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var f=l.value;t.forcedVisibleNodes.delete(f),t.layer.visibleNodes.delete(f)}}catch(e){s=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}t.layer.addShape(e,i),t.childrenTableForRemoving.delete(e),t.nodesForRemoving.delete(e)}t.executingCommandsForRemoving.delete(e)}}}},{key:"onCompleteCreatingChildren",value:function(e,t){var n=this.layer;n.visibleNodes.has(e)&&n.visibleNodes.delete(e);var r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=gc(o.value,2),l=u[0],c=u[1];this.layer.addShape(l,c);var f=this.parentTableForCreating.get(l);this.parentTableForCreating.delete(f),this.nodesForCreating.delete(l)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}}])&&bc(n.prototype,r),i&&bc(n,i),t}();function Sc(e){return(Sc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pc(e,t){return!t||"object"!==Sc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Oc(e){return(Oc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ec(e,t){return(Ec=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ic=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Pc(this,Oc(t).call(this,"shape_pick","shape_added","shape_removed","shape_error","all_shape_removed"))).name=e,r.type=n,r.contentManager=null,r.contentTypes=[],r.contentURLs=[],r.terrain=null,r.collector=new En(3e3),r.traverser=null,r.strategy=null,r.priority=0,r.minLevel=0,r.maxLevel=14,r.visibleNodes=new Map,r.visible=!0,r.clickable=!0,r.isCheckFrustum=!0,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ec(e,t)}(t,E),n=t,(r=[{key:"setVisible",value:function(e){this.visible="boolean"!=typeof e||e}},{key:"setCheckFrustum",value:function(e){"boolean"==typeof e&&(this.isCheckFrustum=e)}},{key:"setClickable",value:function(e){this.clickable="boolean"!=typeof e||e}},{key:"getName",value:function(){return this.name}},{key:"setVisibleLevel",value:function(e,t){this.minLevel=isNaN(e)?this.terrain.minLevel:e,this.maxLevel=isNaN(t)?this.terrain.maxLevel:t}},{key:"addShape",value:function(e,t){this.visibleNodes.set(e,t)}},{key:"getShape",value:function(e){return this.visibleNodes.get(e)}},{key:"removeShape",value:function(e){this.visibleNodes.delete(e)}},{key:"clearShape",value:function(){this.visibleNodes.clear()}},{key:"request",value:function(e,t){var n=this.contentURLs[0](e),r=this.contentTypes[0];return this.contentManager.load(n,this.name,r,this.priority,t)}},{key:"extractVisibleShape",value:function(e){this.visible&&this.strategy.extractVisibleShape(e)}}])&&kc(n.prototype,r),i&&kc(n,i),t}();function Mc(e){return(Mc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Cc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rc(e,t){return!t||"object"!==Mc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ac(e){return(Ac=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Lc(e,t){return(Lc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Dc=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Rc(this,Ac(t).call(this,e,n))).shapeTable=new Map,r.animatedShapeList=[],r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Lc(e,t)}(t,Ic),n=t,(r=[{key:"getShape",value:function(e){return this.shapeTable.get(e)}},{key:"addShape",value:function(e,t){var n=new Lo;if(!t)return this.dispatch("shape_error"),n;this.shapeTable.has(e)&&this.removeShape(e);var r=this.terrain.geometry.getGeometry("preview_geometry"),i=n.createMesh();i.vertexBuffer=r.vertexBuffer,i.indexBuffer=r.indexBuffer;var a=n.createMaterial();a.addTexture(va.DIFFUSE,t),a.setDiffuseColor(0,0,0,1);var o=n.createRenderable(i,a);o.indexLength=y[e.level],o.indexOffset=0,this.shapeTable.set(e,n);var s=this.strategy.getPreviewData(e),u=s.position,l=s.rotation;return It(n.position,u),zt(n.orientation,l),n.updateTransform(),this.visibleNodes.set(e,n),0===this.animatedShapeList.length&&(this.animatedShapeList[0]=n),this.dispatch("shape_added"),n}},{key:"removeShape",value:function(e){this.visibleNodes.delete(e);var t=this.shapeTable.get(e);if(this.clearShapeTexture(t),this.shapeTable.delete(e),this.animatedShapeList.length>0){var n=this.animatedShapeList.indexOf(t);n>-1&&this.animatedShapeList.splice(n,1)}this.dispatch("shape_removed")}},{key:"clearShape",value:function(){var e=this;this.shapeTable.forEach(function(t){e.clearShapeTexture(t)}),this.shapeTable.clear(),this.visibleNodes.clear(),this.animatedShapeList.length=0,this.dispatch("all_shape_removed")}},{key:"clearShapeTexture",value:function(e){var t=e.materialPool[0];if(t){var n=t.getTexture(va.DIFFUSE);n&&(n.reset(),n.handle=null,t.addTexture(va.DIFFUSE,null))}}},{key:"request",value:function(e,t,n){var r=this.strategy.getPreviewData(e),i=r.panoId,a=r.imagePathPrefix,o=r.imagePathPreviewKey,s=this.contentURLs[0](i,a,o,t),u=this.contentTypes[0];return this.contentManager.load(s,this.name,u,this.priority,n)}}])&&Cc(n.prototype,r),i&&Cc(n,i),t}();function Nc(e){return(Nc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function jc(e,t){return!t||"object"!==Nc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Vc(e){return(Vc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Bc(e,t){return(Bc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Uc=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=jc(this,Vc(t).call(this,e,n))).shapeTable=new Map,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bc(e,t)}(t,Ic),n=t,(r=[{key:"getShape",value:function(e){return this.shapeTable.get(e)}},{key:"addShape",value:function(e,t){if(t){var n=this.terrain,r=n.geometry.getGeometry(e.key),i=t.meshPool[0];i.vertexBuffer=r.vertexBuffer,i.indexBuffer=r.indexBuffer;var a=t.renderables[0];a.indexLength=y[e.level],a.indexOffset=0,this.shapeTable.set(e,t);var o=n.getPanoramaInfo().getPosition(),s=n.getPanoramaInfo().getRotation();It(t.position,o),zt(t.orientation,s),t.updateTransform(),this.visibleNodes.set(e,t),this.dispatch("shape_added")}else this.dispatch("shape_error")}},{key:"removeShape",value:function(e){this.visibleNodes.delete(e),this.shapeTable.delete(e),this.dispatch("shape_removed")}},{key:"clearShape",value:function(){var e=this;this.shapeTable.forEach(function(t){e.clearShapeTexture(t)}),this.visibleNodes.clear(),this.shapeTable.clear(),this.dispatch("all_shape_removed")}},{key:"clearShapeTexture",value:function(e){var t=e.materialPool[0];if(t){var n=t.getTexture(va.DIFFUSE);n&&(n.reset(),n.handle=null,t.addTexture(va.DIFFUSE,null))}}},{key:"request",value:function(e,t){var n=this.terrain.getPanoramaInfo().getPanoramaRawData(),r=n.imagePath,i=n.imagePathKey,a=this.contentURLs[0](e,r,i,e.level===this.terrain.maxLevel),o=this.contentTypes[0];return this.contentManager.load(a,this.name,o,this.priority,t)}}])&&Fc(n.prototype,r),i&&Fc(n,i),t}();function Gc(e){return(Gc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zc(e,t){return!t||"object"!==Gc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Wc(e){return(Wc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qc(e,t){return(qc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Yc=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=zc(this,Wc(t).call(this,e,n))).isCheckFrustum=!0,r.commonTileIndexBuffer=null,r.commonTileVertexBuffer=null,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qc(e,t)}(t,Ic),n=t,(r=[{key:"addShape",value:function(e,t){var n=t,r=this.terrain,i=r.getTilePosition(e.level,e.row,e.col),a=r.getTileScale(e.level);n&&(It(n.position,i),It(n.scale,a),n.updateTransform(),this.visibleNodes.set(e,n))}}])&&Hc(n.prototype,r),i&&Hc(n,i),t}();function Xc(e){return(Xc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Kc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zc(e,t){return!t||"object"!==Xc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qc(e){return(Qc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Jc(e,t){return(Jc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $c=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Zc(this,Qc(t).call(this,e,n))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jc(e,t)}(t,Ic),n=t,(r=[{key:"addShape",value:function(e,t){this.visibleNodes.set(e,t)}}])&&Kc(n.prototype,r),i&&Kc(n,i),t}();function ef(e){return(ef="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nf(e,t){return!t||"object"!==ef(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function rf(e){return(rf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function af(e,t){return(af=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var of=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=nf(this,rf(t).call(this,e,n))).shapeList=new Set,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&af(e,t)}(t,Ic),n=t,(r=[{key:"addShape",value:function(e,t){this.removeShape(e),this.visibleNodes.set(e,t),this.shapeList.add(t)}},{key:"removeShape",value:function(e){var t=this.visibleNodes.get(e);this.shapeList.has(t)&&(this.shapeList.delete(t),this.visibleNodes.delete(e))}},{key:"clearShape",value:function(){this.shapeList.clear(),this.visibleNodes.clear()}},{key:"getShape",value:function(e){var t=this.visibleNodes.get(e);return this.shapeList.has(t)?t:null}},{key:"extractVisibleShape",value:function(e){if(this.visible){e.checkFrustum(this.isCheckFrustum);var t=!0,n=!1,r=void 0;try{for(var i,a=this.shapeList[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(o.extractScene(e)){e.addShape(o);var s=!0,u=!1,l=void 0;try{for(var c,f=o.renderables[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=c.value;e.addRenderable(h)}}catch(e){u=!0,l=e}finally{try{s||null==f.return||f.return()}finally{if(u)throw l}}}}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}}}])&&tf(n.prototype,r),i&&tf(n,i),t}();function sf(e){return(sf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function uf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function lf(e,t){return!t||"object"!==sf(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function cf(e){return(cf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ff(e,t){return(ff=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var hf=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=lf(this,cf(t).call(this,e,n))).containerTable=new Map,r.invalidate=!0,r.movedCamera=!1,r.needRenderAtNextFrame=!1,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ff(e,t)}(t,Ic),n=t,(r=[{key:"addShape",value:function(e,t){this.removeShape(e),this.visibleNodes.set(e,t),this.containerTable.set(t)}},{key:"removeShape",value:function(e){var t=this.visibleNodes.get(e);t&&this.containerTable.has(t)&&(e.level-1<=this.terrain.currentLevel&&this.labelManager.exitShape(t),this.containerTable.remove(t)),this.invalidate=!0}},{key:"extractVisibleLabels",value:function(e){if(this.collector.reset(),this.moveCamera||this.invalidate){this.strategy.extractVisibleShape(this.collector.get());var t=!0,n=!1,r=void 0;try{for(var i,a=this.collector.getShapes()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.containerTable.has(o)&&o.extractVisibleLabels(e)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}}},{key:"extractVisibleShape",value:function(e){this.collector.reset(),this.visible}}])&&uf(n.prototype,r),i&&uf(n,i),t}(),pf=n(89),df=n.n(pf);function vf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var yf=Math.sin,mf=Math.cos,gf=Math.PI,bf=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=a,this.panoId=null,this.imagePath=null,this.imagePathKey=null,this.imagePathPrefix=null,this.imagePathPreviewKey=null,this.address=null,this.northAngle=0,this.northAngleRad=0,this.position=Et([]),this.rotation=Ht([]),this.date=Date.now(),this.dateYear=null,this.stName=null,this.stType=null,this.areaType=null,this.isUnderpass=!1,this.spots=[],this.spotKeyCheckTable=new Map,this.pastIdList=[],this.pastTable=new Map,this.availablePasts=[],this.isDummy=!1}var t,n,r;return t=e,r=[{key:"Create",value:function(t){var n=null,r=t.street_view;if(r&&parseInt(r.cnt,10)>0&&r.street){var i=r.street,a=i,o=i.spot,s=i.past;if((n=e.CreateDefaultStreet(a)).address=a.addr,n.stName=a.st_name||null,n.stType=a.st_type&&"null"!==a.st_type?a.st_type:null,n.areaType=a.area_type||null,n.isUnderpass="underpass"===n.areaType,o)for(var u,l=0;u=o[l];++l){var f=parseInt(u.id,10),h=-parseFloat(u.pan),p=h*_t,d=wf(p),v=c[d],y=c[d+1],m=u.st_name||"",g=u.shot_tool||null;n.spotKeyCheckTable.has(v)?n.spotKeyCheckTable.set(v,n.spotKeyCheckTable.get(v)+1):n.spotKeyCheckTable.set(v,1);var b=Mt([],mf(p+gf/2),yf(p+gf/2),0),w=It([],n.position);n.spots.push({repeatCount:n.spotKeyCheckTable.get(v),panoId:f,angle:h,angleRad:p,direction:b,position:w,dirname:v,dirnameKo:y,stName:m,northAngle:n.northAngle,northAngleRad:n.northAngleRad,shotTool:g})}if(s){for(var _,T={},x=0;_=s[x];++x){var S=e.CreateDefaultPastStreet(a,_);n.pastIdList.push(S.panoId),T[S.panoId]=S}n.pastIdList.sort(function(e,t){var n=T[e].date,r=T[t].date;return n>r?1:n<r?-1:0}),n.pastIdList.forEach(function(e){n.pastTable.set(e,T[e])})}else{var k=e.CreateDefaultPastStreet(a,null);n.pastIdList.push(k.panoId),n.pastTable.set(k.panoId,k)}n.availablePasts=n.pastIdList.map(function(e){var t=n.pastTable.get(e);if(!t.isDummy)return{panoId:t.panoId,date:t.date}}).filter(function(e){return e})}return n}},{key:"CreateDefaultStreet",value:function(t){var n=new e;n.panoId=parseInt(t.id,10),n.imagePath=t.img_path.substr(1);var r=n.imagePath.split("/");n.imagePathKey=r.pop(),n.imagePathPrefix=r.join("/"),n.imagePathPreviewKey=n.imagePathKey.substr(1),n.northAngle=-parseFloat(t.angle),n.northAngleRad=n.northAngle*_t,n.date=t.shot_date,n.shotTool=t.shot_tool||null;try{n.dateYear=parseInt(n.date.split(" ")[0].split("-")[0],10)}catch(e){n.dateYear=""}var i=parseFloat(t.wtmx),a=parseFloat(t.wtmy);return Mt(n.position,i,a,3),Wt(n.rotation,n.northAngleRad),n.isDummy=!1,n}},{key:"CreateDefaultPastStreet",value:function(t,n){var r=e.CreateDefaultStreet(t);if(n){r.panoId=parseInt(n.id,10),r.imagePath=n.img_path.substr(1);var i=r.imagePath.split("/");r.imagePathKey=i.pop(),r.imagePathPrefix=i.join("/"),r.imagePathPreviewKey=r.imagePathKey.substr(1),r.northAngle=-parseFloat(n.angle),r.northAngleRad=r.northAngle*_t,r.date=n.shot_date,r.shotTool=n.shot_tool||null;try{r.dateYear=parseInt(r.date.split(" ")[0].split("-")[0],10)}catch(e){r.dateYear=""}Wt(r.rotation,r.northAngleRad),r.isDummy=!1}else r.isDummy=!0;return r}}],(n=[{key:"getDataType",value:function(){return this.type}},{key:"getNextPanoIdByDirection",value:function(e){var t=null,n=this.spots,r=-1/0,i=!0,a=!1,o=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=Dt(e,l.direction);r<c&&(r=c,t=l)}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}return t?t.panoId:null}},{key:"getPastStreet",value:function(e){var t=this.pastTable.get(e);return t||null}},{key:"getPastStreetIndex",value:function(e){return xt(this.pastIdList.indexOf(e),0,this.pastIdList.length-1)}},{key:"getPastPanoId",value:function(e,t){if(0===this.pastIdList.length)return null;for(var n=e,r=null;!(r=this.pastIdList[n])&&n>0;)n=0===n?0:n-1;if(!t)return r;if(t===this.pastTable.get(r).dateYear)return r;for(var i=xt(n-3,0,n),a=xt(n+3,n,this.pastIdList.length-1),o=!1,s=i;s<=a;++s){var u=this.pastIdList[s];if(this.pastTable.get(u).dateYear===t){r=u,o=!0;break}}if(!o)for(var l=99999,c=i;c<=a;++c){var f=this.pastIdList[c],h=this.pastTable.get(f),p=Math.abs(parseInt(h.dateYear,10)-parseInt(t,10));l>p&&(r=f,l=p)}return r}},{key:"getPastList",value:function(){return this.availablePasts}}])&&vf(t.prototype,n),r&&vf(t,r),e}();function wf(e){var t=180*St(e)/Math.PI,n=c.length/8;return t+=22.5,t/=45,(t=Math.floor(t)*n)%c.length}function _f(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Tf(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Sf(e,t,n){return t&&xf(e.prototype,t),n&&xf(e,n),e}var kf=Math.PI/2,Pf="UP",Of="DOWN",Ef={20:Pf,25:Of,30:"OUT",35:"IN",50:"NORMAL",10:"OTHER",0:"NONE"},If=[];!function(){for(var e=0;e<37;++e)If.push(0)}();var Mf=function(){function e(){Tf(this,e),this.type=o,this.storeId=null,this.place=null,this.address=null,this.cid=null,this.date=null,this.position=null,this.originPosition=null,this.allSpots={},this.maps={},this.menus={},this.menuTree=[],this.currentPanoId=null,this.savedInitPanoId=null,this.currentSpot=null,this.baseSpot=null,this.maxTiltStep=2,this.maxDistOrder=5,this.readyStoreDataInSpot=new Map,this.prevMapId=null}return Sf(e,[{key:"setCurrentPanoId",value:function(e){this.currentPanoId=parseInt(e||this.savedInitPanoId,10);var t=this.readyStoreDataInSpot.get(this.currentPanoId);return t||(t=this._makeStoreDataInSpot(),this.readyStoreDataInSpot.set(this.currentPanoId,t),this.prevMapId!==t.mapId&&(this.prevMapId=t.mapId,Mt(t.position,this.position[0],this.position[1],this.position[2]+3*t.minimapPosition[2]))),t._calculated=!1,t.calcRelativeSpots(),this}},{key:"_makeStoreDataInSpot",value:function(){var e=new Cf;this.currentSpot=this.allSpots[this.currentPanoId],this.currentSpot.isWarp&&(this.currentSpot=this.allSpots[this.currentSpot.linkStorePanoId]);var t=this.currentSpot,n=t.mapId,r=this.maps[n];return e.spots=r.spots.filter(function(e){return e.storePanoId!==t.storePanoId}),It(e.minimapOriginPosition,t.minimapOriginPosition),It(e.minimapPosition,t.minimapPosition),It(e.originPosition,this.originPosition),e.type=this.type,e.storePanoId=t.storePanoId,e.storeId=this.storeId,e.savedInitPanoId=this.savedInitPanoId,e.imagePath=t.imagePath,e.imagePathKey=t.imagePathKey,e.imagePathPrefix=t.imagePathPrefix,e.imagePathPreviewKey=t.imagePathPreviewKey,e.outdoorFlag=t.outdoorFlag,e.place=this.place,e.address=this.address,e.cid=this.cid,e.date=this.date,e.northAngle=r.northAngle,e.northAngleRad=r.northAngleRad,e.pan=t.viewPan,e.tilt=t.viewTilt,e.direction=t.viewDirection,e.position=t.position,e.rotation=r.rotation,e.map=r,e.menu=this.menus[t.mapId],e.mapId=t.mapId,e.menus=this.menus,e.menuTree=this.menuTree,e.maps=this.maps,e.mapsArray=this.mapsArray,e.maxTiltStep=this.maxTiltStep,e.maxDistOrder=this.maxDistOrder,e.allSpots=this.allSpots,e}},{key:"getData",value:function(){return this.readyStoreDataInSpot.get(this.currentPanoId)}}],[{key:"Create",value:function(t){if(!t)return null;var n=new e,r=t.storeview;n.storeId=r.vId,n.cid=r.confirmId,n.place=r.placeFullName,n.address=r.addrFullName,n.maxTiltStep=parseInt(r.line_cnt,10),n.maxDistOrder=parseInt(r.max_node_cnt,10),n.date=r.regDate,n.position=Mt([],ds(parseFloat(r.wcongX)),ds(parseFloat(r.wcongY)),0),n.originPosition=Mt([],ds(parseFloat(r.wcongX)),ds(parseFloat(r.wcongY)),0),n.maps={},n.mapsArray=[],r.map.item.forEach(function(e){var t=n.maps[parseInt(e.mapId,10)]={};t.mapId=parseInt(e.mapId,10),t.northAngle=-parseFloat(e.pan),t.northAngleRad=t.northAngle*_t,t.rotation=Wt([],t.northAngleRad),t.label=e.label,t.minimapPath=e.mapImage.substr(1),t.minimapSize={minX:9999,minY:9999,maxX:-9999,maxY:-9999,width:0,height:0},t.pixelPerMeter=parseInt(e.pixelPerMeter,10),t.pixelPerMeter=t.pixelPerMeter?t.pixelPerMeter:5,t.spots=[],t.seq=0,n.mapsArray.push(t)}),n.menus={},n.menuTree=[];var i=r.menu.item;!function e(t,n,r,i){n&&n.forEach(function(n){var a={};a.mapId=n.mapId?parseInt(n.mapId,10):null,a.label=n.label,a.description=n.description,a.childs=[],a.panoSpots=[],a.isLeaf=!1,a.parent=i,a.mapId&&(t.menus[a.mapId]=a);var o=n.item;o?(r.push(a),e(t,o,a.childs,a)):(a.isLeaf=!0,r.push(a))})}(n,i,n.menuTree,null),n.panoSpots=[],n.warpSpots=[],n.allSpots={};var a=r.spot.item;for(var o in a.forEach(function(e){var t=n.allSpots[parseInt(e.storePanoId,10)]={};if(t.storeId=n.storeId,t.storePanoId=parseInt(e.storePanoId,10),t.type=e.type,t.mapId=parseInt(e.mapId,10),t.isWarp="warp"===t.type,t.isWarp)t.linkStorePanoId=parseInt(e.linkStorePanoId,10),t.storePanoId=t.linkStorePanoId,t.linkStoreEffect=e.linkStoreEffect,t.warpEffect=Ef[t.linkStoreEffect],t.connectedSpot=null,t.label=e.label+" 이동",n.warpSpots.push(t);else{t.order=parseInt(e.order,10),t.label=e.label,t.imagePath=e.img_path.substr(1);var r=t.imagePath.split("/");t.imagePathKey=r.pop(),t.imagePathPrefix=r.join("/"),t.imagePathPreviewKey=t.imagePathKey,t.outdoorFlag="Y"===e.outdoorFlag,n.panoSpots.push(t),n.menus[t.mapId]&&n.menus[t.mapId].panoSpots.push(t)}var i=n.maps[t.mapId];t.minimapOriginPosition=Mt([],parseFloat(e.x),parseFloat(e.y),0),t.minimapPosition=Mt([],parseFloat(e.x)/i.pixelPerMeter,parseFloat(e.y)/i.pixelPerMeter,0),t.minimapDirection=Et([]),t.minimapDistance=0,t.relativeDirection=Et([]),t.relativePan=0,t.relativeTilt=0,t.relativeDistance=0,t.relativeDistanceOrder=0,t.relativeTiltStep=0,t.worldPosUpdated=!1,t.position=Et([]),t.direction=Et([]),t.viewPan=-parseFloat(e.pan),t.viewTilt=parseFloat(e.tilt)+90,t.viewPanRad=t.viewPan*_t,t.viewTiltRad=t.viewTilt*_t,t.viewDirection=Et([]);var a=Math.cos(t.viewPanRad+kf),o=Math.sin(t.viewPanRad+kf),s=90-parseFloat(e.tilt),u=Math.cos(s*_t),l=Math.sin(s*_t);Mt(t.viewDirection,a*l,o*l,u),t.zoom=parseInt(e.zoom,10),t.infoTagFlag=e.infoTagFlag,i.spots.push(t),i.minimapSize.maxX=Math.max(i.minimapSize.maxX,t.minimapPosition[0]),i.minimapSize.maxY=Math.max(i.minimapSize.maxY,t.minimapPosition[1]),i.minimapSize.minX=Math.min(i.minimapSize.minX,t.minimapPosition[0]),i.minimapSize.minY=Math.min(i.minimapSize.minY,t.minimapPosition[1])}),n.maps)if(n.maps.hasOwnProperty(o)){var s=n.maps[o];s.minimapSize.width=Math.abs(s.minimapSize.minX)+Math.abs(s.minimapSize.maxX),s.minimapSize.height=Math.abs(s.minimapSize.minY)+Math.abs(s.minimapSize.maxY)}for(var u in n.allSpots)if(n.allSpots.hasOwnProperty(u)){var l=n.allSpots[u],c=n.maps[l.mapId];l.minimapPosition[0]=l.minimapPosition[0],l.minimapPosition[1]=c.minimapSize.height-l.minimapPosition[1]}n.warpSpots.forEach(function(e){var t=e.mapId,r=n.allSpots[e.linkStorePanoId].mapId,i=n.maps[t],a=n.maps[r];e.warpEffect===Pf?a.seq=i.seq+1:e.warpEffect===Of?a.seq=i.seq-1:a.seq=i.seq}),n.currentPanoId=parseInt(a[0].storePanoId,10),n.savedInitPanoId=n.currentPanoId,n.mapsArray.sort(function(e,t){return e.seq-t.seq});var f=n.mapsArray[0].seq;return n.mapsArray.forEach(function(e){e.seq-=f,e.spots.forEach(function(t){return t.minimapPosition[2]=e.seq})}),n}}]),e}(),Cf=function(){function e(){Tf(this,e),this.type=o,this.storePanoId=null,this.storeId=null,this.savedInitPanoId=null,this.imagePath=null,this.imagePathKey=null,this.imagePathPrefix=null,this.imagePathPreviewKey=null,this.outdoorFlag=!1,this.place=null,this.address=null,this.cid=null,this.northAngle=0,this.northAngleRad=0,this.pan=null,this.tilt=null,this.direction=null,this.position=Et([]),this.rotation=Ht([]),this.originPosition=Et([]),this.minimapPosition=Et([]),this.minimapOriginPosition=Et([]),this.maxDistance=u,this.spots=null,this.map=null,this.menu=null,this.maxTiltStep=0,this.maxDistOrder=0,this.allSpots=null,this.mapId=null,this.menuTree=null,this.maps=null,this.mapsArray=null,this._warpSpots=[],this._panoSpots=[],this._calculated=!1}return Sf(e,[{key:"getDataType",value:function(){return this.type}},{key:"calcRelativeSpots",value:function(){var e,t=this;if(!this._calculated){this.spots.forEach(function(e){if(e.minimapDistance=Math.min(jt(e.minimapPosition,t.minimapPosition),2*u),e.minimapDirection=Vt([],Rt([],e.minimapPosition,t.minimapPosition)),e.position=Et([]),Ct(e.position,Lt(e.position,It(e.position,e.minimapDirection),e.minimapDistance),t.position),e.position[2]=3*e.minimapPosition[2],e.isWarp){var n=e.connectedSpot=t.allSpots[e.linkStorePanoId];It(n.position,e.position),n.position[2]=3*n.minimapPosition[2]}e.relativeTiltStep=0}),If.fill(0),this._warpSpots.length=this._panoSpots.length=0,this.spots.forEach(function(e){var n=Vt([],Rt(e.relativeDirection,e.minimapPosition,t.minimapPosition));It(e.direction,n),e.relativeDistance=jt(e.minimapPosition,t.minimapPosition),e.relativePan=-(gt-St(Math.atan2(n[1],n[0])))*Tt,t.maxDistance=Math.ceil(Math.max(t.maxDistance,e.relativeDistance)),e.isWarp?t._warpSpots.push(e):t._panoSpots.push(e)}),this._warpSpots.sort(function(e,t){return e.relativeDistance-t.relativeDistance}),this._panoSpots.sort(function(e,t){return e.relativeDistance-t.relativeDistance}),this._warpSpots.forEach(function(e,t){e.relativeDistanceOrder=t}),this._panoSpots.forEach(function(e,t){e.relativeDistanceOrder=t}),this.spots.length=0,(e=this.spots).push.apply(e,_f(this._warpSpots).concat(_f(this._panoSpots)));var n=0,r=0,i=0,a=0;this.spots.forEach(function(e){i=Math.round(kt(e.relativePan)/10),37===(r=i+1)&&(r=0),(n=i-1)<0&&(n=36),a=If[r]>If[n]?If[r]:If[n];var t=If[i]+a;e.relativeTiltStep+=t,If[i]++}),this._calculated=!0}}},{key:"getMenu",value:function(){return{menu:this.menu,tree:this.menuTree,list:this.menus}}},{key:"getMiniMap",value:function(){return this.map}}]),e}();function Rf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Af,Lf,Df=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isEmpty=!1,this.panoId=t.panoId,this.position=t.position,this.northAngle=t.northAngle,this.stName=t.stName,this.stType=t.stType,this.areaType=t.areaType,this.range={},t.spots.forEach(function(e){n.range[e.dirname]={angle:e.angle,dir:e.direction,dirname:e.dirname,dirnameKo:e.dirnameKo,nodes:[]}}),this.count=0}var t,n,r;return t=e,r=[{key:"Create",value:function(t,n){if(!n)return null;var r=new e(t),i=n.street_view;return r.count=parseInt(i.cnt,10)-1,-1===r.count?(r.isEmpty=!0,r):(i.streetList.slice(1).forEach(function(e){var t=e,n=e.spot,i=parseFloat(t.wtmx),a=parseFloat(t.wtmy),o=Math.sqrt(Math.pow(a-r.position[1],2)+Math.pow(i-r.position[0],2));if(0!==o){var s=t.st_type||null;if(null===r.stType||null!==s){var u=Mt([],i-r.position[0],a-r.position[1],0),l=function(e,t,n){var r=St(n*_t),i=gt-r;Af=[Math.cos(i),-Math.sin(i),0,0,Math.sin(i),Math.cos(i),0,0,0,0,1,0,0,0,0,1],Ce(Nf,Af),Bt(It(Ff,t),Ff,Af);var a=Math.abs(Ff[0]),o=Math.abs(Ff[1]);return Mt(jf,1.3/Math.cos(a/60),1.05/Math.cos(o/60)+.006*a,0),Lf=[Math.abs(jf[0]),0,0,0,0,Math.abs(jf[1]),0,0,0,0,1,0,0,0,0,1],Bt(Ff,Ff,Lf),Bt(Ff,Ff,Nf),Mt([],e[0]+Ff[0],e[1]+Ff[1],0)}(r.position,u,r.northAngle),f=-parseFloat(t.angle),h=f*_t,p=Wt([],h),d=Vt([],It([],u));for(var v in r.range)if(r.range.hasOwnProperty(v)){var y=r.range[v];Dt(d,y.dir)>=0&&function(){var e=new bf;e.panoId=parseInt(t.id,10),e.northAngle=f,e.northAngleRad=h,e.imagePath=t.img_path;var r=e.imagePath.split("/");e.imagePathKey=r.pop(),e.imagePathPrefix=r.join("/"),e.imagePathPreviewKey=e.imagePathKey.substr(1),e.rotation=p,e.markPosition=l,e.position=[i,a,0],e.distance=o,e.direction=d,e.stName=t.st_name||null,e.stType=t.st_type||null,e.areaType=t.area_type||null,e.isUnderpass="underpass"===e.areaType,e.dirname=y.dirname,e.dirnameKo=y.dirnameKo,n&&n.forEach(function(t){var n=parseInt(t.id,10),r=-parseFloat(t.pan),i=r*_t,a=Mt([],Math.cos(i+gt),Math.sin(i+gt),0),o=Vf(parseInt(t.pan,10)*_t),s=c[o],u=c[o+1],f=It([],l),h=t.st_name||null;e.spots.push({panoId:n,angle:r,angleRad:i,direction:a,position:f,dirname:s,dirnameKo:u,stName:h,northAngle:e.northAngle,northAngleRad:e.northAngleRad,altitude:e.altitude})}),y.nodes.push(e)}()}}}}),r)}}],(n=[{key:"getSpotList",value:function(e){return this.range[e]}}])&&Rf(t.prototype,n),r&&Rf(t,r),e}(),Nf=Oe([]),Ff=Et([]),jf=Et([]);function Vf(e){var t=180*St(e)/Math.PI,n=c.length/8;return t+=22.5,t/=45,(t=Math.floor(t)*n)%c.length}function Bf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Uf=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.position=t,this.nodeList=[],this.count=0}var t,n,r;return t=e,r=[{key:"Create",value:function(t,n,r){var i=new e(Mt([],t,n,0)),a=r.street_view;if(i.count=parseInt(a.cnt,10)-1,-1===i.count)return i.isEmpty=!0,i;var o=a.streetList.slice(1);return i.nodeList=o.map(function(e){var t=e,n=parseFloat(t.wtmx),r=parseFloat(t.wtmy),a=Math.sqrt(Math.pow(r-i.position[1],2)+Math.pow(n-i.position[0],2)),o=t.area_type||null,s="underpass"===o;return{panoId:t.id,areaType:o,dist:a,isUnderpass:s,position:Mt([],n,r,0)}}),i.nodeList.sort(function(e,t){return e.dist-t.dist}),i}}],(n=null)&&Bf(t.prototype,n),r&&Bf(t,r),e}();function Gf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Hf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var zf=function(){},Wf=64,qf=32,Yf=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderView=t,this.streetTable=new ee({maxCacheSize:Wf}),this.storeTable=new ee({maxCacheSize:Wf}),this.rangeSearchTable=new ee({maxCacheSize:qf}),this.depthmapTable=new ee({maxCacheSize:qf}),this.loading=!1,this.requestedId=null,this.contentManager=t.getSceneManager().getContentManager(),this.dataTypeTable=new Map,this.contentTypes=[],this.contentURLs=[],this.requestCancelTimer=-1,this.requestCancelDuration=3e3,this.requestCommand=null,this.requestDepthCommand=null,this.requestSearchCommand=null,this.priority=0,this.dummyDepthmapData=null,this.loadStartTimestamp=0,this.forceResetDuration=3e3,this.serviceName=""}var t,n,r;return t=e,(n=[{key:"addDataType",value:function(e){var t=e.index;this.dataTypeTable.set(e.name,t),this.contentTypes[t]=e.contentType,this.contentURLs[t]=e.contentURL}},{key:"setServiceName",value:function(e){this.serviceName=e}},{key:"isLoaded",value:function(){return Date.now()-this.loadStartTimestamp>this.forceResetDuration&&this.loadCancel(),!this.loading}},{key:"loadInit",value:function(e,t,n,r,i,a,o,s){var u=this,l=this.renderView.getSceneManager().getTerrain(),c=-1;this.requestDummyDepthmap(function(f){f?c=setInterval(function(){f.getDepthMaterial()&&(clearInterval(c),l.getPanoramaInfo().setOnceDummyDepthmap(f),u.loadSync(e,t,n,r,i,a,o,s))},100):s()})}},{key:"load",value:function(e,t,n,r,i,o,s,u){var l=this;return n===this.requestedId?console.warn("같은 데이터는 연속적인 중복호출이 불가능합니다."):this.isLoaded()?(clearTimeout(this.requestCancelTimer),this.requestCancelTimer=setTimeout(function(){l.loadCancel(u)},this.requestCancelDuration),this.loading=!0,this.requestedId=n,this.loadStartTimestamp=Date.now(),void(e===a?this.requestStreet(t,n,r,i,o,function(e){if(e){clearTimeout(l.requestCancelTimer),l.loading=!1,l.requestedId=null;var t=Gf(e.position,2),r=t[0],i=t[1];l.requestDepthmap(n,e),l.requestRangeSearch(n,r,i,35,50,e,o),s(e)}else clearTimeout(l.requestCancelTimer),l.loadCancel(u)}):this.requestStore(n,function(e){clearTimeout(l.requestCancelTimer),e?(l.loading=!1,l.requestedId=null,s(e)):l.loadCancel(u)}))):console.warn("로딩 중")}},{key:"loadSync",value:function(e,t,n,r,i,o,s,u){var l=this;return n===this.requestedId?console.warn("같은 데이터는 연속적인 중복호출이 불가능합니다."):this.isLoaded()?(clearTimeout(this.requestCancelTimer),this.requestCancelTimer=setTimeout(function(){l.loadCancel(u)},this.requestCancelDuration),this.loading=!0,this.requestedId=n,this.loadStartTimestamp=Date.now(),void(e===a?this.requestStreet(t,n,r,i,o,function(e){e?(clearTimeout(l.requestCancelTimer),l.requestDepthmap(n,e,function(){var t=Gf(e.position,2),r=t[0],i=t[1];l.requestRangeSearch(n,r,i,35,50,e,o,function(){l.loading=!1,l.requestedId=null,s(e)})})):(clearTimeout(l.requestCancelTimer),l.loadCancel(u))}):this.requestStore(n,function(e){clearTimeout(l.requestCancelTimer),e?(l.loading=!1,l.requestedId=null,s(e)):l.loadCancel(u)}))):console.warn("로딩 중")}},{key:"loadCancel",value:function(e){this.requestCommand&&(this.requestCommand.cancel(),this.requestCommand=null),this.requestSearchCommand&&(this.requestSearchCommand.cancel(),this.requestSearchCommand=null),this.requestDepthCommand&&(this.requestDepthCommand.cancel(),this.requestDepthCommand=null),this.loading&&(this.loading=!1,this.requestedId=null,"function"==typeof e&&e())}},{key:"requestStreet",value:function(e,t,n,r,i,a){var o=this,s=e===g?this.dataTypeTable.get("street"):this.dataTypeTable.get("street_near");if("number"==typeof s)if(a="function"==typeof a?a:zf,this.streetTable.has(t))a(this.streetTable.get(t));else{this.requestCommand&&this.requestCommand.cancel();var u="";u=g===e?this.contentURLs[s](t):this.contentURLs[s](t,n,r,i);var l=this.contentTypes[s];this.requestCommand=this.contentManager.load(u,"pano_street",l,this.priority,function(e){if(o.requestCommand=null,e){var n=bf.Create(e);n&&o.streetTable.set(t,n),a(n)}else a(null)})}}},{key:"requestStore",value:function(e,t){var n=this,r=this.dataTypeTable.get("store");if("number"==typeof r){t="function"==typeof t?t:zf;var i=e.toString().split("_"),a=i[0],o=i[1];if(this.storeTable.has(a)){var s=this.storeTable.get(a).setCurrentPanoId(o).getData();t(s)}else{this.requestCommand&&this.requestCommand.cancel();var u=this.contentURLs[r](a),l=this.contentTypes[r];this.requestCommand=this.contentManager.load(u,"pano_store",l,this.priority,function(e){if(n.requestCommand=null,e){var r=Mf.Create(e),i=null;r&&(i=r.setCurrentPanoId(o).getData(),n.storeTable.set(a,r)),t(i)}else t(null)})}}}},{key:"requestRangeSearch",value:function(e,t,n,r,i,a,o,s){var u=this,l=this.dataTypeTable.get("rangesearch");if("number"==typeof l){if(s="function"==typeof s?s:zf,this.rangeSearchTable.has(e))if(!this.rangeSearchTable.get(e).isEmpty)return void s(this.rangeSearchTable.get(e));this.requestSearchCommand&&this.requestSearchCommand.cancel();var c=this.contentURLs[l](t,n,r,i,o),f=this.contentTypes[l];this.requestSearchCommand=this.contentManager.load(c,"pano_range",f,this.priority,function(t){if(u.requestSearchCommand=null,t){var n=Df.Create(a,t);e&&u.rangeSearchTable.set(e,n),s(n)}else s(null)})}}},{key:"requestSimpleRangeSearch",value:function(e,t,n,r,i,a){var o=this,s=this.dataTypeTable.get("rangesearch");if("number"==typeof s){a="function"==typeof a?a:zf,this.requestSearchCommand&&this.requestSearchCommand.cancel();var u=this.contentURLs[s](e,t,n,r,i),l=this.contentTypes[s];this.requestSearchCommand=this.contentManager.load(u,"pano_range",l,this.priority,function(n){o.requestSearchCommand=null;var r=n?Uf.Create(e,t,n):null;a(r)})}}},{key:"requestDepthmap",value:function(e,t,n){var r=this,i=this.dataTypeTable.get("depthmap");if("number"==typeof i)if(n="function"==typeof n?n:zf,this.depthmapTable.has(e)||t.isUnderpass)n(t.isUnderpass?this.dummyDepthmapData:this.depthmapTable.get(e));else{this.requestDepthCommand&&this.requestDepthCommand.cancel();var a=t.imagePath,o=this.contentURLs[i](e,a),s=this.contentTypes[i];this.requestDepthCommand=this.contentManager.load(o,"pano_depthmap",s,this.priority,function(i){r.requestDepthCommand=null,i?(i.setStreet(t),r.depthmapTable.set(e,i),n(i)):n()})}}},{key:"requestDummyDepthmap",value:function(e){var t=this,n=this.dataTypeTable.get("depthmapdummy");if("number"==typeof n)if(e="function"==typeof e?e:zf,this.dummyDepthmapData)e(this.dummyDepthmapData);else{this.requestDepthCommand&&this.requestDepthCommand.cancel();var r=this.contentURLs[n](),i=this.contentTypes[n];this.requestDepthCommand=this.contentManager.load(r,"pano_dummy_depthmap",i,this.priority,function(n){t.requestDepthCommand=null,n?(n.setStreet({panoId:"dummy",northAngle:0,northAngleRad:0}),n.isDummy=!0,t.dummyDepthmapData=n,e(n)):e(null)})}}},{key:"cacheExpire",value:function(){this.streetTable.expire(),this.storeTable.expire(),this.rangeSearchTable.expire(),this.depthmapTable.expire(function(e){e.value.clearDepthMaterial()})}}])&&Hf(t.prototype,n),r&&Hf(t,r),e}();var Xf=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.isStart=!1,this.isEnd=!1,this.hasRoadview=!1};function Kf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Zf=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.minX=t,this.minY=n,this.maxX=r,this.maxY=i,this.edges=[{p:null,d:null,norm:0},{p:null,d:null,norm:0},{p:null,d:null,norm:0},{p:null,d:null,norm:0}],this.centerX=.5*(t+r),this.centerY=.5*(n+i),this._makeEdge(t,n,r,i)}var t,n,r;return t=e,(n=[{key:"getBound",value:function(){return{min:[this.minX,this.minY],max:[this.maxX,this.maxY]}}},{key:"getCenter",value:function(){return[this.centerX,this.centerY]}},{key:"update",value:function(e,t,n,r){this.minX=Math.min(e,this.minX),this.minY=Math.min(t,this.minY),this.maxX=Math.max(n,this.maxX),this.maxY=Math.max(r,this.maxY),this.centerX=.5*(this.minX+this.maxX),this.centerY=.5*(this.minY+this.maxY),this._makeEdge(this.minX,this.minY,this.maxX,this.maxY)}},{key:"checkPoint",value:function(e,t){return e<=this.maxX&&e>=this.minX&&t<=this.maxY&&t>=this.minY}},{key:"checkRadius",value:function(e,t,n){return this.containsBoxOnCircle(e,t,n)||this.containsCircleOnBox(e,t,n)||this.intersectEdgeCircle(e,t,n)}},{key:"containsBoxOnCircle",value:function(e,t,n){var r=[e,t],i=Vr(r,[this.minX,this.minY]),a=Vr(r,[this.maxX,this.minY]),o=Vr(r,[this.minX,this.maxY]),s=Vr(r,[this.maxX,this.maxY]);return i<=n&&a<=n&&o<=n&&s<=n}},{key:"containsCircleOnBox",value:function(e,t,n){if(e<this.minX||e>this.maxX||t<this.minY||t>this.maxY)return!1;var r=[e,t],i=Vr(r,[this.minX,this.minY]),a=Vr(r,[this.maxX,this.minY]),o=Vr(r,[this.minX,this.maxY]),s=Vr(r,[this.maxX,this.maxY]);return i>=n&&a>=n&&o>=n&&s>=n}},{key:"intersectEdgeCircle",value:function(e,t,n){for(var r=0;r<4;++r){var i=this.edges[r],a=[i.p[0]-e,i.p[1]-t],o=Fr(a,i.d),s=Fr(a,a)-n;if(!(s>0&&o>0)){var u=o*o-s;if(!(u<0)){var l=-o-Math.sqrt(u),c=-o+Math.sqrt(u);if(l>0&&l<i.norm)return!0;if(c>0&&c<i.norm)return!0}}}return!1}},{key:"getDist",value:function(e,t){return Br([e,t],[this.centerX,this.centerY])}},{key:"_makeEdge",value:function(e,t,n,r){this.edges[0].p=[e,r],this.edges[0].d=Nr([],[e,t],[e,r]),this.edges[0].norm=jr(this.edges[0].d),this.edges[0].d[0]/=this.edges[0].norm,this.edges[0].d[1]/=this.edges[0].norm,this.edges[1].p=[e,t],this.edges[1].d=Nr([],[n,t],[e,t]),this.edges[1].norm=jr(this.edges[1].d),this.edges[1].d[0]/=this.edges[1].norm,this.edges[1].d[1]/=this.edges[1].norm,this.edges[2].p=[n,t],this.edges[2].d=Nr([],[n,r],[n,t]),this.edges[2].norm=jr(this.edges[2].d),this.edges[2].d[0]/=this.edges[2].norm,this.edges[2].d[1]/=this.edges[2].norm,this.edges[3].p=[n,r],this.edges[3].d=Nr([],[e,r],[n,r]),this.edges[3].norm=jr(this.edges[3].d),this.edges[3].d[0]/=this.edges[3].norm,this.edges[3].d[1]/=this.edges[3].norm}}])&&Kf(t.prototype,n),r&&Kf(t,r),e}();function Qf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Jf=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.order=t,this.segments=[],this.bound=new Zf(1/0,1/0,-1/0,-1/0)}var t,n,r;return t=e,(n=[{key:"addSegment",value:function(e){if(!(this.segments.filter(function(t){return t.order===e.order}).length>0)){this.segments.push(e);var t=e.bound.getBound();this.bound.update(t.min[0],t.min[1],t.max[0],t.max[1])}}},{key:"search",value:function(e,t,n,r){var i=!0,a=!1,o=void 0;try{for(var s,u=this.segments[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(l.bound.checkRadius(t,n,r)){var c=!0,f=!1,h=void 0;try{for(var p,d=l.lines[Symbol.iterator]();!(c=(p=d.next()).done);c=!0){var v=p.value;v.bound.checkRadius(t,n,r)&&e.push(v)}}catch(e){f=!0,h=e}finally{try{c||null==d.return||d.return()}finally{if(f)throw h}}}}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}}}])&&Qf(t.prototype,n),r&&Qf(t,r),e}();function $f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var eh=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.order=t,this.lines=[],this.worldDist=0,this.bound=new Zf(1/0,1/0,-1/0,-1/0)}var t,n,r;return t=e,(n=[{key:"addLine",value:function(e){if(!(this.lines.filter(function(t){return t.order===e.order}).length>0)){e.setSegment(this),this.lines.push(e);var t=e.bound.getBound();this.bound.update(t.min[0],t.min[1],t.max[0],t.max[1]),this.worldDist+=e.getLength()}}},{key:"getLineCount",value:function(){return this.lines.length}},{key:"getLength",value:function(){return this.worldDist}}])&&$f(t.prototype,n),r&&$f(t,r),e}();function th(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var nh=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.p0=t,this.p1=n,this.segment=null,this.order=r,this.dir=null,this.normvec=null,this.n_normvec=null,this.worldDist=0,this.bound=null,this.precalculate(),this.prevLine=null,this.nextLine=null}var t,n,r;return t=e,(n=[{key:"precalculate",value:function(){var e,t,n,r,i,a=Br(this.p0,this.p1),o=Dr([],this.p1[0]-this.p0[0],this.p1[1]-this.p0[1]);e=o,n=(t=o)[0],r=t[1],(i=n*n+r*r)>0&&(i=1/Rr(i),e[0]=n*i,e[1]=r*i);var s=Dr([],-o[1],o[0]),u=Dr([],-s[0],-s[1]);this.worldDist=a,this.dir=o,this.normvec=s,this.n_normvec=u,this.bound=new Zf(Math.min(this.p0[0],this.p1[0]),Math.min(this.p0[1],this.p1[1]),Math.max(this.p0[0],this.p1[0]),Math.max(this.p0[1],this.p1[1]))}},{key:"setSegment",value:function(e){this.segment=e}},{key:"getOrder",value:function(){return this.order}},{key:"getLength",value:function(){return this.worldDist}},{key:"getNextLine",value:function(){return this.nextLine}},{key:"getPrevLine",value:function(){return this.prevLine}}])&&th(t.prototype,n),r&&th(t,r),e}();function rh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ih=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.routePath=t,this.renderView=n,this.vertices=[],this.vertIndex=-1,this.indices=[],this.indIndex=-1,this.vertexIndexForIndices=0,this.maxDist=-1/0,this.minDist=1/0,this.widthForWorld=1,this.periodForWorld=2*this.widthForWorld,this.lineInfo=[]}var t,n,r;return t=e,(n=[{key:"tesselate",value:function(e,t,n){var r=this.routePath.bound.getCenter();this.vertices.length=0,this.indices.length=0,this.vertIndex=-1,this.indIndex=-1,this.maxDist=-1/0,this.minDist=1/0,this.vertexIndexForIndices=0;var i=!0,a=!1,o=void 0;try{for(var s,u=e.values()[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;this._tesselateLineBody(l,t,n,r)}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}this.lineInfo=[2*this.widthForWorld,this.periodForWorld,this.minDist,this.maxDist]}},{key:"_tesselateLineBody",value:function(e,t,n,r){for(var i=this.indices,a=this.widthForWorld,o=t.texCoords,s=1e-4,u=this.periodForWorld,l=0,c=-u,f=0,h=0,p=e.length;h<p;++h){var d=e[h],v=d.p0[0],y=d.p0[1],m=d.p1[0],g=d.p1[1],b=d.normvec,w=d.n_normvec;l+=f=d.getLength()-d.getLength()%u-u;var _=0;_=Br([v+w[0]*a,y+w[1]*a],n),this._makeVerticesWithParam(v-r[0],y-r[1],c,c,b[0],b[1],s,_,o.su,o.sv,o.eu-o.su,1),this.maxDist=Math.max(this.maxDist,_),this.minDist=Math.min(this.minDist,_),_=Br([m+w[0]*a,g+w[1]*a],n),this._makeVerticesWithParam(m-r[0],g-r[1],l,c,b[0],b[1],s,_,o.su,o.sv,o.eu-o.su,1),this.maxDist=Math.max(this.maxDist,_),this.minDist=Math.min(this.minDist,_),_=Br([m+b[0]*a*2,g+b[1]*a*2],n),this._makeVerticesWithParam(m-r[0],g-r[1],l,c,b[0],b[1],s,_,o.su,o.ev,o.eu-o.su,3),this.maxDist=Math.max(this.maxDist,_),this.minDist=Math.min(this.minDist,_),_=Br([v+b[0]*a*2,y+b[1]*a*2],n),this._makeVerticesWithParam(v-r[0],y-r[1],c,c,b[0],b[1],s,_,o.su,o.ev,o.eu-o.su,3),this.maxDist=Math.max(this.maxDist,_),this.minDist=Math.min(this.minDist,_),c+=f,i[++this.indIndex]=this.vertexIndexForIndices,i[++this.indIndex]=1+this.vertexIndexForIndices,i[++this.indIndex]=2+this.vertexIndexForIndices,i[++this.indIndex]=2+this.vertexIndexForIndices,i[++this.indIndex]=3+this.vertexIndexForIndices,i[++this.indIndex]=0+this.vertexIndexForIndices,this.vertexIndexForIndices+=4,s+=1e-4}}},{key:"_tesselateLineCap",value:function(e,t,n,r,i,a,o){var s=this.indices,u=this.widthForWorld,l=e[0],c=e[1],f=Br([l,c],i);this._makeVerticesWithParam(e[0]-a[0],e[1]-a[1],0,0,0,0,o,f,r.su,r.sv,0,1),this.maxDist=Math.max(this.maxDist,f),this.minDist=Math.min(this.minDist,f),f=Br([l=e[0]+t[0]*u,c=e[1]+t[1]*u],i),this._makeVerticesWithParam(e[0]-a[0],e[1]-a[1],0,0,t[0],t[1],o,f,r.su,r.sv,0,0),this.maxDist=Math.max(this.maxDist,f),this.minDist=Math.min(this.minDist,f);for(var h=o-.001,p=5;p<180;p+=5){var d=p*Math.PI/180,v=t[0]*Math.cos(d)-t[1]*Math.sin(d),y=t[0]*Math.sin(d)+t[1]*Math.cos(d);f=Br([l=e[0]+v*u,c=e[1]+y*u],i),this._makeVerticesWithParam(e[0]-a[0],e[1]-a[1],0,0,v,y,h,f,r.su,r.sv,0,0),this.maxDist=Math.max(this.maxDist,f),this.minDist=Math.min(this.minDist,f)}f=Br([l=e[0]+n[0]*u,c=e[1]+n[1]*u],i),this._makeVerticesWithParam(e[0]-a[0],e[1]-a[1],0,0,n[0],n[1],o,f,r.su,r.sv,0,0),this.maxDist=Math.max(this.maxDist,f),this.minDist=Math.min(this.minDist,f);for(var m=0;m<36;++m)s[++this.indIndex]=0+this.vertexIndexForIndices,s[++this.indIndex]=m+1+this.vertexIndexForIndices,s[++this.indIndex]=m+2+this.vertexIndexForIndices;this.vertexIndexForIndices+=38}},{key:"_makeVerticesWithParam",value:function(e,t,n,r,i,a,o,s,u,l,c,f){var h=this.vertices;h[++this.vertIndex]=e,h[++this.vertIndex]=t,h[++this.vertIndex]=n,h[++this.vertIndex]=r,h[++this.vertIndex]=i,h[++this.vertIndex]=a,h[++this.vertIndex]=o,h[++this.vertIndex]=s,h[++this.vertIndex]=u,h[++this.vertIndex]=l,h[++this.vertIndex]=c,h[++this.vertIndex]=f}},{key:"getResult",value:function(){return{vertices:this.vertices,indices:this.indices}}},{key:"getLineInfo",value:function(){return this.lineInfo}}])&&rh(t.prototype,n),r&&rh(t,r),e}();function ah(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function oh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var sh=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderView=t,this.routeNodes=new Set,this.routeLinks=new Set,this.segments=[],this.lines=[],this.bound=null,this.tesselator=new ih(this,t),this.totalLength=0}var t,n,r;return t=e,(n=[{key:"search",value:function(e,t){var n=e[0],r=e[1],i=t*t,a=[];if(this.bound.checkRadius(n,r,i)){var o=!0,s=!1,u=void 0;try{for(var l,c=this.routeLinks[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var f=l.value;f.bound.checkRadius(n,r,i)&&f.search(a,n,r,i)}}catch(e){s=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}}for(var h=[[]],p=h[0],d=0,v=a;d<v.length;d++){var y=v[d];0===p.length?p.push(y):p[p.length-1].order+1===y.order?p.push(y):(p=[y],h.push(p))}return h}},{key:"getTesselator",value:function(){return this.tesselator}},{key:"build",value:function(e){var t=e.bound;this.bound=new Zf(ds(t.left),ds(t.bottom),ds(t.right),ds(t.top)),this.buildNode(e.nodes),this.buildLink(e.links)}},{key:"buildNode",value:function(e){var t=this;e.forEach(function(e){var n=new Xf(e);"START"===e.type&&(n.isStart=!0),"END"===e.type&&(n.isEnd=!0),e.roadView&&(n.hasRoadview=!0),t.routeNodes.add(n)})}},{key:"buildLink",value:function(e){var t,n=e.map(function(e){return e.points.split(",").map(function(e){return e.split(" ").map(function(e){return ds(parseFloat(e))})}).filter(function(e,t,n){return 0===t||(e[0]!==n[t-1][0]||e[1]!==n[t-1][1])})}),r=0,i=0,a=null,o=new eh(i++);this.segments.push(o);var s=!0,u=!1,l=void 0;try{for(var c,f=n.entries()[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=ah(c.value,2),p=h[0],d=h[1];a=new Jf(p),this.routeLinks.add(a);for(var v=0,y=d.length;v<y-1;++v){var m=d[v+0],g=d[v+1],b=new nh(m,g,r++),w=b.getLength(),_=[b];w>50&&(r=r-1+(_=this._splitLine(b)).length);var T=!0,x=!1,S=void 0;try{for(var k,P=_[Symbol.iterator]();!(T=(k=P.next()).done);T=!0){var O=k.value;o.getLength()+O.getLength()<500?o.addLine(O):(a.addSegment(o),o=new eh(i++),this.segments.push(o),o.addLine(O)),this.lines.push(O),O.prevLine=t,t&&(t.nextLine=O),t=O,this.totalLength+=O.getLength()}}catch(e){x=!0,S=e}finally{try{T||null==P.return||P.return()}finally{if(x)throw S}}}}}catch(e){u=!0,l=e}finally{try{s||null==f.return||f.return()}finally{if(u)throw l}}a.addSegment(o)}},{key:"_splitLine",value:function(e){for(var t,n,r=e.p0,i=e.p1,a=e.dir,o=e.order,s=e.getLength(),u=[],l=Math.ceil(s/50),c=r[0],f=r[1],h=0;h<l;h++)if(h===l-1)u.push(new nh([c,f],i,o+h));else{var p=s*((h+1)/l);t=r[0]+a[0]*p,n=r[1]+a[1]*p,u.push(new nh([c,f],[t,n],o+h)),c=t,f=n}return u}},{key:"buildLink_temp",value:function(e){var t=e.map(function(e){return e.points.split(",").map(function(e){return e.split(" ").map(function(e){return ds(parseFloat(e))})}).filter(function(e,t,n){return 0===t||(e[0]!==n[t-1][0]||e[1]!==n[t-1][1])})}),n=0,r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){n+=o.value.length}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}for(var u=n-t.length,l=Math.ceil(u/10),c=0;c<l;++c)this.segments.push(new eh(c));var f=0,h=0,p=!0,d=!1,v=void 0;try{for(var y,m=t.entries()[Symbol.iterator]();!(p=(y=m.next()).done);p=!0){for(var g=ah(y.value,2),b=g[0],w=g[1],_=new Jf(b),T=void 0,x=void 0,S=0,k=w.length;S<k-1;++S){x=this.segments[h];var P=w[S+0],O=w[S+1],E=new nh(P,O,f++);this.lines.push(E),E.prevLine=T,T&&(T.nextLine=E),T=E,x.addLine(E),10===x.getLineCount()&&(h++,_.addSegment(x),x=null),this.totalLength+=E.getLength()}x&&_.addSegment(x),this.routeLinks.add(_)}}catch(e){d=!0,v=e}finally{try{p||null==m.return||m.return()}finally{if(d)throw v}}}}])&&oh(t.prototype,n),r&&oh(t,r),e}();function uh(e){return(uh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ch(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fh(e,t){return!t||"object"!==uh(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function hh(e){return(hh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ph(e,t){return(ph=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var dh=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=fh(this,hh(t).call(this,"street_created","store_created","route_created","route_deleted","comparemode_ratio_changed","comparemode_empty_past"))).renderView=e,n.currentId=null,n.currentType=null,n.dummyDepthmap=null,n.street=null,n.store=null,n.rangesearch=null,n.currentDepthmap=null,n.buildingInfo={index:-1,info:{kid:"",name:"",point:{x:-1,y:-1}}},n.routePath=null,n.compareViewModeFactors={ratio:0,splitRatio:1,splitbarColor:[0,0,0,1],splitbarSize:2,pastAreaMoveOpacity:1,emptyPast:!1},n.panoramaGlobalRadius=Math.max(s,u),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ph(e,t)}(t,E),n=t,(r=[{key:"setGlobalRadius",value:function(e){this.panoramaGlobalRadius=e}},{key:"getGlobalRadius",value:function(){return this.panoramaGlobalRadius}},{key:"getMaxDepth",value:function(){return a===this.currentType?500:1}},{key:"getPosition",value:function(){var e=this.getCurrentViewType();return e===a?this.street.position:e===o?this.store.position:null}},{key:"getRotation",value:function(){var e=this.getCurrentViewType();return e===a?this.street.rotation:e===o?this.store.rotation:null}},{key:"getCurrentPanoId",value:function(){return this.currentId}},{key:"getCurrentViewType",value:function(){return this.currentType}},{key:"setPanoramaRawData",value:function(e){e.type===a?this.setStreet(e):this.setStore(e)}},{key:"getPanoramaRawData",value:function(){var e=this.getCurrentViewType();return e===a?this.street:e===o?this.store:void 0}},{key:"setStreet",value:function(e){this.street=e,this.currentId=e.panoId,this.currentType=a,this.dummyDepthmap&&this.dummyDepthmap.setStreet(this.street),this.rangesearch=null,this.dispatch("street_created")}},{key:"setStore",value:function(e){this.store=e,this.currentId=e.storePanoId,this.currentType=o,this.dispatch("store_created")}},{key:"setRangesearch",value:function(e){this.rangesearch=e||null}},{key:"getRangesearch",value:function(){if(this.street&&!this.rangesearch){var e=this.renderView.getSceneManager().getTerrain().getDataManager();this.setRangesearch(e.rangeSearchTable.get(this.street.panoId))}return this.rangesearch}},{key:"createBuildingInfo",value:function(e,t,n){var r=this.getDepthmap(),i=r.getDataFromDirection(e.dir);this.buildingInfo.index=i.index;var a=r?r.table:null,o=this.buildingInfo.info;return!!(a&&i.index>=0)&&(o.kid=a.data[i.index][0],o.name=a.data[i.index][1],o.point.x=t,o.point.y=n,!0)}},{key:"clearBuildingInfo",value:function(){this.buildingInfo.index=-1;var e=this.buildingInfo.info;e.kid="",e.name="",e.point.x=-1,e.point.y=-1}},{key:"getBuildingInfo",value:function(){return this.buildingInfo.info}},{key:"setDepthmap",value:function(e){e&&e.getDepthMaterial()?this.currentDepthmap=e:this.currentDepthmap=this.dummyDepthmap}},{key:"getDepthmap",value:function(){return this.currentDepthmap||this.dummyDepthmap}},{key:"getDepthMaterial",value:function(){return this.getDepthmap().getDepthMaterial()}},{key:"setOnceDummyDepthmap",value:function(e){this.dummyDepthmap=e}},{key:"setRouteData",value:function(e){if(e){var t=new sh(this.renderView);t.build(e),this.routePath=t,this.dispatch("route_created")}else this.routePath&&(this.routePath=null,this.dispatch("route_deleted"))}},{key:"getRoutePath",value:function(){return this.routePath}},{key:"setCompareModeSplitBarColor",value:function(e){var t=lh(cs(e),4),n=t[0],r=t[1],i=t[2],a=t[3];this.compareViewModeFactors.splitbarColor[0]=n,this.compareViewModeFactors.splitbarColor[1]=r,this.compareViewModeFactors.splitbarColor[2]=i,this.compareViewModeFactors.splitbarColor[3]=a}},{key:"getCompareModeSplitBarColor",value:function(){return this.compareViewModeFactors.splitbarColor}},{key:"setCompareModeSplitBarSize",value:function(e){this.compareViewModeFactors.splitbarSize=e}},{key:"getCompareModeSplitBarSize",value:function(){return this.compareViewModeFactors.splitbarSize}},{key:"setCompareModeRatio",value:function(e){this.compareViewModeFactors.ratio=e,this.dispatch("comparemode_ratio_changed")}},{key:"getCompareModeRatio",value:function(){return this.compareViewModeFactors.ratio}},{key:"setCompareModeMoveOpacity",value:function(e){this.compareViewModeFactors.pastAreaMoveOpacity=e}},{key:"getCompareModeMoveOpacity",value:function(){return this.compareViewModeFactors.pastAreaMoveOpacity}},{key:"setSplitModeRatio",value:function(e){this.compareViewModeFactors.splitRatio=e}},{key:"getSplitModeRatio",value:function(){return this.compareViewModeFactors.splitRatio}},{key:"setCompareModeEmptyPast",value:function(e){"boolean"==typeof e&&(this.compareViewModeFactors.emptyPast=e,this.dispatch("comparemode_empty_past"))}},{key:"isCompareModeEmptyPast",value:function(){return this.compareViewModeFactors.emptyPast}}])&&ch(n.prototype,r),i&&ch(n,i),t}();function vh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function yh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var mh=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.appEngine=t,this.renderView=n,this.urlManager=new fl(t,n),this.version=null,this.name=null,this.techniqueTable=new Map}var t,n,r;return t=e,(n=[{key:"getTechniqueNames",value:function(){return this.techniqueTable.keys()}},{key:"getTechnique",value:function(e){return this.techniqueTable.get(e)}},{key:"changeEffectTechnique",value:function(e){var t=this.getTechnique(e);this.renderView.setEffectTechnique(t)}},{key:"buildURL",value:function(e){"string"==typeof e&&(e=JSON.parse(e)),this.urlManager.build(e)}},{key:"build",value:function(e){"string"==typeof e&&(e=JSON.parse(e)),this.version=e.version,this.buildView(e.view),this.renderView.dispatch("success")}},{key:"buildView",value:function(e){this.name=e.name,e.camera&&this.buildCamera(e.camera),e.terrain&&this.buildTerrain(e.terrain),e.scene&&this.buildScene(e.scene),e.rendering&&this.buildRendering(e.rendering)}},{key:"buildCamera",value:function(e){var t="orthographic"===e.mode?Pn.ORTHOGRAPHIC:Pn.PERSPECTIVE,n=e.center||[0,0,0],r=e.panTilt||[0,0],i=e.fovy||45,a=e.zoomLevel||0,o=e.panoramaMode||!1;t=o?Pn.PERSPECTIVE:t;var s=this.renderView.getSceneManager(),u=new Pn(t,this.renderView.viewport);s.setCamera(u),u.panoramaMode=o,u.setTarget(n[0],n[1],n[2]||0),u.setPanTilt(r[0],r[1]),u.setZoomLevel(a),u.setFovy(i)}},{key:"buildTerrain",value:function(e){var t=e.system,n=this.renderView.getSceneManager();"panorama"===t?(n.terrain=new Il(this.renderView),n.terrain.panoramaDataManager=new Yf(this.renderView),n.terrain.panoramaInfo=new dh(this.renderView),e.enable&&n.terrain.enable(),n.traverser=new Cl):"wtm"===t&&(n.terrain=new jl(this.renderView),n.traverser=new Ul),n.camera&&n.traverser.setCamera(n.camera)}},{key:"buildScene",value:function(e){var t=this.renderView.getSceneManager(),n=e.layer,r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value,l=this.createSceneLayer(u);t.addLayer(l)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}e.poi_strategy&&this.buildLabelStrategyData(e.poi_strategy);var c=e.data,f=t.getTerrain();if(c&&f){var h=f.getDataManager(),p=!0,d=!1,v=void 0;try{for(var y,m=c.entries()[Symbol.iterator]();!(p=(y=m.next()).done);p=!0){var g=vh(y.value,2),b=g[0],w=g[1],_=this.createSceneData(w,b);h.addDataType(_)}}catch(e){d=!0,v=e}finally{try{p||null==m.return||m.return()}finally{if(d)throw v}}}}},{key:"buildLabelStrategyData",value:function(e){var t=e.poi_layer_name;this.renderView.getSceneManager().getLayer(t)}},{key:"buildRendering",value:function(e){var t=e,n=t.vp,r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value,l=u.name;if(u.ondisk){var c=df.a.vp[l];this.renderView.getGraphicsManager().addVertexShader(l,c)}}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}var f=t.fp,h=!0,p=!1,d=void 0;try{for(var v,y=f[Symbol.iterator]();!(h=(v=y.next()).done);h=!0){var m=v.value,g=m.name;if(m.ondisk){var b=df.a.fp[g];this.renderView.getGraphicsManager().addFragmentShader(g,b)}}}catch(e){p=!0,d=e}finally{try{h||null==y.return||y.return()}finally{if(p)throw d}}var w=t.render_targets;if(w){var _=!0,T=!1,x=void 0;try{for(var S,k=w[Symbol.iterator]();!(_=(S=k.next()).done);_=!0){var P=S.value;this.createScreenRenderTarget(P)}}catch(e){T=!0,x=e}finally{try{_||null==k.return||k.return()}finally{if(T)throw x}}}var O=t.technique,E=!0,I=!1,M=void 0;try{for(var C,R=O[Symbol.iterator]();!(E=(C=R.next()).done);E=!0){var A=C.value,L=A.name,D=this.createEffectTechnique(A);this.techniqueTable.set(L,D)}}catch(e){I=!0,M=e}finally{try{E||null==R.return||R.return()}finally{if(I)throw M}}}},{key:"createSceneLayer",value:function(e){var t=e.name,n=e.type,r=null;switch(n){case"panorama_preview":(r=new Dc(t,n)).setCheckFrustum(!1);break;case"panorama_tile":(r=new Uc(t,n)).setCheckFrustum(!1);break;case"raster":(r=new Yc(t,n)).setCheckFrustum(!1);break;case"ordered":(r=new of(t,n)).setCheckFrustum(!1);break;case"poi":case"sub_poi":r=new hf(t,n);break;case"d3g":r=new $c(t,n);break;default:r=new Ic(t,n)}e.priority;r.priority=0;var i=e.strategy;i&&(r.strategy=this.createLayerStrategy(i,r));var a=e.reader;if(a){var o=this.createReader(a);this.appEngine.getContentManager().setReader(a,o),r.contentTypes[0]=a}var s=e.url;return s&&(r.contentURLs[0]=this.urlManager.getURLFunction(s)),r.terrain=this.renderView.getSceneManager().getTerrain(),r.traverser=this.renderView.getSceneManager().getTraverser(),r.setVisibleLevel(r.terrain.minLevel,r.terrain.maxLevel),e.clickable?r.setClickable(!0):r.setClickable(!1),e.visible?r.setVisible(!0):r.setVisible(!1),e.enable&&r.strategy&&r.strategy.enable(),r}},{key:"createSceneData",value:function(e,t){var n=e.name,r=e.reader,i=this.createReader(r);this.appEngine.getContentManager().setReader(r,i);var a=e.url,o=this.urlManager.getURLFunction(a);return{index:t,name:n,priority:e.priority,contentType:r,contentURL:o}}},{key:"createReader",value:function(e){var t=null;switch(e){case"default":t=new ue;break;case"jsonp-data":case"ajaxjson-data":t=new Ku;break;case"image-texture":t=new ko(this.renderView);break;case"debug-panorama-tile":t=new sl(this.renderView);break;case"panorama-tile":t=new tl(this.renderView);break;case"debug-raster-tile":t=new os(this.renderView);break;case"raster-tile":t=new Go(this.renderView);break;case"depthmap-image":t=new Ws(this.renderView);break;case"d3g-to-shape":t=new au(this.renderView);break;case"json_to_poi_shape":t=new Hu(this.renderView);break;default:throw"unreachable code. type:(".concat(e,")")}return t.setContentType(e),t}},{key:"createLayerStrategy",value:function(e,t){var n=null;switch(e){case"panorama_preview_node":n=new Zl(t);break;case"panorama_tile_node":n=new rc(t);break;case"panorama_street_mask":n=new cc(t);break;case"visible_node":n=new yc(t);break;case"tree_leaf_node":n=new xc(t);break;default:throw"unreachable code."}return n}},{key:"createScreenRenderTarget",value:function(e){var t=e.name,n=e.width,r=e.height;this.renderView.existRenderTarget(t)||this.renderView.createRenderTarget(t,n,r)}},{key:"createEffectTechnique",value:function(e){var t=go.CreateEffectTechnique(this.renderView),n=e.operation,r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value,l=u.type,c=null;(c="command"===l?this.createGraphicsCommand(u):this.createPass(u,l))&&t.addPass(c)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return t}},{key:"createGraphicsCommand",value:function(e){var t=null,n=e.command;if("bind_render_target"===n){var r=e.render_target,i=null;i=this.renderView.existRenderTarget(r)?this.renderView.getRenderTarget(r):this.renderView.createRenderTarget(r),t=go.CreateBindRenderTargetCommand(this.renderView,i)}else if("clear_all_buffer"===n){var a=cs(e.color),o=e.depth;t=go.CreateClearAllBufferCommand(this.renderView,a,o)}else if("clear_depth_buffer"===n){var s=e.depth;t=go.CreateClearDepthBufferCommand(this.renderView,s)}else if("clear_color_buffer"===n){var u=cs(e.color);t=go.CreateClearColorBufferCommand(this.renderView,u)}return t}},{key:"createPass",value:function(e,t){var n=e.name,r=e.vp,i=e.fp,a="screen_quad_pass"===t?go.CreateEffectScreenQuadPass(this.renderView,n,r,i):go.CreateEffectPass(this.renderView,n,r,i),o=e.read_render_targets;if(o)for(var s in o)if(o.hasOwnProperty(s)){var u=s.toUpperCase(),l=va[u],c=this.renderView.getRenderTarget(o[s]);a.setReadRenderTarget(l,c)}var f=e.depth;if(f){var h="boolean"==typeof f.write&&f.write;a.setDepthTest(h,f.compare)}var p=e.blend;if(p){var d=p.source||p.source_color,v=p.dest||p.dest_color,y=p.source_alpha||d,m=p.dest_alpha||v;a.setBlendState(d,v,y,m)}var g=e.layer;if(g){var b=!0,w=!1,_=void 0;try{for(var T,x=g[Symbol.iterator]();!(b=(T=x.next()).done);b=!0){var S=T.value;a.addLayerName(S)}}catch(e){w=!0,_=e}finally{try{b||null==x.return||x.return()}finally{if(w)throw _}}}return a}}])&&yh(t.prototype,n),r&&yh(t,r),e}();function gh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var bh=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isDev=!0,this.version="",this.configName=n,this.urlName=t,this.contentType="config",this.domainPath=null,this.config=null}var t,n,r;return t=e,(n=[{key:"setPath",value:function(e){return this.domainPath=e,this}},{key:"hasPath",value:function(){return!!this.domainPath}},{key:"getPath",value:function(){return this.domainPath}},{key:"getUrlName",value:function(){return this.urlName}},{key:"getConfigName",value:function(){return this.configName}},{key:"createConfig",value:function(e,t){return this.config=new mh(e,t),this.config}},{key:"getConfig",value:function(){return this.config}}])&&gh(t.prototype,n),r&&gh(t,r),e}();var wh=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a===t.type?(this.type="ROADVIEW",function(e,t){e.panoId=t.panoId,e.address=t.address,e.position={x:ps(t.position[0]),y:ps(t.position[1]),z:t.position[2]},e.northAngle=-t.northAngle,e.date=t.date,e.spots=t.spots.map(function(e){return{panoId:e.panoId}}),t.getPastList().length>0?e.pasts=t.getPastList().map(function(e){return{panoId:e.panoId,date:e.date}}):e.pasts=[];e.getSpotList=function(){return e.spots},e.getPastList=function(){return e.pasts}}(this,t)):(this.type="STOREVIEW",function(e,t){e.storeId=t.storeId,e.storePanoId=t.storePanoId,e.place=t.place,e.address=t.address,e.confirmId=t.cid,e.date=t.date,e.northAngle=-t.northAngle,e.pan=kt(-t.pan),e.tilt=t.tilt-90,e.position={x:ps(t.position[0]),y:ps(t.position[1]),z:t.position[2]},e.originPosition={x:ps(t.originPosition[0]),y:ps(t.originPosition[1]),z:t.originPosition[2]},e.spots=t.spots.map(function(e){return{storeId:e.storeId,storePanoId:"pano"===e.type?e.storePanoId:e.linkStorePanoId,spotType:e.type,isWarpType:e.isWarp,label:e.label,angle:kt(-e.relativePan),heightStep:e.relativeTiltStep,position:{x:ps(e.position[0]),y:ps(e.position[1]),z:e.position[2]}}});var n=t.map;e.miniMap={label:n.label,mapId:n.mapId,imagePath:n.minimapPath,pixelPerMeter:n.pixelPerMeter,spots:n.spots.map(function(e){return{storeId:e.storeId,storePanoId:"pano"===e.type?e.storePanoId:e.linkStorePanoId,spotType:e.type,isWarpType:e.isWarp,label:e.label,position:{x:e.minimapOriginPosition[0],y:e.minimapOriginPosition[1]}}})};var r=_h.get(t.storeId);r||(r=function e(t){if(!Array.isArray(t))return{label:t.label,description:t.description,isLeaf:t.isLeaf,spots:t.panoSpots.map(function(e){return{storeId:e.storeId,storePanoId:e.storePanoId,label:e.label}}),childs:e(t.childs)};return t.map(function(t){return e(t)})}(t.menuTree),_h.set(t.storeId,r));e.menuTree=r,e.getSpotList=function(){return e.spots},e.getMiniMap=function(){return e.miniMap},e.getMenuTree=function(){return e.menuTree}}(this,t))};var _h=new Map;function Th(e){return e}function xh(e){return--e*e*e+1}function Sh(e){return 1- --e*e*e*e}function kh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}window.requestAnimationFrame,window.cancelAnimationFrame;var Ph=0,Oh=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.from,r=void 0===n?[]:n,i=t.to,a=void 0===i?[]:i,o=t.step,s=void 0===o?function(){}:o,u=t.done,l=void 0===u?function(){}:u,c=t.duration,f=void 0===c?2e3:c,h=t.delay,p=void 0===h?0:h,d=t.easing,v=void 0===d?Th:d;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.startTime=0,this.isDone=!1,this.rafId=null,this.from=r,this.to=a,this.stepCallback=s,this.doneCallback=l,this.duration=f,this.delay=p,this.easingFunction=v,this.id=Ph++}var t,n,r;return t=e,(n=[{key:"reset",value:function(){this.isDone=!1}},{key:"next",value:function(e){if(this.isDone)this.doneCallback();else{var t=(e-this.startTime-this.delay)/this.duration;if(!(t<0)){t>1&&(t=1,this.isDone=!0);var n=this.interpolate(t);this.stepCallback(n)}}}},{key:"interpolate",value:function(e){for(var t=[],n=0;n<this.from.length;n++){var r=this.from[n],i=this.to[n],a=this.easingFunction;Array.isArray(a)&&(a=a[n]),t.push(r+(i-r)*a(e))}return t}}])&&kh(t.prototype,n),r&&kh(t,r),e}();function Eh(e){return(Eh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ih(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mh(e,t){return!t||"object"!==Eh(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ch(e){return(Ch=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rh(e,t){return(Rh=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ah=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Mh(this,Ch(t).call(this,n))).name=e,r.engineInit=!1,r.viewActive=!1,r.captureMode=!1,r.compareMode=!1,r.needFade=!1,r.terrain=null,r.panoInfo=null,r.panoDataManager=null,r.panoData=null,r.previewLayer=null,r.tileLayer=null,r.maskLayer=null,r.emptyLayer=null,r.apiDataTable=new Map,r.fadeAnimator=null,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rh(e,t)}(t,Wi),n=t,(r=[{key:"createEngineLoader",value:function(e,t){var n=new ua(this.renderEngine),r=new bh(e,t);return n.addConfig(r,this.renderView),this.setConfig(r.getConfig()),n}},{key:"setCommonVars",value:function(e){var t=this,n=this.renderView.getSceneManager();this.terrain=n.getTerrain(),this.panoInfo=this.terrain.getPanoramaInfo(),this.panoDataManager=this.terrain.getDataManager(),e&&this.panoDataManager.setServiceName(e.serviceName),this.tileLayer.on("shape_added",function(){t.renderView.todoRender()}),this.maskLayer.on("shape_added",function(){t.renderView.todoRender()}),this.fadeAnimator=new Oh({step:function(e){var n=e[0];t.terrain.setGlobalOpacity(n),t.viewRender()},done:function(){t.viewRender(!0)},duration:600,delay:200,easing:[xh]})}},{key:"setPanoData",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&(this.panoData=e,t&&this.createPanoramaAPIData(),n&&this.panoData&&a===this.panoData.type&&this.updateDepthmapByPanoData())}},{key:"getPanoData",value:function(){return this.panoData}},{key:"clearPanoData",value:function(){this.panoData=null}},{key:"getPanoInfo",value:function(){return this.panoInfo}},{key:"updateDepthmapByPanoData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t)this.panoData&&this.panoDataManager.requestDepthmap(this.panoData.panoId,this.panoData,function(t){e.panoInfo.setDepthmap(t)});else if(this.panoData){var n=this.panoDataManager.depthmapTable.get(this.panoData.panoId);this.panoInfo.setDepthmap(n)}}},{key:"clearLayerShape",value:function(){this.previewLayer.clearShape(),this.tileLayer.clearShape(),this.maskLayer.clearShape()}},{key:"setTileLock",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?(this.tileLayer.clearShape(),this.tileLayer.strategy.extractLock()):this.tileLayer.strategy.extractUnLock(),t?(this.maskLayer.clearShape(),this.maskLayer.strategy.extractLock()):this.maskLayer.strategy.extractUnLock(),e&&t?this.renderView.getSceneManager().getTerrain().lock():this.renderView.getSceneManager().getTerrain().unLock()}},{key:"updateTile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.panoData&&(this.panoInfo.setPanoramaRawData(this.panoData),e&&this.renderView.getSceneManager().getTerrain().onPartitionReset(),this.viewRender(!0))}},{key:"clearPanoramaCache",value:function(){this.panoDataManager.cacheExpire()}},{key:"isDataUpdated",value:function(){return this.isRoadviewMode()?this.panoData.panoId===this.panoInfo.getCurrentPanoId():!!this.isStoreviewMode()&&this.panoData.storePanoId===this.panoInfo.getCurrentPanoId()}},{key:"createPanoramaAPIData",value:function(){if(!this.panoData)return null;if(a===this.panoData.type){var e=this.panoData.panoId;this.apiDataTable.has(e)||this.apiDataTable.set(e,new wh(this.panoData))}else{var t=this.panoData.storeId+"_"+this.panoData.storePanoId;this.apiDataTable.set(t,new wh(this.panoData))}}},{key:"getPanoramaAPIData",value:function(){if(!this.panoData)return null;var e=this.panoData.type===a?this.panoData.panoId:this.panoData.storeId+"_"+this.panoData.storePanoId;return this.apiDataTable.get(e)}},{key:"getDistanceWithPosition",value:function(e){return jt(e,this.panoData.position)}},{key:"getDepthWithPosition",value:function(e){var t=this.panoInfo.getDepthmap(),n=Vt([],Rt([],e,this.panoData.position));return t.getDataFromDirection(n).depth}},{key:"checkLoadStoreviewPanoId",value:function(e,t){if(this.isStoreviewMode()&&e===this.panoData.storeId)if(t){if(t===this.panoData.storePanoId)return!1}else if(this.panoData.savedInitPanoId===this.panoData.storePanoId)return!1;return!0}},{key:"getPreviewShape",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){};this.previewLayer.strategy.onDataUpdate(e,t,function(t){n(t,e)})}},{key:"getRangeDataForTargetPosition",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(e){};this.panoDataManager.requestRangeSearch(null,e,t,n,r,this.panoData,i,function(e){return a(e)})}},{key:"getSimpleRangeData",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(e){};this.panoDataManager.requestSimpleRangeSearch(e,t,n,r,i,function(e){return a(e)})}},{key:"startFadeInAnimation",value:function(){this.fadeAnimator.from=[0],this.fadeAnimator.to=[1],this.stopAnimation(this.fadeAnimator),this.fadeAnimator.reset(),this.startAnimation(this.fadeAnimator),this.needFade=!1}},{key:"changeMouseCursor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this.renderView.getGraphicsManager().getContainer().style.cursor=e}},{key:"setGlobalAlpha",value:function(e){this.terrain.setGlobalOpacity(e)}},{key:"prepareFade",value:function(){this.needFade=!0,this.setGlobalAlpha(0)}},{key:"isRoadviewMode",value:function(){return!!this.panoData&&a===this.panoData.getDataType()}},{key:"isStoreviewMode",value:function(){return!!this.panoData&&o===this.panoData.getDataType()}},{key:"initEngine",value:function(){this.engineInit=!0}},{key:"isEngineInit",value:function(){return this.engineInit}},{key:"activeView",value:function(){this.viewActive=!0}},{key:"deactiveView",value:function(){this.viewActive=!1}},{key:"isViewActive",value:function(){return this.viewActive}},{key:"activeCaptureMode",value:function(){this.captureMode=!0}},{key:"deactiveCaptureMode",value:function(){this.captureMode=!1}},{key:"isCaptureMode",value:function(){return this.captureMode}},{key:"activeCompareMode",value:function(){this.compareMode=!0}},{key:"deactiveCompareMode",value:function(){this.compareMode=!1}},{key:"isCompareMode",value:function(){return this.compareMode}},{key:"isFading",value:function(){return this.needFade}}])&&Ih(n.prototype,r),i&&Ih(n,i),t}();function Lh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Dh={IMG:"img",JSONP:"jsonp",XHR:"xhr"},Nh=null,Fh=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loaderTable=new Map,this.assetTable=new Map}var t,n,r;return t=e,r=[{key:"getInstance",value:function(){return Nh||(Nh=new e),Nh}}],(n=[{key:"_replaceDomainUrl",value:function(e){return e.replace(/\|(\d)\|/g,function(e,t){return 10*Math.random()&parseInt(t,10)-1})}},{key:"add",value:function(e,t,n){var r=this;if(!n)throw"asset의 url 정보가 없습니다.";var i=this._replaceDomainUrl(n);switch(e){case Dh.IMG:var a=new Image;a.onload=function(){r.assetTable.set(t,a),a.done(),a.done=null,a.send=null},a.crossOrigin="anonymous",a.send=function(){a.src=i},this.loaderTable.set(t,a);break;case Dh.JSONP:var o=B(i,{complete:function(e){r.assetTable.set(t,e),o.done(),o.done=null},jsonp:!0});this.loaderTable.set(t,o);break;case Dh.XHR:var s=B(i,{complete:function(e){r.assetTable.set(t,e),s.done(),s.done=null},responseType:"json",jsonp:!1});this.loaderTable.set(t,s);break;default:throw"unreachable code."}}}])&&Lh(t.prototype,n),r&&Lh(t,r),e}().getInstance();function jh(e){var t=[],n=!0,r=!1,i=void 0;try{for(var a,o=function(){var e=a.value;t.push(new Promise(function(t,n){e.done=t,e.send()}))},s=Fh.loaderTable.values()[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)o()}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}Promise.all(t).then(function(){Fh.loaderTable.clear(),e()})}function Vh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Bh=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parents="string"==typeof t?document.getElementById(t):t,this.wrapper=document.createElement("div"),this.wrapper.id="".concat(n,"_layer_").concat(Date.now()%1e4);var r=this.wrapper.rcss=new Ve("#"+this.wrapper.id);r.set("position","absolute"),r.set("top",0),r.set("left",0),r.set("zIndex",1),r.set("display","block"),this.domTable=new Map,this.parents.appendChild(this.wrapper)}var t,n,r;return t=e,(n=[{key:"getWrapper",value:function(){return this.wrapper}},{key:"addBoard",value:function(e){var t=e.getContent();this.wrapper.appendChild(t),this.domTable.set(e.key,e),e.triggerAttached(),e.checkAndUpdate()}},{key:"removeBoard",value:function(e){var t=e.getContent();this.hasBoard(t)&&(this.wrapper.removeChild(t),this.domTable.delete(e.key,e),e.triggerDetached())}},{key:"hasBoard",value:function(e){if(this.wrapper.hasChildNodes()){var t=!0,n=!1,r=void 0;try{for(var i,a=this.wrapper.childNodes[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){if(i.value===e)return!0}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}return!1}},{key:"update",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.domTable.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){r.value.update("position")}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"layerHide",value:function(){this.wrapper.rcss.set("display","none")}},{key:"layerShow",value:function(){this.wrapper.rcss.set("display","block")}}])&&Vh(t.prototype,n),r&&Vh(t,r),e}();function Uh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Gh=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Sh;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.app=t,this.transition=new Oh({easing:i,step:function(e){return n(e)},duration:r}),this.defaultDuration=r}var t,n,r;return t=e,(n=[{key:"start",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.app,r=this.transition;r.reset(),r.from=e,r.to=e.map(function(){return 0}),t&&(r.duration=this.defaultDuration+t),n.requestRenderFrame(function(e){r.startTime=e,n.addAnimation(r)})}},{key:"stop",value:function(){var e=this.app,t=this.transition;e.requestRenderFrame(function(){e.cancelAnimation(t.id)})}},{key:"isDone",value:function(){return this.transition.isDone}}])&&Uh(t.prototype,n),r&&Uh(t,r),e}();function Hh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function zh(e,t){var n=e.clientX,r=e.clientY,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=t.getBoundingClientRect();return[(n-a.left|0)*i,(r-a.top|0)*i]}function Wh(e,t){var n=t.clientX,r=t.clientY,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=Hh(zh({clientX:n,clientY:r},e,a),2),s=o[0],u=o[1],l=e.getBoundingClientRect(),c=l.width,f=l.height;return s>=0+i&&s<=(c-i)*a&&u>=0+i&&u<=(f-i)*a}function qh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Yh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Xh=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.appEngine=t,this.renderView=n,this.canvas=t.getGraphicsManager().canvas,this.pixelRatio=n.getGraphicsManager().getPixelRatio(),this.lastX=0,this.lastY=0,this.isIdle=!0,this.recordsForInertialTranslation=[],this.inertiaController=new Gh(t,function(e){return r.inertialRotate(e)},0),this.lastCallback=null,this.frameRequested=!0,this.activeInertia=!0}var t,n,r;return t=e,(n=[{key:"enable",value:function(){}},{key:"disable",value:function(){}},{key:"setActiveInertia",value:function(e){this.activeInertia=e.PANTILT_INERTIA_ACTIVE}},{key:"onMouseDown",value:function(e){if(this.isIdle&&!e.ctrlKey&&!e.shiftKey&&0===e.button){this.inertiaController.stop(),this.isIdle=!1;var t=e.timeStamp,n=zh(e,this.canvas,this.pixelRatio);this.recordsForInertialTranslation.lenght=0,this.recordsForInertialTranslation=[[n[0],n[1],t]],this.lastX=n[0],this.lastY=n[1]}}},{key:"onMouseMove",value:function(e,t){var n=this;if(this.frameRequested){var r=this.renderView.getSceneManager().getCamera(),i=e.timeStamp,a=zh(e,this.canvas,this.pixelRatio),o=this.lastX-a[0],s=a[1]-this.lastY;this.lastX=a[0],this.lastY=a[1],this.recordsForInertialTranslation.push([a[0],a[1],i]),this.appEngine.requestRenderFrame(function(){n.frameRequested=!0,r.panTilt(o,s),"function"==typeof t&&(n.lastCallback=t,t())}),this.frameRequested=!1}}},{key:"onMouseUp",value:function(e){for(var t=this.recordsForInertialTranslation;t.length>0&&t[0][2]+50<e.timeStamp;)t.shift();if(t.length>0){var n=e.timeStamp,r=zh(e,this.canvas,this.pixelRatio),i=qh(t[0],3),a=i[0],o=i[1],s=n-i[2],u=(a-r[0])/s,l=(r[1]-o)/s,c=Math.sqrt(u*u+l*l);c>.5&&this.inertiaController.start([8*u,8*l],this.activeInertia?1e3+4*c:32)}this.isIdle=!0}},{key:"inertialRotate",value:function(e){var t=this,n=this.renderView.getSceneManager().getCamera(),r=qh(e,2),i=r[0],a=r[1];this.appEngine.requestRenderFrame(function(){n.panTilt(i,a),"function"==typeof t.lastCallback&&t.lastCallback()})}},{key:"isActive",value:function(){return!this.isIdle}}])&&Yh(t.prototype,n),r&&Yh(t,r),e}();function Kh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Zh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Qh=Math.PI,Jh=Math.atan2,$h=Math.acos,ep=10,tp=40,np=800;var rp=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.appEngine=t,this.renderView=n,this.doc=window.document,this.canvas=t.getGraphicsManager().canvas,this.pixelRatio=n.graphicsManager.getPixelRatio(),this.anchorX=0,this.anchorY=0,this.isIdle=!0,this.recordsForInertialZoom=[],this.inertiaController=new Gh(t,function(e){return r.inertialZoom(e)},0),this.offset=[],this.ray=new Fn,this.needUpdateRay=!0,this.lastCallback=null,this.frameRequested=!0,this.activeInertia=!0}var t,n,r;return t=e,(n=[{key:"enable",value:function(){}},{key:"disable",value:function(){}},{key:"setActiveInertia",value:function(e){this.activeInertia=e.ZOOM_INERTIA_ACTIVE}},{key:"onWheel",value:function(e,t){this.inertiaController.isDone()&&(this.needUpdateRay=!0),this.inertiaController.stop(),this.offset=zh(e,this.canvas,this.pixelRatio);var n,r,i,a,o,s=(n=e,r=0,i=0,a=0,o=0,"detail"in n&&(i=n.detail),"wheelDelta"in n&&(i=-n.wheelDelta/120),"wheelDeltaY"in n&&(i=-n.wheelDeltaY/120),"wheelDeltaX"in n&&(r=-n.wheelDeltaX/120),"axis"in n&&n.axis===n.HORIZONTAL_AXIS&&(r=i,i=0),a=r*ep,o=i*ep,"deltaY"in n&&(o=n.deltaY),"deltaX"in n&&(a=n.deltaX),(a||o)&&n.deltaMode&&(1===n.deltaMode?(a*=tp,o*=tp):(a*=np,o*=np)),a&&!r&&(r=a<1?-1:1),o&&!i&&(i=o<1?-1:1),{spinX:r,spinY:i,pixelX:a,pixelY:o}).spinY,u=s>=0?1:-1,l=Math.log2(Math.abs(s+u))*u;this.inertiaController.start([2*l],this.activeInertia?200:32),"function"==typeof t&&(this.lastCallback=t)}},{key:"inertialZoom",value:function(e){var t=this,n=this.renderView.getSceneManager().getCamera(),r=Kh(e,1)[0];this.appEngine.requestRenderFrame(function(){t.needUpdateRay&&(t.renderView.constructRayThroughPixel(t.ray,t.offset),t.needUpdateRay=!1),n.zoomFovy(r,{pan:St(Jh(t.ray.dir[1],t.ray.dir[0])-Qh/2),tilt:Qh-$h(t.ray.dir[2]),dir:t.ray.dir}),"function"==typeof t.lastCallback&&t.lastCallback()})}},{key:"isActive",value:function(){return!this.isIdle}}])&&Zh(t.prototype,n),r&&Zh(t,r),e}();function ip(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ap(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var op=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderEngine=t,this.renderView=n,this.doc=window.document,this.pixelRatio=n.graphicsManager.getPixelRatio(),this.types={MOVE:"move",VIEWPOINT:"viewpoint",RETURN:"return",FEATURE:"feature",CAPTURE:"capture"},this.ways4={FORWARD:[],LEFTSIDE:[],BACKWARD:[],RIGHTSIDE:[]},this.viewpointWay={LEFT:!1,RIGHT:!1,TOP:!1,BOTTOM:!1,ZOOMIN:!1,ZOOMOUT:!1},this.moveKey={87:"FORWARD",38:"FORWARD",32:"FORWARD",65:"LEFTSIDE",37:"LEFTSIDE",83:"BACKWARD",40:"BACKWARD",68:"RIGHTSIDE",39:"RIGHTSIDE"},this.viewpointKey={81:"LEFT",36:"LEFT",37:"LEFTSIDE",69:"RIGHT",33:"RIGHT",39:"RIGHTSIDE",82:"TOP",34:"TOP",38:"FORWARD",70:"BOTTOM",35:"BOTTOM",40:"BACKWARD",109:"ZOOMIN",189:"ZOOMIN",107:"ZOOMOUT",187:"ZOOMOUT"},this.returnKey={90:"RE-TURN"},this.changeFeatureKey={49:"MOTION-PVT_ON",50:"MOTION-PVT_OFF",51:"QUALITY-LOW",52:"QUALITY-HIGH",56:"MOTION-PT_OFF",57:"MOTION-VT_OFF"},this.captureKey={80:"CAPTURE"},this.pressedMoveKey=null,this.pressedVPKey=null,this.isIdle=!0,this.frameRequested=!0,this.timestamp=0,this.captureTimestamp=0}var t,n,r;return t=e,(n=[{key:"enable",value:function(){}},{key:"disable",value:function(){}},{key:"onKeyDown",value:function(e,t){var n=this;if(this.frameRequested){this.forceRelease=!1;var r=e.timeStamp,i=e.keyCode,a=e.metaKey,o=e.shiftKey,s=e.ctrlKey;if(a)return;if(o&&this.captureKey[i]){if(r-this.captureTimestamp<2e3)return;return this.captureTimestamp=r,this.renderEngine.requestRenderFrame(function(){t(n.types.CAPTURE,{}),n.frameRequested=!0}),this.frameRequested=!1,void(this.isIdle=!1)}if((o||s)&&this.returnKey[i])return this.renderEngine.requestRenderFrame(function(){t(n.types.RETURN,{}),n.frameRequested=!0}),this.frameRequested=!1,void(this.isIdle=!1);if(o&&this.changeFeatureKey[i]){var u=ip(this.changeFeatureKey[i].split("-"),2),l=u[0],c=u[1];return this.renderEngine.requestRenderFrame(function(){t(n.types.FEATURE,{featureInfo:{group:l,key:c}}),n.frameRequested=!0}),this.frameRequested=!1,void(this.isIdle=!1)}if(!o&&this.moveKey[i]){this.pressedMoveKey=i,this.updateWays();var f=this.moveKey[this.pressedMoveKey],h=this.ways4[f];h&&(this.renderEngine.requestRenderFrame(function(){t(n.types.MOVE,{direction:h}),n.frameRequested=!0}),this.frameRequested=!1,this.isIdle=!1)}if(this.viewpointKey[i]){if(r-this.timestamp<120)return;this.timestamp=r,this.pressedVPKey=i;var p=this.viewpointKey[this.pressedVPKey];this.updateViewpoint(p,o)&&(this.renderEngine.requestRenderFrame(function(){t(n.types.VIEWPOINT,{direction:n.viewpointWay}),n.frameRequested=!0}),this.frameRequested=!1,this.isIdle=!1)}}}},{key:"onKeyUp",value:function(e,t){var n=e.keyCode;(this.moveKey[n]||this.viewpointKey[n]||this.returnKey[n]||this.changeFeatureKey[n]||this.captureKey[n])&&(this.viewpointKey[n]&&"function"==typeof t&&t(this.types.VIEWPOINT),this.forceRelease=!1,this.pressedMoveKey=null,this.pressedVPKey=null,this.isIdle=!0)}},{key:"onForceRelease",value:function(e){this.forceRelease=!0,this.isIdle=!0,"function"==typeof e&&(this.moveKey[this.pressedMoveKey]?e(this.types.MOVE,null):this.viewpointKey[this.pressedVPKey]&&e(this.types.VIEWPOINT,null)),this.pressedMoveKey=null,this.pressedVPKey=null}},{key:"isForceReleased",value:function(){return this.forceRelease}},{key:"isActive",value:function(){return!this.isIdle}},{key:"updateWays",value:function(){var e=It([],this.renderView.getSceneManager().getCamera().direction);e[2]=0;var t=this.ways4;It(t.FORWARD,e),Nt(t.LEFTSIDE,e,[0,0,-1]),Mt(t.BACKWARD,-e[0],-e[1],-e[2]),Nt(t.RIGHTSIDE,e,[0,0,1])}},{key:"updateViewpoint",value:function(e,t){this.viewpointWay.LEFT=!1,this.viewpointWay.RIGHT=!1,this.viewpointWay.TOP=!1,this.viewpointWay.BOTTOM=!1,this.viewpointWay.ZOOMIN=!1,this.viewpointWay.ZOOMOUT=!1;var n=!1;return"LEFT"===e||"LEFTSIDE"===e&&t?(this.viewpointWay.LEFT=!0,n=!0):"RIGHT"===e||"RIGHTSIDE"===e&&t?(this.viewpointWay.RIGHT=!0,n=!0):"TOP"===e||"FORWARD"===e&&t?(this.viewpointWay.TOP=!0,n=!0):"BOTTOM"===e||"BACKWARD"===e&&t?(this.viewpointWay.BOTTOM=!0,n=!0):"ZOOMIN"===e?(this.viewpointWay.ZOOMIN=!0,n=!0):"ZOOMOUT"===e&&(this.viewpointWay.ZOOMOUT=!0,n=!0),n}}])&&ap(t.prototype,n),r&&ap(t,r),e}();function sp(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var up=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.appEngine=t,this.renderView=n,this.doc=window.document,this.canvas=t.getGraphicsManager().canvas,this.pixelRatio=n.graphicsManager.getPixelRatio(),this.firstX=0,this.firstY=0,this.timeStamp=0,this.dblTimeStamp=0,this.moved=!1,this.isIdle=!0,this.frameRequested=!0,this.onMouseMoveHandler=function(e){r.onMouseMove(e)},this.onMouseDownHandler=function(e){r.onMouseDown(e)}}var t,n,r;return t=e,(n=[{key:"enable",value:function(){this.canvas.addEventListener("mousedown",this.onMouseDownHandler)}},{key:"disable",value:function(){this.canvas.removeEventListener("mousedown",this.onMouseDownHandler)}},{key:"onMouseDown",value:function(e){if(this.isIdle){this.isIdle=!1;var t=e.timeStamp,n=zh(e,this.canvas,this.pixelRatio);this.firstX=n[0],this.firstY=n[1],this.timeStamp=t,this.moved=!1,this.canvas.addEventListener("mousemove",this.onMouseMoveHandler)}}},{key:"onMouseMove",value:function(e){if(!this.isIdle||this.moved){var t=zh(e,this.canvas,this.pixelRatio);Math.pow(t[0]-this.firstX,2)+Math.pow(t[1]-this.firstY,2)>8&&(this.moved=!0)}}},{key:"reset",value:function(e){this.isIdle=!0,this.moved=!1}},{key:"onClick",value:function(e,t){var n=this;if(this.frameRequested){var r=e.timeStamp;if(r-this.dblTimeStamp<500)return void(this.isIdle=!0);var i=zh(e,this.canvas,this.pixelRatio);if(!this.moved){var a=r-this.timeStamp;this.appEngine.requestRenderFrame(function(){n.frameRequested=!0,a<1e3?t({type:"short",x:i[0],y:i[1]}):a>=1e3&&t({type:"long",x:i[0],y:i[1]})}),this.frameRequested=!1,this.dblTimeStamp=r}this.canvas.removeEventListener("mousemove",this.onMouseMoveHandler),this.isIdle=!0}}},{key:"isActive",value:function(){return!this.isIdle}},{key:"isMoved",value:function(){return this.moved}}])&&sp(t.prototype,n),r&&sp(t,r),e}();function lp(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var cp=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.appEngine=t,this.doc=window.document,this.canvas=t.getGraphicsManager().canvas,this.pixelRatio=n.graphicsManager.getPixelRatio(),this.isIdle=!1,this.isEnter=!0,this.frameRequested=!1,this.stayFrameRequested=!1,this.lastCallback=null,this.clearKeepTimer=-1,this.stayTime=500,this.onMouseDownHandler=function(e){r.onMouseDown(e)},this.onMouseMoveHandler=function(e){r.onMouseMove(e)},this.onMouseUpHandler=function(e){r.onMouseUp(e)},this.onMouseOutHandler=function(e){r.onMouseOut(e)}}var t,n,r;return t=e,(n=[{key:"enable",value:function(){this.canvas.addEventListener("mousedown",this.onMouseDownHandler),this.canvas.addEventListener("mousemove",this.onMouseMoveHandler),this.canvas.addEventListener("mouseup",this.onMouseUpHandler),this.canvas.addEventListener("mouseout",this.onMouseOutHandler)}},{key:"disable",value:function(){this.canvas.removeEventListener("mousedown",this.onMouseDownHandler),this.canvas.removeEventListener("mousemove",this.onMouseMoveHandler),this.canvas.removeEventListener("mouseup",this.onMouseUpHandler),this.canvas.removeEventListener("mouseout",this.onMouseOutHandler)}},{key:"onMouseOut",value:function(e){this.isEnter=!1,clearTimeout(this.clearKeepTimer)}},{key:"onMouseDown",value:function(e){this.isIdle=!0}},{key:"onMouseUp",value:function(e){this.isIdle=!1}},{key:"onMouseMove",value:function(e){var t=this;this.idle||(this.isEnter=!0,this.stayFrameRequested||(this.stayFrameRequested=!0,this.appEngine.requestRenderFrame(function(){clearTimeout(t.clearKeepTimer),t.clearKeepTimer=setTimeout(function(){if(t.isEnter){var n=zh(e,t.canvas,t.pixelRatio);"function"==typeof t.lastCallback&&(t.lastCallback({type:"long",x:n[0],y:n[1]}),t.lastCallback=null)}},t.stayTime),t.stayFrameRequested=!1})))}},{key:"onOver",value:function(e,t){var n=this;this.idle||this.frameRequested||(this.frameRequested=!0,this.appEngine.requestRenderFrame(function(){if("function"==typeof t){var r=zh(e,n.canvas,n.pixelRatio);n.lastCallback=t,t({type:"short",x:r[0],y:r[1]})}n.frameRequested=!1}))}},{key:"clearKeepOverEvent",value:function(){clearTimeout(this.clearKeepTimer)}},{key:"isActive",value:function(){return!this.isIdle}}])&&lp(t.prototype,n),r&&lp(t,r),e}();function fp(e){return(fp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function pp(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function dp(e,t){return!t||"object"!==fp(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vp(e){return(vp=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yp(e,t){return(yp=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var mp=i,gp=function(e){function t(e,n){var r,i=n.pan,a=n.tilt,o=n.zoom;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=dp(this,vp(t).call(this,mp.VT_STEP,mp.VT_END))).app=e,r.camera=e.renderView.getSceneManager().getCamera(),r.inertiaTimestamp=-1,r.animateDuration=0,r.inertiaDefaultDuration=0,r.inertiaActive=!0,r.animator=new Oh({step:function(e){var t=r.camera;t.setPanTilt(e[0],e[1]),t.setFovy(e[2]),r.dispatch(mp.VT_STEP)},duration:r.animateDuration,easing:[xh,xh,xh],done:function(){r.animating=!1}}),r.inertiaController=new Gh(e.renderEngine,function(e){return r.inertialRotate(e)},0,Th),r.animating=!1,r.setPanTiltZoom(i,a,o),r.frameRequested=!0,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yp(e,t)}(t,E),n=t,i=[{key:"convertToCameraPan",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"number"!=typeof e?0:-(e||0)}},{key:"convertToCameraTilt",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"number"!=typeof e?90:xt(90-e,0,180)}},{key:"convertToCameraFovy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"number"!=typeof e?90:e>=0&&e<=6?90-10*e:90}}],(r=[{key:"reset",value:function(){this.animating=!1,this.inertialStop(),this.frameRequested=!0}},{key:"setDuration",value:function(e){this.animator.duration=this.animateDuration=e.VPT_ANIMATION_TIME,this.inertiaDefaultDuration=e.VPT_INERTIA_TIME,this.inertiaActive=e.VPT_INERTIA_ACTIVE}},{key:"setPosition",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.camera;r?i.setTarget(e,t,n):i.setTarget(ds(e),ds(t),n),i.setDistance(3)}},{key:"getPosition",value:function(){var e=this.camera;return[ps(e.position[0]),ps(e.position[1]),e.position[2]]}},{key:"setPanTiltZoom",value:function(e,n,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=this.camera,o=kt(i?t.convertToCameraPan(e):e),s=i?t.convertToCameraTilt(n):n,u="number"==typeof r?t.convertToCameraFovy(r):a.fovy*Tt;this.animating=!0;var l=kt(a.pan*Tt);l=Math.abs(o-l)<180?l:o-l<0?l-360:l+360;var c=a.tilt*Tt,f=a.fovy*Tt;this.app.stopAnimation(this.animator),this.animator.reset(),this.animator.from=[l,c,f],this.animator.to=[o,s,u],this.app.startAnimation(this.animator)}},{key:"getPanTiltZoom",value:function(){for(var e=this.camera,t=kt(-e.pan*Tt),n=-(e.tilt-Math.PI/2)*Tt,r=e.fovy*Tt,i=0,a=90;a>=30&&!(Math.ceil(r)>=a);a-=10)i++;return[t,n,i]}},{key:"translateDelta",value:function(e,t,n){var r=this,i=this.camera;this.frameRequested&&(this.app.renderEngine.requestRenderFrame(function(){r.frameRequested=!0;var a=Date.now(),o=3*(a-r.inertiaTimestamp);r.inertiaController.stop(),i.panTilt(e,t),i.zoomFovy(n),r.inertiaController.start([2*e,2*t,n],-1===r.inertiaTimestamp||o>r.inertiaDefaultDuration?r.inertiaDefaultDuration:o),r.dispatch(mp.VT_STEP),r.inertiaTimestamp=a}),this.frameRequested=!1)}},{key:"inertialRotate",value:function(e){var t=this,n=this.camera,r=hp(e,3),i=r[0],a=r[1],o=r[2];this.app.renderEngine.requestRenderFrame(function(){n.panTilt(i,a),n.zoomFovy(o),t.dispatch(mp.VT_STEP)})}},{key:"inertialStop",value:function(){this.inertiaActive&&this.inertiaController.stop()}},{key:"inertialForceStop",value:function(){this.inertiaController.stop()}},{key:"isInertiaActive",value:function(){return this.inertiaActive}},{key:"isAnimating",value:function(){return this.animating}}])&&pp(n.prototype,r),i&&pp(n,i),t}();function bp(e){return(bp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wp(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _p(e,t){return!t||"object"!==bp(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tp(e){return(Tp=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xp(e,t){return(xp=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Sp=i,kp=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=_p(this,Tp(t).call(this,Sp.PT_PREPARE,Sp.PT_START,Sp.PT_STEP,Sp.PT_END,Sp.PT_CHAIN,Sp.PT_IDLE))).app=e,n.layers=[],n.camera=e.renderView.getSceneManager().getCamera(),n.checkLoadFailCount=0,n.maxLoadFailCount=5,n.loadingData=null,n.loadingIndex=0,n.panoDataList=[],n.orderIndex=0,n.orderedCurrentShapeList=[],n.orderedCurrentDataList=[],n.orderedPastShapeList=[],n.orderedPastDataList=[],n.currentViewData={from:null,to:null},n.pastViewData={from:null,to:null},n.moveDurationTime=0,n.idleDelayTime=0,n.maxPreloadCount=0,n.moveTransition=new Oh({step:function(e){return n.stepMoveTransition(e)},done:function(){return n.endMoveTransition()},duration:n.moveDurationTime,easing:[Th,Th,Th,Th]}),n.idleTrigger=new Oh({done:function(){n.dispatch(Sp.PT_IDLE,{current:n.currentViewData,past:n.pastViewData}),n.idle=!0,n.shapeLoaded=!0},duration:0,delay:n.idleDelayTime}),n.idle=!0,n.animating=!1,n.chaining=!1,n.stopReserve=!1,n.shapeLoaded=!0,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xp(e,t)}(t,E),n=t,(r=[{key:"setDuration",value:function(e){this.moveTransition.duration=this.moveDurationTime=e.PT_ANIMATION_TIME,this.idleTrigger.delay=this.idleDelayTime=e.PT_IDLE_TIME}},{key:"setMaxPreloadCount",value:function(e){this.maxPreloadCount=e}},{key:"setupLayer",value:function(){this.layers.push(this.app.renderView.getSceneManager().getLayer("pano_preview_layer"),this.app.pastCompare.renderView.getSceneManager().getLayer("past_preview_layer"))}},{key:"isLoaded",value:function(){return this.app.panoDataManager.isLoaded()&&this.shapeLoaded}},{key:"continuousMove",value:function(e){var t=this;if(!this.stopReserve)if(this.orderedCurrentDataList.length-this.orderIndex<this.maxPreloadCount)if(this.isLoaded()){this.checkLoadFailCount=0;var n=this.getTransitionNextId(e)||this.app.getPanoData()&&this.app.getPanoData().getNextPanoIdByDirection(e);if(!n)return;this.app.panoDataManager.load(a,g,n,null,null,l,function(e){return t.loadShape(e,function(){t.start(!0)})})}else++this.checkLoadFailCount>this.maxLoadFailCount&&this.reset();else this.start(!0)}},{key:"onestepMove",value:function(e){var t=this;this.stopReserve||this.isLoaded()&&(this.checkLoadFailCount=0,this.app.panoDataManager.load(a,g,e,null,null,l,function(e){t.loadShape(e,function(){t.start(!1)})}))}},{key:"continueStepMove",value:function(e){var t=this;if(e&&0!==e.length&&e.length>=1){var n=e.length,r=n-Math.ceil(.2*n);!function e(n){var i=n.shift();t.app.panoDataManager.load(a,g,i,null,null,l,function(i){t.loadShape(i,function(){e(n),r>=n.length&&t.start(!0)})},function(){})}(e)}}},{key:"setCamera",value:function(e){this.camera=e}},{key:"loadShape",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.panoDataList.push(e),this.shapeLoaded=!1;var r=this.panoDataList[this.loadingIndex];r&&this.loadingData!==r?(this.loadingData=r,this.app.loadShapeForTransition(r,function(e,i){t.app.pastCompare.loadShapeForTransition(r,function(r,a){t.orderedCurrentDataList.push(i),t.orderedCurrentShapeList.push(e),t.orderedPastDataList.push(a),t.orderedPastShapeList.push(r),e.materialPool[0].setDiffuseColor(0,0,0,1),r&&r.materialPool[0].setDiffuseColor(0,0,0,1),t.loadingIndex++,t.shapeLoaded=!0,"function"==typeof n&&n(e,i)})})):this.reserveStop()}},{key:"start",value:function(e){if(!(this.loadingIndex<1||(this.chaining=e||!1,this.idle=!1,this.app.stopAnimation(this.idleTrigger),this.idleTrigger.reset(),this.animating))){var t=this._getMoveAnimationInfo();t?(this.dispatch(Sp.PT_PREPARE,{current:this.currentViewData,past:this.pastViewData}),this.startMoveTransition(t)):this.dispatchDelayedIdleEvent(),this.chaining||this.reserveStop()}}},{key:"reserveStop",value:function(){this.animating&&(this.stopReserve=!0),this.chaining=!1}},{key:"isAnimating",value:function(){return!this.idle}},{key:"_getMoveAnimationInfo",value:function(){var e=this.orderedCurrentDataList[this.orderIndex];if(e){var t=e.position,n=[this.orderedCurrentShapeList[this.orderIndex],this.orderedPastShapeList[this.orderIndex]];return this.currentViewData.from=this.orderedCurrentDataList[this.orderIndex-1]||null,this.currentViewData.to=this.orderedCurrentDataList[this.orderIndex],this.pastViewData.from=this.orderedPastDataList[this.orderIndex-1]||null,this.pastViewData.to=this.orderedPastDataList[this.orderIndex],{position:t,shapeList:n}}return null}},{key:"startMoveTransition",value:function(e){var t=this,n=e.position,r=e.shapeList;this.idle=!1,this.animating=!0,this.dispatch(Sp.PT_START,{current:this.currentViewData,past:this.pastViewData});var i=this.camera;r.forEach(function(e,n){e&&t.layers[n].animatedShapeList[0]!==e&&(t.layers[n].animatedShapeList[1]=e)}),this.moveTransition.reset(),this.moveTransition.from[0]=i.position[0],this.moveTransition.from[1]=i.position[1],this.moveTransition.from[2]=i.position[2],this.moveTransition.from[3]=1,this.moveTransition.to[0]=n[0],this.moveTransition.to[1]=n[1],this.moveTransition.to[2]=n[2],this.moveTransition.to[3]=0,this.app.startAnimation(this.moveTransition)}},{key:"stepMoveTransition",value:function(e){this.idle=!1;var t=this.camera,n=e[3];this.layers.forEach(function(e,t){var r=e.animatedShapeList[0];if(r&&e.animatedShapeList[1]){var i=!0,a=!1,o=void 0;try{for(var s,u=r.materialPool[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){s.value.setDiffuseColor(0,0,0,n)}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}}}),t.setTarget(e[0],e[1],e[2]),this.dispatch(Sp.PT_STEP,{current:this.currentViewData,past:this.pastViewData,interpolate:e})}},{key:"endMoveTransition",value:function(){this.idle=!1,this.orderIndex++,this.layers.forEach(function(e){e.animatedShapeList[1]&&e.animatedShapeList.splice(0,1)}),this.dispatch(Sp.PT_END,{current:this.currentViewData,past:this.pastViewData});var e=null;!this.stopReserve&&this.chaining&&(e=this._getMoveAnimationInfo())?(this.dispatch(Sp.PT_CHAIN,{current:this.currentViewData,past:this.pastViewData}),this.startMoveTransition(e)):(this.animating=!1,this.chaining=!1,this.stopReserve=!1,this.dispatchDelayedIdleEvent())}},{key:"reset",value:function(){this.orderedCurrentDataList.length=0,this.orderedCurrentShapeList.length=0,this.orderedPastDataList.length=0,this.orderedPastShapeList.length=0,this.orderIndex=0,this.panoDataList.length=0,this.loadingIndex=0,this.loadingData=null,this.animating=!1,this.chaining=!1,this.stopReserve=!1,this.shapeLoaded=!0,this.checkLoadFailCount=0}},{key:"getTransitionNextId",value:function(e){var t=this.panoDataList[this.panoDataList.length-1];return t?t.getNextPanoIdByDirection(e):null}},{key:"dispatchDelayedIdleEvent",value:function(){this.app.stopAnimation(this.idleTrigger),this.idleTrigger.reset(),this.app.startAnimation(this.idleTrigger)}}])&&wp(n.prototype,r),i&&wp(n,i),t}();function Pp(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Op={ROOT:"root",VERT:"vert",HORI:"hori"},Ep=function(){function e(t,n,r,i,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.x=n,this.y=r,this.w=i,this.h=a,this.sibling=o,this.assigned=!1,this.childs=[null,null],this.no=s}var t,n,r;return t=e,(n=[{key:"clear",value:function(){for(var e=0;e<2;++e)this.childs[e]&&this.childs[e].clear();this.childs=[null,null],this.assigned=!1,this.sibling=null,this.x=this.y=this.w=this.h=0}},{key:"search",value:function(e,t,n){if(!(e.length>=1))if(!this.assigned&&this.inBounds(t,n))this.divide(t,n),this.resizeTo(t,n),e[0]=this;else for(var r=0;r<2;++r)this.childs[r]&&this.childs[r].search(e,t,n)}},{key:"inBounds",value:function(e,t){return e<=this.w&&t<=this.h&&(this.assigned=!0,!0)}},{key:"divide",value:function(t,n){var r=this.x,i=this.y,a=this.w,o=this.h,s=r+t,u=i+n,l=null,c=null;this.w>this.h?(a-t>=8&&(c=new e(Op.HORI,s,i,a-t,o,null,this.no),this.childs[0]=c),o-n>=8&&(l=new e(Op.VERT,r,u,a,o-n,null,this.no),this.childs[1]=l)):(o-n>=8&&(l=new e(Op.VERT,r,u,a,o-n,null,this.no),this.childs[0]=l),a-t>=8&&(c=new e(Op.HORI,s,i,a-t,o,null,this.no),this.childs[1]=c)),l&&c&&(l.sibling=c,c.sibling=l)}},{key:"resizeTo",value:function(e,t){this.type!==Op.ROOT&&this.sibling&&!this.sibling.assigned&&(this.type===Op.VERT?this.sibling.resizeBy(0,-this.h):this.type===Op.HORI&&this.sibling.resizeBy(-this.w,0)),this.w=e,this.h=t}},{key:"resizeBy",value:function(e,t){this.w+=e,this.h+=t}}])&&Pp(t.prototype,n),r&&Pp(t,r),e}();function Ip(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Mp=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rootCandidate=new Ep(Op.ROOT,0,0,t,n,null,r)}var t,n,r;return t=e,(n=[{key:"search",value:function(e,t){var n=[];return this.rootCandidate.search(n,e,t),n}},{key:"clear",value:function(){this.rootCandidate.clear()}}])&&Ip(t.prototype,n),r&&Ip(t,r),e}();function Cp(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Rp="find_yes",Ap="find_no",Lp="size_error",Dp=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=n,this.height=r,this.invWidth=1/this.width,this.invHeight=1/this.height,this.binded=!1,this.full=!1,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.buffer=t.getGraphicsManager().createTextureBuffer(this.canvas),this.ctx=this.canvas.getContext("2d"),this.assignLimit=90,this.totalArea=n*r,this.assignedArea=0,this.no=i,this.spaceTree=new Mp(n,r,i),this.autoGenerate=!1}var t,n,r;return t=e,(n=[{key:"check",value:function(e){var t=e.getSize(),n=e.getMargin(),r=n.left+n.right,i=n.top+n.bottom;if(t.width+r>this.width||t.height+i>this.height)return Lp;var a=this.spaceTree.search(t.width+r,t.height+i)[0];return a?(e.setPosition(a.x,a.y),this.assignedArea+=a.w*a.h,!this.full&&this.getUsage()>this.assignLimit&&(this.full=!0),Rp):Ap}},{key:"render",value:function(e){e.renderTo(this.ctx),e.joinTo=this,this.binded=!1,this.autoGenerate&&this.generateBuffer()}},{key:"generateBuffer",value:function(){this.binded||(this.buffer.updateData(this.canvas),this.binded=!0,this.autoGenerate=!0)}},{key:"getUsage",value:function(){return this.assignedArea/this.totalArea*100}},{key:"clear",value:function(){this.spaceTree.clear(),this.binded=!1,this.full=!1,this.assignedArea=0,this.buffer.reset()}}])&&Cp(t.prototype,n),r&&Cp(t,r),e}();var Np=function e(t,n,r,i,a,o,s,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.key=t,this.texCoords={su:n,sv:r,eu:i,ev:a,w:o,h:s},this.buffer=u};function Fp(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var jp={IMG:"img",TXT:"txt"},Vp=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=null,this.key=t,this.src=n,this.margin={left:0,top:0,right:0,bottom:0},this.pos={x:0,y:0},this.size={width:0,height:0},this.joinTo=null}var t,n,r;return t=e,(n=[{key:"renderTo",value:function(){}},{key:"setPosition",value:function(e,t){this.pos.x=e,this.pos.y=t}},{key:"getPosition",value:function(){return this.pos}},{key:"setSize",value:function(e,t){this.size.width=e,this.size.height=t}},{key:"getSize",value:function(){return this.size}},{key:"setMargin",value:function(e,t,n,r){this.margin.left=e,this.margin.top=t,this.margin.right=n,this.margin.bottom=r}},{key:"getMargin",value:function(){return this.margin}}])&&Fp(t.prototype,n),r&&Fp(t,r),e}();function Bp(e){return(Bp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Up(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gp(e,t){return!t||"object"!==Bp(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Hp(e){return(Hp=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zp(e,t){return(zp=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Wp=function(e){function t(e,n,r,i,a){var o,s=a.left,u=void 0===s?1:s,l=a.top,c=void 0===l?1:l,f=a.right,h=void 0===f?1:f,p=a.bottom,d=void 0===p?1:p;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=Gp(this,Hp(t).call(this,e,n))).type=jp.IMG,o.setSize(r,i),o.setMargin(u,c,h,d),o}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zp(e,t)}(t,Vp),n=t,(r=[{key:"renderTo",value:function(e){var t=this.size;e.drawImage(this.src,this.pos.x+this.margin.left,this.pos.y+this.margin.top,t.width,t.height)}}])&&Up(n.prototype,r),i&&Up(n,i),t}();function qp(e){return(qp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yp(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xp(e,t){return!t||"object"!==qp(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Kp(e){return(Kp=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zp(e,t){return(Zp=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qp='AppleSDGothicNeo-Regular,"Malgun Gothic","맑은 고딕",dotum,"돋움",sans-serif',Jp="hang",$p=document.createElement("canvas");$p.width=768,$p.height=128;var ed=$p.getContext("2d");var td=function(e){function t(e,n,r,i){var a,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7?arguments[7]:void 0,c=arguments.length>8?arguments[8]:void 0,f=arguments.length>9?arguments[9]:void 0,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,d=arguments.length>12?arguments[12]:void 0,v=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,y=arguments.length>14&&void 0!==arguments[14]?arguments[14]:10,m=arguments.length>15&&void 0!==arguments[15]?arguments[15]:10,g=arguments.length>16?arguments[16]:void 0,b=g.left,w=void 0===b?1:b,_=g.top,T=void 0===_?1:_,x=g.right,S=void 0===x?1:x,k=g.bottom,P=void 0===k?1:k;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=Xp(this,Kp(t).call(this,e,n))).type=jp.TXT,a.setSize(function(e,t,n,r,i){return ed.font="".concat(i?"bold ":"").concat(t,"px ").concat(Qp),ed.textBaseline=Jp,ed.measureText(e).width+n}(n,r,l,0,u)+2*y+Math.abs(h),r+l+c+2*m+Math.abs(p)),a.setMargin(w,T,S,P),a.textSize=r,a.isBold=u,a.color=i,a.textPosX=o,a.textPosY=s,a.strokeColor=f,a.strokeSize=l,a.strokeBlur=c,a.strokeOffsetX=h,a.strokeOffsetY=p,a.bgColor=d,a.paddingX=y,a.paddingY=m,a.isRoundCorner=v>0,a.radius=v,a}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zp(e,t)}(t,Vp),n=t,(r=[{key:"renderTo",value:function(e){e.save(),e.font="".concat(this.isBold?"bold ":"").concat(this.textSize,"px ").concat(Qp),e.textBaseline=Jp,e.fillStyle=this.bgColor;var t=this.pos.x+this.margin.left,n=this.pos.y+this.margin.top;if(this.isRoundCorner)if(1===this.src.length){var r=.5*Math.min(this.size.width,this.size.height);this.backgroundCircle(e,t+.5*this.size.width,n+.5*this.size.height,r)}else this.backgroundRoundRect(e,t,n,this.size.width,this.size.height,this.radius);else this.backgroundSquareRect(e,t,n,this.size.width,this.size.height);t+=this.textPosX,n+=this.textPosY+this.textSize/(this.textSize<=13?1.2:1.3),(this.strokeSize||this.strokeBlur)&&(this.strokeBlur=this.strokeBlur<=this.strokeSize?this.strokeBlur:this.strokeSize,e.shadowBlur=this.strokeBlur,e.shadowColor=this.strokeColor,e.shadowOffsetX=this.strokeOffsetX,e.shadowOffsetY=this.strokeOffsetY,e.strokeStyle=this.strokeColor,e.lineWidth=this.strokeSize,e.strokeText(this.src,t+this.strokeSize/2,n+this.strokeSize)),e.fillStyle=this.color,e.fillText(this.src,t+this.strokeSize/2,n+this.strokeSize),e.restore()}},{key:"backgroundCircle",value:function(e,t,n,r){e.beginPath(),e.arc(t,n,r,0,2*Math.PI,!0),e.closePath(),e.fill()}},{key:"backgroundRoundRect",value:function(e,t,n,r,i,a){e.beginPath(),e.moveTo(t+a,n),e.lineTo(t+r-a,n),e.quadraticCurveTo(t+r,n,t+r,n+a),e.lineTo(t+r,n+i-a),e.quadraticCurveTo(t+r,n+i,t+r-a,n+i),e.lineTo(t+a,n+i),e.quadraticCurveTo(t,n+i,t,n+i-a),e.lineTo(t,n+a),e.quadraticCurveTo(t,n,t+a,n),e.closePath(),e.fill()}},{key:"backgroundSquareRect",value:function(e,t,n,r,i){e.fillRect(t,n,r,i)}}])&&Yp(n.prototype,r),i&&Yp(n,i),t}();function nd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function rd(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var id=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.testIndexNo=0,this.appEngine=t,this.pixelRatio=t.getGraphicsManager().getPixelRatio(),this.defaultSize={width:512*this.pixelRatio,height:512*this.pixelRatio},this.atlasList=[],this.maxLength=6;for(var n=0;n<this.maxLength;++n)this.atlasList[n]=null;this.atlasList[0]=new Dp(t,this.defaultSize.width,this.defaultSize.height,this.testIndexNo),this.sourceMap=new Map,this.atlasDataMap=new Map,this.isStartGenerate=!1}var t,n,r;return t=e,(n=[{key:"clear",value:function(){this.atlasDataMap.clear(),this.sourceMap.clear();for(var e=0;e<this.atlasList.length;++e)this.atlasList[e]&&(this.atlasList[e].clear(),this.atlasList[e]=null);this.atlasList=[]}},{key:"_add",value:function(e){for(var t,n=Ap,r=0;r<this.maxLength;++r){if(!(t=this.atlasList[r])){var i=Math.min(Math.ceil(e.size.width/this.defaultSize.width),4),a=Math.min(Math.ceil(e.size.height/this.defaultSize.height),4);-1!==this.testIndexNo&&this.testIndexNo++,t=this.atlasList[r]=new Dp(this.appEngine,this.defaultSize.width*i,this.defaultSize.height*a,this.testIndexNo),this.isStartGenerate&&(t.autoGenerate=!0)}if(!t.full&&(n=t.check(e))===Rp){t.render(e);break}}return n===Lp&&(t=null,console.warn("##########################"),console.warn("입력소스가 텍스쳐 최대 크기(2048x2048)보다 크거나.\n크기를 확인해 주세요."),console.warn("##########################")),n===Ap&&(t=null,console.warn("##########################"),console.warn("소스의 크기가 8px 이내이거나, 만들 수 있는 텍스쳐를 모두 사용하여서 더이상 생성할 수 없습니다."),console.warn("##########################")),t}},{key:"startGenerate",value:function(){this.atlasList.forEach(function(e){!e||e.autoGenerate||e.isBinded||e.generateBuffer()}),this.isStartGenerate=!0}},{key:"addText",value:function(e,t,n,r){var i=t.text,a=t.size,o=void 0===a?12:a,s=t.color,u=void 0===s?"#fff":s,l=t.alpha,c=void 0===l?1:l,f=t.posX,h=void 0===f?0:f,p=t.posY,d=void 0===p?0:p,v=t.isBold,y=void 0!==v&&v,m=n.strokeSize,g=void 0===m?0:m,b=n.strokeBlur,w=void 0===b?0:b,_=n.strokeColor,T=void 0===_?"#000":_,x=n.strokeAlpha,S=void 0===x?0:x,k=n.strokeOffsetX,P=void 0===k?0:k,O=n.strokeOffsetY,E=void 0===O?0:O,I=r.bgColor,M=void 0===I?"#000":I,C=r.bgAlpha,R=void 0===C?0:C,A=r.radius,L=void 0===A?0:A,D=r.paddingX,N=void 0===D?0:D,F=r.paddingY,j=void 0===F?0:F,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},B=V.left,U=void 0===B?1:B,G=V.top,H=void 0===G?1:G,z=V.right,W=void 0===z?1:z,q=V.bottom,Y=void 0===q?1:q;if(i){if(this.atlasDataMap.has(e))return this.atlasDataMap.get(e);var X=ls(u,c,255),K=nd(X,4),Z=K[0],Q=K[1],J=K[2],$=K[3],ee=ls(T,S,255),te=nd(ee,4),ne=te[0],re=te[1],ie=te[2],ae=te[3],oe=ls(M,R,255),se=nd(oe,4),ue=se[0],le=se[1],ce=se[2],fe=se[3],he=new td(e,i,o,"rgba(".concat(Z,",").concat(Q,",").concat(J,",").concat($,")"),h,d,y,g,w,"rgba(".concat(ne,",").concat(re,",").concat(ie,",").concat(ae,")"),P,E,"rgba(".concat(ue,",").concat(le,",").concat(ce,",").concat(fe,")"),L,N,j,{left:U,top:H,right:W,bottom:Y}),pe=this._add(he);if(!pe)return null;this.sourceMap.set(e,he);var de=he.getPosition(),ve=he.getSize(),ye=he.getMargin(),me=new Np(e,(de.x+ye.left)*pe.invWidth,1-(de.y+ye.top+ve.height)*pe.invHeight,(de.x+ye.left+ve.width)*pe.invWidth,1-(de.y+ye.top)*pe.invHeight,ve.width,ve.height,pe.buffer);return this.atlasDataMap.set(e,me),me}console.warn("반드시 텍스트가 있어야 합니다.")}},{key:"addImage",value:function(e,t){var n=t.img,r=t.width,i=t.height,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.spriteName,s=a.spriteOriginX,u=a.spriteOriginY,l=a.spriteWidth,c=a.spriteHeight,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},h=f.left,p=void 0===h?1:h,d=f.top,v=void 0===d?1:d,y=f.right,m=void 0===y?1:y,g=f.bottom,b=void 0===g?1:g;if(this.atlasDataMap.has(e))return this.atlasDataMap.get(e);var w,_,T=0,x=0;if(o){var S=o;if(this.sourceMap.has(S))_=(w=this.sourceMap.get(S)).joinTo;else{if(w=new Wp(S,n,l,c,{left:p,top:v,right:m,bottom:b}),!(_=this._add(w)))return null;this.sourceMap.set(S,w)}T=s,x=u}else{if(w=new Wp(e,n,r,i,{left:p,top:v,right:m,bottom:b}),!(_=this._add(w)))return null;this.sourceMap.set(e,w)}var k=w.getPosition(),P=w.getMargin(),O=new Np(e,(k.x+P.left+T)*_.invWidth,1-(k.y+P.top+x+i)*_.invHeight,(k.x+P.left+T+r)*_.invWidth,1-(k.y+P.top+x)*_.invHeight,r,i,_.buffer);return this.atlasDataMap.set(e,O),O}}])&&rd(t.prototype,n),r&&rd(t,r),e}();function ad(e){return(ad="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function od(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sd(e,t){return!t||"object"!==ad(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ud(e){return(ud=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ld(e,t){return(ld=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var cd=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=sd(this,ud(t).call(this))).appEngine=e,r.renderView=n,r.name="UI",r.enabled=!1,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ld(e,t)}(t,E),n=t,(r=[{key:"getName",value:function(){return this.name}},{key:"enable",value:function(){}},{key:"disable",value:function(){}},{key:"update",value:function(){}}])&&od(n.prototype,r),i&&od(n,i),t}();function fd(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var hd=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.capacity=t,this.layer=null,this.screenPoint=Ar([]),this.results=[]}var t,n,r;return t=e,(n=[{key:"reset",value:function(){this.results.length=0}},{key:"setScreenPoint",value:function(e){this.screenPoint[0]=e[0],this.screenPoint[1]=e[1]}},{key:"setCollision",value:function(e){this.results.length<this.capacity?this.results.push(e):console.warn("out of capacity")}},{key:"getCollision",value:function(e){return this.results[e]}},{key:"getCount",value:function(){return this.results.length}},{key:"setLayer",value:function(e){this.layer=e}},{key:"getLayer",value:function(){return this.layer}}])&&fd(t.prototype,n),r&&fd(t,r),e}();function pd(e){return(pd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dd(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function vd(e,t){return!t||"object"!==pd(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yd(e){return(yd=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function md(e,t){return(md=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var gd=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=vd(this,yd(t).call(this,"pick"))).renderView=e,n.ray=new Fn,n.pickResults=new hd(20),n.smallestNonNegativeDistance=1/0,n.isDispatchEvent=!1,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&md(e,t)}(t,E),n=t,(r=[{key:"_doPickRay",value:function(e,t){}},{key:"pickScreenPoint",value:function(e,t){return this.constructRay(e),t="string"==typeof t?[t]:t,this.pickRay(this.ray,t)}},{key:"pickRay",value:function(e,t){return this.pickResults.reset(),this.smallestNonNegativeDistance=1/0,Un.ClippingFar=1/0,this._doPickRay(e,t),this.pickResults.setScreenPoint(e.screenPoint),this.isDispatchEvent&&this.dispatchEventToLayer(),this.pickResults}},{key:"getRay",value:function(){return this.ray}},{key:"constructRay",value:function(e){this.renderView.constructRayThroughPixel(this.ray,e)}},{key:"setDispatchEventToLayer",value:function(e){this.isDispatchEvent=e}},{key:"dispatchEventToLayer",value:function(){var e=this.renderView.getSceneManager().getLayer(this.pickResults.getLayer());e&&e.dispatch("pick")}}])&&dd(n.prototype,r),i&&dd(n,i),t}();function bd(e){return(bd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wd(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _d(e,t){return!t||"object"!==bd(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Td(e){return(Td=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xd(e,t){return(xd=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Sd=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),_d(this,Td(t).call(this,e))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xd(e,t)}(t,gd),n=t,(r=[{key:"_doPickRay",value:function(e,t){for(var n,r=new lr,i=0;n=t[i];++i){var a=this.renderView.getSceneManager().getShapeCollector(n).getShapes(),o=!0,s=!1,u=void 0;try{for(var l,c=a[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var f=l.value.meshPool,h=!0,p=!1,d=void 0;try{for(var v,y=f[Symbol.iterator]();!(h=(v=y.next()).done);h=!0){var m=v.value.getPhysicsModel();m&&m.intersectRay(r,e)&&r.distance<this.smallestNonNegativeDistance&&(this.smallestNonNegativeDistance=r.distance,this.pickResults.setLayer(n),this.pickResults.results[0]=r)}}catch(e){p=!0,d=e}finally{try{h||null==y.return||y.return()}finally{if(p)throw d}}}}catch(e){s=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}}}}])&&wd(n.prototype,r),i&&wd(n,i),t}();function kd(e){return(kd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pd(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Od(e){return(Od=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ed(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Id(e,t){return(Id=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Md=[],Cd=Oe([]),Rd=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(e,t){return!t||"object"!==kd(t)&&"function"!=typeof t?Ed(e):t}(this,Od(t).call(this,e,n))).atlasManager=r,i.name="roadview-spot-ui",i.targetLayer=null,i.billboardLayer=null,i.terrain=null,i.panoramaInfo=null,i.commonSpotVertexBuffer=null,i.commonSpotIndexBuffer=null,i.commonTextIndexBuffer=null,i.commonDirectionToTextBufferTable=new Map,i.directionToNodeTable=new Map,i.nodeToShapeTable=new Map,i.nodeToDirTextShapeTable=new Map,i.nodeToDirHoverTextShapeTable=new Map,i.nodeToSpotDataTable=new Map,i.activatedNodes=new Set,i.selectedNode=null,i.panoData=null,i.premakeCommonTextBuffers(),i.premakeCommonArrowBuffers(),i.dataUpdatedListener=i.onDataUpdated.bind(Ed(i)),i.picker=new Sd(n),i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Id(e,t)}(t,cd),n=t,(r=[{key:"enable",value:function(){this.enabled||(this.enabled=!0,this.targetLayer=this.renderView.getSceneManager().getLayer("panorama_spot"),this.billboardLayer=this.renderView.getSceneManager().getLayer("panorama_billboard_spot"),this.terrain=this.renderView.getSceneManager().getTerrain(),this.panoramaInfo=this.terrain.getPanoramaInfo(),this.panoramaInfo.on("street_created",this.dataUpdatedListener))}},{key:"disable",value:function(){this.enabled&&(this.clear(),this.enabled=!1,this.panoramaInfo.off("street_created",this.dataUpdatedListener),this.targetLayer=this.billboardLayer=this.terrain=this.panoramaInfo=null)}},{key:"clear",value:function(){if(this.enabled){var e=!0,t=!1,n=void 0;try{for(var r,i=this.activatedNodes[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;this.targetLayer.removeShape(a),this.billboardLayer.removeShape(a)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this.activatedNodes.clear()}}},{key:"onDataUpdated",value:function(){this.enabled&&(this.panoData=this.terrain.getPanoramaInfo().getPanoramaRawData(),this.panoData&&(this.update(),this.updatePhysicModelBound()))}},{key:"dataUpdate",value:function(e){this.enabled&&(this.panoData=e,this.panoData&&(this.update(),this.updatePhysicModelBound()))}},{key:"update",value:function(){if(this.enabled&&this.panoData){var e=this.renderView.getSceneManager().getCamera(),t=Mt([],e.position[0]+5*e.direction[0],e.position[1]+5*e.direction[1],e.position[2]+5*e.direction[2]);this.clear();var n=this.panoData.spots,r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value,l=this.makeNode(u.dirname,u.repeatCount),c=this.makeShapes(l,u.dirnameKo),f=c.arrowShape,h=c.textShape,p=c.hoverTextShape;this.nodeToSpotDataTable.set(l,u),Et(Md),Lt(Md,u.direction,2),Ct(f.position,t,Md),f.position[2]=1,It(h.position,f.position),h.position[2]=1,It(p.position,f.position),p.position[2]=1,Ht(f.orientation),Wt(f.orientation,u.angleRad+2*Math.PI),f.updateTransform(),h.updateTransform(),p.updateTransform(),this.targetLayer.addShape(l,f),this.selectedNode===l?this.billboardLayer.addShape(l,p):this.billboardLayer.addShape(l,h),this.activatedNodes.add(l)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}}},{key:"updatePhysicModelBound",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.activatedNodes[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value,o=this.nodeToShapeTable.get(a);Ie(Cd,o.orientation);var s=o.meshPool[0];s.getPhysicsModel().getBVHRoot().getBound().fromVertexBuffer(s.vertexBuffer,Aa.Pf3Nf3,Cd)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"makeNode",value:function(e,t){var n=e+t,r=this.directionToNodeTable.get(n);return r||(r=new ks(null,null,0,0,c.indexOf(e)+c.length*(t-1)),this.directionToNodeTable.set(n,r)),r}},{key:"makeShapes",value:function(e,t){var n={arrowShape:this.nodeToShapeTable.get(e),textShape:this.nodeToDirTextShapeTable.get(e),hoverTextShape:this.nodeToDirHoverTextShapeTable.get(e)};return n.arrowShape||(n.arrowShape=this.getSpotShape(e),this.nodeToShapeTable.set(e,n.arrowShape)),n.textShape||(n.textShape=this.getTextShape(t),this.nodeToDirTextShapeTable.set(e,n.textShape)),n.hoverTextShape||(n.hoverTextShape=this.getHoverTextShape(t),this.nodeToDirHoverTextShapeTable.set(e,n.hoverTextShape)),n}},{key:"premakeCommonTextBuffers",value:function(){var e=this.renderView.getGraphicsManager().getPixelRatio(),t=this.atlasManager,n=this.appEngine.getAsset("common_sprite"),r=0,i=!0,a=!1,o=void 0;try{for(var s,u=["동","서","남","북","남서","남동","북동","북서"].values()[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=2===l.length?39:26,f=2===l.length?41:28,h={width:c*e,height:26*e,originX:(147+r)*e,originY:53*e},p={width:c*e,height:26*e,originX:(147+r)*e,originY:81*e},d=t.addImage(l,{img:n.source,width:h.width,height:h.height},{spriteName:"common_sprite",spriteOriginX:h.originX,spriteOriginY:h.originY,spriteWidth:n.width,spriteHeight:n.height}),v=t.addImage(l+"_hover",{img:n.source,width:p.width,height:p.height},{spriteName:"common_sprite",spriteOriginX:p.originX,spriteOriginY:p.originY,spriteWidth:n.width,spriteHeight:n.height}),y=d.texCoords,m=this.renderView.getGraphicsManager().createVertexBuffer(new Float32Array([0,0,0,y.su,y.sv,0-y.w,0,0,0,0,y.eu,y.sv,y.w+0,0,0,0,0,y.eu,y.ev,y.w+0,2*y.h+0,0,0,0,y.su,y.ev,0-y.w,2*y.h+0]),Aa.Pf3Tf2F2);y=v.texCoords;var g=this.renderView.getGraphicsManager().createVertexBuffer(new Float32Array([0,0,0,y.su,y.sv,0-y.w,0,0,0,0,y.eu,y.sv,y.w+0,0,0,0,0,y.eu,y.ev,y.w+0,2*y.h+0,0,0,0,y.su,y.ev,0-y.w,2*y.h+0]),Aa.Pf3Tf2F2);this.commonDirectionToTextBufferTable.set(l,{defaultVertexBuffer:m,hoverVertexBuffer:g,textureBuffer:d.buffer}),r+=f}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}this.commonTextIndexBuffer=this.renderView.getGraphicsManager().createIndexBuffer(new Uint16Array([0,1,2,2,3,0]))}},{key:"premakeCommonArrowBuffers",value:function(){var e=this.appEngine,t=this.renderView,n=e.getAsset("spot_mesh");this.commonSpotVertexBuffer=t.getGraphicsManager().createVertexBuffer(new Float32Array(n.vertices),Aa.Pf3Nf3),this.commonSpotIndexBuffer=t.getGraphicsManager().createIndexBuffer(new Uint16Array(n.indices))}},{key:"getSpotShape",value:function(e){var t=new Lo,n=t.createMesh();n.vertexBuffer=this.commonSpotVertexBuffer,n.indexBuffer=this.commonSpotIndexBuffer;var r=this.renderView.getSceneManager().createPhysicsModel(Mn,An),i=this.renderView.getSceneManager().createBVH(Cn,An),a=this.renderView.getSceneManager().createChunks(1,An)[0];a.bound.fromVertexBuffer(n.vertexBuffer,Aa.Pf3Nf3),a.offset=0,a.length=n.indexBuffer.indexLength,a.mesh=n,a.id=e,Mt(t.scale,1/6,1/6,1/12),n.setChunk(a),r.setBVHRoot(i),n.setPhysicsModel(r);var o=t.createMaterial();return o.setDiffuseColor(0,0,0,.9),t.createRenderable(n,o).indexLength=n.indexBuffer.indexLength,t}},{key:"getTextShape",value:function(e){var t=this.commonDirectionToTextBufferTable.get(e),n=new Lo,r=n.createMesh();r.vertexBuffer=t.defaultVertexBuffer,r.indexBuffer=this.commonTextIndexBuffer;var i=n.createMaterial();return i.addTexture(va.DIFFUSE,t.textureBuffer),i.setDiffuseColor(1,1,1,1),n.createRenderable(r,i).indexLength=r.indexBuffer.indexLength,n}},{key:"getHoverTextShape",value:function(e){var t=this.commonDirectionToTextBufferTable.get(e),n=new Lo,r=n.createMesh();r.vertexBuffer=t.hoverVertexBuffer,r.indexBuffer=this.commonTextIndexBuffer;var i=n.createMaterial();return i.addTexture(va.DIFFUSE,t.textureBuffer),i.setDiffuseColor(1,1,1,1),n.createRenderable(r,i).indexLength=r.indexBuffer.indexLength,n}},{key:"setHover",value:function(e){if(e){var t=e.chunk.mesh.getShape();this.targetLayer.removeShape(e.id),this.targetLayer.addShape(e.id,t),this.billboardLayer.removeShape(e.id),this.billboardLayer.addShape(e.id,this.nodeToDirHoverTextShapeTable.get(e.id)),t.materialPool[0].setDiffuseColor(49/255,151/255,251/255,1),this.selectedNode=e.id}else{this.selectedNode=null;var n=!0,r=!1,i=void 0;try{for(var a,o=this.activatedNodes[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;this.targetLayer.getShape(s).materialPool[0].setDiffuseColor(0,0,0,.9),this.billboardLayer.removeShape(s),this.billboardLayer.addShape(s,this.nodeToDirTextShapeTable.get(s))}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}}},{key:"overSpot",value:function(e,t){if(this.enabled){var n=this.picker.pickScreenPoint([e,t],this.targetLayer.getName()).getCollision(0);return this.setHover(null),!!n&&(this.setHover(n),!0)}}},{key:"clickSpot",value:function(e,t){if(this.enabled){var n=this.picker.pickScreenPoint([e,t],this.targetLayer.getName()).getCollision(0);return n?this.nodeToSpotDataTable.get(n.id).panoId:null}}}])&&Pd(n.prototype,r),i&&Pd(n,i),t}();function Ad(e){return(Ad="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ld(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Dd(e){return(Dd=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Nd(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fd(e,t){return(Fd=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var jd=new Uint16Array([0,1,2,0,2,3,0,3,4,0,4,1]),Vd=[],Bd=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(e,t){return!t||"object"!==Ad(t)&&"function"!=typeof t?Nd(e):t}(this,Dd(t).call(this,e,n))).atlasManager=r,i.name="roadview-roadname-ui",i.targetLayer=null,i.terrain=null,i.panoramaInfo=null,i.commonIndexBuffer=n.getGraphicsManager().createIndexBuffer(jd),i.directionToNodeTable=new Map,i.nodeToShapeTable=new Map,i.activatedNodes=new Set,i.roadnameToCommonDataTable=new Map,i.atlasData=null,i.dataUpdatedListener=i.onDataUpdated.bind(Nd(i)),i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fd(e,t)}(t,cd),n=t,(r=[{key:"enable",value:function(){this.enabled||(this.enabled=!0,this.targetLayer=this.renderView.getSceneManager().getLayer("panorama_roadname"),this.terrain=this.renderView.getSceneManager().getTerrain(),this.panoramaInfo=this.terrain.getPanoramaInfo(),this.panoramaInfo.on("street_created",this.dataUpdatedListener))}},{key:"disable",value:function(){this.enabled&&(this.clear(),this.enabled=!1,this.panoramaInfo.off("street_created",this.dataUpdatedListener),this.targetLayer=this.terrain=this.panoramaInfo=null)}},{key:"onDataUpdated",value:function(){this.enabled&&(this.panoData=this.terrain.getPanoramaInfo().getPanoramaRawData(),this.panoData&&this.update())}},{key:"dataUpdate",value:function(e){this.enabled&&(this.panoData=e,this.panoData&&this.update())}},{key:"clear",value:function(){if(this.enabled){var e=!0,t=!1,n=void 0;try{for(var r,i=this.activatedNodes[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;this.targetLayer.removeShape(a)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this.activatedNodes.clear()}}},{key:"update",value:function(){if(this.enabled&&this.panoData){this.clear();var e=this.panoData.spots,t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(o.stName){var s=this.makeNode(o.dirname,o.repeatCount),u=this.makeShape(s),l=this.roadnameToCommonDataTable.get(o.stName);l||(l=this.createCommonData(o.stName)),u.meshPool[0].vertexBuffer=l.vertexBuffer,u.materialPool[0].addTexture(va.DIFFUSE,l.textureBuffer),Ht(u.orientation),Wt(u.orientation,o.angleRad+2*Math.PI),Et(Vd),Lt(Vd,o.direction,10),Ct(u.position,o.position,Vd),Mt(u.scale,4,2,1),u.position[2]=0,u.updateTransform(),this.targetLayer.addShape(s,u),this.activatedNodes.add(s)}}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}}},{key:"makeNode",value:function(e,t){var n=e+t,r=this.directionToNodeTable.get(n);return r||(r=new ks(null,null,0,0,c.indexOf(e)+c.length*(t-1)),this.directionToNodeTable.set(n,r)),r}},{key:"makeShape",value:function(e){var t=this.nodeToShapeTable.get(e);if(!t){var n=(t=new Lo).createMesh();n.indexBuffer=this.commonIndexBuffer;var r=t.createMaterial();r.setDiffuseColor(0,0,0,0),t.createRenderable(n,r).indexLength=n.indexBuffer.indexLength,this.nodeToShapeTable.set(e,t)}return t}},{key:"createCommonData",value:function(e){var t=this.renderView.getGraphicsManager().getPixelRatio(),n=this.atlasManager.addText(e,{text:e,size:52*t,color:"#fff",alpha:.65,posX:0*t,posY:5*t},{strokeSize:5,strokeBlur:1,strokeColor:"#444",strokeAlpha:.4},{bgColor:"#f00",bgAlpha:0,radius:0,paddingX:0,paddingY:0}),r=n.texCoords,i=.5*(r.su+r.eu),a=.5*(r.sv+r.ev),o=new Float32Array([0,0,1,0,i,a,1,-1,-1,1,0,r.su,r.sv,1,1,-1,1,0,r.eu,r.sv,1,1,1,1,0,r.eu,r.ev,1,-1,1,1,0,r.su,r.ev,1]),s={vertexBuffer:this.renderView.getGraphicsManager().createVertexBuffer(o,Aa.Pf4Tf3),textureBuffer:n.buffer};return this.roadnameToCommonDataTable.set(e,s),s}}])&&Ld(n.prototype,r),i&&Ld(n,i),t}();function Ud(e){return(Ud="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Hd(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zd(e){return(zd=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wd(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qd(e,t){return(qd=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Yd=function(e){function t(e,n,r){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(e,t){return!t||"object"!==Ud(t)&&"function"!=typeof t?Wd(e):t}(this,zd(t).call(this,e,n))).name="roadview-route-ui",i.targetLayer=null,i.terrain=null,i.panoramaInfo=null,i.panoData=null,i.nodeToTable=new Map;var a=e.getAsset("common_sprite");return i.patternAtlas=r.addImage("line_pattern",{img:a.source,width:145,height:280},{spriteName:"common_sprite",spriteOriginX:0,spriteOriginY:0,spriteWidth:a.width,spriteHeight:a.height}),i.nodeToShape=new ks(null,null,0,0,0),i.dataUpdatedListener=i.onDataUpdated.bind(Wd(i)),i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qd(e,t)}(t,cd),n=t,(r=[{key:"enable",value:function(){this.enabled||(this.enabled=!0,this.targetLayer=this.renderView.getSceneManager().getLayer("panorama_path"),this.terrain=this.renderView.getSceneManager().getTerrain(),this.panoramaInfo=this.terrain.getPanoramaInfo(),this.panoramaInfo.on("route_created",this.dataUpdatedListener),this.panoramaInfo.on("route_deleted",this.dataUpdatedListener),this.panoramaInfo.on("street_created",this.dataUpdatedListener))}},{key:"disable",value:function(){this.enabled&&(this.clear(),this.enabled=!1,this.panoramaInfo.off("route_created",this.dataUpdatedListener),this.panoramaInfo.off("route_deleted",this.dataUpdatedListener),this.panoramaInfo.off("street_created",this.dataUpdatedListener),this.targetLayer=this.terrain=this.panoramaInfo=null)}},{key:"onDataUpdated",value:function(){this.enabled&&(this.panoData=this.terrain.getPanoramaInfo().getPanoramaRawData(),this.panoData&&this.update())}},{key:"dataUpdate",value:function(e){this.enabled&&(this.panoData=e,this.panoData&&this.update())}},{key:"clear",value:function(){if(this.enabled){var e=this.targetLayer.getShape(this.nodeToShape);this.targetLayer.clearShape(),this.removeShape(e)}}},{key:"update",value:function(){if(this.enabled&&this.panoData){var e=this.panoData.position,t=this.panoramaInfo.getRoutePath();if(t){var n=t.getTesselator(),r=t.search(e,100);if(r[0].length>0){n.tesselate(r,this.patternAtlas,e);var i=n.getResult(),a=i.vertices,o=i.indices,s=t.bound.getCenter(),u=this.makeShape(a,o,s);this.targetLayer.addShape(this.nodeToShape,u)}else this.clear()}else this.clear()}}},{key:"makeShape",value:function(e,t,n){var r=new Lo,i=r.createMesh();i.vertexBuffer=this.renderView.getGraphicsManager().createVertexBuffer(new Float32Array(e),Aa.Pf4Nf4Tf4),i.indexBuffer=this.renderView.getGraphicsManager().createIndexBuffer(new Uint16Array(t));var a=Gd(ls("#339266",.7),4),o=a[0],s=a[1],u=a[2],l=a[3],c=r.createMaterial();return c.addTexture(va.DIFFUSE,this.patternAtlas.buffer),c.setDiffuseColor(o,s,u,l),r.createRenderable(i,c).indexLength=i.indexBuffer.indexLength,Mt(r.position,n[0],n[1],0),r.updateTransform(),r}},{key:"removeShape",value:function(e){e&&this.appEngine.requestRenderFrame(function(){var t=e.meshPool[0];t&&(t.vertexBuffer.reset(),t.indexBuffer.reset())})}}])&&Hd(n.prototype,r),i&&Hd(n,i),t}();function Xd(e){return(Xd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Kd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Zd(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Qd(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Jd(e,t){return!t||"object"!==Xd(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $d(e){return($d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ev(e,t){return(ev=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var tv=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=Jd(this,$d(t).call(this,e,n))).atlasManager=r,i.name="roadview-indicator-ui",i.targetLayer=null,i.billboardLayer=null,i.terrain=null,i.panoramaInfo=null,i.indexMap={rsIndexOffset:0,rsIndexLength:0,groundIndexOffset:0,groundIndexLength:0,groundEdgeIndexOffset:0,groundEdgeIndexLength:0,wallIndexOffset:0,wallIndexLength:0,wallEdgeIndexOffset:0,wallEdgeIndexLength:0},i.arrowAtlas=null,i.jumpAtlas=null,i.cursorGroundNode=new ks(null,null,0,0,0),i.cursorWallNode=new ks(null,null,0,0,1),i.cursorJumpNode=new ks(null,null,0,0,2),i.nextStreetNode=new ks(null,null,0,0,3),i.meterTextNode=new ks(null,null,0,0,4),i.meterTextShapeTable=new Map,i.meterTextAtlasData={prefix:null,numbers:[],surfix:null},i.meterTextIndexBuffer=null,i.cursorVertexBuffer=null,i.cursorIndexBuffer=null,i.jumpfarVertexBuffer=null,i.jumpfarIndexBuffer=null,i.activeCursorNode=null,i.activeCursorStyle=m.GROUND,i.activeCursorShape=null,i.nextStreetData=null,i.nextStreetDataList=[],i.nodeToShapeTable=new Map,i.backupRay=null,i.isHide=!1,i.premakeVertex(),i.premakeShape(),i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ev(e,t)}(t,cd),n=t,(r=[{key:"enable",value:function(){this.enabled||(this.enabled=!0,this.targetLayer=this.renderView.getSceneManager().getLayer("panorama_indicator"),this.billboardLayer=this.renderView.getSceneManager().getLayer("panorama_billboard_indicator"),this.terrain=this.renderView.getSceneManager().getTerrain(),this.panoramaInfo=this.terrain.getPanoramaInfo())}},{key:"disable",value:function(){this.enabled&&(this.clear(),this.enabled=!1,this.targetLayer=this.terrain=this.panoramaInfo=null)}},{key:"clear",value:function(){this.enabled&&(this.nextStreetData=null,this.nextStreetDataList.length=0,this.targetLayer.clearShape(),this.billboardLayer.clearShape(),this.isHide=!0)}},{key:"getNextStreet",value:function(){return this.nextStreetData}},{key:"getNextStreetList",value:function(){return this.nextStreetDataList.map(function(e){return e.panoId})}},{key:"getCursorPosition",value:function(){if(this.enabled){var e=this.activeCursorShape;return e?[e.position[0],e.position[1],0]:null}}},{key:"update",value:function(e){if(this.enabled){this.targetLayer.clearShape(),this.billboardLayer.clearShape();var t=this.panoramaInfo.getDepthmap(),n=this.panoramaInfo.getPanoramaRawData(),r=this.panoramaInfo.getRangesearch();if(n&&this.panoramaInfo.getCurrentViewType()===a&&t){var i=t.getDataFromDirection(e.dir);if(i&&!i.isSky){this.nextStreetData=null,this.nextStreetDataList.length=0,this.backupRay=e;var o=this.checkLongJump(i),s=i.isWall;this.setCursorStyle(o,s);var u=this.activeCursorShape=this.nodeToShapeTable.get(this.activeCursorNode);if(this.updateCursorPosition(u,e,i,t,o),!o&&i.depth<50&&r&&this.searchNextStreet(e,u.position,n,r,!0)){var l=this.nodeToShapeTable.get(this.nextStreetNode);l&&this.updateRangeSearchMark(l,n)}}}}}},{key:"setCursorStyle",value:function(e,t){e?(this.activeCursorNode=this.cursorJumpNode,this.activeCursorStyle=m.LONG):t?(this.activeCursorNode=this.cursorWallNode,this.activeCursorStyle=m.WALL):(this.activeCursorNode=this.cursorGroundNode,this.activeCursorStyle=m.GROUND)}},{key:"getCursorStyle",value:function(){return this.activeCursorStyle}},{key:"updateMeterTextPosition",value:function(e,t){var n=10*Math.floor(e/10),r=e<=10?e:n+5*Math.floor((e-n)/5),i=this.makeMeterShape(Math.round(r));It(i.position,t),i.updateTransform(),this.billboardLayer.addShape(this.meterTextNode,i)}},{key:"updateCursorPosition",value:function(e,t,n,r,i){var a,o,s=[t.pos[0]+t.dir[0]*n.depth,t.pos[1]+t.dir[1]*n.depth,t.pos[2]+t.dir[2]*n.depth];if(i)this.billboardLayer.addShape(this.activeCursorNode,e),It(e.position,s);else{if(Ht(e.orientation),n.isWall){var u=Math.atan2(n.normal[1],n.normal[0])-Math.PI/2,l=(a=[],o=-Math.PI/2,a[0]=Ut(.5*o),a[1]=0,a[2]=0,a[3]=Gt(.5*o),a),c=function(e,t){return e[0]=0,e[1]=Ut(.5*t),e[2]=0,e[3]=Gt(.5*t),e}([],-u);!function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=n[0],u=n[1],l=n[2],c=n[3];e[0]=r*c+o*s+i*l-a*u,e[1]=i*c+o*u+a*s-r*l,e[2]=a*c+o*l+r*u-i*s,e[3]=o*c-r*s-i*u-a*l}(e.orientation,l,c)}It(e.position,s),this.targetLayer.addShape(this.activeCursorNode,e)}return e.updateTransform(),e}},{key:"updateRangeSearchMark",value:function(e,t){var n=this.nextStreetData;It(e.position,[n.markPosition[0],n.markPosition[1],0]);var r=Vt([],Rt([],n.position,t.position)),i=Math.acos(Dt(r,[1,0,0]));Dt(r,[0,1,0])<0&&(i=2*Math.PI-i),Wt(e.orientation,i),e.updateTransform(),this.targetLayer.addShape(this.nextStreetNode,e)}},{key:"getNearestSpot",value:function(e,t){for(var n,r=null,i=2*Math.PI,a=t.spots,o=0;n=a[o];++o){var s=Math.acos(Dt(n.direction,e.dir));s<=i&&(r=n,i=s)}return r}},{key:"searchNextStreet",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!r||r.isEmpty)return!1;this.nextStreetData=null,this.nextStreetDataList.length=0;var a=1/0,o=this.getNearestSpot(e,n),s=r.getSpotList(o.dirname);if(!s)return!1;var u=s.nodes,l=[t[0],t[1],0];i&&u.slice(0,2).forEach(function(e){o.panoId===e.panoId&&n.areaType!==e.areaType&&(i=!1)});for(var c,f=0;c=u[f];++f){var h=Ft(c.position,l);h<a&&(!i||n.areaType===c.areaType)&&(a=h,this.nextStreetData=c,this.nextStreetDataList.push(c))}return!(!this.nextStreetData||n.panoId===this.nextStreetData.panoId)||(this.nextStreetData=null,this.nextStreetDataList.length=0,!1)}},{key:"checkLongJump",value:function(e){return!!(e.depth>50&&e.isGround)}},{key:"premakeVertex",value:function(){var e=this.appEngine,t=this.renderView,n=this.atlasManager,r=(this.renderView.getGraphicsManager().getPixelRatio(),e.getAsset("common_sprite"));this.arrowAtlas=n.addImage("ground_pattern",{img:r.source,width:112,height:112},{spriteName:"common_sprite",spriteOriginX:147,spriteOriginY:109,spriteWidth:r.width,spriteHeight:r.height});var i=this.arrowAtlas.texCoords,a=.5*(i.su+i.eu),o=.5*(i.sv+i.ev),s=[],u=[],l=Float32Array.BYTES_PER_ELEMENT,c=Aa.Pf4Tf3.stride/l,f=null;this.indexMap.rsIndexOffset=0,f=this.makeCircleIndices(0),u.push.apply(u,Zd(f)),this.indexMap.rsIndexLength=f.length,s.push.apply(s,Zd(this.makeCircleVertices(!0,i,0,1,a,o,.3))),this.indexMap.groundIndexOffset=2*u.length,f=this.makeCircleIndices(s.length/c,!0),u.push.apply(u,Zd(f)),this.indexMap.groundIndexLength=f.length,f=this.makeCircleIndices(s.length/c,!1),u.push.apply(u,Zd(f)),this.indexMap.groundIndexLength+=f.length,this.indexMap.groundEdgeIndexOffset=2*u.length,f=this.makeCircleEdgeIndices(s.length/c),u.push.apply(u,Zd(f)),this.indexMap.groundEdgeIndexLength=f.length,s.push.apply(s,Zd(this.makeCircleVertices(!1,i,0,0,0,0,1))),this.indexMap.wallIndexOffset=2*u.length,f=this.makeRectIndices(s.length/c),u.push.apply(u,Zd(f)),this.indexMap.wallIndexLength=f.length,this.indexMap.wallEdgeIndexOffset=2*u.length,f=this.makeRectEdgeIndices(s.length/c),u.push.apply(u,Zd(f)),this.indexMap.wallEdgeIndexLength=f.length,s.push.apply(s,Zd(this.makeRectVertices(!1,i,0,0,0,0,1))),this.cursorVertexBuffer=t.getGraphicsManager().createVertexBuffer(new Float32Array(s),Aa.Pf4Tf3),this.cursorIndexBuffer=t.getGraphicsManager().createIndexBuffer(new Uint16Array(u)),r=e.getAsset("common_sprite"),this.jumpAtlas=n.addImage("jumpfar",{img:r.source,width:199,height:81},{spriteName:"common_sprite",spriteOriginX:261,spriteOriginY:109,spriteWidth:r.width,spriteHeight:r.height}),i=this.jumpAtlas.texCoords,this.jumpfarVertexBuffer=t.getGraphicsManager().createVertexBuffer(new Float32Array(this.makeBillboardVertices(this.jumpAtlas.texCoords,0,-i.h,.35,.35)),Aa.Pf3Tf2F2),this.jumpfarIndexBuffer=t.getGraphicsManager().createIndexBuffer(new Uint16Array([0,1,2,2,3,0]))}},{key:"premakeShape",value:function(){var e=new Lo,t=e.createMesh();t.vertexBuffer=this.cursorVertexBuffer,t.indexBuffer=this.cursorIndexBuffer;var n=Kd(ls("#3396ff",.8),4),r=n[0],i=n[1],a=n[2],o=n[3],s=e.createMaterial();s.addTexture(va.DIFFUSE,this.arrowAtlas.buffer),s.setDiffuseColor(r,i,a,o);var u=e.createRenderable(t,s);u.indexOffset=this.indexMap.rsIndexOffset,u.indexLength=this.indexMap.rsIndexLength,this.nodeToShapeTable.set(this.nextStreetNode,e),(t=(e=new Lo).createMesh()).vertexBuffer=this.jumpfarVertexBuffer,t.indexBuffer=this.jumpfarIndexBuffer,(s=e.createMaterial()).addTexture(va.DIFFUSE,this.jumpAtlas.buffer),s.setDiffuseColor(0,0,0,1),(u=e.createRenderable(t,s)).indexOffset=0,u.indexLength=6,this.nodeToShapeTable.set(this.cursorJumpNode,e),(t=(e=new Lo).createMesh()).vertexBuffer=this.cursorVertexBuffer,t.indexBuffer=this.cursorIndexBuffer,(s=e.createMaterial()).addTexture(va.DIFFUSE,this.arrowAtlas.buffer),s.setDiffuseColor(1,1,1,.4),(u=e.createRenderable(t,s)).indexOffset=this.indexMap.groundIndexOffset,u.indexLength=this.indexMap.groundIndexLength,(s=e.createMaterial()).addTexture(va.DIFFUSE,this.arrowAtlas.buffer),s.setDiffuseColor(1,1,1,.3),(u=e.createRenderable(t,s)).indexOffset=this.indexMap.groundEdgeIndexOffset,u.indexLength=this.indexMap.groundEdgeIndexLength,u.drawMode=WebGLRenderingContext.LINES,this.nodeToShapeTable.set(this.cursorGroundNode,e),(t=(e=new Lo).createMesh()).vertexBuffer=this.cursorVertexBuffer,t.indexBuffer=this.cursorIndexBuffer,(s=e.createMaterial()).addTexture(va.DIFFUSE,this.arrowAtlas.buffer),s.setDiffuseColor(1,1,1,.4),(u=e.createRenderable(t,s)).indexOffset=this.indexMap.wallIndexOffset,u.indexLength=this.indexMap.wallIndexLength,(s=e.createMaterial()).addTexture(va.DIFFUSE,this.arrowAtlas.buffer),s.setDiffuseColor(1,1,1,.3),(u=e.createRenderable(t,s)).indexOffset=this.indexMap.wallEdgeIndexOffset,u.indexLength=this.indexMap.wallEdgeIndexLength,u.drawMode=WebGLRenderingContext.LINES,this.nodeToShapeTable.set(this.cursorWallNode,e)}},{key:"makeMeterShape",value:function(e){var t=this.meterTextShapeTable.get(e),n=this.renderView.getGraphicsManager().getPixelRatio();if(!t){for(var r=e+"",i=1===r.length?18:24,a=this.meterTextAtlasData.prefix,o=this.makeBillboardVertices(a.texCoords,0,25),s=25*n,u=0,l=s,c=0;c<r.length;c++){var f=r.charAt(c);a=this.meterTextAtlasData.numbers[parseInt(f,10)],o.push.apply(o,Zd(this.makeBillboardVertices(a.texCoords,s+c*u,25))),l+=u=a.texCoords.w+3*n}l+=2,a=this.meterTextAtlasData.surfix,o.push.apply(o,Zd(this.makeBillboardVertices(a.texCoords,l,23)));var h=this.renderView.getGraphicsManager().createVertexBuffer(new Float32Array(o),Aa.Pf3Tf2F2),p=(t=new Lo).createMesh();p.vertexBuffer=h,p.indexBuffer=this.meterTextIndexBuffer;var d=t.createMaterial();d.addTexture(va.DIFFUSE,a.buffer),d.setDiffuseColor(0,0,0,1),t.createRenderable(p,d).indexLength=i,this.meterTextShapeTable.set(e,t)}return t}},{key:"makeCircleVertices",value:function(e,t,n,r,i,a,o){var s=[1,0],u=[];u.push.apply(u,[0,0,e?1:0,n,i,a,o]);for(var l=0;l<=360;l+=5){var c=l*Math.PI/180,f=s[0]*Math.cos(c)-s[1]*Math.sin(c),h=s[0]*Math.sin(c)+s[1]*Math.cos(c),p=i+Math.cos(c)*(.5*(t.eu-t.su)),d=a+Math.sin(c)*(.5*(t.ev-t.sv));u.push.apply(u,[f,h,e?1:0,r,p,d,o])}return u}},{key:"makeCircleIndices",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=5,r=360,i=r/n+1,a=[],o=1;o<i;o++)t?a.push(0+e,o+e,o+e+1):a.push(0+e,o+e+1,o+e);return a}},{key:"makeCircleEdgeIndices",value:function(e){for(var t=[],n=1;n<73;n++)t.push(n+e,n+e+1);return t}},{key:"makeRectVertices",value:function(e,t,n,r,i,a,o){return[0,0,e?1:0,n,i,a,o,-1,-1,e?1:0,r,t.su,t.sv,o,1,-1,e?1:0,r,t.eu,t.sv,o,1,1,e?1:0,r,t.eu,t.ev,o,-1,1,e?1:0,r,t.su,t.ev,o]}},{key:"makeRectIndices",value:function(e){return[0+e,1+e,2+e,0+e,2+e,3+e,0+e,3+e,4+e,0+e,4+e,1+e,0+e,2+e,1+e,0+e,3+e,2+e,0+e,4+e,3+e,0+e,1+e,4+e]}},{key:"makeRectEdgeIndices",value:function(e){return[1+e,2+e,2+e,3+e,3+e,4+e,4+e,1+e]}},{key:"makeBillboardVertices",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=e.w*r,o=e.h*i,s=t*r,u=n*i;return[0,0,0,e.su,e.sv,-a+s,0+u,0,0,0,e.eu,e.sv,a+s,0+u,0,0,0,e.eu,e.ev,a+s,2*o+u,0,0,0,e.su,e.ev,-a+s,2*o+u]}}])&&Qd(n.prototype,r),i&&Qd(n,i),t}();function nv(e){return(nv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function iv(e,t){return!t||"object"!==nv(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function av(e){return(av=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ov(e,t){return(ov=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var sv=new Uint16Array([0,1,2,2,3,0,4,5,6,6,7,4]),uv=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=iv(this,av(t).call(this,e,n))).atlasManager=r,i.name="roadview-past-empty-ui",i.panoramaInfo=null,i.targetLayer=null,i.emptyNode=new ks(null,null,0,0,0),i.emptyShape=null,i.imgAtlas=null,i.txtAtlas=null,i.prevWidth=-1,i.prevHeight=-1,i.onRatioChange=function(){i.panoramaInfo.isCompareModeEmptyPast()&&i.update()},i.onEmptyPast=function(){i.panoramaInfo.isCompareModeEmptyPast()?i.update():i.clear()},i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ov(e,t)}(t,cd),n=t,(r=[{key:"enable",value:function(){this.enabled||(this.enabled=!0,this.panoramaInfo=this.renderView.getSceneManager().getTerrain().getPanoramaInfo(),this.targetLayer=this.renderView.getSceneManager().getLayer("past_empty_overlay"),this.panoramaInfo.on("comparemode_ratio_changed",this.onRatioChange),this.panoramaInfo.on("comparemode_empty_past",this.onEmptyPast),this.emptyShape||this.prepareShape())}},{key:"disable",value:function(){this.enabled&&(this.enabled=!1,this.panoramaInfo.off("comparemode_ratio_changed",this.onRatioChange),this.panoramaInfo.off("comparemode_empty_past",this.onEmptyPast),this.targetLayer=null,this.panoramaInfo=null)}},{key:"prepareShape",value:function(){var e=this.atlasManager,t=this.appEngine.getAsset("common_sprite");this.imgAtlas=e.addImage("emptyImage",{img:t.source,width:49,height:44},{spriteName:"common_sprite",spriteOriginX:147,spriteOriginY:223,spriteWidth:t.width,spriteHeight:t.height}),this.txtAtlas=e.addImage("emptyText",{img:t.source,width:240,height:15},{spriteName:"common_sprite",spriteOriginX:147,spriteOriginY:36,spriteWidth:t.width,spriteHeight:t.height});var n=this.emptyShape=new Lo,r=n.createMesh();if(r.indexBuffer=this.renderView.getGraphicsManager().createIndexBuffer(sv),this.imgAtlas.buffer===this.txtAtlas.buffer){var i=n.createMaterial();i.addTexture(va.DIFFUSE,this.txtAtlas.buffer),i.setDiffuseColor(0,0,0,1),n.createRenderable(r,i).indexLength=r.indexBuffer.indexLength}else[[this.imgAtlas.buffer,0,6],[this.txtAtlas.buffer,6,6]].forEach(function(e){var t=n.createMaterial();t.addTexture(va.DIFFUSE,e[0]),t.setDiffuseColor(0,0,0,1);var i=n.createRenderable(r,t);i.indexOffset=e[1],i.indexLength=e[2]})}},{key:"makeShape",value:function(e,t,n){var r=this.imgAtlas.texCoords,i=this.txtAtlas.texCoords,a=r.w,o=r.h,s=[.5*a+.5*e,o+.5*t],u=[2*(s[0]-a/2)-n,2*(s[1]-o/2)-t],l=i.w,c=i.h,f=[.5*l+.5*e,2*c+.5*t-o],h=[2*(f[0]-l/2)-n,2*(f[1]-c/2)-t],p=[1/n,1/t],d=[-1*a*p[0]+u[0]*p[0],-1*o*p[1]+u[1]*p[1],0,r.su,r.sv,1*a*p[0]+u[0]*p[0],-1*o*p[1]+u[1]*p[1],0,r.eu,r.sv,1*a*p[0]+u[0]*p[0],1*o*p[1]+u[1]*p[1],0,r.eu,r.ev,-1*a*p[0]+u[0]*p[0],1*o*p[1]+u[1]*p[1],0,r.su,r.ev],v=[-1*l*p[0]+h[0]*p[0],-1*c*p[1]+h[1]*p[1],0,i.su,i.sv,1*l*p[0]+h[0]*p[0],-1*c*p[1]+h[1]*p[1],0,i.eu,i.sv,1*l*p[0]+h[0]*p[0],1*c*p[1]+h[1]*p[1],0,i.eu,i.ev,-1*l*p[0]+h[0]*p[0],1*c*p[1]+h[1]*p[1],0,i.su,i.ev],y=this.emptyShape.meshPool[0],m=new Float32Array([].concat(d,v));y.vertexBuffer=this.renderView.getGraphicsManager().createVertexBuffer(m,Aa.Pf3Tf2)}},{key:"update",value:function(){if(this.enabled){var e=this.renderView.getSceneManager().getCamera(),t=e.viewportWidth*this.panoramaInfo.getCompareModeRatio(),n=e.viewportHeight;if(this.prevWidth!==t||this.prevHeight!==n){var r=e.viewportWidth;this.makeShape(t,n,r),this.targetLayer.addShape(this.emptyNode,this.emptyShape),this.prevWidth=t,this.prevHeight=n}}}},{key:"clear",value:function(){this.enabled&&(this.targetLayer.removeShape(this.emptyNode),this.prevWidth=-1,this.prevHeight=-1)}},{key:"updateEmptyText",value:function(){this.enabled&&this.update()}}])&&rv(n.prototype,r),i&&rv(n,i),t}();function lv(e){return(lv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fv(e,t){return!t||"object"!==lv(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function hv(e){return(hv=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pv(e,t){return(pv=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var dv=new Uint16Array([0,1,2,2,3,0]),vv=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=fv(this,hv(t).call(this,e,n))).userAtlasManager=r,i.name="panorama-overlay-ui",i.targetLayer=null,i.shapeTable=new Map,i.shapeDataTable=new Map,i.markerTable=new Map,i.picker=new Sd(n),i.lastSelectedMarker=null,i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pv(e,t)}(t,cd),n=t,(r=[{key:"enable",value:function(){this.enabled||(this.enabled=!0,this.targetLayer=this.renderView.getSceneManager().getLayer("panorama_screen_overlay"))}},{key:"disable",value:function(){this.enabled&&(this.enabled=!1,this.targetLayer=null)}},{key:"showMarker",value:function(){this.targetLayer.visible=!0}},{key:"hideMarker",value:function(){this.targetLayer.visible=!1}},{key:"getMarker",value:function(e){return this.markerTable.has(e)?this.markerTable.get(e):null}},{key:"addMarker",value:function(e){if(!e.source)return console.warn("Marker Source가 필요합니다.");var t=this.getShapeDataFromSource(e.source),n=this.getAndCreateShape(e,t);this.targetLayer.addShape(e.key,n),this.markerTable.set(e.key,e)}},{key:"removeMarker",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.targetLayer.removeShape(e.key),this.markerTable.delete(e.key),t&&(this.shapeTable.delete(e.key),this.shapeDataTable.delete(e.key))}},{key:"clearMarker",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;this.removeMarker(s,t)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}t&&this.userAtlasManager.clear()}},{key:"changeMarker",value:function(e,t){switch(t){case"source":this.changeMarkerSource(e);break;case"position":this.changeMarkerPosition(e);break;case"opacity":this.changeMarkerAlpha(e);break;case"offset":this.changeMarkerOffset(e)}}},{key:"changeMarkerSource",value:function(e){if(this.shapeTable.has(e.key)){var t=this.shapeTable.get(e.key),n=this.getShapeDataFromSource(e.source),r=e.getOffset(),i=n.vertexGenFunction(r.x,r.y);t.meshPool[0].vertexBuffer=this.renderView.getGraphicsManager().createVertexBuffer(i,Aa.Pf3Tf2F2);var a=t.materialPool[0];this.updateShapeMaterial(a,n.textureBuffer,n.sourceAlpha,e.opacity)}}},{key:"changeMarkerPosition",value:function(e){if(this.shapeTable.has(e.key)){var t=this.shapeTable.get(e.key);this.updateShapePosition(t,e.position)}}},{key:"changeMarkerAlpha",value:function(e){if(this.shapeTable.has(e.key)&&this.shapeDataTable.has(e.source.key)){var t=this.shapeTable.get(e.key),n=this.shapeDataTable.get(e.source.key),r=t.materialPool[0];this.updateShapeMaterial(r,n.textureBuffer,n.sourceAlpha,e.opacity)}}},{key:"changeMarkerOffset",value:function(e){if(this.shapeTable.has(e.key)&&this.shapeDataTable.has(e.source.key)){var t=this.shapeTable.get(e.key),n=this.shapeDataTable.get(e.source.key),r=e.getOffset(),i=n.vertexGenFunction(r.x,r.y);t.meshPool[0].vertexBuffer=this.renderView.getGraphicsManager().createVertexBuffer(i,Aa.Pf3Tf2F2)}}},{key:"getAndCreateShape",value:function(e,t){return this.shapeTable.has(e.key)?this.shapeTable.get(e.key):this.createShape(e.key,e.position,e.opacity,e.offset,t)}},{key:"createShape",value:function(e,t,n,r,i){var a=new Lo,o=i.vertexGenFunction(r.x,r.y),s=a.createMesh();s.vertexBuffer=this.renderView.getGraphicsManager().createVertexBuffer(o,Aa.Pf3Tf2F2),s.indexBuffer=i.indexBuffer;var u=this.renderView.getSceneManager().createPhysicsModel(In,Ln),l=this.renderView.getSceneManager().createBVH(Rn,Ln),c=this.renderView.getSceneManager().createChunks(1,Ln)[0];c.mesh=s,c.id=e,s.setChunk(c),u.setBVHRoot(l),s.setPhysicsModel(u);var f=a.createMaterial();return this.updateShapeMaterial(f,i.textureBuffer,i.sourceAlpha,n),a.createRenderable(s,f).indexLength=s.indexBuffer.indexLength,this.updateShapePosition(a,t),this.shapeTable.set(e,a),a}},{key:"updateShapeMaterial",value:function(e,t,n,r){e.addTexture(va.DIFFUSE,t),e.setDiffuseColor(0,0,0,n*r)}},{key:"updateShapePosition",value:function(e,t){It(e.position,[t.x,t.y,t.z]),e.updateTransform()}},{key:"getShapeDataFromSource",value:function(e){return this.shapeDataTable.has(e.key)?this.shapeDataTable.get(e.key):"image"===e.type?this._createFromImageSource(e):"text"===e.type?this._createFromTextSource(e):null}},{key:"_createFromImageSource",value:function(e){var t,n,r=this.renderView.getGraphicsManager().getPixelRatio(),i=r/e.ratio,a=this.userAtlasManager,o=null;if(e.isSprite){t=e.width*r,n=e.height*r;var s=e.spriteOption.spriteOriginX*r,u=e.spriteOption.spriteOriginY*r;o=a.addImage(e.key,{img:e.image,width:t,height:n},{spriteName:e.spriteOption.spriteName,spriteOriginX:s,spriteOriginY:u,spriteWidth:e.spriteOption.spriteWidth*i,spriteHeight:e.spriteOption.spriteHeight*i})}else t=e.width*r*i,n=e.height*r*i,o=a.addImage(e.key,{img:e.image,width:t,height:n});var l=o.texCoords,c=this.renderView.getGraphicsManager().createIndexBuffer(dv),f={textureBuffer:o.buffer,indexBuffer:c,vertexGenFunction:function(e,i){return e*=r,i*=r,new Float32Array([0,0,0,l.su,l.sv,-t+e,0+i,0,0,0,l.eu,l.sv,t+e,0+i,0,0,0,l.eu,l.ev,t+e,2*n+i,0,0,0,l.su,l.ev,-t+e,2*n+i])},indices:dv,indexLength:6,sourceAlpha:e.alpha};return this.shapeDataTable.set(e.key,f),f}},{key:"_createFromTextSource",value:function(e){var t=this.renderView.getGraphicsManager().getPixelRatio(),n=this.userAtlasManager,r={text:e.text,size:e.size*t,color:e.color,alpha:e.alpha,posX:e.posX,posY:e.posY,isBold:e.isBold},i=e.isStroke?{strokeSize:e.strokeOption.size,strokeBlur:e.strokeOption.blur,strokeColor:e.strokeOption.color,strokeAlpha:e.strokeOption.alpha}:{},a=e.isBackground?{bgColor:e.backgroundOption.color,radius:e.backgroundOption.radius*t,bgAlpha:e.backgroundOption.alpha,paddingX:e.backgroundOption.paddingX,paddingY:e.backgroundOption.paddingY}:{},o=n.addText(e.key,r,i,a,{left:2,top:2,right:2,bottom:2}),s=o.texCoords,u=this.renderView.getGraphicsManager().createIndexBuffer(dv),l={textureBuffer:o.buffer,indexBuffer:u,vertexGenFunction:function(e,n){return e*=t,n*=t,new Float32Array([0,0,0,s.su,s.sv,-s.w+e,0+n,0,0,0,s.eu,s.sv,s.w+e,0+n,0,0,0,s.eu,s.ev,s.w+e,2*s.h+n,0,0,0,s.su,s.ev,-s.w+e,2*s.h+n])},indices:dv,indexLength:6,sourceAlpha:1};return this.shapeDataTable.set(e.key,l),l}},{key:"clickOverlay",value:function(e,t){if(this.enabled){var n=this.picker.pickScreenPoint([e,t],this.targetLayer.getName()).getCollision(0);if(n){var r=n.id,i=this.getMarker(r);return!!i.clickable&&(i.triggerClick(),!0)}return!1}}},{key:"overOverlay",value:function(e,t){if(this.enabled){var n=this.picker.pickScreenPoint([e,t],this.targetLayer.getName()).getCollision(0);if(n){var r=n.id,i=this.getMarker(r);return!!i.hoverable&&(i!==this.lastSelectedMarker&&(this.lastSelectedMarker&&this.lastSelectedMarker.triggerMouseout(),this.lastSelectedMarker=i,i.triggerMouseover()),!0)}return this.lastSelectedMarker&&this.lastSelectedMarker.hoverable&&(this.lastSelectedMarker.triggerMouseout(),this.lastSelectedMarker=null),!1}}}])&&cv(n.prototype,r),i&&cv(n,i),t}();function yv(e){return(yv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mv(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function gv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bv(e,t){return!t||"object"!==yv(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function wv(e){return(wv=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _v(e,t){return(_v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tv=new Uint16Array([0,1,2,2,3,0]),xv=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=bv(this,wv(t).call(this,e,n))).atlasManager=r,i.name="panorama-capture-ui",i.terrain=null,i.renderTarget=null,i.targetLayer=null,i.warterMarkNode=new ks(null,null,0,0,0),i.warterMarkShape=null,i.atlasData=null,i.prevWidth=0,i.prevHeight=0,i.isCapture=!1,i.doneCallback=null,i.opacityTransition=new Oh({from:[3],to:[1],step:function(e){var t=e[0];i.terrain.setGlobalOpacity(t),i.renderView.todoRender()},done:function(){i.onCapture(),i.renderView.todoRender()},duration:200,easing:[xh]}),i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_v(e,t)}(t,cd),n=t,(r=[{key:"enable",value:function(){this.enabled||(this.enabled=!0,this.terrain=this.renderView.getSceneManager().getTerrain(),this.renderTarget=this.renderView.getRenderTarget("diffuse_for_capture"),this.targetLayer=this.renderView.getSceneManager().getLayer("panorama_wartermark"),this.warterMarkShape||this.prepareShape())}},{key:"disable",value:function(){this.enabled&&(this.enabled=!1,this.targetLayer=null,this.renderTarget=null,this.terrain=null)}},{key:"prepareShape",value:function(){var e=this.atlasManager,t=this.appEngine.getAsset("common_sprite");this.atlasData=e.addImage("wartermark",{img:t.source,width:107,height:34},{spriteName:"common_sprite",spriteOriginX:147,spriteOriginY:0,spriteWidth:t.width,spriteHeight:t.height});var n=this.warterMarkShape=new Lo,r=n.createMaterial();r.addTexture(va.DIFFUSE,this.atlasData.buffer),r.setDiffuseColor(0,0,0,1);var i=n.createMesh();i.indexBuffer=this.renderView.getGraphicsManager().createIndexBuffer(Tv),n.createRenderable(i,r).indexLength=i.indexBuffer.indexLength,this.targetLayer.addShape(this.warterMarkNode,n)}},{key:"makeShape",value:function(e,t){var n=this.atlasData.texCoords,r=n.w,i=n.h,a=[e-12,i+10],o=[2*(a[0]-r/2)-e,2*(a[1]-i/2)-t],s=[1/e,1/t],u=It([],[-1*r*s[0]+o[0]*s[0],-1*i*s[1]+o[1]*s[1],0]),l=It([],[1*r*s[0]+o[0]*s[0],-1*i*s[1]+o[1]*s[1],0]),c=It([],[1*r*s[0]+o[0]*s[0],1*i*s[1]+o[1]*s[1],0]),f=It([],[-1*r*s[0]+o[0]*s[0],1*i*s[1]+o[1]*s[1],0]),h=this.warterMarkShape.meshPool[0],p=new Float32Array([].concat(mv(u),[n.su,n.sv],mv(l),[n.eu,n.sv],mv(c),[n.eu,n.ev],mv(f),[n.su,n.ev]));h.vertexBuffer=this.renderView.getGraphicsManager().createVertexBuffer(p,Aa.Pf3Tf2)}},{key:"update",value:function(){var e=this.renderView.getSceneManager().getCamera(),t=e.viewportWidth,n=e.viewportHeight;this.prevWidth===t&&this.prevHeight===n||(this.makeShape(t,n),this.prevWidth=t,this.prevHeight=n)}},{key:"capture",value:function(e){var t=this;this.isCapture||(this.opacityTransition.reset(),this.isCapture=!0,this.doneCallback=e,this.update(),this.appEngine.requestRenderFrame(function(e){t.opacityTransition.startTime=e,t.appEngine.addAnimation(t.opacityTransition)}))}},{key:"onCapture",value:function(){var e=this.renderTarget.getPixelData();"function"==typeof this.doneCallback&&this.doneCallback(e),this.isCapture=!1}}])&&gv(n.prototype,r),i&&gv(n,i),t}();function Sv(e){return(Sv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pv(e,t){return!t||"object"!==Sv(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ov(e){return(Ov=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ev(e,t){return(Ev=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Iv=new Uint16Array([0,1,2,2,3,0]),Mv="default",Cv="capture_",Rv=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=Pv(this,Ov(t).call(this,e,n))).defaultAtlasManager=r,i.name="panorama-copyright-ui",i.copyrightLayer=null,i.extraCopyrightLayer=null,i.extraCopyrightForCaptureLayer=null,i.copyrightAtlasTable=new Map,i.copyrightNodeTable=new Map,i.copyrightShapeTable=new Map,i.picker=new Sd(n),i.copyrightAtlasTable.set(Mv,i.getImageAtlas("copyright",46,19,256,0)),i.copyrightNodeTable.set(Mv,new ks(null,null,0,0,0)),i.copyrightShapeTable.set(Mv,i.makeCopyrightShape(Mv)),i.copyrightAtlasTable.set(w.SEA,i.getTextAtlas(w.SEA,"촬영: 국립공원공단",11)),i.copyrightNodeTable.set(w.SEA,new ks(null,null,0,0,1)),i.copyrightShapeTable.set(w.SEA,i.makeCopyrightShape(w.SEA)),i.copyrightAtlasTable.set(Cv+w.SEA,i.getTextAtlas(Cv+w.SEA,"촬영: 국립공원공단",11)),i.copyrightNodeTable.set(Cv+w.SEA,new ks(null,null,0,0,2)),i.copyrightShapeTable.set(Cv+w.SEA,i.makeCopyrightShape(Cv+w.SEA)),i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ev(e,t)}(t,cd),n=t,(r=[{key:"enable",value:function(){this.enabled||(this.enabled=!0,this.copyrightLayer=this.renderView.getSceneManager().getLayer("panorama_copyright"),this.extraCopyrightLayer=this.renderView.getSceneManager().getLayer("panorama_extra_copyright"),this.extraCopyrightForCaptureLayer=this.renderView.getSceneManager().getLayer("panorama_extra_copyright_for_capture"),this.hideDefaultCopyright())}},{key:"disable",value:function(){this.enabled&&(this.enabled=!1,this.copyrightLayer=null,this.extraCopyrightLayer=null,this.extraCopyrightForCaptureLayer=null)}},{key:"showDefaultCopyright",value:function(){this.copyrightLayer.setVisible(!0),this.updateCopyright()}},{key:"hideDefaultCopyright",value:function(){var e=this.copyrightNodeTable.get(Mv);this.copyrightLayer.setVisible(!1),this.copyrightLayer.removeShape(e)}},{key:"showExtraCopyright",value:function(e){this.extraCopyrightLayer.setVisible(!0),this.extraCopyrightForCaptureLayer.setVisible(!0),this.updateCopyright(e)}},{key:"hideExtraCopyright",value:function(){this.extraCopyrightLayer.setVisible(!1),this.extraCopyrightLayer.clearShape(),this.extraCopyrightForCaptureLayer.setVisible(!1),this.extraCopyrightForCaptureLayer.clearShape()}},{key:"updateCopyright",value:function(e){if(this.enabled){var t=this.renderView.getSceneManager().getCamera(),n=t.viewportWidth,r=t.viewportHeight;if(this.copyrightLayer.visible){var i=this.copyrightAtlasTable.get(Mv),a=this.copyrightNodeTable.get(Mv),o=this.copyrightShapeTable.get(Mv),s=i.texCoords,u=(s.w,s.h);this.updateCopyrightShape(i,o,n-5,u+5,n,r),this.copyrightLayer.addShape(a,o)}if(this.extraCopyrightLayer.visible&&e){var l=this.copyrightAtlasTable.get(e),c=this.copyrightNodeTable.get(e),f=this.copyrightShapeTable.get(e);if(l&&c&&f){var h=l.texCoords,p=(h.w,h.h);this.updateCopyrightShape(l,f,n-73,p+25,n,r),this.extraCopyrightLayer.addShape(c,f)}}if(this.extraCopyrightForCaptureLayer.visible&&e){var d=Cv+e,v=this.copyrightAtlasTable.get(d),y=this.copyrightNodeTable.get(d),m=this.copyrightShapeTable.get(d);if(v&&y&&m){var g=v.texCoords,b=g.w,w=g.h;this.updateCopyrightShape(v,m,b+25,w+25,n,r),this.extraCopyrightForCaptureLayer.addShape(y,m)}}}}},{key:"makeCopyrightShape",value:function(e){var t=this.copyrightAtlasTable.get(e),n=new Lo,r=n.createMesh();r.indexBuffer=this.renderView.getGraphicsManager().createIndexBuffer(Iv);var i=this.renderView.getSceneManager().createPhysicsModel(In,Ln),a=this.renderView.getSceneManager().createBVH(2,Ln),o=this.renderView.getSceneManager().createChunks(1,Ln)[0];o.mesh=r,o.id=this.copyrightNode,r.setChunk(o),i.setBVHRoot(a),r.setPhysicsModel(i);var s=n.createMaterial();return s.addTexture(va.DIFFUSE,t.buffer),s.setDiffuseColor(0,0,0,1),n.createRenderable(r,s).indexLength=r.indexBuffer.indexLength,n}},{key:"updateCopyrightShape",value:function(e,t,n,r,i,a){if(this.enabled){var o=i,s=a,u=e.texCoords,l=u.w,c=u.h,f=[n,r],h=[2*(f[0]-l/2)-o,2*(f[1]-c/2)-s],p=[1/o,1/s],d=[-1*l*p[0]+h[0]*p[0],-1*c*p[1]+h[1]*p[1],0,u.su,u.sv,1*l*p[0]+h[0]*p[0],-1*c*p[1]+h[1]*p[1],0,u.eu,u.sv,1*l*p[0]+h[0]*p[0],1*c*p[1]+h[1]*p[1],0,u.eu,u.ev,-1*l*p[0]+h[0]*p[0],1*c*p[1]+h[1]*p[1],0,u.su,u.ev],v=t.meshPool[0],y=new Float32Array(d);v.vertexBuffer=this.renderView.getGraphicsManager().createVertexBuffer(y,Aa.Pf3Tf2)}}},{key:"getImageAtlas",value:function(e,t,n,r,i){var a=this.appEngine.getAsset("common_sprite");return this.defaultAtlasManager.addImage(e,{img:a.source,width:t,height:n},{spriteName:"common_sprite",spriteOriginX:r,spriteOriginY:i,spriteWidth:a.width,spriteHeight:a.height})}},{key:"getTextAtlas",value:function(e,t,n){var r=this.renderView.getGraphicsManager().getPixelRatio(),i={text:t,size:n*r,color:"#fff",alpha:.8,posX:0,posY:0,isBold:!1},a={},o={};return this.defaultAtlasManager.addText(e,i,a,o,{left:2,top:2,right:2,bottom:2})}},{key:"clickCopyright",value:function(e,t){if(this.enabled){if(this.picker.pickScreenPoint([e,t],this.copyrightLayer.getName()).getCollision(0)){var n=document.createElement("a");return n.target="_blank",n.href="https://map.kakao.com",n.click(),!0}return!1}}},{key:"overCopyright",value:function(e,t){if(this.enabled)return!!this.picker.pickScreenPoint([e,t],this.copyrightLayer.getName()).getCollision(0)}}])&&kv(n.prototype,r),i&&kv(n,i),t}();function Av(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Lv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Dv=document.createElement("canvas"),Nv=Dv.getContext("2d"),Fv=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.app=t,this.commonEnabled=!1,this.roadviewEnabled=!1;var n=new id(t.renderEngine),r=new id(t.renderEngine),i=new id(t.renderEngine);n.startGenerate(),r.startGenerate(),i.startGenerate(),this.userAtlasManager=i,this.roadviewRouteUI=new Yd(this.app.renderEngine,this.app.renderView,n),this.roadviewPastEmptyUI=new uv(this.app.renderEngine,this.app.renderView,n),this.panoOverlayUI=new vv(this.app.renderEngine,this.app.renderView,i),this.panoCaptureUI=new xv(this.app.renderEngine,this.app.renderView,n),this.roadviewIndicatorUI=new tv(this.app.renderEngine,this.app.renderView,n),this.roadviewSpotUI=new Rd(this.app.renderEngine,this.app.renderView,n),this.roadviewRoadNameUI=new Bd(this.app.renderEngine,this.app.renderView,r),this.panoCopyrightUI=new Rv(this.app.renderEngine,this.app.renderView,n),this.currentShotTool=null}var t,n,r;return t=e,(n=[{key:"enableCommon",value:function(){this.commonEnabled||(this.panoOverlayUI.enable(),this.panoCaptureUI.enable(),this.panoCopyrightUI.enable(),this.commonEnabled=!0)}},{key:"disableCommon",value:function(){this.commonEnabled&&(this.panoOverlayUI.disable(),this.panoCaptureUI.disable(),this.panoCopyrightUI.disable(),this.commonEnabled=!1)}},{key:"enableRoadview",value:function(){this.roadviewEnabled||(this.roadviewSpotUI.enable(),this.roadviewRoadNameUI.enable(),this.roadviewRouteUI.enable(),this.roadviewIndicatorUI.enable(),this.roadviewPastEmptyUI.enable(),this.roadviewEnabled=!0)}},{key:"disableRoadview",value:function(){this.roadviewEnabled&&(this.roadviewSpotUI.disable(),this.roadviewRoadNameUI.disable(),this.roadviewRouteUI.disable(),this.roadviewIndicatorUI.disable(),this.roadviewPastEmptyUI.disable(),this.roadviewEnabled=!1)}},{key:"updateForResize",value:function(){this.roadviewPastEmptyUI.updateEmptyText(),this.currentShotTool&&this.panoCopyrightUI.updateCopyright(this.currentShotTool)}},{key:"addMarker",value:function(e){e.checkAndUpdate(),this.panoOverlayUI.addMarker(e),this.app.viewRender(),e.triggerAttached()}},{key:"removeMarker",value:function(e){this.panoOverlayUI.removeMarker(e),this.app.viewRender(),e.triggerDetached()}},{key:"clearMarkers",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;this.panoOverlayUI.removeMarker(s,t)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}t&&this.userAtlasManager.clear(),this.app.viewRender()}},{key:"changeMarker",value:function(e,t){switch(t){case"source":this.panoOverlayUI.changeMarkerSource(e);break;case"position":this.panoOverlayUI.changeMarkerPosition(e);break;case"opacity":this.panoOverlayUI.changeMarkerAlpha(e);break;case"offset":this.panoOverlayUI.changeMarkerOffset(e)}this.app.viewRender()}},{key:"visibleToggleMarker",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?this.panoOverlayUI.showMarker():this.panoOverlayUI.hideMarker()}},{key:"captureAndDownload",value:function(e,t,n){var r=this,i=this.app.renderView.getSceneManager().getCamera(),a=this.app.renderEngine.getGraphicsManager().getContainer();Dv.width=i.viewportWidth,Dv.height=i.viewportHeight;var o=Nv.createImageData(i.viewportWidth,i.viewportHeight);this.app.changeRenderpass(t),this.getCaptureData(function(t){r.app.changeRenderpass(n),o.data.set(t),Nv.save(),Nv.putImageData(o,0,0),Nv.scale(1,-1),Nv.translate(0,-o.height),Nv.drawImage(Dv,0,0),Nv.restore();for(var i=atob(Dv.toDataURL({type:"image/png"}).split(",")[1]),s=i.length,u=new Uint8Array(s),l=0;l<s;++l)u[l]=i.charCodeAt(l);e+=".png";var c=new Blob([u],{type:"image/png"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(c,e);else{var f=document.createElement("a");f.download=e,f.href=URL.createObjectURL(c),f.style.display="none",a.appendChild(f),f.click(),setTimeout(function(){URL.revokeObjectURL(c),f.href=null,a.removeChild(f)},100)}}),this.app.viewRender()}},{key:"getCaptureData",value:function(e){var t=this;this.app.captureMode=!0,this.panoCaptureUI.capture(function(n){t.app.captureMode=!1,"function"==typeof e&&e(n)})}},{key:"repositionIndicator",value:function(){var e=this.roadviewIndicatorUI.backupRay;if(e){var t=Av(e.screenPoint,2),n=t[0],r=t[1];this.roadviewIndicatorUI.update(this.app.getRay(n,r))}}},{key:"showExtraCopyright",value:function(e){if(null===e)return this.panoCopyrightUI.hideExtraCopyright(),void(this.currentShotTool=null);if(this.currentShotTool!==e)switch(this.panoCopyrightUI.hideExtraCopyright(),this.currentShotTool=null,e){case w.SEA:this.panoCopyrightUI.showExtraCopyright(w.SEA),this.currentShotTool=e}}}])&&Lv(t.prototype,n),r&&Lv(t,r),e}();function jv(e){return(jv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Bv(e,t){return!t||"object"!==jv(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Uv(e){return(Uv=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gv(e,t){return(Gv=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Hv=0,zv=function(e){function t(e){var n,i=e.content,a=void 0===i?null:i,o=e.position,s=e.opacity,u=void 0===s?1:s,l=e.margin,c=void 0===l?{}:l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Bv(this,Uv(t).call(this,o,u,[r.ATTACHED,r.DETACHED]))).key="board_"+Hv++,n.type="billboard",n.content=null,n.margin=c,n.width=0,n.height=0,n.hidePaddingValue=20,n.wrap=document.createElement("div"),n.wrap.style.position="absolute",n.setContent(a),n.setMargin(c),n}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gv(e,t)}(t,_s),n=t,(i=[{key:"triggerAttached",value:function(){this.target&&(this.attached=!0,this.dispatch(r.ATTACHED))}},{key:"triggerDetached",value:function(){this.target||(this.attached=!1,this.dispatch(r.DETACHED))}},{key:"setContent",value:function(e){this.changeState.content=!0;var t=this.content;if("string"==typeof e){var n=document.createElement("div");n.innerHTML=e,this.content=n.childNodes[0]}else this.content=e;t&&this.wrap.removeChild(t),this.wrap.appendChild(this.content),this.update("content")}},{key:"setMargin",value:function(e){var t=e.top,n=e.right,r=e.bottom,i=e.left;this.changeState.margin=!0,"number"==typeof t&&(this.wrap.style.marginTop=t+"px"),"number"==typeof n&&(this.wrap.style.marginRight=n+"px"),"number"==typeof r&&(this.wrap.style.marginBottom=r+"px"),"number"==typeof i&&(this.wrap.style.marginLeft=i+"px"),this.changeState.margin=!1}},{key:"setSize",value:function(e,t){this.width=e,this.height=t}},{key:"getSize",value:function(){var e=this.wrap.clientWidth,t=this.wrap.clientHeight;return this.setSize(e,t),{width:this.width,height:this.height}}},{key:"getContent",value:function(){return this.wrap}},{key:"containViewport",value:function(e){var t=this.target.getViewport();return!(e.x<-(this.width+this.hidePaddingValue)||e.x>t.width+this.width+this.hidePaddingValue||e.y<-(this.height+this.hidePaddingValue)||e.y>t.height+this.height+this.hidePaddingValue)}},{key:"update",value:function(e){if(this.target&&this.attached){if("position"===e){var t=this.getScreenPoint();t.z>0&&this.containViewport(t)?(this.wrap.style.display="block",this.wrap.style.transform="translate(".concat(t.x,"px, ").concat(t.y,"px)")):this.wrap.style.display="none"}else"opacity"===e?this.wrap.style.opacity=this.opacity:"content"===e&&this.setSize(this.wrap.clientWidth,this.wrap.clientHeight);this.changeState[e]=!1}}}])&&Vv(n.prototype,i),a&&Vv(n,a),t}();function Wv(e){return(Wv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qv(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Yv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xv(e,t){return!t||"object"!==Wv(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Kv(e){return(Kv=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zv(e,t){return(Zv=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qv=window,Jv="MOTION",$v="QUALITY",ey=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Xv(this,Kv(t).call(this,i.FC_INIT_TYPE,i.FC_CHANGE_TYPE))).app=e,n.domLayer=new Bh(e.renderEngine.getGraphicsManager().getContainer(),"fc"),n.motionTypeRange=[0,P.length-1],n.storage=Qv.localStorage,n.storageKey="motion_type",n.storageKey2="quality_type",n.toastGuideText={motion:["로드뷰 효과 - ON","로드뷰 효과 - OFF","이동 효과만 - OFF","패닝 효과만 - OFF"],quality:{LOW:"프리뷰 - 일반화질",HIGH:"프리뷰 - 고화질"}},n.motionType=x.MOTION.PVT_ON,n.motionPreset=P[n.motionType],n.qualityType=x.QUALITY.LOW,n.qualityPriority=S[n.qualityType],n.previewPreloadMaxCount=k.NORMAL,n.popupArray=[0,1,2].map(function(e){return n.createToast(e)}),n.layerHideTimer=-1,n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zv(e,t)}(t,E),n=t,(r=[{key:"init",value:function(){this.motionType=this.getMotionType(),this.setMotionPreset(this.motionType),this.qualityType=this.getQualityType(),this.setQualityPriority(this.qualityType),this.dispatch(i.FC_INIT_TYPE)}},{key:"createToast",value:function(e){var t=this,n=Date.now()%1e4+e,r=document.createElement("div"),i=document.createElement("div"),a=document.createElement("p");r.id="toastGuideBox_"+n,r.rcss=new Ve("#"+r.id),i.id="toastGuideBack_"+n,i.rcss=new Ve("#"+i.id),a.id="toastGuideText_"+n,a.rcss=new Ve("#"+a.id),r.rcss.cssText("width:160px;height:42px;text-align:center"),i.rcss.cssText("width:160px;height:42px;opacity:0.7;background-color:#000;border-radius:8px"),a.rcss.cssText("width:160px;position:absolute;top:0;left:0;color:#fff;font-size:18px;text-align:center;line-height:24px;opacity:0.8;letter-spacing:-1px;padding:10px 0;"),a.rcss.set("font-family",'AppleSDGothicNeo-Regular,"Malgun Gothic","맑은 고딕",dotum,"돋움",sans-serif'),r.appendChild(i),r.appendChild(a);var o=new zv({content:r});return o.wrap.style.cssText="position:absolute;display:none",this.domLayer.addBoard(o),this.domLayer.layerHide(),{board:o,changeText:function(e){a.innerText=e},updatePosition:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:160,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:44;r.rcss.set("width",n+"px").set("height",s+"px"),i.rcss.set("width",n+"px").set("height",s+"px"),a.rcss.set("width",n+"px");var u=t.app.renderView.getViewport();o.wrap.style.left=u.width/2-n/2+"px",o.wrap.style.top=u.height/5-s/2+e+"px"},show:function(){o.wrap.style.display="block"},hide:function(){o.wrap.style.display="none"}}}},{key:"showToast",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.tx,a=r.ty,o=r.w,s=r.h,u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3,c=this.popupArray[e];clearTimeout(this.layerHideTimer),this.layerHideTimer=-1,this.domLayer.layerShow(),c.changeText(t),c.updatePosition(i,a,o,s),c.show(),u&&(this.layerHideTimer=setTimeout(function(){return n.hideToast()},l))}},{key:"hideToast",value:function(){clearTimeout(this.layerHideTimer),this.domLayer.layerHide(),this.popupArray.forEach(function(e){return e.hide()})}},{key:"checkAndGetMotionType",value:function(e){return isNaN(e)?x.MOTION.PVT_ON:xt.apply(void 0,[parseInt(e,10)].concat(qv(this.motionTypeRange)))}},{key:"changeMotionPreset",value:function(e){this.hideToast(),e=this.checkAndGetMotionType(e),this.setMotionPreset(e);var t=this.toastGuideText.motion[e];this.showToast(0,t),this.dispatch(i.FC_CHANGE_TYPE)}},{key:"getMotionType",value:function(){if(this.storage){var e=this.storage.getItem(this.storageKey);return e?this.checkAndGetMotionType(e):this.motionType}return this.motionType}},{key:"setMotionPreset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.MOTION.PVT_ON;this.motionType=this.checkAndGetMotionType(e),this.motionPreset=P[this.motionType],this.storage&&this.storage.setItem(this.storageKey,this.motionType)}},{key:"getMotionPreset",value:function(){return this.motionPreset}},{key:"checkAndGetQualityType",value:function(e){return e===x.QUALITY.HIGH?x.QUALITY.HIGH:x.QUALITY.LOW}},{key:"changeQualityPriority",value:function(e){this.hideToast(),e=this.checkAndGetQualityType(e),this.setQualityPriority(e);var t=this.toastGuideText.quality[e];this.showToast(1,t),this.dispatch(i.FC_CHANGE_TYPE)}},{key:"getQualityType",value:function(){if(this.storage){var e=this.storage.getItem(this.storageKey2);return e?this.checkAndGetQualityType(e):this.qualityType}return this.qualityType}},{key:"setQualityPriority",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.QUALITY.LOW;x.QUALITY.HIGH===e?(this.qualityType=x.QUALITY.HIGH,this.qualityPriority=S[this.qualityType],this.previewPreloadMaxCount=k.EXTEND):(this.qualityType=x.QUALITY.LOW,this.qualityPriority=S[this.qualityType],this.previewPreloadMaxCount=k.NORMAL),this.storage&&this.storage.setItem(this.storageKey2,this.qualityType)}},{key:"getQualityPriority",value:function(){return this.qualityPriority}},{key:"getPreviewPreloadMaxCount",value:function(){return this.previewPreloadMaxCount}}])&&Yv(n.prototype,r),a&&Yv(n,a),t}();function ty(e){return(ty="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ny(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ry(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function iy(e){return(iy=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ay(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oy(e,t){return(oy=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var sy=i,uy=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==ty(t)&&"function"!=typeof t?ay(e):t}(this,iy(t).call(this,sy.INTERACTION_CHANGED,sy.INTERACTION_IDLE,sy.ACTION,sy.KEEP_HOVER))).app=e,n.canvas=n.app.renderEngine.getGraphicsManager().canvas,n.container=n.app.renderEngine.getGraphicsManager().getContainer(),n.pixelRatio=n.app.renderView.getGraphicsManager().getPixelRatio(),n.isMouseInCanvas=!1,n.isBackMove=!1,n.continueStepCount=0,n.isBindedEvent=!1,n.actionSource=T.FROM_NULL,n.historyList=[],n.panoDragRotate=new Xh(n.app.renderEngine,n.app.renderView),n.panoScrollZoom=new rp(n.app.renderEngine,n.app.renderView),n.panoKeyAction=new op(n.app.renderEngine,n.app.renderView),n.panoClick=new up(n.app.renderEngine,n.app.renderView),n.panoOver=new cp(n.app.renderEngine,n.app.renderView),n.contextmenuListener=n.oncontextmenu.bind(ay(n)),n.mousedownDocListener=n.onmousedownDoc.bind(ay(n)),n.mousedownContainerListener=n.onmousedownContainer.bind(ay(n)),n.mouseupListener=n.onmouseup.bind(ay(n)),n.mousemoveDocListener=n.onmousemoveDoc.bind(ay(n)),n.mousemoveCanvasListener=n.onmousemoveCanvas.bind(ay(n)),n.mousewheelListener=n.onmousewheel.bind(ay(n)),n.keyupListener=n.onkeyup.bind(ay(n)),n.keydownListener=n.onkeydown.bind(ay(n)),n.mouseoutCanvasListener=n.onmouseoutCanvas.bind(ay(n)),n.mouseclickListener=n.onmouseclick.bind(ay(n)),n.mousedragstartListener=n.ondragstart.bind(ay(n)),n.positionTransition=new kp(e),n.viewpointTransition=new gp(e,{pan:e.pan,tilt:e.tilt,zoom:e.zoom}),n.uiManager=new Fv(e),n.chainAnimateTimer=-1,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oy(e,t)}(t,E),n=t,(r=[{key:"bindEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isBindedEvent||(this.enableHandlers(),this.enableMouseEvent(),e&&this.enableKeyEvent(),this.isBindedEvent=!0)}},{key:"unbindEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isBindedEvent&&(this.disableHandlers(),this.disableMouseEvent(),e&&this.disableKeyEvent(),this.isBindedEvent=!1)}},{key:"bindTransitionEvent",value:function(){var e=this,t=this.viewpointTransition,n=this.positionTransition;t.on(sy.VT_STEP,function(){e.uiManager.roadviewSpotUI.update(),e.dispatch(sy.INTERACTION_CHANGED)}),t.on(sy.VT_END,function(){e.uiManager.roadviewSpotUI.update(),e.dispatch(sy.INTERACTION_CHANGED)}),n.on(sy.PT_PREPARE,function(){e.app.isRoadviewMode()&&e.uiManager.roadviewIndicatorUI.clear()}),n.on(sy.PT_START,function(t,n){var r=n.current;e.app.isRoadviewMode()&&(e.uiManager.roadviewRouteUI.dataUpdate(r.to),e.continueStepCount++)}),n.on(sy.PT_STEP,function(){e.app.isRoadviewMode()&&e.uiManager.roadviewSpotUI.update()}),n.on(sy.PT_END,function(t,n){var r=n.current;e.app.isRoadviewMode()&&(e.uiManager.roadviewSpotUI.dataUpdate(r.to),e.uiManager.roadviewRoadNameUI.clear(),e.isBackMove?e.isBackMove=!1:(e.addHistory(r.from?r.from.panoId:e.app.panoInfo.getCurrentPanoId()),e.isBackMove=!1))}),n.on(sy.PT_IDLE,function(){e.panoKeyAction.isActive()?n.dispatchDelayedIdleEvent():(e.updateAppFeature(),e.panoKeyAction.onForceRelease(),e.app.panoDataManager.loadCancel(),e.resetTransition(),e.continueStepCount>=6&&e.actionSource===T.FROM_ARROW_CMD&&(e.actionSource=T.FROM_ARROW_CONTINUE_CMD),e.dispatch(sy.ACTION,{target:e.actionSource}),e.actionSource=T.FROM_NULL,e.continueStepCount=0,e.dispatch(sy.INTERACTION_IDLE),e.uiManager.repositionIndicator())})}},{key:"resetTransition",value:function(){this.positionTransition.reset(),this.viewpointTransition.reset()}},{key:"updateAppFeature",value:function(){var e=this.app.featureControl,t=e.getMotionPreset(),n=e.getPreviewPreloadMaxCount();this.positionTransition.setMaxPreloadCount(n),this.positionTransition.setDuration(t),this.viewpointTransition.setDuration(t),this.panoDragRotate.setActiveInertia(t),this.panoScrollZoom.setActiveInertia(t)}},{key:"enableHandlers",value:function(){this.panoDragRotate.enable(),this.panoScrollZoom.enable(),this.panoKeyAction.enable(),this.panoClick.enable(),this.panoOver.enable()}},{key:"disableHandlers",value:function(){this.panoDragRotate.disable(),this.panoScrollZoom.disable(),this.panoKeyAction.disable(),this.panoClick.disable(),this.panoOver.disable()}},{key:"enableMouseEvent",value:function(){var e=this.canvas,t=this.container;t.addEventListener("mousedown",this.mousedownContainerListener),document.addEventListener("mousedown",this.mousedownDocListener),document.addEventListener("mouseup",this.mouseupListener),document.addEventListener("mousemove",this.mousemoveDocListener),t.addEventListener("click",this.mouseclickListener),e.addEventListener("contextmenu",this.contextmenuListener),e.addEventListener("mousemove",this.mousemoveCanvasListener),e.addEventListener("wheel",this.mousewheelListener),e.addEventListener("mouseout",this.mouseoutCanvasListener),e.addEventListener("dragstart",this.mousedragstartListener)}},{key:"disableMouseEvent",value:function(){var e=this.canvas,t=this.container;t.removeEventListener("mousedown",this.mousedownContainerListener),document.removeEventListener("mousedown",this.mousedownDocListener),document.removeEventListener("mouseup",this.mouseupListener),document.removeEventListener("mousemove",this.mousemoveDocListener),t.removeEventListener("click",this.mouseclickListener),e.removeEventListener("contextmenu",this.contextmenuListener),e.removeEventListener("mousemove",this.mousemoveCanvasListener),e.removeEventListener("wheel",this.mousewheelListener),e.removeEventListener("mouseout",this.mouseoutCanvasListener),e.removeEventListener("dragstart",this.mousedragstartListener)}},{key:"enableKeyEvent",value:function(){window.addEventListener("keyup",this.keyupListener),window.addEventListener("keydown",this.keydownListener)}},{key:"disableKeyEvent",value:function(){window.removeEventListener("keyup",this.keyupListener),window.removeEventListener("keydown",this.keydownListener)}},{key:"addHistory",value:function(e){this.historyList.push(e)}},{key:"getHistory",value:function(){return this.historyList.pop()}},{key:"clearHistory",value:function(){this.historyList.length=0}},{key:"onkeyup",value:function(e){var t=this;this.app.isViewActive()&&this.panoKeyAction.isActive()&&this.app.isRoadviewMode()&&this.isMouseInCanvas&&(this.panoKeyAction.isForceReleased()&&this.positionTransition.isAnimating()||this.panoKeyAction.onKeyUp(e,function(e){e===t.panoKeyAction.types.VIEWPOINT&&(t.viewpointTransition.isInertiaActive()||t.viewpointTransition.inertialForceStop())}))}},{key:"onkeydown",value:function(e){var t=this;this.app.isViewActive()&&this.app.isRoadviewMode()&&!this.app.isCaptureMode()&&this.isMouseInCanvas&&(this.panoKeyAction.isForceReleased()&&this.positionTransition.isAnimating()||this.panoKeyAction.onKeyDown(e,function(e,n){var r=n.direction,i=n.featureInfo;if(e!==t.panoKeyAction.types.CAPTURE||t.positionTransition.isAnimating()){if(e!==t.panoKeyAction.types.RETURN||t.positionTransition.isAnimating())if(e!==t.panoKeyAction.types.FEATURE||t.positionTransition.isAnimating())if(e!==t.panoKeyAction.types.VIEWPOINT)e===t.panoKeyAction.types.MOVE&&(t.positionTransition.continuousMove(r),t.actionSource=T.FROM_ARROW_CMD);else{var a=[10,5,1];t.viewpointTransition.translateDelta(r.LEFT?-a[0]:r.RIGHT?a[0]:0,r.BOTTOM?-a[1]:r.TOP?a[1]:0,r.ZOOMOUT?-a[2]:r.ZOOMIN?a[2]:0)}else i.group===Jv?t.app.featureControl.changeMotionPreset(x.MOTION[i.key]):i.group===$v&&t.app.featureControl.changeQualityPriority(x.QUALITY[i.key]);else if(!t.isBackMove){var o=t.getHistory();o&&(t.actionSource=T.FROM_RETURN_CMD,t.isBackMove=!0,t.positionTransition.onestepMove(o))}}else t.app.capture()}))}},{key:"oncontextmenu",value:function(e){return e.preventDefault(),!1}},{key:"ondragstart",value:function(e){return e.preventDefault(),!1}},{key:"onmouseclick",value:function(e){var t=this;this.app.isCaptureMode()||(this.panoClick.isActive()&&this.panoClick.isMoved()?this.panoClick.reset():e.target!==this.canvas||this.positionTransition.isAnimating()||this.panoClick.onClick(e,function(e){var n=e.type,r=e.x,i=e.y;if("short"===n){var a=t.app.getPanoData();if(t.positionTransition.reset(),!t.uiManager.panoOverlayUI.clickOverlay(r,i)&&t.app.isRoadviewMode()){var o=t.uiManager.roadviewSpotUI.clickSpot(r,i);if(o)t.positionTransition.onestepMove(o),t.actionSource=T.FROM_SPOT;else{if(t.app.isCompareMode())return;var s=t.app.getRay(r,i);t.uiManager.roadviewIndicatorUI.update(s);var u=t.uiManager.roadviewIndicatorUI.getNextStreet(),c=t.uiManager.roadviewIndicatorUI.getCursorPosition();if(u&&u.panoId!==a.panoId)t.positionTransition.onestepMove(u.panoId),t.actionSource=T.FROM_RANGE_GROUND;else if(!u&&c){var f=ny(c,2),h=f[0],p=f[1];t.app.getRangeDataForTargetPosition(h,p,35,10,l,function(e){var n=t.app.getRay(r,i);if(t.uiManager.roadviewIndicatorUI.searchNextStreet(n,c,a,e,!0)){var o=t.uiManager.roadviewIndicatorUI.getNextStreet();t.positionTransition.setDuration(P[x.MOTION.PVT_ON]),t.positionTransition.onestepMove(o.panoId)}else{var s=t.app.panoInfo.getRangesearch();if(t.uiManager.roadviewIndicatorUI.searchNextStreet(n,c,a,s,!1)){var u=t.uiManager.roadviewIndicatorUI.getNextStreet();t.positionTransition.setDuration(P[x.MOTION.PVT_ON]),t.positionTransition.onestepMove(u.panoId)}}t.actionSource=t.uiManager.roadviewIndicatorUI.getCursorStyle()===m.WALL?T.FROM_FAR_WALL:T.FROM_FAR_GROUND})}}}}}))}},{key:"onmousedownDoc",value:function(e){this.app.isCaptureMode()||!this.panoDragRotate.isActive()&&Wh(this.canvas,e,0,this.pixelRatio)&&(this.viewpointTransition.inertialStop(),this.panoDragRotate.onMouseDown(e))}},{key:"onmousedownContainer",value:function(e){this.app.isCaptureMode()||(e.stopPropagation(),!this.panoDragRotate.isActive()&&Wh(this.canvas,e,0,this.pixelRatio)&&(this.viewpointTransition.inertialStop(),this.panoDragRotate.onMouseDown(e)))}},{key:"onmouseup",value:function(e){this.app.isCaptureMode()||this.panoDragRotate.isActive()&&this.panoDragRotate.onMouseUp(e)}},{key:"onmousemoveDoc",value:function(e){var t=this;this.app.isCaptureMode()||(this.panoDragRotate.isActive()&&this.panoDragRotate.onMouseMove(e,function(){t.uiManager.roadviewSpotUI.update(),t.dispatch(sy.INTERACTION_CHANGED)}),this.positionTransition.isAnimating()||e.target===this.canvas||(this.uiManager.roadviewIndicatorUI.clear(),this.app.viewRender()))}},{key:"onmousemoveCanvas",value:function(e){var t=this;this.positionTransition.isAnimating()||this.app.isCaptureMode()||(this.isMouseInCanvas=!0,this.panoOver.isActive()&&this.panoOver.onOver(e,function(e){var n=e.type,r=e.x,i=e.y,a=t.app.getRay(r,i);if(t.app.changeMouseCursor("default"),"short"===n){if(!t.app.isCompareMode()&&t.uiManager.panoOverlayUI.overOverlay(r,i))return t.uiManager.roadviewIndicatorUI.clear(),t.uiManager.roadviewSpotUI.setHover(null),t.panoOver.clearKeepOverEvent(),t.app.viewRender(),void t.app.changeMouseCursor("pointer");if(t.app.isRoadviewMode()){if(t.uiManager.roadviewSpotUI.overSpot(r,i))return t.uiManager.roadviewIndicatorUI.clear(),t.panoOver.clearKeepOverEvent(),t.app.viewRender(),void t.app.changeMouseCursor("pointer");t.uiManager.roadviewSpotUI.setHover(null),t.uiManager.roadviewIndicatorUI.update(a)}t.app.viewRender()}else"long"===n&&t.app.isRoadviewMode()&&t.app.isDataUpdated()&&!t.positionTransition.isAnimating()&&!t.app.isCompareMode()&&(t.app.getPanoInfo().clearBuildingInfo(),t.app.getPanoInfo().createBuildingInfo(a,r,i)&&t.dispatch(sy.KEEP_HOVER))}))}},{key:"onmouseoutCanvas",value:function(e){var t=this;this.isMouseInCanvas=Wh(this.canvas,e,5,this.pixelRatio),!this.isMouseInCanvas&&this.panoKeyAction.isActive()&&(this.app.panoDataManager.loadCancel(),this.positionTransition.reset(),this.panoKeyAction.onForceRelease(function(e){e===t.panoKeyAction.types.MOVE&&(t.actionSource=T.FROM_ARROW_CMD)}))}},{key:"onmousewheel",value:function(e){var t=this;this.app.isCaptureMode()||this.panoScrollZoom.onWheel(e,function(){t.app.isCompareMode()||t.uiManager.roadviewSpotUI.update(),t.dispatch(sy.INTERACTION_CHANGED)})}}])&&ry(n.prototype,r),i&&ry(n,i),t}();function ly(e){return(ly="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cy(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fy(e,t){return!t||"object"!==ly(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function hy(e){return(hy=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function py(e,t){return(py=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var dy=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=fy(this,hy(t).call(this,"pastCompare",[r.RATIO_CHANGED,r.PAST_CHANGED,r.PAST_EMPTY,r.VIEWTYPE_CHANGED,r.SHOW,r.HIDE,r.RESIZE]))).app=e,n.interactionManager=e.interactionManager,n.uiManager=n.interactionManager.uiManager,n.pastPanoId=null,n.pastStreetIndex=0,n.pastList=[],n.prevPastPanoId=null,n.prevPastStreet=null,n.dimmedMove=!1,n.isMove=!0,n.loadedPastPanoId=null,n.loadedPastStreet=null,n.viewType="COMPARE",n.backupRatioCheck=!1,n.backupRatio=0,n.stepLastRatio=0,n.setRenderEngine(e.renderEngine),n.createRenderView("pastcompare",!1),n.app.addRenderpass("RV","roadview"),n.app.addRenderpass("PCOMP","past_compare"),n.app.addRenderpass("PCOMP_EMPTY","past_compare_empty"),n.app.addRenderpass("CC","capture_compare"),n.app.on(r.PANOID_CHANGED,function(){n.isViewActive()&&(n.pastList=n.app.getPanoData().getPastList())});var a=n.interactionManager;return a.positionTransition.on(i.PT_PREPARE,function(){n.isViewActive()&&n.setTileLock(!0,!0)}),a.positionTransition.on(i.PT_START,function(e,t){var r=t.past;if(n.isViewActive()){var i=r.to;n.setPanoData(i,!1,!1),n.isMove=!0,n.pastList=n.app.getPanoData().getPastList(),n.pastPanoId=i.panoId,n.pastPanoId===n.prevPastPanoId||i.isDummy?(n.dimmedMove=!0,n.app.changeRenderpass("PCOMP_EMPTY"),i.isDummy?(n.app.getPanoInfo().setCompareModeEmptyPast(!0),n.app.getPanoInfo().setCompareModeMoveOpacity(.1)):(n.app.getPanoInfo().setCompareModeEmptyPast(!1),n.app.getPanoInfo().setCompareModeMoveOpacity(.5))):(n.dimmedMove=!1,n.app.changeRenderpass("PCOMP"),n.app.getPanoInfo().setCompareModeEmptyPast(!1),n.app.getPanoInfo().setCompareModeMoveOpacity(1),n.prevPastStreet=i,n.prevPastPanoId=n.pastPanoId)}}),a.positionTransition.on(i.PT_END,function(){n.isViewActive()&&n.isMove&&(n.getPanoData().isDummy?n.dispatch(r.PAST_EMPTY):n.dispatch(r.PAST_CHANGED))}),a.on(i.INTERACTION_IDLE,function(){n.isViewActive()&&(n.isMove=!1,n.dimmedMove?n.pastPanoId&&!n.getPanoData().isDummy&&n.loadShapeForChange(n.getPanoData()):(w.isWalk(n.getPanoData().shotTool)?n.setTileLock(!1,!0):n.setTileLock(!1,!1),n.updateTile()))}),n.createEngineLoader("urls.json","pano_compare_config.json").load(function(){var e=n.renderView.getSceneManager();n.previewLayer=e.getLayer("past_preview_layer"),n.tileLayer=e.getLayer("past_tile_layer"),n.maskLayer=e.getLayer("past_mask_layer"),n.emptyLayer=e.getLayer("past_empty_overlay");var t=n.app.renderView.getSceneManager();e.setCamera(t.getCamera()),t.addLayer(n.previewLayer,n.tileLayer,n.maskLayer,n.emptyLayer),n.setCommonVars()}),n.ceremonyAnimator=new Oh({step:function(e){var t=e[0];n.app.getPanoInfo().setCompareModeRatio(t),n.app.viewRender(),n.dispatch(r.RATIO_CHANGED)},easing:[xh]}),n.ceremonyAnimator2=new Oh({step:function(e){var t=e[0];n.app.getPanoInfo().setSplitModeRatio(t),n.app.viewRender()},done:function(){n.dispatch(r.VIEWTYPE_CHANGED)},duration:500,easing:[xh]}),n.blendAnimator=new Oh({from:[1],to:[0],step:function(e){var t=e[0],r=n.previewLayer.animatedShapeList[0];r&&(r.materialPool[0].setDiffuseColor(0,0,0,t),n.app.viewRender())},done:function(){n.previewLayer.animatedShapeList.splice(0,1),setTimeout(function(){return n.updateTile(!0)},100)},duration:300,easing:[Th]}),n}var n,a,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&py(e,t)}(t,Ah),n=t,(a=[{key:"loadShapeForChange",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;this.setPanoData(e,!1,!1),this.pastPanoId=e.panoId,this.pastList=this.app.getPanoData().getPastList();var a=e;n||(this.tileLayer.clearShape(),this.previewLayer.clearShape()),this.getPreviewShape(a,S.LOW,function(e,o){e&&("function"==typeof i&&i(e,a),t.app.changeRenderpass("PCOMP"),t.app.getPanoInfo().setCompareModeEmptyPast(!1),t.app.getPanoInfo().setCompareModeMoveOpacity(1),t.dimmedMove=!1,n||(w.isWalk(t.getPanoData().shotTool)?t.setTileLock(!1,!0):t.setTileLock(!1,!1),t.updateTile()),t.loadedPastStreet=t.prevPastStreet=a,t.loadedPastPanoId=t.prevPastPanoId=t.pastPanoId,t.activeView(),t.isMove=!1,t.dispatch(r.PAST_CHANGED))})}},{key:"loadShapeForTransition",value:function(e,t){var n=this;if(!this.isViewActive())return t(null,null);var r=e.getPastPanoId(this.pastStreetIndex,this.loadedPastStreet&&this.loadedPastStreet.dateYear),i=e.getPastStreet(r);i.isDummy?(i.imagePath=this.loadedPastStreet.imagePath,i.imagePathForTile=this.loadedPastStreet.imagePathForTile,i.rotation=this.loadedPastStreet.rotation,i.date=this.loadedPastStreet.date,i.dateYear=this.loadedPastStreet.dateYear,this.getPreviewShape(i,S.LOW,function(e,r){n.loadedPastStreet=i,t(e,i)})):this.loadedPastPanoId===r?this.getPreviewShape(i,S.LOW,function(e,r){n.loadedPastStreet=i,t(e,i)}):this.getPreviewShape(i,S.LOW,function(e,a){n.loadedPastPanoId=r,n.loadedPastStreet=i,t(e,i)})}},{key:"getPanoId",value:function(){return this.getPanoData().isDummy?null:this.getPanoData().panoId}},{key:"getDate",value:function(){var e=this,t=this.pastList.filter(function(t){return t.panoId===e.pastPanoId})[0];return t?t.date:null}},{key:"getPastList",value:function(){return this.pastList}},{key:"isActive",value:function(){return this.app.isEngineInit()&&this.app.isViewActive()&&this.isViewActive()}},{key:"show",value:function(e){var t=this;if((e="number"!=typeof e?parseInt(e,10):e)&&this.app.isRoadviewMode()&&this.app.isIdle()){this.pastStreetIndex=this.app.getPanoData().getPastStreetIndex(e);var n=this.app.getPanoData().getPastStreet(e),i=this.isViewActive();this.loadShapeForChange(n,i,function(e,n){if(t.isViewActive())t.previewLayer.animatedShapeList[1]=e,t.app.stopAnimation(t.blendAnimator),t.blendAnimator.reset(),t.app.startAnimation(t.blendAnimator),t.tileLayer.clearShape();else{t.app.hideOverlay(),t.app.compareMode=!0,t.renderView.getSceneManager().getTerrain().enable(),t.renderView.setVisible(!0);t.ceremonyAnimator.from=[0],t.ceremonyAnimator.to=[.5],t.ceremonyAnimator.duration=500,t.ceremonyAnimator.doneCallback=function(){t.app.getPanoInfo().setCompareModeRatio(.5),t.dispatch(r.SHOW)},t.ceremonyAnimator.reset(),t.app.startAnimation(t.ceremonyAnimator)}})}}},{key:"hide",value:function(){var e=this,t=this.getRatio(),n=1e3*t;this.ceremonyAnimator.from=[t],this.ceremonyAnimator.to=[0],this.ceremonyAnimator.duration=n,this.ceremonyAnimator.doneCallback=function(){e.renderView.getSceneManager().getTerrain().disable(),e.prevPastPanoId=null,e.prevPastStreet=null,e.pastStreetIndex=0,e.setPanoData(null,!1,!1),e.pastPanoId=null,e.pastList=[],e.deactiveView(),e.renderView.setVisible(!1),e.app.compareMode=!1,e.app.changeRenderpass("RV"),e.app.viewRender(),e.app.showOverlay(),e.dispatch(r.HIDE)},this.ceremonyAnimator.reset(),this.app.startAnimation(this.ceremonyAnimator),"SPLIT"===this.viewType&&(this.ceremonyAnimator2.from=[2],this.ceremonyAnimator2.to=[1],this.ceremonyAnimator2.duration=.8*n,this.ceremonyAnimator2.reset(),this.app.startAnimation(this.ceremonyAnimator2),this.viewType="COMPARE")}},{key:"getViewType",value:function(){return this.viewType}},{key:"setRatio",value:function(e){this.isRoadviewMode()&&"SPLIT"!==this.viewType&&(e=xt(e="number"!=typeof e?parseFloat(e):e,0,1),this.app.getPanoInfo().setCompareModeRatio(e),this.app.viewRender())}},{key:"getRatio",value:function(){return this.app.getPanoInfo().getCompareModeRatio()}},{key:"changeCompareMode",value:function(){this.isViewActive()&&this.app.isRoadviewMode()&&"SPLIT"===this.viewType&&(this.ceremonyAnimator2.from=[2],this.ceremonyAnimator2.to=[1],this.ceremonyAnimator2.duration=500,this.ceremonyAnimator2.reset(),this.app.startAnimation(this.ceremonyAnimator2),this.viewType="COMPARE")}},{key:"changeSplitMode",value:function(){var e=this;if(this.isViewActive()&&this.app.isRoadviewMode()&&"COMPARE"===this.viewType){var t=this.getRatio();if(.5===t)this.ceremonyAnimator2.from=[1],this.ceremonyAnimator2.to=[2],this.ceremonyAnimator2.duration=500,this.ceremonyAnimator2.reset(),this.app.startAnimation(this.ceremonyAnimator2);else{var n=1e3*Math.abs(t-.5)*2;this.ceremonyAnimator.from=[t],this.ceremonyAnimator.to=[.5],this.ceremonyAnimator.duration=n,this.ceremonyAnimator.doneCallback=function(){e.setRatio(.5)},this.ceremonyAnimator.reset(),this.app.startAnimation(this.ceremonyAnimator),this.ceremonyAnimator2.from=[1],this.ceremonyAnimator2.to=[2],this.ceremonyAnimator2.duration=500,this.ceremonyAnimator2.reset(),this.app.startAnimation(this.ceremonyAnimator2)}this.viewType="SPLIT"}}},{key:"relayout",value:function(){this.isViewActive()&&this.isRoadviewMode()&&this.app.relayout()}},{key:"capture",value:function(){if(this.isViewActive()){var e="COMPARE"===this.viewType?"로드뷰_겹침_"+this.app.getPanoData().address:"로드뷰_분할_"+this.app.getPanoData().address,t=this.getPanoData().isDummy?"PCOMP_EMPTY":"PCOMP";this.uiManager.captureAndDownload(e,"CC",t)}}}])&&cy(n.prototype,a),o&&cy(n,o),t}();function vy(e){return(vy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function my(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gy(e,t){return!t||"object"!==vy(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function by(e){return(by=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wy(e,t){return(wy=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _y=function(e){function t(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=gy(this,by(t).call(this,"pastThumb",[r.PAST_CHANGED,r.PAST_EMPTY,r.SHOW,r.HIDE,r.RESIZE]))).app=e,a.interactionManager=e.interactionManager;var o=a.interactionManager;a.pastStreetIndex=0,a.pastPanoId=null,a.pastList=[],a.width=400,a.height=400,a.isTileLoad=!1,a.isEmpty=!1;var s=Date.now()%1e4,u=document.createElement("div");u.id="thumbnail_"+s,u.rcss=new Ve("#"+u.id),u.rcss.cssText("width:100%;height:100%;display:none");var l=document.createElement("div");l.id="viewer_"+s,a.internalDomLayer=new Bh(l,"thumb"),a.internalDomLayer.layerHide(),a.toastPopup=null,a.element=u,a.element.appendChild(l),a.relayoutFrameRequested=!0,a.createRenderEngine(l,!1,function(){a.isContextLost()?a.app.handleCtxLost("장시간 미사용 또는 일시적인 오류로 인해 과거사진을 볼 수 없습니다.\n브라우저를 새로고침 해주세요."):a.app.handleCtxRestore()}),a.createRenderView("thumb"),a.addRenderpass("thumb","thumbnail"),a.renderEngine.start(),o.positionTransition.on(i.PT_START,function(){a.isViewActive()&&(a.pastList=a.app.getPanoData().getPastList())}),o.on(i.INTERACTION_CHANGED,function(){if(a.isViewActive()&&!a.isEmpty){var e=a.app.renderView.getSceneManager().getCamera(),t=a.renderView.sceneManager.getCamera();t.setPanTilt(e.pan*Tt,e.tilt*Tt),t.setFovy(e.fovy*Tt)}}),o.on(i.INTERACTION_IDLE,function(){a.isViewActive()&&(a.pastPanoId=a.app.getPanoData().getPastPanoId(a.pastStreetIndex,a.getPanoData()&&a.getPanoData().dateYear),a.pastList=a.app.getPanoData().getPastList(),a.setPanoData(a.app.getPanoData().getPastStreet(a.pastPanoId),!1,!1),a.pastPanoId&&a.pastList.length>0?a.loadShapeForChange(a.getPanoData(),!1,function(){a.isEmpty=!1,a.internalDomLayer.layerHide(),a.renderView.setVisible(!0),a.resume(),a.relayout(),a.dispatch(r.PAST_CHANGED)}):(a.isEmpty=!0,a.internalDomLayer.layerShow(),a.pause(),a.renderView.setVisible(!1),a.dispatch(r.PAST_EMPTY)))}),o.positionTransition.on(i.PT_PREPARE,function(){a.isViewActive()&&a.pause()});var c=a.createEngineLoader("urls.json","pano_thumb_config.json"),f=n(60).images[1];return c.addImage(f.name,f.url),c.load(function(){a.createdEmptyToast();var e=a.renderView.getSceneManager();a.previewLayer=e.getLayer("panothumb_preview_layer"),a.tileLayer=e.getLayer("panothumb_tile_layer"),a.maskLayer=e.getLayer("panothumb_mask_layer"),a.changeRenderpass("thumb"),a.setCommonVars(),a.setTileLock(!0,!1),a.initEngine(),a.renderEngine.stop()}),a.blendAnimator=new Oh({from:[1],to:[0],step:function(e){var t=e[0],n=a.previewLayer.animatedShapeList[0];n&&(n.materialPool[0].setDiffuseColor(0,0,0,t),a.viewRender())},done:function(){a.previewLayer.animatedShapeList.splice(0,1),a.updateTile(!0)},duration:300,easing:[Th]}),a.wrap=l,a}var a,o,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wy(e,t)}(t,Ah),a=t,(o=[{key:"loadShapeForChange",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;this.setPanoData(e,!1,!1),this.pastPanoId=e.panoId,this.pastList=this.app.getPanoData().getPastList(),n||(this.tileLayer.clearShape(),this.previewLayer.clearShape(),this.maskLayer.clearShape());var i=this.app.renderView.getSceneManager().getCamera(),a=this.renderView.getSceneManager().getCamera();this.getPreviewShape(e,S.LOW,function(o,s){if(n)t.previewLayer.animatedShapeList[1]=o,t.app.stopAnimation(t.blendAnimator),t.blendAnimator.reset(),t.app.startAnimation(t.blendAnimator),t.tileLayer.clearShape();else{var u=yy(i.position,3),l=u[0],c=u[1],f=u[2];a.setTarget(l,c,f),a.setDistance(3),a.setPanTilt(i.pan*Tt,i.tilt*Tt),a.setFovy(i.fovy*Tt),t.setPanoData(e,!1,!1),t.updateTile(!0)}"function"==typeof r&&r()})}},{key:"createdEmptyToast",value:function(){var e=Date.now()%1e4,t=document.createElement("div");t.id="toastBox_"+e,t.rcss=new Ve("#"+t.id);var n=this.renderEngine.getAsset("empty_toast").source;n.id="toastImage_"+e;var r=document.createElement("p");r.id="toastText_"+e,t.rcss.cssText("width:300px;text-align:center"),n.rcss=new Ve("#"+n.id),r.rcss=new Ve("#"+r.id),r.rcss.cssText("color:#fff;font-size:15px;text-align:center;line-height:31px"),r.rcss.set("font-family",'AppleSDGothicNeo-Regular,"Malgun Gothic","맑은 고딕",dotum,"돋움",sans-serif'),r.innerText="과거 로드뷰가 존재하지 않는 위치입니다.",t.appendChild(n),t.appendChild(r),this.toastPopup=new zv({content:t}),this.toastPopup.wrap.style.cssText="position:absolute;display:block",this.toastPopup.wrap.style.left=this.width/2-150+"px",this.toastPopup.wrap.style.top=this.height/2-30+"px",this.internalDomLayer.addBoard(this.toastPopup),this.internalDomLayer.layerHide()}},{key:"updateEmptyToast",value:function(){this.toastPopup.wrap.style.left=this.width/2-150+"px",this.toastPopup.wrap.style.top=this.height/2-30+"px"}},{key:"setSize",value:function(e,t){this.isEngineInit()&&this.isViewActive()&&(this.width=e=xt(e,0,_.MAX_WIDTH),this.height=t=xt(t,0,_.MAX_HEIGHT),this.wrap.rcss.set("width",e===_.MAX_WIDTH?e+"px":"100%"),this.wrap.rcss.set("height",t===_.MAX_HEIGHT?t+"px":"100%"),this.updateEmptyToast(),this.toggleTile(e,t),this.dispatch(r.RESIZE))}},{key:"toggleTile",value:function(e,t){this.isEngineInit()&&this.pastPanoId&&(e>_.TH_WIDTH||t>_.TH_HEIGHT?this.isTileLoad||(this.tileLayer.strategy.enable(),this.tileLayer.setVisible(!0),SHOT_TOOL.isWalk(this.getPanoData().shotTool)?this.setTileLock(!1,!0):this.setTileLock(!1,!1),this.updateTile(!0),this.isTileLoad=!0):this.isTileLoad&&(this.tileLayer.strategy.disable(),this.tileLayer.setVisible(!1),SHOT_TOOL.isWalk(this.getPanoData().shotTool)?this.setTileLock(!0,!0):this.setTileLock(!0,!1),this.isTileLoad=!1))}},{key:"reset",value:function(){this.pastPanoId=null,this.pastStreetIndex=0,this.clearPanoData()}},{key:"pause",value:function(){this.renderView.getSceneManager().getTerrain().setGlobalOpacity(.5),this.viewRender()}},{key:"resume",value:function(){this.renderView.getSceneManager().getTerrain().setGlobalOpacity(1),this.viewRender()}},{key:"isAttached",value:function(){return!!this.element.parentNode}},{key:"getPanoId",value:function(){return this.getPanoData().isDummy?null:this.getPanoData().panoId}},{key:"getDate",value:function(){var e=this,t=this.pastList.filter(function(t){return t.panoId===e.pastPanoId})[0];return t?t.date:null}},{key:"getPastList",value:function(){return this.pastList}},{key:"getElement",value:function(){return this.isEngineInit()?this.element:null}},{key:"show",value:function(e){var t=this;if(this.isAttached()&&this.app.isRoadviewMode()&&this.app.isIdle()){if(this.internalDomLayer.layerHide(),!(e="number"!=typeof e?parseInt(e,10):e))return this.showEmpty();this.pastStreetIndex=this.app.getPanoData().getPastStreetIndex(e);var n=this.app.getPanoData().getPastStreet(e);if(n){var i=0!==this.previewLayer.animatedShapeList.length;this.loadShapeForChange(n,i,function(){t.activeView(),t.element.rcss.set("display","block"),t.renderView.setVisible(!0),t.resume(),t.dispatch(r.SHOW),t.dispatch(r.PAST_CHANGED),t.relayout()}),this.renderEngine.start()}}}},{key:"hide",value:function(){this.pastPanoId=null,this.pastStreetIndex=0,this.deactiveView(),this.clearPanoData(),this.previewLayer.clearShape(),this.tileLayer.clearShape(),this.maskLayer.clearShape(),this.renderView.setVisible(!1),this.renderEngine.stop(),this.element.rcss.set("display","none"),this.dispatch(r.HIDE)}},{key:"showEmpty",value:function(){this.activeView(),this.isEmpty=!0,this.pastPanoId=null,this.pastStreetIndex=0,this.clearPanoData(),this.previewLayer.clearShape(),this.tileLayer.clearShape(),this.maskLayer.clearShape(),this.internalDomLayer.layerShow(),this.element.rcss.set("display","block"),this.renderView.setVisible(!0),this.renderEngine.start(),this.pause(),this.relayout(),this.dispatch(r.SHOW),this.dispatch(r.PAST_EMPTY)}},{key:"relayout",value:function(){var e=this;this.isAttached()&&this.isEngineInit()&&this.isViewActive()&&this.relayoutFrameRequested&&(this.renderEngine.requestRenderFrame(function(){e.relayoutFrameRequested=!0;var t=e.element.getBoundingClientRect(),n=t.width,r=t.height;n>0&&r>0&&e.renderView.setViewport(0,0,n,r,!0)&&e.setSize(n,r)}),this.relayoutFrameRequested=!1)}},{key:"isActive",value:function(){return this.app.isEngineInit()&&this.isEngineInit()&&this.app.isViewActive()&&this.isViewActive()}}])&&my(a.prototype,o),s&&my(a,s),t}();function Ty(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function xy(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Sy=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.app=t,this.projRay=new Fn}var t,n,r;return t=e,(n=[{key:"unproject",value:function(e){var t=e.x,n=e.y;this.app.renderView.constructRayThroughPixel(this.projRay,[t,n]);var r=this.app.getPanoInfo().getDepthmap().getDataFromDirection(this.projRay.dir),i=3;r&&(i=r.depth);var a=this.projRay.pos,o=this.projRay.dir;return{x:ps(a[0]+o[0]*i),y:ps(a[1]+o[1]*i),z:a[2]+o[2]*i}}},{key:"project",value:function(e){var t=e.x,n=e.y,r=e.z,i=void 0===r?3:r,a=1/this.app.renderView.getGraphicsManager().getPixelRatio(),o=Ty(this.app.renderView.project([ds(t),ds(n),i]),3);return{x:o[0]*a,y:o[1]*a,z:o[2]*a}}}])&&xy(t.prototype,n),r&&xy(t,r),e}();function ky(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Py=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=t.list[0];this.links=[],r.sections.forEach(function(e){var t;(t=n.links).push.apply(t,ky(e.links))}),this.nodes=r.nodes,this.bound=r.bound};function Oy(e){return(Oy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ey(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Iy(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function My(e){return(My=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Cy(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ry(e,t){return(Ry=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ay=[[],[]],Ly=function(e){function t(e){var a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=o.storeId,c=void 0===l?null:l,f=o.storePanoId,h=void 0===f?null:f,p=o.panoId,d=void 0===p?null:p,v=o.pan,y=void 0===v?0:v,m=o.tilt,g=void 0===m?0:m,b=o.zoom,_=void 0===b?0:b,S=o.serviceName,k=void 0===S?"Roadview":S,P=o._keyEvent,O=void 0===P||P;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=function(e,t){return!t||"object"!==Oy(t)&&"function"!=typeof t?Cy(e):t}(this,My(t).call(this,"panorama",[r.CTX_LOST,r.INIT,r.PANOID_CHANGED,r.PANOID_EMPTY,r.PANOID_LEFT,r.PANOID_MOVE,r.VIEWPOINT_CHANGED,r.BUILDING_DETECTED,r.SPOT_MOVED,r.KEYBOARD_MOVED,r.KEYBOARD_MOVED_CONTINUE,r.RETURN_MOVED,r.SMART_MOVED,r.SMART_MOVED_FAR,r.SMART_MOVED_FAR_WALL,r.CAPTURE,r.MT,r.QT]))).viewpoint={pan:y,tilt:g,zoom:_},a.options={panoId:d,storeId:c,storePanoId:h,serviceName:k,keyEvent:O},a.createRenderEngine(e,!1,function(){a.isContextLost()?a.handleCtxLost("장시간 미사용 또는 일시적인 오류로 인해 로드뷰를 사용할 수 없습니다.\n브라우저를 새로고침 해주세요."):a.handleCtxRestore()}),a.createRenderView("current"),a.addRenderpass("RV","roadview"),a.addRenderpass("SV","storeview"),a.addRenderpass("CN","capture_normal");var E=a.createEngineLoader("urls.json","pano_config.json"),I=n(60),M=I.data,C=I.images,R=!0,A=!1,L=void 0;try{for(var D,N=M[Symbol.iterator]();!(R=(D=N.next()).done);R=!0){var F=D.value;E.addData(F.name,F)}}catch(e){A=!0,L=e}finally{try{R||null==N.return||N.return()}finally{if(A)throw L}}var j=C[0];return E.addImage(j.name,j.url),jh(function(){return E.load(function(){var t=a.renderView.getSceneManager();a.previewLayer=t.getLayer("pano_preview_layer"),a.tileLayer=t.getLayer("pano_tile_layer"),a.maskLayer=t.getLayer("pano_mask_layer"),a.setCommonVars(a.options),a.setGlobalAlpha(0),a.interactionManager=new uy(Cy(a)),a.interactionManager.bindTransitionEvent(),a.uiManager=a.interactionManager.uiManager,a.uiManager.enableCommon();var n=i,o=a.interactionManager;o.on(n.ACTION,function(e,t){if(a.isViewActive())switch(t.target){case T.FROM_SPOT:a.dispatch(r.SPOT_MOVED);break;case T.FROM_ARROW_CMD:a.dispatch(r.KEYBOARD_MOVED);break;case T.FROM_ARROW_CONTINUE_CMD:a.dispatch(r.KEYBOARD_MOVED_CONTINUE);break;case T.FROM_RETURN_CMD:a.dispatch(r.RETURN_MOVED);break;case T.FROM_RANGE_GROUND:a.dispatch(r.SMART_MOVED);break;case T.FROM_FAR_GROUND:a.dispatch(r.SMART_MOVED_FAR);break;case T.FROM_FAR_WALL:a.dispatch(r.SMART_MOVED_FAR_WALL);break;case T.FROM_CAPTURE:a.dispatch(r.CAPTURE)}}),o.on(n.INTERACTION_CHANGED,function(){a.isViewActive()&&(a.domLayer.update(),a.dispatch(r.VIEWPOINT_CHANGED))}),o.on(n.INTERACTION_IDLE,function(){a.isViewActive()&&(a.isRoadviewMode()?w.isWalk(a.getPanoData().shotTool)?a.setTileLock(!1,!0):a.setTileLock(!1,!1):a.setTileLock(!1,!0),a.updateTile(),a.isRoadviewMode()?(a.getPanoInfo().setGlobalRadius(s),a.updateDepthmapByPanoData(!0)):a.getPanoInfo().setGlobalRadius(u),a.clearPanoramaCache(),a.uiManager.showExtraCopyright(a.getPanoData().shotTool),a.dispatch(r.PANOID_CHANGED))}),o.on(n.KEEP_HOVER,function(){a.isViewActive()&&a.dispatch(r.BUILDING_DETECTED)}),o.positionTransition.on(n.PT_PREPARE,function(){a.isViewActive()&&(a.setTileLock(!0,!0),a.dispatch(r.PANOID_LEFT))}),o.positionTransition.on(n.PT_START,function(e,t){var n=t.current;a.isViewActive()&&a.isRoadviewMode()&&a.setPanoData(n.to,!0,!0)}),o.positionTransition.on(n.PT_STEP,function(){a.isViewActive()&&(a.updateDepthmapByPanoData(),a.domLayer.update(),a.dispatch(r.PANOID_MOVE))}),a.renderView.on("resize",function(){a.isViewActive()&&(a.domLayer.update(),a.uiManager.updateForResize())}),a.projection=new Sy(Cy(a)),a.pastThumb=new _y(Cy(a)),a.pastCompare=new dy(Cy(a)),a.domLayer=new Bh(e,"main"),a.domLayer.layerShow(),a.featureControl=new ey(Cy(a)),a.featureControl.on(i.FC_INIT_TYPE,function(){o.updateAppFeature();var e=a.featureControl.getMotionType();e!==x.MOTION.PVT_ON&&e!==x.MOTION.PVT_OFF||a.dispatch(r.MT,{type:e});var t=a.featureControl.getQualityType();a.dispatch(r.QT,{type:t})}),a.featureControl.on(i.FC_CHANGE_TYPE,function(){o.updateAppFeature()}),o.positionTransition.setupLayer(),a.initEngine(),a.setViewpoint(a.viewpoint),Dy(0)||(c?a.setStoreId(c,h):d&&a.setPanoId(d)),a.dispatch(r.INIT)})}),a.renderEngine.start(),a.interactionManager=null,a.uiManager=null,a.domLayer=null,a.projection=null,a.pastThumb=null,a.pastCompare=null,a.featureControl=null,a.relayoutFrameRequested=!0,a.overlayList=new Set,a.activeRenderLoop=!1,a.loopActivationTimer=-1,a.loopActivationHandler=function(){a.activeRenderLoop=!1,a.interactionManager.unbindEvent(a.options.keyEvent)},a}var c,f,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ry(e,t)}(t,Ah),c=t,(f=[{key:"handleCtxLost",value:function(e){var t=this.featureControl;t&&t.showToast(2,e,{w:520,h:68},!0,1e4),this.dispatch(r.CTX_LOST)}},{key:"handleCtxRestore",value:function(){var e=this.featureControl;e&&e.hideToast()}},{key:"instanceRender",value:function(e){this.isEngineInit()&&!this.isContextLost()&&(!this.activeRenderLoop&&this.isViewActive()&&this.interactionManager.bindEvent(this.options.keyEvent),clearTimeout(this.loopActivationTimer),this.activeRenderLoop=!0,this.renderEngine.render(e),this.pastThumb.isContextLost()||this.pastThumb.renderEngine.render(e),this.loopActivationTimer=setTimeout(this.loopActivationHandler,100))}},{key:"loadShapeForTransition",value:function(e,t){var n=this,i=this.featureControl.getQualityPriority(),s=a===e.getDataType()?i:o===e.getDataType()?S.NONE:S.LOW;this.getPreviewShape(e,s,function(i,a){i?t(i,e):n.dispatch(r.PANOID_EMPTY)})}},{key:"isActive",value:function(){return this.isEngineInit()&&this.isViewActive()}},{key:"isIdle",value:function(){var e=this.interactionManager;return!(e.positionTransition.isAnimating()||e.viewpointTransition.isAnimating())}},{key:"release",value:function(){this.isEngineInit()&&this.isViewActive()&&(this.interactionManager.unbindEvent(this.options.keyEvent),this.interactionManager.resetTransition(),this.panoDataManager.loadCancel(),this.pastCompare.isViewActive()&&this.pastCompare.hide(),this.pastThumb.isViewActive()&&this.pastThumb.hide(),this.clearLayerShape(),this.setGlobalAlpha(0),this.viewRender(),this.clearPanoData(),this.deactiveView())}},{key:"setEnableKeyEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.getPanoData();t&&"boolean"==typeof e&&this.isRoadviewMode()&&(e?(this.interactionManager.enableKeyEvent(),this.options.keyEvent=!0):(this.interactionManager.disableKeyEvent(),this.options.keyEvent=!1))}},{key:"getViewType",value:function(){return this.isRoadviewMode()?"ROADVIEW":this.isStoreviewMode()?"STOREVIEW":null}},{key:"setPanoId",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e)if(this.isEngineInit()){var s=g;hs([n,i])&&(s=b,n=ds(n),i=ds(i));var u=this.panoDataManager,c=this.interactionManager;if(this.isViewActive()){if(this.getPanoId()===e)return;this.pastThumb.isViewActive()&&(this.pastThumb.reset(),this.pastThumb.pause()),c.positionTransition.reset(),u.loadSync(a,s,e,n,i,l,function(e){return c.positionTransition.loadShape(e,function(n){o||t.prepareFade();var r=0,i=0;t.isStoreviewMode()?(c.uiManager.enableRoadview(),t.options.keyEvent&&c.enableKeyEvent(),i=(r=t.getDistanceWithPosition(e.position))<100?2*r+1:0,t.getPanoInfo().setGlobalRadius(i)):(r=t.getDistanceWithPosition(e.position),i=t.getDepthWithPosition(e.position)),t.setPanoData(e,!0,!0),t.changeRenderpass("RV"),(o=!(r>.5*i)&&o)?c.positionTransition.setDuration(t.featureControl.getMotionPreset()):c.positionTransition.setDuration(P[x.MOTION.PVT_OFF]),c.positionTransition.start(!1),t.isFading()?t.startFadeInAnimation():t.setGlobalAlpha(1)})},function(){return t.dispatch(r.PANOID_EMPTY)})}else{this.prepareFade();var f=this.featureControl.getQualityPriority();u.loadInit(a,s,e,n,i,l,function(n){return t.getPreviewShape(n,f,function(i,a){if(i){t.prepareFade(),t.options.panoId=e,t.activeView(),t.updateViewport(),t.setPanoData(n,!0,!0);var o=Ey(n.position,3),s=o[0],u=o[1],l=o[2];c.bindEvent(t.options.keyEvent),c.uiManager.enableRoadview(),c.viewpointTransition.setPosition(s,u,l,!0),w.isWalk(t.getPanoData().shotTool)?t.setTileLock(!1,!0):t.setTileLock(!1,!1),t.updateTile(),t.changeRenderpass("RV"),t.uiManager.showExtraCopyright(t.getPanoData().shotTool),t.dispatch(r.PANOID_CHANGED),Dy(1),t.startFadeInAnimation(),t.featureControl.init()}else t.dispatch(r.PANOID_EMPTY)})},function(){return t.dispatch(r.PANOID_EMPTY)})}c.clearHistory()}else Ay[0].push(function(){t.setPanoId(e,n,i,!1)})}},{key:"getPanoId",value:function(){return this.isRoadviewMode()?this.getPanoData().panoId:null}},{key:"getNearestPanoId",value:function(e,t,n,r){var i=this;this.isEngineInit()?(e=ds(e),t=ds(t),this.getSimpleRangeData(e,t,n,35,l,function(e){var t=e.nodeList;e.nodeList.every(function(e){return e.isUnderpass})||(t=e.nodeList.filter(function(e){return!e.isUnderpass}));var n=t[0];n?r(n.panoId,ps(n.position[0]),ps(n.position[1])):r(null,null,null)})):Ay[0].push(function(){i.getNearestPanoId(e,t,n,r)})}},{key:"setStoreId",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e)if(this.isEngineInit()){var s=n?e+"_"+n:e,c=this.panoDataManager,f=this.interactionManager;if(this.isViewActive()){if(this.checkLoadStoreviewPanoId(e,n)){var h=9999,p=u,d=!1;this.getStoreId()!==e&&(this.clearLayerShape(),this.panoDataManager.loadCancel(),this.interactionManager.resetTransition(),d=!0),f.positionTransition.reset(),c.loadSync(o,null,s,null,null,function(e){return f.positionTransition.loadShape(e,function(n){(d||!d&&!i)&&t.prepareFade(),t.isRoadviewMode()?(t.pastThumb.isViewActive()&&t.pastThumb.hide(),t.pastCompare.isViewActive()&&t.pastCompare.hide(),f.uiManager.disableRoadview(),f.disableKeyEvent(),h=t.getDistanceWithPosition(e.position),p=2*h,t.getPanoInfo().setGlobalRadius(p)):(h=t.getDistanceWithPosition(e.position))>p?t.getPanoInfo().setGlobalRadius(h):t.getPanoInfo().setGlobalRadius(p),t.setPanoData(e,!0,!0),t.changeRenderpass("SV");var r=e.pan,o=e.tilt;i?(f.positionTransition.setDuration(t.featureControl.getMotionPreset()),f.viewpointTransition.setDuration(t.featureControl.getMotionPreset())):(f.positionTransition.setDuration(P[x.MOTION.PVT_OFF]),f.viewpointTransition.setDuration(P[x.MOTION.PVT_OFF])),f.positionTransition.start(!1),a&&f.viewpointTransition.setPanTiltZoom(r,o,null,!1),t.isFading()?t.startFadeInAnimation():t.setGlobalAlpha(1)})},function(){return t.dispatch(r.PANOID_EMPTY)})}}else this.prepareFade(),c.loadInit(o,null,s,null,null,l,function(i){return t.getPreviewShape(i,S.NONE,function(a,o){if(a){t.prepareFade(),t.options.storeId=e,t.options.storePanoId=n,t.activeView(),t.updateViewport(),t.setPanoData(i,!0,!0);var s=Ey(i.position,3),u=s[0],l=s[1],c=s[2],h=i.pan,p=i.tilt;f.bindEvent(!1),f.uiManager.disableRoadview(),f.viewpointTransition.setPosition(u,l,c,!0),f.viewpointTransition.setPanTiltZoom(h,p,null,!1),t.setTileLock(!1,!0),t.updateTile(),t.changeRenderpass("SV"),t.dispatch(r.PANOID_CHANGED),Dy(1),t.startFadeInAnimation(),t.featureControl.init()}else t.dispatch(r.PANOID_EMPTY)})},function(){return t.dispatch(r.PANOID_EMPTY)});f.clearHistory()}else Ay[0].push(function(){t.setStoreId(e,n)})}},{key:"getStoreId",value:function(){return this.isStoreviewMode()?this.getPanoData().storeId:null}},{key:"getStorePanoId",value:function(){return this.isStoreviewMode()?this.getPanoData().storePanoId:null}},{key:"setViewpoint",value:function(e){var t=this,n=e.pan,r=e.tilt,i=e.zoom,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isViewActive())return Ay[1].push(function(){t.setViewpoint({pan:n,tilt:r,zoom:i},!1)}),this.viewpoint.pan=n,this.viewpoint.tilt=r,void(this.viewpoint.zoom=i);var o=this.interactionManager.viewpointTransition,s=o.getPanTiltZoom();n=isNaN(n)?s[0]:parseInt(n,10),r=isNaN(r)?s[1]:parseInt(r,10),i=isNaN(i)?s[2]:parseInt(i,10),s[0]===n&&s[1]===r&&s[2]===i||(a?o.setDuration(P[0]):o.setDuration(P[1]),o.setPanTiltZoom(n,r,i,!0))}},{key:"getViewpoint",value:function(){var e=this.interactionManager.viewpointTransition;if(!e)return{pan:this.viewpoint.pan,tilt:this.viewpoint.tilt,zoom:this.viewpoint.zoom};var t=e.getPanTiltZoom();return{pan:t[0],tilt:t[1],zoom:t[2]}}},{key:"getPosition",value:function(){var e=this.interactionManager.viewpointTransition;if(!e)return{x:0,y:0,z:0};var t=e.getPosition();return{x:t[0],y:t[1],z:t[2]}}},{key:"addRoute",value:function(e){var t=this;if(this.isViewActive()){if(e){var n=new Py(e);this.getPanoInfo().setRouteData(n)}}else Ay[1].push(function(){t.addRoute(e)})}},{key:"removeRoute",value:function(){this.isViewActive()&&(this.getPanoInfo().setRouteData(null),this.viewRender())}},{key:"getBuildingInfo",value:function(){return this.getPanoInfo().getBuildingInfo()}},{key:"getPanoramaData",value:function(){return this.getPanoData()?this.getPanoramaAPIData():null}},{key:"getProjection",value:function(){return this.projection}},{key:"getPastThumbView",value:function(){return this.pastThumb}},{key:"getPastCompareView",value:function(){return this.pastCompare}},{key:"showOverlay",value:function(){this.domLayer.layerShow(),this.uiManager.visibleToggleMarker(!0)}},{key:"hideOverlay",value:function(){this.domLayer.layerHide(),this.uiManager.visibleToggleMarker(!1)}},{key:"addOverlay",value:function(e){var t=this;this.isViewActive()?(e.setTarget(this),"marker"===e.type?this.uiManager.addMarker(e):this.domLayer.addBoard(e),this.overlayList.add(e)):this.lazyExecQueue[1].push(function(){t.addOverlay(e)})}},{key:"removeOverlay",value:function(e){this.isViewActive()&&this.overlayList.has(e)&&(e.setTarget(null),"marker"===e.type?this.uiManager.removeMarker(e):this.domLayer.removeBoard(e),this.overlayList.delete(e))}},{key:"clearOverlay",value:function(e){if(this.isViewActive()){var t=[],n=!0,r=!1,i=void 0;try{for(var a,o=this.overlayList[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.setTarget(null),"marker"===s.type?t.push(s):this.domLayer.removeBoard(s)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}t.length>=1&&this.uiManager.clearMarkers(t,e),this.overlayList.clear()}}},{key:"getViewport",value:function(){var e=this.renderView.viewport;return{xpos:e.xpos,ypos:e.ypos,width:e.width,height:e.height}}},{key:"relayout",value:function(){var e=this;this.isViewActive()&&this.relayoutFrameRequested&&(this.renderEngine.requestRenderFrame(function(){e.relayoutFrameRequested=!0,e.updateViewport(),e.domLayer.update()}),this.relayoutFrameRequested=!1)}},{key:"capture",value:function(){if(this.isViewActive()&&!this.pastCompare.isViewActive()){var e=this.isRoadviewMode()?"로드뷰_"+this.getPanoData().address:"스토어뷰_"+this.getPanoData().place,t=this.isRoadviewMode()?"RV":"SV";this.uiManager.captureAndDownload(e,"CN",t),this.dispatch(r.CAPTURE)}}},{key:"setMotion",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.MOTION.PVT_ON;if(!isNaN(e)){var t=this.featureControl.checkAndGetMotionType(e);this.featureControl.changeMotionPreset(t)}}},{key:"setPreviewQuality",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.QUALITY.LOW;if("string"==typeof e){var t=this.featureControl.checkAndGetQualityType(e);this.featureControl.changeQualityPriority(t)}}},{key:"startAnimation",value:function(e){var t=this;this.renderEngine.requestRenderFrame(function(n){e.startTime=n,t.renderEngine.addAnimation(e)})}},{key:"stopAnimation",value:function(e){var t=this;this.renderEngine.requestRenderFrame(function(){t.renderEngine.cancelAnimation(e.id)})}}])&&Iy(c.prototype,f),h&&Iy(c,h),t}();function Dy(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=-1,n=!1,r=Ay[e].shift();return r&&(n=!0,t=setInterval(function(){r?("function"==typeof r&&r(),r=Ay[e].shift()):clearInterval(t)},1e3/60)),n}var Ny=0;var Fy=0;"undefined"!=typeof window&&(window.mvp={version:"1.5.5",supportWebGL:ss,supportGPUAcceleration:us,render:function(e,t){e&&e.instanceRender(t||Date.now())},Panorama:Ly,Marker:Rs,MarkerImage:function e(t){var n=t.image,r=void 0===n?null:n,i=t.width,a=void 0===i?0:i,o=t.height,s=void 0===o?0:o,u=t.spriteName,l=void 0===u?null:u,c=t.spriteOriginX,f=void 0===c?0:c,h=t.spriteOriginY,p=void 0===h?0:h,d=t.spriteWidth,v=void 0===d?0:d,y=t.spriteHeight,m=void 0===y?0:y,g=t.ratio,b=void 0===g?1:g,w=t.alpha,_=void 0===w?1:w;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.key="img_"+Ny++,this.type="image",this.image=r,this.width=a,this.height=s,this.isSprite=!!l,this.spriteOption={spriteName:l,spriteOriginX:f,spriteOriginY:p,spriteWidth:v,spriteHeight:m},this.ratio=b,this.alpha=_},MarkerText:function e(t){var n=t.text,r=void 0===n?"":n,i=t.size,a=void 0===i?12:i,o=t.color,s=void 0===o?"#fff":o,u=t.posX,l=void 0===u?0:u,c=t.posY,f=void 0===c?0:c,h=t.bold,p=void 0!==h&&h,d=t.alpha,v=void 0===d?1:d,y=t.strokeSize,m=void 0===y?0:y,g=t.strokeBlur,b=void 0===g?0:g,w=t.strokeColor,_=void 0===w?"#000":w,T=t.strokeAlpha,x=void 0===T?0:T,S=t.backgroundColor,k=void 0===S?"#000":S,P=t.backgroundAlpha,O=void 0===P?0:P,E=t.backgroundRadius,I=void 0===E?0:E,M=t.backgroundPaddingX,C=void 0===M?0:M,R=t.backgroundPaddingY,A=void 0===R?0:R;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.key="txt_"+Fy++,this.type="text",this.text=r,this.size=a,this.color=s,this.alpha=v,this.posX=l,this.posY=f,this.isBold=p,this.isStroke=0!==x,this.strokeOption={size:m,blur:b,color:_,alpha:x},this.isBackground=0!==O,this.backgroundOption={color:k,alpha:O,radius:I,paddingX:C,paddingY:A}},Billboard:zv,registerImageAsset:function(e,t){Fh.add(Dh.IMG,e,t)},registerJsonAsset:function(e,t){t.toLowerCase().indexOf("callback")>-1?Fh.add(Dh.JSONP,e,t):Fh.add(Dh.XHR,e,t)},getAsset:function(e){return Fh.assetTable.get(e)},loadAsset:jh})}]);